---
knit: "bookdown::render_book"
title: "The Epidemiologist R Handbook"  
description: "The Epi R Handbook is a R reference manual for applied epidemiology and public health."
author: "the handbook team"
date: "`r Sys.Date()`"
#url: 'https://github.com/nsbatra/Epi_R_handbook'
#twitter-handle: 
#cover-image: images/R_Handbook_Logo.png
site: bookdown::bookdown_site
# output: bookdown::gitbook:
#      config:
#           sharing:
#                twitter: yes
#                facebook: yes
#                whatsapp: yes
#                github: yes
documentclass: book
---

# output: bookdown::gitbook:

Placeholder


## R for applied epidemiology and public health {-}  
## How to use this handbook {-} 
## Acknowledgements {-}  
### Contributors {-}  
### Funding and support {-}  
### Inspiration {-}  
## Terms of Use and Contribution {-}  
### License {.unnumbered} 
### Citation {.unnumbered}
### Contribution {.unnumbered}  

<!--chapter:end:index.Rmd-->

# (PART) About this book {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_about_book.Rmd-->


# Editorial and technical notes { }

Placeholder


## Approach and style
### R packages {.unnumbered}
### Code style {.unnumbered}
### Nomenclature {.unnumbered}  
### Notes {.unnumbered} 
## Editorial decisions  
## Major revisions  
## Session info (R, RStudio, packages)  

<!--chapter:end:new_pages/editorial_style.Rmd-->


# Download handbook and data  

Placeholder


## Download offline handbook  
### Use download link {.unnumbered}  
### Use our R package {.unnumbered}  
## Download data to follow along  
### Use our R package {.unnumbered}  
### Download one-by-one {.unnumbered}  
#### Case linelist {.unnumbered}
#### Malaria count data {#data_malaria .unnumbered}  
#### Likert-scale data {.unnumbered}  
#### Flexdashboard {.unnumbered}  
#### Contact Tracing {.unnumbered} 
#### GIS {.unnumbered}  
#### Phylogenetic trees {.unnumbered}  
#### Standardization {.unnumbered}  
#### Time series and outbreak detection {#data_outbreak .unnumbered}  
#### Survey analysis {#data_survey .unnumbered}  
#### Shiny {#data_shiny .unnumbered}  

<!--chapter:end:new_pages/data_used.Rmd-->

# (PART) Basics {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_basics.Rmd-->


# R Basics {}

Placeholder


## Why use R?
## Key terms  
## Resources for learning {#learning}  
### Resources within RStudio {.unnumbered}  
### Cheatsheets {.unnumbered}
### Twitter {.unnumbered}  
### Free online resources {.unnumbered}  
### Languages other than English {.unnumbered}  
## Installation  
### R and RStudio {.unnumbered}  
### Other software you *may* need to install {.unnumbered} 
#### TinyTex {.unnumbered}  
#### Pandoc {.unnumbered}
#### RTools {.unnumbered}  
#### phantomjs {.unnumbered}  
## RStudio {#rstudio}
### RStudio orientation {.unnumbered}  
### RStudio settings {.unnumbered}  
### Keyboard shortcuts {.unnumbered}  
## Functions {#functions}  
### Simple functions {.unnumbered}  
### Functions with multiple arguments {.unnumbered}  
### Writing Functions {.unnumbered}  
## Packages {#packages}  
### Install and load {.unnumbered}  
#### Your library {.unnumbered}  
#### Install from CRAN {.unnumbered}  
#### How to install and load {.unnumbered}  
### Code syntax {.unnumbered}  
### Function help {.unnumbered}  
### Update packages {.unnumbered}  
### Delete packages {.unnumbered}
### Dependencies {.unnumbered}  
### Masked functions {.unnumbered}  
### Detach / unload {.unnumbered}  
### Install older version {.unnumbered}  
### Suggested packages {.unnumbered}  
## Scripts {#scripts}
### Commenting {.unnumbered}  
### Style {.unnumbered}  
### Example Script {.unnumbered}  
### R markdown {.unnumbered}
### R notebooks {.unnumbered}
### Shiny {.unnumbered}
### Code folding {.unnumbered}  
## Working directory  
### Recommended approach {.unnumbered}  
### Set by command {.unnumbered}
### Set manually {.unnumbered}  
### Within an R project {.unnumbered}
### Working directory in an R markdown {.unnumbered}
### Providing file paths {.unnumbered}  
## Objects {#objects}
### Everything is an object {.unnumbered} 
### Defining objects (`<-`) {.unnumbered}
### Object structure {.unnumbered}  
### Object classes  {.unnumbered}
### Columns/Variables (`$`) {.unnumbered}  
### Access/index with brackets (`[ ]`) {.unnumbered}  
### Remove objects {.unnumbered} 
## Piping (`%>%`)  
### **Pipes** {.unnumbered}
### Define intermediate objects {.unnumbered}
## Key operators and functions {#operators}
### Assignment operators {.unnumbered}  
### Relational and logical operators {.unnumbered}  
### Missing values {.unnumbered}
### Mathematics and statistics {.unnumbered}  
#### Mathematical operators {.unnumbered} 
#### Mathematical functions {.unnumbered}
#### Scientific notation {.unnumbered}
#### Rounding {.unnumbered}  
#### Statistical functions {.unnumbered}  
#### Other useful functions {.unnumbered}  
### `%in%` {.unnumbered}  
## Errors & warnings  
### Error versus Warning {.unnumbered}
### General syntax tips {.unnumbered}
### Code assists {.unnumbered}  

<!--chapter:end:new_pages/basics.Rmd-->


# Transition to R { }  

Placeholder


## From Excel  
### Benefits {.unnumbered}  
### Tidy data {.unnumbered}  
### Functions {.unnumbered}  
### Scripts {.unnumbered}  
### Excel-to-R resources {.unnumbered}
### R-Excel interaction {.unnumbered}  
## From Stata  
## From SAS  
## Data interoperability  

<!--chapter:end:new_pages/transition_to_R.Rmd-->


# Suggested packages

Placeholder


## Packages from CRAN  
## Packages from Github  

<!--chapter:end:new_pages/packages_suggested.Rmd-->


# R projects {}  

Placeholder


## Suggested use  
## Creating an R project {}
### Switch projects {.unnumbered}
### Settings {.unnumbered}  
### Organization {.unnumbered}  
### Version control {.unnumbered}  
## Examples  
## Resources {}

<!--chapter:end:new_pages/r_projects.Rmd-->


# Import and export {}

Placeholder


## Overview
## The **rio** package {}  
## The **here** package {#here}
## File paths  
### "Relative" file paths {.unnumbered}
### "Absolute" file paths {.unnumbered}  
### Select file manually {.unnumbered}
## Import data  
### Specific Excel sheets {.unnumbered}
### Missing values {#import_missing .unnumbered} 
### Skip rows {.unnumbered} 
### Manage a second header row {.unnumbered}  
#### Remove the second header row {.unnumbered}  
#### Make a data dictionary {.unnumbered}  
#### Combine the two header rows {.unnumbered}  
### Google sheets {.unnumbered}
## Multiple files - import, export, split, combine  
## Import from Github {#import_github}
### CSV files {.unnumbered}  
### XLSX files {.unnumbered}  
### Shapefiles {.unnumbered} 
## Manual data entry {}
### Entry by rows {.unnumbered}  
### Entry by columns {.unnumbered}  
### Pasting from clipboard {.unnumbered}  
## Import most recent file  
### Dates in file name {.unnumbered}  
### Use the file info {.unnumbered}  
## APIs {#import_api}
### HTTP request {.unnumbered}  
### Packages {.unnumbered}  
### Publicly-available data {.unnumbered}  
### Authentication required {.unnumbered}  
## Export {}  
### With **rio** package {.unnumbered}
### To clipboard {.unnumbered}
## RDS files {#import_rds}
## Rdata files and lists {#import_rdata}
## Saving plots {} 
## Resources {} 

<!--chapter:end:new_pages/importing.Rmd-->

# (PART) Data Management {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_data_management.Rmd-->


# Cleaning data and core functions {}

Placeholder


### Core functions {.unnumbered}  
### Nomenclature {.unnumbered}  
## Cleaning pipeline
## Load packages  
## Import data  
### Import {.unnumbered}  
### Review {.unnumbered}  
## Column names {} 
### Labels {.unnumbered}  
### Automatic cleaning {.unnumbered}  
### Manual name cleaning {.unnumbered}  
#### Rename by column position {.unnumbered} 
#### Rename via `select()` and `summarise()` {.unnumbered}  
### Other challenges {.unnumbered}  
#### Empty Excel column names {.unnumbered} 
#### Merged Excel column names and cells {.unnumbered}  
## Select or re-order columns {} 
### Keep columns {.unnumbered}  
### "tidyselect" helper functions {#clean_tidyselect .unnumbered}  
### Remove columns {.unnumbered} 
### Standalone {.unnumbered}
#### Add to the pipe chain {.unnumbered}  
## Deduplication
## Column creation and transformation { }
### New columns {.unnumbered}
### Convert column class {.unnumbered}
### Grouped data {.unnumbered}  
### Transform multiple columns {#clean_across .unnumbered}
#### `across()` column selection {.unnumbered}  
#### `across()` functions {.unnumbered}
### `coalesce()` {.unnumbered}  
### Cumulative math {.unnumbered}
### Using **base** R {.unnumbered}  
### Add to pipe chain {.unnumbered}  
## Re-code values
### Specific values {.unnumbered}  
### By logic {.unnumbered}
### Simple logic {.unnumbered}  
#### `replace()` {.unnumbered}  
#### `ifelse()` and `if_else()` {.unnumbered}  
### Complex logic {#clean_case_when .unnumbered}  
### Missing values {.unnumbered} 
### Cleaning dictionary {.unnumbered}
#### Add to pipe chain {.unnumbered}  
## Numeric categories {#num_cats}
### Review distribution {.unnumbered}
### `age_categories()` {.unnumbered}
### `cut()` {.unnumbered}
### Quantile breaks {.unnumbered}  
### Evenly-sized groups {.unnumbered}  
### `case_when()` { .unnumbered}
### Add to pipe chain {.unnumbered}  
## Add rows  
### One-by-one {.unnumbered}  
### Bind rows {.unnumbered}  
## Filter rows {  }
### Simple filter {.unnumbered} 
### Filter out missing values {.unnumbered}  
### Filter by row number {.unnumbered}  
### Complex filter {.unnumbered} 
#### Examine the data  {.unnumbered}  
#### How filters handle missing numeric and date values {.unnumbered}  
#### Design the filter {.unnumbered}  
### Standalone {.unnumbered}  
### Quickly review records {.unnumbered} 
#### Add to pipe chain {.unnumbered}  
## Row-wise calculations  
## Arrange and sort  

<!--chapter:end:new_pages/cleaning.Rmd-->


# Working with dates {}

Placeholder


## Preparation
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## Current date  
## Convert to Date  
### **base** R {.unnumbered}  
### **lubridate** {.unnumbered}  
### Combine columns {.unnumbered}  
## Excel dates
## Messy dates  
## Working with date-time class  
### Convert dates with times {.unnumbered}  
### Convert times alone {.unnumbered}  
### Extract time {.unnumbered}  
## Working with dates   
### Extract date components {.unnumbered}  
### Date math {.unnumbered}  
### Date intervals {.unnumbered}  
## Date display  
### `format()` {.unnumbered}  
### Month-Year {.unnumbered}  
## Epidemiological weeks {#dates_epi_wks}
### **lubridate** {.unnumbered}  
### Weekly counts {.unnumbered}  
### Epiweek alternatives {.unnumbered}  
## Converting dates/time zones
## Lagging and leading calculations  
## Resources  

<!--chapter:end:new_pages/dates.Rmd-->


# Characters and strings { }  

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
### Import data  {.unnumbered}  
## Unite, split, and arrange { }
### Combine strings {.unnumbered}
### Dynamic strings {.unnumbered}
### Unite columns  {#str_unite .unnumbered}
### Split {.unnumbered}  
### Split columns {.unnumbered}  
### Arrange alphabetically {.unnumbered} 
### base R functions {.unnumbered}
## Clean and standardise  
### Change case {.unnumbered}
### Pad length  {#str_pad .unnumbered}
### Truncate {.unnumbered} 
### Standardize length {.unnumbered}
### Remove leading/trailing whitespace {.unnumbered}  
### Remove repeated whitespace within {.unnumbered}  
### Wrap into paragraphs {.unnumbered}  
## Handle by position { }
### Extract by character position {.unnumbered}  
### Extract by word position {.unnumbered} 
### Replace by character position {.unnumbered} 
### Evaluate length  {.unnumbered}
## Patterns { }
### Detect a pattern {.unnumbered}
#### Convert commas to periods {.unnumbered}  
### Replace all {.unnumbered}  
### Detect within logic {.unnumbered}
### Locate pattern position {.unnumbered}  
### Extract a match {.unnumbered}  
### Subset and count {.unnumbered}  
### Regex groups {.unnumbered}
## Special characters  
## Regular expressions (regex) 
## Regex and special characters { } 
## Resources { }

<!--chapter:end:new_pages/characters_strings.Rmd-->


# Factors {}

Placeholder


## Preparation  
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
### New categorical variable {#fct_newcat .unnumbered}  
#### Create column {.unnumbered}  
#### Default value order {.unnumbered}  
## Convert to factor  
## Add or drop levels  
### Add {#fct_add .unnumbered}
### Drop {.unnumbered}  
## Adjust level order {#fct_adjust} 
### Manually {.unnumbered} 
### Within a plot {.unnumbered}  
### Reverse {.unnumbered}  
### By frequency {.unnumbered}  
### By appearance {.unnumbered}  
### By summary statistic of another column {.unnumbered}  
### By "end" value {.unnumbered}  
## Missing values {#fct_missing}  
## Combine levels  
### Manually {.unnumbered}  
### Reduce into "Other" {.unnumbered}  
### Reduce by frequency {.unnumbered}
## Show all levels  
### In plots {.unnumbered}  
### In tables {.unnumbered}  
## Epiweeks  
### Epiweeks in a plot {.unnumbered}  
### Epiweeks in the data {.unnumbered}  
## Resources {} 

<!--chapter:end:new_pages/factors.Rmd-->


# Pivoting data {}

Placeholder


## Preparation  
### Load packages {.unnumbered}  
### Import data {.unnumbered}
### Malaria count data {-}  
### Linelist case data {-}  
## Wide-to-long {}
### "Wide" format {.unnumbered}
### `pivot_longer()` {.unnumbered}
### Standard pivoting {.unnumbered}  
### Pivoting data of multiple classes {.unnumbered}
## Long-to-wide {}
### Data {.unnumbered}
### Pivot wider {.unnumbered}  
## Fill 
### Data {.unnumbered}
### `fill()` {.unnumbered}
## Resources  

<!--chapter:end:new_pages/pivoting.Rmd-->

# データをグループ化する

```{r, out.width=c('100%'), echo=F, message=F}
knitr::include_graphics(here::here("images", "Grouping_1500x500.png"))
```

このページでは、記述的分析のためにデータをグループ化および集約する方法について説明します。 **tidyverse** ファミリーのパッケージが一般的で機能が使いやすいため、これを使用します。

データのグループ化は、データ管理と分析のコアとなる要素です。グループ化されたデータは、グループごとに統計的に要約され、グループごとにプロットできます。**dplyr** パッケージ（**tidyverse** の一部）の関数を使用すると、グループ化とその後の操作が非常に簡単になります。

このページでは、次のトピックについて説明します：

-   `group_by()` 関数によるデータのグループ化\
-   データのグループ化を解除する\
-   グループ化されたデータを `summarise()` で統計的に要約\
-   `count()` と `tally()` の違い\
-   `arrange()` をグループ化されたデータに使う\
-   `filter()` をグループ化されたデータに使う\
-   `mutate()` をグループ化されたデータに使う\
-   `select()` をグループ化されたデータに使う\
-   **base** R の `aggregate()` コマンドを、代替として使う

<!-- ======================================================= -->

## 準備

### パッケージの読み込み {.unnumbered}

以下のコードは分析に必要なパッケージの読み込みを示しています。このハンドブックでは、pacman パッケージの`p_load()`を強調しています。これは、必要があればパッケージをインストールし、使用するためにロードします。 インストールされたパッケージを **base** R から `library()`でロードすることもできます。 R パッケージの詳細については、 [R basics] を参照してください。

```{r}
pacman::p_load(
  rio,       # データ読み込み
  here,      # to locate files ファイルを見つける
  tidyverse, # データをクリーニングして、処理して、プロットする (dplyr を含む)
  janitor)   # 列と行の合計を追加する
```

### データのインポート {.unnumbered}

エボラ出血熱の流行をシミュレートした症例のデータセットをインポートします。 もし同じようにやってみたければ、 <a href='https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>こちらをクリックしてクリーニングされたラインリストをダウンロードしてくださいclick </a> （.rds ファイルです）。 このデータセットは **rio** パッケージの `import()` 関数を使用してインポートされています。データをインポートするさまざまな方法については、 [Import and export] のページを参照してください。

```{r, echo=F}
linelist <- rio::import(here("data", "case_linelists", "linelist_cleaned.rds"))
```

```{r, eval=F}
linelist <- import("linelist_cleaned.rds")
```

`linelist` の最初の50 行：

```{r message=FALSE, echo=F}
DT::datatable(head(linelist,50), rownames = FALSE, filter="top", options = list(pageLength = 5, scrollX=T), class = 'white-space: nowrap' )
```

<!-- ======================================================= -->

## グループ化

**dplyr** の関数 `group_by()` は、指定された列の値によって、行をグループ化します。複数の列が指定されている場合は、列の値の組み合わせによって、行がグループ化されます。それぞれの一意の値（または値の組み合わせ）でグループが構成されます。その後のデータセットまたは計算への変更は、各グループ内で実行されます。

たとえば、次のコマンドは `linelist` を取得し、 `outcome`列の値で行をグループ化し、出力を新しいデータフレーム `ll_by_outcome` として保存します。グループ化する列は `group_by()` 関数の括弧内に書きます。

```{r}
ll_by_outcome <- linelist %>% 
  group_by(outcome)
```

`group_by()`を実行した後も**データセットに目に見える変化はないことに注意してください。** `mutate()`、 `summarise()`、 `arrange()` などの別のdplyr関数を「グループ化された」データフレームに適用するまで目に見える変化はありません。

ただし、データフレームを印刷することで、グループ化を「見る」ことができます。グループ化されたデータフレームを表示すると、それが [`tibble` class object](https://tibble.tidyverse.org/) に変換されていることがわかります。このオブジェクトを表示すると、適用されているグループ化とグループの数がヘッダー行のすぐ上に表示されます。

```{r}
# 表示して、アクティブなグループを確認
ll_by_outcome
```

### 一意のグループ {.unnumbered}

**作成されたグループは、グループ化された列全体の値の一意の組み合わせを反映しています。**

グループと各グループの行数を確認するには、グループ化されたデータを `tally()` に渡します。カウントなしで一意のグループだけを表示するには `group_keys()` に渡します。

下の例ではグループ化列 `outcome` の結果には、「Death」、「Recover」、`NA` の 3 つの一意の値があります。 `nrow(linelist %>% filter(outcome == "Death"))` の deaths, `nrow(linelist %>% filter(outcome == "Recover"))` の recover, `nrow(linelist %>% filter(is.na(outcome)))` の outcome の記録なしがあります。

```{r}
linelist %>% 
  group_by(outcome) %>% 
  tally()
```

複数の列でグループ化することもできます。下の例では、データフレームが `outcome` と `gender` ごとにグループ化され、集計されています。 `outcome` と `gender` の一意の組み合わせが、いずれかの列の欠測値も含めて、独自のグループとして登録されていることに注意してください。

```{r}
linelist %>% 
  group_by(outcome, gender) %>% 
  tally()
```

### 新しい列 {.unnumbered}

`group_by()` ステートメント内に新しいグループ化された列を作成することもできます。これは、 `group_by()` の前に `mutate()` を呼び出すのと同じです。簡単に集計するには、このスタイルが便利ですが、コードをわかりやすくするために、 `mutate()` ステップでこの列を作成してから、`group_by()` にパイプしてください。

```{r}
#  group_by() コマンド内で作成された2列にもとづくｃグループデータ
linelist %>% 
  group_by(
    age_class = ifelse(age >= 18, "adult", "child")) %>% 
  tally(sort = T)
```

### グループ化した列の追加／削除 {.unnumbered}

デフォルトでは、すでにグループ化されているデータに対して `group_by()` を実行すると、古いグループが削除され、新しいグループが適用されます。既存のグループに新しいグループを追加する場合は、引数に `.add = TRUE` を含めます。

```{r, eval=F}
# outcome毎にグループ化
by_outcome <- linelist %>% 
  group_by(outcome)

# さらに性別によるグループ化を追加
by_outcome_gender <- by_outcome %>% 
  group_by(gender, .add = TRUE)
```

\*\* すべてのグループをキープする \*\*

クラス因子の列でグループ化すると、現在データに存在しない因子のレベルが存在する可能性があります。この列でグループ化すると、デフォルトでは、存在しないレベルは削除され、グループとして含まれません。すべてのレベルが（データに存在しない場合でも）グループとして表示されるようにこれを変更するには、`group_by()` コマンドで `.drop = FALSE` を設定します。

## グループ化の解除 {.unnumbered}

グループ化されたデータは `ungroup()` でグループ化が解除されるまで、グループ化されたままになります。グループ化を解除するのを忘れると、計算が正しくなくなる可能性があります！\
以下は、すべてのグループを削除する例です。

```{r, eval=F}
linelist %>% 
  group_by(outcome, gender) %>% 
  tally() %>% 
  ungroup()
```

`ungroup()` 内に列名を書くと、特定の列のみのグループ化を削除することもできます。

```{r, eval=F}
linelist %>% 
  group_by(outcome, gender) %>% 
  tally() %>% 
  ungroup(gender) # gender によるグループ化を削除し、outcome によるグループ化を残す
```

**注：** `count()` 関数はカウントした後にデータのグループ化を自動的に解除します。

## 要約する(summarise) {#group_summarise}

`summarise()` を使用してサマリーテーブルを作成する方法の詳細については、 [Descriptive tables] ページの **dplyr** セクションを参照してください。ここではグループ化されたデータに適用したときに、その動作がどのように変化するかについて簡単に説明します。

**dplyr** 関数 `summarise()` （または `summarize()`）はデータフレームを受け取り、あなたの定義したサマリー統計量を含む、新しい要約データフレームに変換します。グループ化されていないデータフレームでは、サマリー統計量はすべての行から計算されます。グループ化されたデータに `summarise()` を適用すると、各グループのサマリー統計量が生成されます。

`summarise()` の構文は、以下に示すように、新しい要約列の名前、等号、およびデータに適用する統計関数を指定します。例えば `min()`、 `max()`、 `median()`、 `sd()` などです。統計関数の中に、操作する列と関連する引数を書きます（例：na.rm = TRUE）。 `sum()` を使用して、論理条件を満たす行の数を数えることもできます（== を使用します）。

以下は、グループ化されたデータなしで適用された `summarise()` の例です。返される統計は、データセット全体から生成されます。

```{r}
# グループ化されていないラインリストの要約統計量
linelist %>% 
  summarise(
    n_cases  = n(),
    mean_age = mean(age_years, na.rm=T),
    max_age  = max(age_years, na.rm=T),
    min_age  = min(age_years, na.rm=T),
    n_males  = sum(gender == "m", na.rm=T))
```

対照的に、以下はグループ化されたデータに適用される同じ `summarise()` ステートメントです。統計は `outcome` グループごとに計算されます。グループ化された列が新しいデータフレームにどのように引き継がれるかに注意してください。

```{r}
# summary statistics on grouped linelist
linelist %>% 
  group_by(outcome) %>% 
  summarise(
    n_cases  = n(),
    mean_age = mean(age_years, na.rm=T),
    max_age  = max(age_years, na.rm=T),
    min_age  = min(age_years, na.rm=T),
    n_males    = sum(gender == "m", na.rm=T))
```

[**ヒント**： summary 関数は、英国と米国の両方のスペルで機能します。summarise`()`と summary`()`は同じ関数を呼び出します。]{style="color: darkgreen;"}

## カウントと集計 （Counts and tallies）

`count()` と `tally()` は同じような機能を提供しますが、異なるものです。 　`count()` と `tally()` の違いについて詳しくは、[こちら](https://dplyr.tidyverse.org/reference/tally.html) をご覧ください。

### `tally()` {.unnumbered}

`tally()` は `summarise(n = n())` の省略形であり、データをグループ化しません。グループ化された集計をするには、 `group_by()` コマンドの後に書かないといけません。 `sort = TRUE` を追加すると、最大のグループが一番上に表示されます。

```{r}
linelist %>% 
  tally()
```

```{r}
linelist %>% 
  group_by(outcome) %>% 
  tally(sort = TRUE)
```

### `count()` {.unnumbered}

対照的に `count()` は次のことを行います:

1)  指定された列に `group_by()` を適応\
2)  `summarise()` を適用し、グループごとの行数が表示される `n` 列を返します\
3)  `ungroup()` を適応

```{r}
linelist %>% 
  count(outcome)
```

`group_by()` と同様に `count()` コマンド内で新しい列を作成できます。

```{r}
linelist %>% 
  count(age_class = ifelse(age >= 18, "adult", "child"), sort = T)
```

`count()` は「ロールアップ」機能を使用して複数回呼び出すことができます。たとえば、性別ごとに存在する病院の数を要約するには、次のようにします。わかりやすくするために、最後の列の名前が（`name  =` を使って）デフォルトの「n」から変更されていることに注意してください。

```{r}
linelist %>% 
  # 一意なoutcome - genderグループをカウントします
  count(gender, hospital) %>% 
  # 性別ごとに行を集計し（3）、性別ごとに病院の数を数えます（6）
  count(gender, name = "hospitals per gender" ) 
```

### 総数を追加する {.unnumbered}

`count()` と `summarise()` とは対照的に、`add_count()` を使用すると、[データフレームの他のすべての列を保持しつつ]{.ul}、グループごとの行数を含む新しい列 `n` を[追加]{.ul}できます。

新しい列 `n` のグループのカウント番号が、グループの各行に出力されます。デモンストレーションのために、この列を追加してから、見やすくなるように列を並べ替えています。他の例については、[filter on group size](#group_filter_grp_size)のセクションを参照してください。

```{r}
linelist %>% 
  as_tibble() %>%                   # 出力が綺麗になるようにtibbleに変換
  add_count(hospital) %>%           # 病院ごとのカウント列n を追加
  select(hospital, n, everything()) # デモ目的に列を並び替え
```

### 合計を追加する {.unnumbered}

`tally()` か `count()` を使用した後、合計行または列の[合計]{.ul}を簡単に追加するには、[Descriptive tables](#tbl_janitor) ページの **janitor** セクションを参照してください。このパッケージは `adorn_totals()` や `adorn_percentages()` のような、合計を追加し、パーセンテージを表示するような関数を提供します。以下は簡単な例です。

```{r}
linelist %>%                                  # 症例のラインリスト
  tabyl(age_cat, gender) %>%                  # 2 つの列の数をクロス集計
  adorn_totals(where = "row") %>%             # 合計行を追加
  adorn_percentages(denominator = "col") %>%  # 列の分母を使用して比率に変換
  adorn_pct_formatting() %>%                  # 比率をパーセントに変換
  adorn_ns(position = "front") %>%            # 「数（パーセント）」と表示
  adorn_title(                                # タイトルを調整
    row_name = "Age Category",
    col_name = "Gender")
```

より複雑な合計行、たとえば合計以外の要約統計量を含むようなものを追加するには、 [this section of the Descriptive Tables page](#tbl_dplyr_totals) を参照。

## 日付によるグループ化

データを日付でグループ化する場合は、対象の日付単位（たとえば「日」、「疫学週」、「月」など）の列が必要です。（なければ作成する）。この列は、「日付の操作」 [Working with dates] ページの [Epidemiological weeks section](#dates_epi_wks) セクションで説明されているように、**lubridate**の `floor_date()` を使用して作成することもできます。 この列があれば **dplyr**の `count()` を使用して、これらの一意の日付で行をグループ化し、カウントすることができます。

日付の処理に共通して、よく必要となる追加手順は、データに存在しない日付を追加して埋めることです。tidyr の `complete()` を使用すると、集計された日付系列の、範囲内のすべての日付単位に関して、日付が完全にそろいます。この手順がないと、ケースが報告されていない 一週間はデータに表示されないかもしれません！

`complete（）` 内で、日付列を最小から最大までの一連の日付 `seq.Date（）`として再定義します。したがって、日付が拡張されます。デフォルトでは、新しい「展開された」行のケースカウント値はNAになります。 `complete()` の引数 `fill =` と名前のリストを使用して、NA を 0 に設定できます。（counts列の名前が n であれば `fill = list(n = 0)` と書きます）\
詳細については `?complete` を、例については「日付の操作」 [Working with dates](#dates_epi_wks) ページを参照してください。

### ラインリストの症例を日でグループ化 {.unnumbered}

こちらは `complete()` を使用[せずに]{.ul}、症例を日数にグループ化する例です。最初の行で症例のない日をスキップすることに注意してください。

```{r}
daily_counts <- linelist %>% 
  drop_na(date_onset) %>%        # date_onset の値がないものを削除します
  count(date_onset)              # 一意な日付ごとの行数をカウントします
```

```{r message=FALSE, echo=F}
DT::datatable(daily_counts, rownames = FALSE, options = list(pageLength = 5, scrollX=T), class = 'white-space: nowrap' )
```

下の例では `complete()` コマンドを追加して、範囲内のすべての日が確実に表示されるようにしました。

```{r, eval=F}
daily_counts <- linelist %>% 
  drop_na(date_onset) %>%                 # date_onset 列の値がないものを削除します
  count(date_onset) %>%                   # 一意な日付ごとの行数をカウントします
  complete(                               # 症例がない日もすべて表示されるようにします
    date_onset = seq.Date(                # 列を日付シーケンスとして再定義します
      from = min(date_onset, na.rm=T), 
      to = max(date_onset, na.rm=T),
      by = "day"),
    fill = list(n = 0))  # 新しく行を追加して列 n に（デフォルトの NAの代わりに）0 を表示します
```

```{r message=FALSE, echo=F}
DT::datatable(daily_counts, rownames = FALSE, options = list(pageLength = 5, scrollX=T), class = 'white-space: nowrap' )
```

### ラインリストの症例を週でグループ化 {.unnumbered}

同じ原則を週にも適応できます。最初に「症例が発症した週」という新しい列を `floor_date()` と `unit = "week"` を使って作成します。 次に前述のように `count()` を使って週毎の症例数を集計します。最後に `complete()` で症例がなくて週もすべて表示します。

```{r}
# 週毎の症例数のデータセットを作る
weekly_counts <- linelist %>% 
  drop_na(date_onset) %>%                 # date_onset 列の値がないものを削除します
  mutate(week = lubridate::floor_date(date_onset, unit = "week")) %>%  # 発症した週という新しい列
  count(week) %>%                         # データを週毎にグループ化し、グループごとに行をカウントします。
  complete(                               # ケースがない場合でも、すべての日が表示されるようにします
    week = seq.Date(                      # 列を日付シーケンスとして再定義します
      from = min(week, na.rm=T), 
      to = max(week, na.rm=T),
      by = "week"),
    fill = list(n = 0))                   # 新しく行を追加して列 n に（デフォルトの NA の代わりに）0 を表示します
```

データフレームの最初の 50 行は次のとおりです：

```{r message=FALSE, echo=F}
DT::datatable(weekly_counts, rownames = FALSE, options = list(pageLength = 5, scrollX=T), class = 'white-space: nowrap' )
```

### ラインリストの症例を月でグループ化 {.unnumbered}

症例を月毎に集約するには、**lubridate** パッケージの `floor_date()` をまた使用しますが、引数は `unit = "months"` です。 これにより、各日付はその月の 1 日に切り捨てられます。出力はDateクラスになります。 `complete()` ステップでも `by = "months"` を使用することに注意してください。

```{r}
# 月毎の症例数のデータセットを作る
monthly_counts <- linelist %>% 
  drop_na(date_onset) %>% 
  mutate(month = lubridate::floor_date(date_onset, unit = "months")) %>%  # 新しい列、発症月の 1 日
  count(month) %>%                          # 月ごとの症例数をカウント
  complete(
    month = seq.Date(
      min(month, na.rm=T),     # 症例が報告されていない月も含めてすべての月を組み込む
      max(month, na.rm=T),
      by="month"),
    fill = list(n = 0))
```

```{r message=FALSE, echo=F}
DT::datatable(monthly_counts, rownames = FALSE, options = list(pageLength = 5, scrollX=T), class = 'white-space: nowrap' )
```

### 日毎の集計数を週毎に {.unnumbered}

日毎の集計を週毎に集約するには、上記のように `floor_date()` を使用します。ただし、 `count()` の代わりに `group_by()` と `summarize()` を使用します。なぜなら週あたりの行数をカウントするだけでなく、日毎の症例数を `sum()` する必要があるからです。

#### 日毎の集計を月毎に　　\#ここは上とレベルを合わせたほうがよさそう {.unnumbered}

日毎の集計を月毎に集約するには、上記のように `floor_date()` と `unit = "month"` を使用します。ただし、 `count()` の代わりに `group_by()` と `summarize()` を使用します。なぜなら月毎の行数をカウントするだけでなく、日毎の症例数を `sum()` する必要があるからです。

## グループ化したデータの並び替え

**dplyr**動詞 `arrange()` を使用してデータフレーム内の行を並べ替えると、引数に `.by_group =TRUE` を設定しない限り、データがグループ化されたときに同じように動作します。この場合、行はまずグループ化された列、次に `arrange()` に指定した列の順番で並び替えられます。

## グループ化したデータのフィルター

### `filter()` {.unnumbered}

データフレームを評価する関数（ `max()`, `min()`, `mean()` など）と組み合わせて適用すると、これらの関数がグループに適用されます。たとえば、患者が年齢の中央値を超えている行をフィルタリングして保持する場合、これはグループごとに適用され、グループの年齢の中央値を超える行を保持するようにフィルターします。

### グループごとにスライスする {.unnumbered}

データ内の位置に基づいて行をフィルタリングする [filters rows based on their position](https://dplyr.tidyverse.org/reference/slice.html) dplyr関数 `slice()` も、グループごとに適用できます。良い「スライス」を取得するためには、各グループ内のデータを並べ替えることを忘れないでください。

たとえば、各病院から最新の 5 つの入院のみを取得するには、次のようにします：

1)  `hospital` 列ごとにラインリストをグループ化\
2)  [各病院グループ内で]{.ul} `date_hospitalisation` を最新から古いものへ並べ替え\
3)  スライスして各病院から最初の5行を取得

```{r,}
linelist %>%
  group_by(hospital) %>%
  arrange(hospital, date_hospitalisation) %>%
  slice_head(n = 5) %>% 
  arrange(hospital) %>%                            # 表示用
  select(case_id, hospital, date_hospitalisation)  # 表示用
```

`slice_head()` - 上からn行を選択\
`slice_tail()` - 最後からn行を選択\
`slice_sample()` - n行をランダムに選択\
`slice_min()` - `order_by =` 列で最も高い値を持つn行を選択, `with_ties = TRUE` を使用すると同点を保持\
`slice_max()` - `order_by =` 列で最も低い値を持つn行を選択, `with_ties = TRUE` を使用すると同点を保持

`slice()` のその他の例と詳細については [De-duplication] を参照。

### グループの大きさでのフィルター　 {#group_filter_grp_size .unnumbered}

関数 `add_count()` は元のデータに列nを追加して、その行のグループ内の行数を示します。

以下に示すように `add_count()` は `hospital` 列に適用されるため、新しい列nの値は、その行の病院グループの行数を反映します。列nの値がどのように繰り返されるかに注意してください。以下の例では、列名 `n` は、 `add_count()` 内の `name =` を使用して変更できます。デモンストレーションのため、 `select()` を使用して列を並べ替えています。

```{r}
linelist %>% 
  as_tibble() %>% 
  add_count(hospital) %>%          # 「この行と同じ病院に入院した行数」を追加します
  select(hospital, n, everything())
```

こうすれば「小さな」病院、たとえば 500 人未満の患者が入院した病院、に入院した症例列を簡単にフィルタリングできるようになります。

```{r, eval=F}
linelist %>% 
  add_count(hospital) %>% 
  filter(n < 500)
```

## グループ化したデータをミューテート（mutate）する

すべての列と（要約ではない）行を保持したまま、グループ統計を含む新しい列を追加するには `summarise()` ではなく、 `group_by()` の後に `mutate()` を使用します。

これは、他のすべての列を残したままでグループ統計をするときに役立ちます。例えば、ある行をそのグループと比較する計算などです。

たとえば、以下のコードは、ある行の入院の遅れと、病院全体の遅れの中央値との差を計算します。 手順は次のとおりです：

1)  データを病院ごとにグループ化する\
2)  `days_onset_hosp`（入院までの遅れ）列を使って、病院全体の遅れの平均を含む新しい列を作成します\
3)  2 つの列の差を計算します

デモの目的で、表示する列のみを選択 `select()` しています。

```{r}
linelist %>% 
  # 病院ごとのグループデータ（ラインリストへの変更はまだありません）
  group_by(hospital) %>% 
  
  # 新しい列
  mutate(
    # 病院ごとの入院までの平均日数（小数点第1位を四捨五入）
    group_delay_admit = round(mean(days_onset_hosp, na.rm=T), 1),
    
    # 各行の遅延と病院の平均遅延の差（小数点以下第1位を四捨五入）
    diff_to_group     = round(days_onset_hosp - group_delay_admit, 1)) %>%
  
  # 特定の行のみを選択 - 表示の目的で
  select(case_id, hospital, days_onset_hosp, group_delay_admit, diff_to_group)
```

## グループ化されたデータの選択

動詞 `select()` はグループ化されたデータに対して機能しますが、グループ化された列は常に（ `select()` で指定されていない場合でも）含まれます。これらのグループ化された列が必要なければ、最初に `ungroup()` を使用してください。

<!-- ======================================================= -->

## リソース

詳細については、次に示すリソースが役立ちます。

グループ化されたデータに対しての要約機能を使うことができます。 [RStudio data transformation cheat sheet](https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf) を参照。

dplyrのデータ大工(Data Carpentry)ページ\
**tidyverse** リファレンスページの [group_by()](https://dplyr.tidyverse.org/reference/group_by.html) と [grouping](https://dplyr.tidyverse.org/articles/grouping.html)

このサイトの [Data manipulation](https://itsalocke.com/files/DataManipulationinR.pdf)

[Summarize with conditions in dplyr](https://stackoverflow.com/questions/23528862/summarize-with-conditions-in-dplyr)
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/grouping.Rmd-->


# Joining data { }  

Placeholder


## Preparation { }
### Load packages {.unnumbered}
### Import data {.unnumbered}
### Example datasets {.unnumbered}
#### "Miniature" case linelist {#joins_llmini .unnumbered}  
#### Hospital information data frame {#joins_hosp_info .unnumbered}  
### Pre-cleaning {.unnumbered}
## **dplyr** joins { }
### General syntax {.unnumbered}
### Left and right joins {.unnumbered}  
#### "Should I use a right join, or a left join?" {.unnumbered}  
### Full join {.unnumbered} 
### Inner join {.unnumbered} 
### Semi join {.unnumbered} 
### Anti join {.unnumbered} 
#### Simple `anti_join()` example {.unnumbered}  
#### Complex `anti_join()` example {.unnumbered}  
## Probabalistic matching { }
### Probabilistic matching {.unnumbered}  
### Probabilistic deduplication {.unnumbered}  
## Binding and aligning  
### Bind rows {.unnumbered}
### Bind columns {.unnumbered}
#### Use `match()` to align ordering {.unnumbered}  
## Resources { }

<!--chapter:end:new_pages/joining_matching.Rmd-->


# De-duplication {}  

Placeholder


## Preparation { }
### Load packages {.unnumbered}
### Import data {.unnumbered}
#### Here is the data frame {#dedup_data .unnumbered}  
## Deduplication { }
### Examine duplicate rows {.unnumbered}  
### Keep only unique rows  {.unnumbered}
### Deduplicate elements in a vector {.unnumbered}  
### Using **base** R {.unnumbered}
## Slicing { }
### Slice with groups  {.unnumbered}
### Keep all but mark them  {.unnumbered}
### Calculate row completeness {.unnumbered} 
## Roll-up values {#str_rollup}
### Roll-up values into one row {.unnumbered}  
### Overwrite values/hierarchy {.unnumbered} 
## Probabilistic de-duplication  
## Resources { }

<!--chapter:end:new_pages/deduplication.Rmd-->


# Iteration, loops, and lists { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## *for loops* {  }
### *for loops* in R {#iter_loops .unnumbered}  
### Core components {.unnumbered}   
### Sequence {.unnumbered}  
### Operations  {.unnumbered}  
### Container {.unnumbered}
### Printing {.unnumbered}  
### Testing your for loop {.unnumbered}
### Looping plots {.unnumbered}
### Tracking progress of a loop {.unnumbered} 
## **purrr** and lists {#iter_purrr}
### Load packages {.unnumbered}  
### `map()` {.unnumbered}  
#### Example - import and combine Excel sheets {#iter_combined .unnumbered}  
### Split dataset and export {.unnumbered}  
#### Split dataset {.unnumbered}  
##### More than one `group_split()` column {.unnumbered}  
#### Export as Excel sheets {.unnumbered}  
#### Export as CSV files {.unnumbered}  
### Custom functions {.unnumbered}  
### Mapping a function across columns {.unnumbered}  
### Extract from lists {.unnumbered}  
#### Names of elements {.unnumbered}  
#### Elements by name or position {.unnumbered}  
#### `pluck()` {.unnumbered}  
### Convert list to data frame {.unnumbered}  
### Discard, keep, and compact lists {.unnumbered}  
### `pmap()` {.unnumbered}
## Apply functions  
## Resources { }

<!--chapter:end:new_pages/iteration.Rmd-->

# (PART) Analysis {.unnumbered}

```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_analysis.Rmd-->


# Descriptive tables { }

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}
## Browse data {  }
### **skimr** package {.unnumbered}
### Summary statistics {.unnumbered} 
## **janitor** package {#tbl_janitor}  
### Simple tabyl {.unnumbered}  
### Cross-tabulation {.unnumbered}  
### "Adorning" the tabyl {#tbl_adorn .unnumbered}  
### Printing the tabyl {.unnumbered}
### Use on other tables {.unnumbered}  
### Saving the tabyl {.unnumbered}  
### Statistics {#janitor_age_out_stats .unnumbered}  
### Other tips {.unnumbered}  
## **dplyr** package   
### Get counts {.unnumbered}  
### Show all levels {.unnumbered}  
### Proportions {#tbl_dplyr_prop .unnumbered}  
### Plotting {.unnumbered}  
### Summary statistics {.unnumbered}  
### Conditional statistics {.unnumbered}  
### Glueing together {.unnumbered}  
#### Percentiles {.unnumbered}  
### Summarise aggregated data {.unnumbered}  
### `across()` multiple columns {.unnumbered}  
### Pivot wider {#tbls_pivot_wider .unnumbered}
### Total rows {#tbl_dplyr_totals .unnumbered}  
#### **janitor**'s `adorn_totals()` {.unnumbered}  
#### `summarise()` on "total" data and then `bind_rows()` {.unnumbered}  
## **gtsummary** package {#tbl_gt}   
### Summary table {.unnumbered}
### Adjustments {.unnumbered}  
### Multi-line stats for continuous variables {.unnumbered}  
## **base** R   
### Proportions {.unnumbered}  
### Totals {.unnumbered}  
### Convert to data frame {.unnumbered}  
## Resources {  }

<!--chapter:end:new_pages/tables_descriptive.Rmd-->


# Simple statistical tests { }

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}
## **base** R {}
### T-tests {.unnumbered} 
### Shapiro-Wilk test {.unnumbered}  
### Wilcoxon rank sum test {.unnumbered}
### Kruskal-Wallis test {.unnumbered}
### Chi-squared test {.unnumbered} 
## **rstatix** package {}
### Summary statistics {.unnumbered}  
### T-test {.unnumbered}  
### Shapiro-Wilk test {.unnumbered}  
### Wilcoxon rank sum test {.unnumbered}  
### Kruskal-Wallis test {.unnumbered}  
### Chi-squared test {.unnumbered}  
## `gtsummary` package {#stats_gt}
### Chi-squared test {.unnumbered}
### T-tests {.unnumbered} 
### Wilcoxon rank sum test{.unnumbered}
### Kruskal-wallis test {.unnumbered}
## Correlations 
## Resources {  }

<!--chapter:end:new_pages/stat_tests.Rmd-->


# Univariate and multivariable regression { }

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}
### Clean data {.unnumbered}
#### Store explanatory variables {.unnumbered}  
#### Convert to 1's and 0's  {.unnumbered}   
#### Drop rows with missing values {.unnumbered}  
## Univariate {  }
### **base** R {.unnumbered}
#### Linear regression {.unnumbered}  
#### Logistic regression {.unnumbered}  
#### Univariate `glm()` {.unnumbered}
#### Printing results {.unnumbered}
#### Looping multiple univariate models {.unnumbered}  
### **gtsummary** package {#reg_gt_uni .unnumbered}
## Stratified {  }
## Multivariable  
### Conduct multivariable {.unnumbered}  
#### Building the model {.unnumbered}  
### Combine univariate and multivariable {.unnumbered}
#### Combine with **gtsummary**  {.unnumbered}  
#### Combine with **dplyr** {.unnumbered}  
## Forest plot {  }
### **ggplot2** package {.unnumbered}
### **easystats** packages {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/regression.Rmd-->


# Missing data { }

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
### Convert missing on import {.unnumbered}  
## Missing values in R { }
### `NA` {.unnumbered}  
### Versions of `NA` {.unnumbered}  
### `NULL` {.unnumbered}  
### `NaN` {.unnumbered}  
### `Inf` {.unnumbered}  
### Examples {.unnumbered}  
## Useful functions { }
### `is.na()` and `!is.na()` {.unnumbered}  
### `na.omit()` {.unnumbered}  
### `drop_na()` {.unnumbered}  
### `na.rm = TRUE` {.unnumbered}  
## Assess missingness in a data frame { }
### Quantifying missingness {.unnumbered}
### Visualizing missingness {.unnumbered}  
### Explore and visualize missingness relationships {.unnumbered} 
### "Shadow" columns {.unnumbered}
## Using data with missing values  
### Filter out rows with missing values {.unnumbered}
### Handling `NA` in `ggplot()` {.unnumbered}
### `NA` in factors {.unnumbered}
## Imputation { }
### Types of missing data {.unnumbered}
### Useful packages {.unnumbered}
### Mean Imputation {.unnumbered}
### Regression imputation {.unnumbered}
### LOCF and BOCF {.unnumbered}
### Multiple Imputation {.unnumbered}
## Resources { }

<!--chapter:end:new_pages/missing_data.Rmd-->


# Standardised rates { }  

Placeholder


## Overview  
## Preparation {  }
### Load packages {.unnumbered}
### Load population data {.unnumbered}  
### Load death counts {.unnumbered}  
### Clean populations and deaths {.unnumbered}  
### Load reference population {.unnumbered}  
### Clean reference population {.unnumbered}
### Create dataset with standard population {#standard_all .unnumbered}  
## **dsr** package {  }
### Standardized rates {.unnumbered}
### Standardized rate ratios {.unnumbered}
### Standardized rate difference {.unnumbered}
## **PHEindicatormethods** package {#standard_phe  }
### Directly standardized rates {.unnumbered}
### Indirectly standardized rates {#standard_indirect .unnumbered}
## Resources {  }

<!--chapter:end:new_pages/standardization.Rmd-->


# Moving averages { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}
## Calculate with **slider** {  }
### Rolling by date  {#roll_index .unnumbered}  
### Indexed data {.unnumbered}  
### Rolling by group {#roll_slider_group .unnumbered}  
## Calculate with **tidyquant** within `ggplot()` {  }
## Resources {  }

<!--chapter:end:new_pages/moving_average.Rmd-->


# Time series and outbreak detection { }  

Placeholder


## Overview {  }
## Preparation {  }
### Packages {.unnumbered}
### Load data {.unnumbered}
### Clean data {.unnumbered}
### Download climate data {.unnumbered} 
### Load climate data {.unnumbered}
## Time series data {  }
### Duplicates {.unnumbered}
### Missings {.unnumbered}
## Descriptive analysis {  }
### Moving averages {#timeseries_moving .unnumbered}
### Periodicity {.unnumbered}
### Decomposition {.unnumbered}
### Autocorrelation {.unnumbered}
## Fitting regressions {  }
### Fourier terms {.unnumbered}
### Negative binomial {.unnumbered}
### Residuals {.unnumbered}
## Relation of two time series {  }
### Merging datasets {.unnumbered}
### Descriptive analysis {.unnumbered}
### Lags and cross-correlation {.unnumbered}
### Negative binomial with two variables {.unnumbered}
#### Residuals {.unnumbered}
## Outbreak detection {  }
### **trending** package {.unnumbered}
#### Cut-off date { -}
#### Add rows {.unnumbered}
#### Fourier terms {.unnumbered}
#### Split data and fit regression {.unnumbered}
#### Prediction validation {.unnumbered}
### **surveillance** package {.unnumbered}
#### Farrington method {.unnumbered}
#### GLRNB method {.unnumbered}
## Interrupted timeseries {  }
## Resources {  }

<!--chapter:end:new_pages/time_series.Rmd-->


# Epidemic modeling { }  

Placeholder


## Overview {  }
## Preparation {  }
## Estimating R<sub>t</sub> {  }
### EpiNow2 vs. EpiEstim {.unnumbered}
### EpiNow2 {.unnumbered}
#### Estimating delay distributions {.unnumbered}
#### Running **EpiNow2** {.unnumbered}
#### Analysing outputs {.unnumbered}
### EpiEstim {.unnumbered}
#### Using serial interval estimates from the literature {.unnumbered}
#### Using serial interval estimates from the data {.unnumbered}
#### Specifying estimation time windows {.unnumbered}
#### Analysing outputs {.unnumbered}
## Projecting incidence {  }
### EpiNow2 {.unnumbered}
### projections {.unnumbered}
#### Using serial interval estimates from the literature {.unnumbered}
#### Using serial interval estimates from the data {.unnumbered}
#### Projecting incidence {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/epidemic_models.Rmd-->


# Contact tracing { }

Placeholder


## Preparation
### Load packages {.unnumbered}  
### Import data {.unnumbered}
#### Case data {.unnumbered}  
#### Contacts data {.unnumbered}  
#### Follow-up data {.unnumbered}  
#### Relationships data {.unnumbered}  
## Descriptive analyses  
### Demographics {.unnumbered}  
#### Age and Gender of contacts {.unnumbered}  
### Contacts per case {.unnumbered}  
## Contact Follow Up  
### Data cleaning {.unnumbered}  
### Plot over time {.unnumbered}  
### Daily individual tracking  {.unnumbered}  
### Analyse by group {.unnumbered}  
## KPI Tables  
## Transmission Matrices  
## Resources  

<!--chapter:end:new_pages/contact_tracing.Rmd-->


# Survey analysis { }  

Placeholder


## Overview {  }
## Preparation {  }
### Packages {.unnumbered}
### Load data {.unnumbered}
### Clean data {.unnumbered}
## Survey data {  }
## Observation time {  }
## Weighting {  }
## Survey design objects {  }
### **Survey** package  
### **Srvyr** package  
## Descriptive analysis {  }
### Sampling bias 
### Demographic pyramids 
### Alluvial/sankey diagram
## Weighted proportions {  }
### **Survey** package 
### **Srvyr** package 
### **Sitrep** package 
### **Gtsummary** package
## Weighted ratios {  }
### **Survey** package 
### **Srvyr** package 
## Resources {  }

<!--chapter:end:new_pages/survey_analysis.Rmd-->


# Survival analysis { }  

Placeholder


## Overview {}
## Preparation {  }
### Load packages {.unnumbered}  
### Import dataset {.unnumbered}  
### Data management and transformation {.unnumbered}
## Basics of survival analysis {}
### Building a surv-type object {.unnumbered}
### Running initial analyses {.unnumbered}
### Cumulative hazard {.unnumbered}  
### Plotting Kaplan-Meir curves  {.unnumbered}
## Comparison of survival curves 
### Log rank test {.unnumbered}
## Cox regression analysis {}
### Fitting a Cox model {.unnumbered}
### Forest plots {.unnumbered}
## Time-dependent covariates in survival models {}
### Time-dependent covariate setup {.unnumbered} 
#### Add unique patient identifier {.unnumbered}  
#### Expand patient rows {.unnumbered}  
### Cox regression with time-dependent covariates {.unnumbered} 
## Resources {  }

<!--chapter:end:new_pages/survival_analysis.Rmd-->


# GIS basics { }  

Placeholder


## Overview {  }
## Key terms {}  
### GIS software {.unnumbered}
### Spatial data {.unnumbered}
### Visualizing spatial data {.unnumbered}
## Getting started with GIS  
### Types of maps for visualizing your data {.unnumbered}
## Preparation {  }
### Load packages {.unnumbered}  
### Sample case data {.unnumbered}
### Admin boundary shapefiles {.unnumbered}  
### Population data {.unnumbered}  
### Health Facilities {.unnumbered}
## Plotting coordinates {  }
## Spatial joins {}
### Points in polygon {.unnumbered}
### Nearest neighbor {.unnumbered}
### Buffers {.unnumbered} 
### Other spatial joins {.unnumbered}  
## Choropleth maps {}  
## Mapping with ggplot2
## Basemaps { }
### OpenStreetMap {.unnumbered} 
## Contoured density heatmaps {}
### Time series heatmap {.unnumbered}
## Spatial statistics
### Spatial relationships {.unnumbered}  
### Spatial autocorrelation {.unnumbered}  
### Spatial regression {.unnumbered}  
## Resources {  }

<!--chapter:end:new_pages/gis.Rmd-->

# (PART) Data Visualization {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_data_viz.Rmd-->


# Tables for presentation { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered} 
### Import data {.unnumbered}  
### Prepare table {.unnumbered}  
## Basic flextable {  }
### Create a flextable {.unnumbered}  
### Column width {.unnumbered}
### Column headers {.unnumbered}
### Borders and background {.unnumbered}  
### Font and alignment {.unnumbered}
### Merge cells {.unnumbered}  
### Background color {.unnumbered}
## Conditional formatting {  }
## All code together {#tbl_pres_all}  
## Saving your table {  }
### Save single table {.unnumbered}
### Print table in R markdown {.unnumbered}  
## Resources {  }

<!--chapter:end:new_pages/tables_presentation.Rmd-->


# ggplot basics {}

Placeholder


## Preparation {}
### Load packages {.unnumbered}
### Import data {.unnumbered}  
### General cleaning {.unnumbered}
### Pivoting longer {.unnumbered}
## Basics of ggplot {}
## `ggplot()`  
## Geoms  
## Mapping data to the plot {#ggplot_basics_mapping}  
### Plot aesthetics {.unnumbered}  
### Set to a static value {.unnumbered}  
### Scaled to column values {.unnumbered}  
### Where to make mapping assignments {#ggplot_basics_map_loc .unnumbered}
### Groups {#ggplotgroups .unnumbered}  
## Facets / Small-multiples {#ggplot_basics_facet}  
### `facet_wrap()` {.unnumbered}
### `facet_grid()` {.unnumbered}  
### Free or fixed axes {.unnumbered}  
### Factor level order in facets {.unnumbered}  
## Storing plots  
### Saving plots {.unnumbered}
### Modifying saved plots {.unnumbered}  
### Exporting plots {.unnumbered}   
## Labels 
## Themes {#ggplot_basics_themes} 
### Complete themes {.unnumbered}  
### Modify theme {.unnumbered}  
## Colors  
## Piping into **ggplot2**   
## Plot continuous data
### Histograms {.unnumbered}
### Box plots {.unnumbered}
### Violin, jitter, and sina plots {.unnumbered}
### Two continuous variables  {.unnumbered}
### Three continuous variables {.unnumbered}  
## Plot categorical data  
### Preparation  {.unnumbered}
#### Data structure {.unnumbered}  
#### Column class and value ordering {.unnumbered}  
### `geom_bar()` {#ggplot_basics_bars .unnumbered}  
### `geom_col()` {.unnumbered}  
### `geom_histogram()` {.unnumbered}  
## Resources  

<!--chapter:end:new_pages/ggplot_basics.Rmd-->


# ggplot tips {}

Placeholder


## Preparation {}
### Load packages {.unnumbered}
### Import data {.unnumbered}  
## Scales for color, fill, axes, etc. {#ggplot_tips_colors}
### Color schemes
### Scales {#ggplot_tips_scales .unnumbered}  
### Scale arguments {.unnumbered}  
### Manual adjustments {.unnumbered}  
### Continuous axes scales {.unnumbered}  
#### Display percents {.unnumbered}  
#### Log scale {.unnumbered}  
### Gradient scales {.unnumbered}  
### Palettes {.unnumbered}  
#### Colorbrewer and Viridis {.unnumbered}
## Change order of discrete variables {}  
#### **ggthemr** {.unnnumbered}  
## Contour lines  
## Marginal distributions  
## Smart Labeling {}  
## Time axes {}
## Highlighting {}
## Plotting multiple datasets  
## Combine plots {}
### `plot_grid()` {.unnumbered}
### Combine legends {.unnumbered}  
### Inset plots {.unnumbered} 
## Dual axes {}
## Packages to help you  
### Point-and-click **ggplot2** with **equisse**  {.unnumbered}
## Miscellaneous  
### Numeric display {.unnumbered}  
## Resources

<!--chapter:end:new_pages/ggplot_tips.Rmd-->


# Epidemic curves { }  

Placeholder


## Preparation
### Packages {.unnumbered}  
### Import data {.unnumbered}
### Set parameters {.unnumbered}
### Verify dates {.unnumbered}
## Epicurves with **incidence2** package { }
### Simple example {.unnumbered}
### Change time interval of case aggregation {.unnumbered}  
### Groups {.unnumbered}
### Filtered data {.unnumbered}
### Aggregated counts {.unnumbered}
### Facets/small multiples {.unnumbered}  
### Modifications with `plot()` {.unnumbered} 
### Modifications with ggplot2 {.unnumbered}
### Change colors  {.unnumbered}  
#### Specify a palette {.unnumbered}  
#### Specify manually {.unnumbered}  
### Adjust level order {.unnumbered}  
### Vertical gridlines {.unnumbered}  
### Cumulative incidence {.unnumbered}  
### Rolling average  {.unnumbered}
## Epicurves with ggplot2 { }
### Specify case bins {.unnumbered}  
### Weekly epicurve example {.unnumbered}  
#### Sunday weeks {.unnumbered}  
### Group/color by value {.unnumbered}
### Adjust colors {.unnumbered}  
### Adjust level order {.unnumbered}  
### Adjust legend {.unnumbered}
### Bars side-by-side {.unnumbered}  
### Axis limits {.unnumbered}  
### Date-axis labels/gridlines {.unnumbered} 
#### Demonstrations {.unnumbered}
### Aggregated data {.unnumbered} 
#### Plotting daily counts {.unnumbered}  
#### Plotting weekly counts {.unnumbered}
### Moving averages {.unnumbered}
### Faceting/small-multiples {.unnumbered}
#### Total epidemic in facet background {.unnumbered}
#### One facet with data {.unnumbered}  
## Tentative data  
### Using `annotate()` {.unnumbered}
### Bars color {.unnumbered}  
## Multi-level date labels  
## Dual-axis { }  
## Cumulative Incidence {}
## Resources { }

<!--chapter:end:new_pages/epicurves.Rmd-->


# Demographic pyramids and Likert-scales {}  

Placeholder


## Preparation {}
### Load packages {.unnumbered}
### Import data {.unnumbered}  
### Cleaning {.unnumbered}  
## **apyramid** package {}
### Linelist data {.unnumbered}  
#### Missing values {.unnumbered}  
#### Proportions, colors, & aesthetics {.unnumbered}  
### Aggregated data {.unnumbered}  
## `ggplot()` {#demo_pyr_gg}
### Preparation {.unnumbered}
### Constructing the plot {.unnumbered} 
### Compare to baseline  {.unnumbered} 
## Likert scale {}
## Resources {}

<!--chapter:end:new_pages/age_pyramid.Rmd-->


# Heat plots { }  

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
## Transmission matrix  
### Data preparation {.unnumbered}  
#### Make cases data frame {.unnumbered} 
#### Make infectors data frame {.unnumbered}  
### Create heat plot {.unnumbered}  
## Reporting metrics over time { }
### Data preparation {.unnumbered}
#### Aggregate and summarize {.unnumbered}
### Create heat plot {.unnumbered}
### Basic {.unnumbered}  
### Cleaned plot {.unnumbered}
### Ordered y-axis {.unnumbered}  
### Display values {.unnumbered}  
## Resources { }

<!--chapter:end:new_pages/heatmaps.Rmd-->


# Diagrams and charts { }  

Placeholder


## Preparation { }
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## Flow diagrams { }
### Simple examples {.unnumbered} 
### Syntax  {.unnumbered}
### Complex examples  {.unnumbered}
### Outputs  {.unnumbered}
### Parameterized figures {.unnumbered} 
## Alluvial/Sankey Diagrams { }
### Load packages {.unnumbered}  
### Plotting from dataset {.unnumbered} 
## Event timelines { }
## DAGs { }
## Resources { }

<!--chapter:end:new_pages/diagrams.Rmd-->


# Combinations analysis { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}
### Import data {.unnumbered}  
### Re-format values {.unnumbered}  
## **ggupset** {  }
## `UpSetR` {  }
## Resources {  }

<!--chapter:end:new_pages/combination_analysis.Rmd-->


# Transmission chains { }

Placeholder


## Overview {  }
## Preparation {  }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
### Creating an epicontacts object {.unnumbered}
## Handling {  }
### Subsetting {.unnumbered}
### Accessing IDs {.unnumbered}
## Visualization {  }
### Basic plotting {.unnumbered}
#### Visualising node attributes {.unnumbered}
#### Visualising edge attributes {.unnumbered}
### Temporal axis {.unnumbered}
#### Specifying transmission tree shape {.unnumbered}
#### Saving plots and figures {.unnumbered}
### Timelines {.unnumbered}
## Analysis {  }
### Summarising {.unnumbered}
### Pairwise characteristics {.unnumbered}
### Identifying clusters {.unnumbered}
### Calculating degrees {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/transmission_chains.Rmd-->


# Phylogenetic trees {}  

Placeholder


## Overview {}
## Preparation {}
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
### Clean and inspect {.unnumbered}  
## Simple tree visualization {}
### Different tree layouts {.unnumbered}  
### Simple tree plus sample data {.unnumbered}  
## Tree manipulation {}
### Zoom in {.unnumbered}  
### Collapsing branches {.unnumbered} 
### Subsetting a tree {.unnumbered} 
### Rotating nodes in a tree {.unnumbered} 
### Example subtree with sample data annotation {.unnumbered} 
## More complex trees: adding heatmaps of sample data {.unnumbered}
## Resources {}

<!--chapter:end:new_pages/phylogenetic_trees.Rmd-->


# Interactive plots { }  

Placeholder


## Preparation {  }
### Load packages {.unnumbered}  
### Start with a `ggplot()` {.unnumbered}  
### Import data {.unnumbered}
## Plot with `ggplotly()` {  }
## Modifications {  }
### File size {.unnumbered}  
### Buttons {.unnumbered}  
## Heat tiles {  }
## Resources {  }

<!--chapter:end:new_pages/interactive_plots.Rmd-->

# (PART) Reports and dashboards {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_reports_dashboards.Rmd-->


# Reports with R Markdown { }  

Placeholder


## Preparation {  }
## Getting started {  }
### Install rmarkdown R package {.unnumbered}
### Starting a new Rmd file {.unnumbered}
### Important to know {.unnumbered}
## R Markdown components {  }
### YAML metadata {.unnumbered}
### Text {.unnumbered}
#### New lines {.unnumbered}  
#### Case {.unnumbered}  
#### Color {.unnumbered}  
#### Titles and headings {.unnumbered}  
#### Bullets and numbering {.unnumbered}  
#### Comment out text {.unnumbered}
### Code chunks {.unnumbered}
#### In-text R code {.unnumbered}  
### Images {.unnumbered}  
### Tables {.unnumbered}  
### Tabbed sections {.unnumbered}  
## File structure {}
### Self-contained Rmd {.unnumbered}  
#### Source other files {.unnumbered}
### Runfile {.unnumbered}  
### Folder strucutre {.unnumbered}  
## Producing the document  
### Option 1: "Knit" button {.unnumbered}  
### Option 2: `render()` command {.unnumbered}
###  Options 3: **reportfactory**  package {.unnumbered}  
## Parameterised reports {  }
### Setting parameters {.unnumbered}
#### Option 1: Set parameters within YAML {.unnumbered}
#### Option 2: Set parameters within `render()` {.unnumbered}  
#### Option 3: Set parameters using a Graphical User Interface {.unnumbered}  
### Parameterized example {.unnumbered} 
### Parameterisation without `params` {.unnumbered}
## Looping reports  {  }
## Templates  
### Word documents {.unnumbered}
### Powerpoint documents {.unnumbered}
### Integrating templates into the YAML {.unnumbered}
### Formatting HTML files {.unnumbered}
## Dynamic content  
### Tables {.unnumbered}  
### HTML widgets {.unnumbered}
## Resources {  }

<!--chapter:end:new_pages/rmarkdown.Rmd-->


# Organizing routine reports {  }  

Placeholder


## Preparation
### Load packages {.unnumbered}  
## New factory  
## Create a report  
## Compile  
### Compile by name {.unnumbered}  
### Compile by number {.unnumbered}
### Compile all {.unnumbered}
### Compile from sub-folder {.unnumbered}  
### Parameterization {.unnumbered}
### Using a "run-file" {.unnumbered}  
## Outputs  
## Miscellaneous  
### Knit {.unnumbered} 
### Scripts {.unnumbered}  
### Extras {.unnumbered} 
## Resources {  }

<!--chapter:end:new_pages/reportfactory.Rmd-->


# Dashboards with R Markdown { }

Placeholder


## Preparation
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## Create new R Markdown  
## The script  
### YAML {.unnumbered}  
### Code chunks {.unnumbered}  
### Narrative text {.unnumbered}  
### Headings {.unnumbered}  
## Section attributes  
## Layout {#layout}  
### Pages {.unnumbered}  
### Orientation {.unnumbered}  
### Tabs {.unnumbered} 
## Adding content  
### Text {.unnumbered}  
### Tables {.unnumbered}  
### Plots {.unnumbered}  
### Interactive plots {.unnumbered}  
### HTML widgets {.unnumbered}
## Code organization
## Shiny  
### Settings {.unnumbered}  
### Worked example {.unnumbered}  
### Other examples {.unnumbered}  
## Sharing  
## Resources  

<!--chapter:end:new_pages/flexdashboard.Rmd-->


# Dashboards with Shiny { }  

Placeholder


## Preparation  
### Load packages {.unnumbered}  
### Import data {.unnumbered}  
## The structure of a shiny app {  }
### Basic file structures {.unnumbered}  
### The server and the ui {.unnumbered}
### Before you start to build an app {.unnumbered}
## Building a UI 
## Loading data into our app
## Developing an app server
## Adding more functionality
### Adding static text {.unnumbered}  
### Adding a link {.unnumbered}
### Adding a download button {.unnumbered}
### Adding a facility selector {.unnumbered}  
### Adding another tab with a table {.unnumbered}
## Sharing shiny apps
## Further reading
## Recommended extension packages
## Recommended resources

<!--chapter:end:new_pages/shiny_basics.Rmd-->

# (PART) Miscellaneous {.unnumbered}
```{r include=FALSE, cache=FALSE}

# clear workspace
rm(list = ls(all = TRUE))

# clear all packages except base
#lapply(names(sessionInfo()$loadedOnly), require, character.only = TRUE)
#invisible(lapply(paste0('package:', names(sessionInfo()$otherPkgs)), detach, character.only=TRUE, unload=TRUE, force=TRUE))

# to ensure that tidyverse packages prevail
filter <- dplyr::filter
select <- dplyr::select
summarise <- dplyr::summarise
summary <- base::summary
incidence <- incidence2::incidence

#load core packages
pacman::p_load(
     rio,
     here,
     DT,
     stringr,
     lubridate,
     tidyverse
)

# import the cleaned ebola linelist
linelist <- rio::import(here::here("data", "case_linelists", "linelist_cleaned.rds"))

# import the count data - facility level
#count_data <- rio::import(here::here("data", "facility_count_data.rds"))

# Settings

options(scipen=1, digits=7)

# print only text (not code)
#library(knitr)
#opts_chunk$set(list(echo = FALSE, eval = FALSE))
```

<!--chapter:end:new_pages/cat_misc.Rmd-->


# Writing functions  

Placeholder


## Preparation {  }
### Load packages {-}
### Import data {-}
## Functions  
## Why would you use a function? 
## How does R  build functions?
## Basic syntax and structure
## Examples  
### Return proportion tables for several columns {.unnumbered}  
## Using **purrr**: writing functions that can be iteratively applied
### Modify class of multiple columns in a dataset {.unnumbered}  
### Iteratively produce graphs for different levels of a variable {.unnumbered}
### Iteratively produce tables for different levels of a variable {.unnumbered}
## Tips and best Practices for well functioning functions
### Naming and syntax {.unnumbered}
### Column names and tidy evaluation {.unnumbered}  
### Testing and Error handling {.unnumbered}
## Resources

<!--chapter:end:new_pages/writing_functions.Rmd-->


# Directory interactions { }  

Placeholder


## Preparation  
### **fs** package {.unnumbered}  
### Print directory as a dendrogram tree {.unnumbered}  
## List files in a directory  
## File information  
## Check if exists  
### R objects {.unnumbered}  
### Directories {.unnumbered}  
### Files {.unnumbered}  
## Create  
### Directories {.unnumbered}  
### Files {.unnumbered}  
### Create if does not exists {.unnumbered}  
## Delete
### R objects {.unnumbered}  
### Directories {.unnumbered}  
### Files {.unnumbered}  
## Running other files  
### `source()` {.unnumbered}  
### `render()` {.unnumbered}  
### Run files in a directory {.unnumbered}
### Import files in a directory  {.unnumbered}
## **base** R  
## Resources {  }

<!--chapter:end:new_pages/directories.Rmd-->


# Version control and collaboration with Git and Github

Placeholder


## What is Git?
## Why use the combo Git and Github?
### This sounds complicated, I am not a programmer {-}
## Setup
### Install Git {.unnumbered}
### Install an interface (optional but recommended) {.unnumbered}
### Github account {.unnumbered}
## Vocabulary, concepts and basic functions
### Repository {.unnumbered}
### Commits {.unnumbered}
### Branches {.unnumbered}
### Local and remote repositories {.unnumbered}
## Get started: create a new repository
### Start-up files {.unnumbered}
### Create a new repository in Github {.unnumbered}
### Clone from a Github repository {.unnumbered}
#### In Rstudio {.unnumbered}
#### In Github Desktop {.unnumbered}
### New Github repo from existing R project {.unnumbered}
### What does it look like now? {.unnumbered}
#### In RStudio {-}
#### In Github Desktop {-}
## Git + Github workflow
### Process overview {.unnumbered}
## Create a new branch
### In Rstudio Git pane {.unnumbered}
### In Github Desktop {.unnumbered}
### In console {.unnumbered}
## Commit changes
### In Rstudio {.unnumbered}
### In Github Desktop {.unnumbered}
### In console {.unnumbered}
### Amend a previous commit {.unnumbered}
## Pull and push changes up to Github
#### In Rstudio {.unnumbered}
#### In Github Desktop {.unnumbered}
#### Console {.unnumbered}
### I want to pull but I have local work {.unnumbered}
## Merge branch into Main 
### Locally in Github Desktop {.unnumbered}
### In console {.unnumbered}
### In Github: submitting pull requests {.unnumbered}
### Resolving conflicts {.unnumbered}
### Delete your branch {.unnumbered}
#### Github + Rstudio
#### In Github Desktop
### Forking {.unnumbered}
## What we learned
## Git commands {#git}
### Recommended learning {.unnumbered}
### Where to enter commands {.unnumbered}
### Sample commands {.unnumbered}
## Resources

<!--chapter:end:new_pages/collaboration.Rmd-->


# Common errors  

Placeholder


## Interpreting error messages  
## Common errors  
### Typo errors {.unnumbered}  
### Package errors {.unnumbered}  
### Object errors {.unnumbered}  
### Function syntax errors {.unnumbered}
### Logic errors {.unnumbered}  
### Factor errors {.unnumbered}  
### Plotting errors {.unnumbered}  
### R Markdown errors {.unnumbered}  
### Miscellaneous {.unnumbered}  
## Resources { }

<!--chapter:end:new_pages/errors.Rmd-->


# Getting help  

Placeholder


## Github issues  
## Reproducible example  
### The **reprex** package {.unnumbered}  
### Minimal data {.unnumbered}  
## Posting to a forum  
## Resources { }

<!--chapter:end:new_pages/help.Rmd-->


# R on network drives { }  

Placeholder


## Overview {  }
## RStudio as administrator  
## Useful commands 
## Troubleshooting common errors {  }

<!--chapter:end:new_pages/network_drives.Rmd-->


# Data Table { }  

Placeholder


## Intro to data tables {  }
## Load packages and import data { }
### Load packages {.unnumbered}  
### Import data {.unnumbered}
## The i argument: selecting and filtering rows{ }
### Using helper functions for filtering {.unnumbered}  
## The j argument: selecting and computing on columns{ }
### Selecting columns {.unnumbered} 
### Computing on columns {.unnumbered} 
## The by argument: computing by groups{ }
## Adding and updating to data tables { }
## Resources {  }

<!--chapter:end:new_pages/data_table.Rmd-->


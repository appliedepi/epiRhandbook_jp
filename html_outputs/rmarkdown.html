<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>40 R Markdown で作るレポート | 疫学のための R ハンドブック</title>
<meta name="author" content="the handbook team">
<meta name="description" content="自動化され、再現性があり、かつ、共有する価値のあるアウトプット、すなわちレポートを作成するためにR Markdown は広い分野で利用されています。R Markdown は、静的な出力や、動的な出力を Word や pdf、html、PowerPoint、その他の形式で生成可能です。 R...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="40 R Markdown で作るレポート | 疫学のための R ハンドブック">
<meta property="og:type" content="book">
<meta property="og:description" content="自動化され、再現性があり、かつ、共有する価値のあるアウトプット、すなわちレポートを作成するためにR Markdown は広い分野で利用されています。R Markdown は、静的な出力や、動的な出力を Word や pdf、html、PowerPoint、その他の形式で生成可能です。 R...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="40 R Markdown で作るレポート | 疫学のための R ハンドブック">
<meta name="twitter:description" content="自動化され、再現性があり、かつ、共有する価値のあるアウトプット、すなわちレポートを作成するためにR Markdown は広い分野で利用されています。R Markdown は、静的な出力や、動的な出力を Word や pdf、html、PowerPoint、その他の形式で生成可能です。 R...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script type="text/javascript">
        // window.addEventListener("load", function() {
        //     document.getElementById('toc').firstChild.innerHTML = "章目次"; 
        // });
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementsByClassName("d-flex align-items-start justify-content-between")[0].children[0].children[0].innerHTML = "疫学のための R</br>ハンドブック";
            document.getElementById('toc').firstChild.innerHTML = "章目次"; 
            document.getElementById('main-nav').children[1].firstChild.innerHTML = "総目次";
            document.getElementById('search').setAttribute("placeholder", "検索");
        });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">疫学のための R ハンドブック</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">本書について</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> 編集前記・技術注記</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> ハンドブックとデータのダウンロード</a></li>
<li class="book-part">基本編</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R の基礎</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Excel・Stata・SASとの比較</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> 推奨パッケージ</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R プロジェクト</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> データのインポート・エクスポート</a></li>
<li class="book-part">データマネジメント</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> データクリーニングと主要関数</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> データのグループ化</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> 重複データの排除</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> ループと反復処理・リストの操作</a></li>
<li class="book-part">データ分析</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> 記述統計表の作り方</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> 標準化率</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> 移動平均</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> 時系列分析とアウトブレイクの検出</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> エピデミックモデリング</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></li>
<li class="book-part">データの可視化</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> 流行曲線（エピカーブ）</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> 人口ピラミッドとリッカート尺度</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> 感染連鎖</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> 系統樹</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></li>
<li class="book-part">レポートとダッシュボード</li>
<li><a class="active" href="rmarkdown.html"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> R Markdownで作るダッシュボード</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny で作るダッシュボード</a></li>
<li class="book-part">その他</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> 関数の作成</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> ディレクトリの操作</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Git と Github を使ったバージョン管理と共同作業</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> よくあるエラー</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> ヘルプ</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> ネットワークドライブで R を使用する場合</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table パッケージを使用したデータ処理</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="rmarkdown" class="section level1" number="40">
<h1>
<span class="header-section-number">40</span> R Markdown で作るレポート<a class="anchor" aria-label="anchor" href="#rmarkdown"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/markdown/rmarkdown_overview.png" width="100%" style="display: block; margin: auto;"></div>
<p>自動化され、再現性があり、かつ、共有する価値のあるアウトプット、すなわちレポートを作成するためにR Markdown は広い分野で利用されています。R Markdown は、静的な出力や、動的な出力を Word や pdf、html、PowerPoint、その他の形式で生成可能です。</p>
<p>R Markdownは、レポートなどの共有する価値のある、自動化され、再現性があるアウトプットを作成するためのツールとして広い分野で利用されています。それは、静的・動的な出力を Word や pdf、html、PowerPoint、その他の形式で生成可能です。</p>
<p>これら文書は、定期的に更新するために生成されたり（e.g. 日毎のサーベイランスレポート）、あるいは、データのサブセットをもとに実行する（e.g. 各管区ごとのレポート）ことが可能です。</p>
<p>このハンドブックの別の章では以下のトピックを追加で取り上げます：</p>
<ul>
<li>
<a href="reportfactory.html#reportfactory">定期レポート作成の効率化</a> の章では、自動生成されるタイムスタンプ付きのフォルダでレポート生成をルーチン化する方法を例示します。</li>
<li>
<a href="flexdashboard.html#flexdashboard">R Markdownで作るダッシュボード</a> の章では、ダッシュボードとして R Markdown レポートを定型化する方法を説明します。</li>
</ul>
<p>注釈として、<a href="https://r4epis.netlify.app/">R4Epis</a> プロジェクトは、MSF プロジェクトで遭遇したよくあるアウトブレイクやサーベイシナリオのための R Markdown スクリプトテンプレートを開発してきました。</p>
<!-- ======================================================= -->
<div id="準備-31" class="section level2" number="40.1">
<h2>
<span class="header-section-number">40.1</span> 準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-31"><i class="fas fa-link"></i></a>
</h2>
<p><strong>R Markdown の背景</strong></p>
<p>関連するコンセプトといくつかのパッケージについての説明として：</p>
<ul>
<li>
<strong>Markdown</strong> は、プレーンテキストで文書を記述できる “言語” です。それで、記述された文書は、html や他の形式に変換できます。これは、R 言語に特化したものではありません。Markdown で記載されたファイルは, ’ .md’ 拡張子を持ちます。</li>
<li>
<strong>R Markdoen</strong>: は、<u>R 言語に特化した</u> markdown 言語の一種です。- それは、markdown 言語を用いて、テキストを生成し <u>R コードを埋め込み、そのアウトプットを表示する</u>ための文書を記載することが可能です。 R Markdown ファイルは ‘.Rmd’ 拡張子を持ちます。</li>
<li>
<strong>rmarkdown</strong> - パッケージ: このパッケージをR上で利用することで、 .Rmd ファイルを希望の形式に描画することができます。このパッケージの目的は、markdown（文書）のシンタクスを変換することです。つまり、更に下記パッケージが必要です…</li>
<li>
<strong>knitr</strong>: この R パッケージは、コードチャンクを読み取り、実行し、さらに「編み上げて」（knit して）文書に差し込みます。このようにすることで、表やグラフをテキストとともに文書に含むことができます。</li>
<li>
<strong>Pandoc</strong>: 最後に、pandoc は、word/pdf/powerpoint などに出力を実際に変換します。R とは分離したソフトフェアですが、RStudio とともに自動的にインストールされます。</li>
</ul>
<p>まとめると、<u>バックグラウンドで</u> 実行されるプロセス（それらのステップを全て知る必要はありません！）は、<strong>knitr</strong> に .Rmd ファイルを与えることに関わっています。このパッケージは、R コードチャンクを実行し、R コードとその出力を含む、新規の .md (markdown) ファイルを生成します。.md ファイルは、それから、完成品：（Microfoft Word ドキュメント、 HTML ファイル、powerpoint ドキュメント、pdf など）を作成するために pandoc で処理されます。</p>
<div class="inline-figure"><img src="images/markdown/0_rmd.png" width="100%" style="display: block; margin: auto;"></div>
<p>(ソース： <a href="https://rmarkdown.rstudio.com/authoring_quick_tour.html" class="uri">https://rmarkdown.rstudio.com/authoring_quick_tour.html</a>):</p>
<p><strong>インストール</strong></p>
<p>R Markdown の出力を生成するためには以下に挙げるものがインストールされている必要があります：</p>
<ul>
<li>
<strong>rmarkdown</strong> パッケージ(<strong>knitr</strong> も自動的にインストールされます)</li>
<li>RStudio とともにインストールされる Pandoc。もし RStudio を使用していない場合は、ここから Pandoc をダウンロード可能です： <a href="http://pandoc.org" class="uri">http://pandoc.org</a>
</li>
<li>もし PDF 出力を生成したい場合は（少し変則的ですが）、LaTeX のインストールが必要です。事前に、 LaTeX をインストールしていない R Markdown ユーザには、TinyTex (<a href="https:yihui.name/tinytex/" class="uri">https:yihui.name/tinytex/</a>) のインストールをおすすめします。下記のコマンドでインストール可能です：</li>
</ul>
<div class="sourceCode" id="cb1800"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">tinytex</span><span class="op">)</span>     <span class="co"># tinytex パッケージのインストール</span></span>
<span><span class="fu">tinytex</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tinytex/man/install_tinytex.html">install_tinytex</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># TinyTeX ソフトウェアをインストールするための R コマンド</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="はじめに" class="section level2" number="40.2">
<h2>
<span class="header-section-number">40.2</span> はじめに<a class="anchor" aria-label="anchor" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><i class="fas fa-link"></i></a>
</h2>
<div id="rmarkdown-r-パッケージのインストール" class="section level3 unnumbered">
<h3>rmarkdown R パッケージのインストール<a class="anchor" aria-label="anchor" href="#rmarkdown-r-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB"><i class="fas fa-link"></i></a>
</h3>
<p><strong>rmarkdown</strong> R パッケージをインストールします。このハンドブックでは、パッケージを読み込むために、pacman パッケージの p_load() を主に使用しています。p_load() は、必要に応じてパッケージをインストールし、現在の R セッションで使用するためにパッケージを読み込む関数です。また、すでにインストールされたパッケージは、R の基本パッケージである <strong>base</strong> （以下、<strong>base</strong> R）の library() を使用して読み込むこともできます。R のパッケージに関する詳細は <a href="basics.html#basics">R basics</a> の章をご覧ください。</p>
<div class="sourceCode" id="cb1801"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">rmarkdown</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="新規-rmd-ファイルの作成" class="section level3 unnumbered">
<h3>新規 Rmd ファイルの作成<a class="anchor" aria-label="anchor" href="#%E6%96%B0%E8%A6%8F-rmd-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fas fa-link"></i></a>
</h3>
<p>RStudio 内で新規の R markdown ファイルを開には、<code>File</code> を選択し、それから、<code>New file</code> を選択し、<code>R markdown...</code> を選択します。</p>
<div class="inline-figure"><img src="images/markdown/1_gettingstarted.png" width="50%" style="display: block; margin: auto;"></div>
<p>R Studio は、あなたにどの出力を行うかを選択するオプションを提示します。Html 文書をここでは作りたいので、下記の例では、“HTML” を選択しています。Title と Author は重要ではありません。希望する出力文書形式が選択肢の中になくても心配いりません。いずれかひとつの文書形式を選択した後、文書の中で変更することができます。</p>
<div class="inline-figure"><img src="images/markdown/1_gettingstartedB.png" width="50%" style="display: block; margin: auto;"></div>
<p>この操作で、新規の .Rmd スクリプトが開かれます。</p>
</div>
<div id="知っておくべき重要事項" class="section level3 unnumbered">
<h3>知っておくべき重要事項<a class="anchor" aria-label="anchor" href="#%E7%9F%A5%E3%81%A3%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%B9%E3%81%8D%E9%87%8D%E8%A6%81%E4%BA%8B%E9%A0%85"><i class="fas fa-link"></i></a>
</h3>
<p><strong>ワーキングディレクトリ</strong></p>
<p>マークダウンファイルのワーキングディレクトリは、Rmd ファイル自身が保存された場所になります。例えば、もし R プロジェクトが <code>~/Docuents/projectX</code> 内にあり、Rmd ファイル自体がサブフォルダ <code>~/Documents/projectX/markdownfiles/markdown.Rmd</code> にある場合、マークダウン内に記載されたコード <code>read.csv("data.csv")</code> は、プロジェクトに含まれるスクリプトが通常自動的に検索するプロジェクトのルートフォルダではなく、<code>markdownfiles</code> フォルダ内の csv ファイルを検索します。</p>
<p>他の場所のファイルを参照するには、絶対ファイルパス、あるいは、<strong>here</strong> パッケージのいずれかを使用する必要があるでしょう。<strong>here</strong> パッケージは、ワーキングディレクトリを R プロジェクトのルートフォルダに設定します。詳細は、このハンドブックの<a href="r-projects.html#r-projects">R プロジェクトの設定</a> および <a href="importing.html#importing">データのインポート・エクスポート</a> の章で説明されています。例えば、<code>projectX</code> フォルダ内にある “data.csv” というファイルをインポートするためのコードは、<code>import(here("data.csv"))</code> となります。</p>
<p>注意、R markdown スクリプト内で <code><a href="https://rdrr.io/r/base/getwd.html">setwd()</a></code> を使用することは推奨されません。このコマンドは、これが書かれたコードチャンク内にのみ適用されます。</p>
<p><strong>共有フォルダ上とローカルコンピュータ上での作業について</strong></p>
<p>共有ネットワークドライブ上で実行するとき、R Markdown は pandoc の問題とぶつかるので、作業フォルダを自身のローカルコンピュータ上のフォルダにすることが推奨されます。例えば、’ My Documents’ 内のプロジェクトなど。もし、Git を使用している（非常におすすめです！）場合、ローカルコンピュータ上で作業することに慣れていると思います。より詳細は、このハンドブックの <a href="network-drives.html#network-drives">ネットワークドライブで R を使用する場合</a> および <a href="errors.html#errors">エラーとヘルプ</a> の章をご覧ください。</p>
<!-- ======================================================= -->
</div>
</div>
<div id="r-markdown-を形作る部品" class="section level2" number="40.3">
<h2>
<span class="header-section-number">40.3</span> R Markdown を形作る部品<a class="anchor" aria-label="anchor" href="#r-markdown-%E3%82%92%E5%BD%A2%E4%BD%9C%E3%82%8B%E9%83%A8%E5%93%81"><i class="fas fa-link"></i></a>
</h2>
<p>R Markdown 文書は通常の R スクリプトと同じように RStudio 内で編集可能です。新規 R Markdown スクリプトを開いたとき、RStudio は R Markdown スクリプトの様々なセクションを説明するテンプレートを表示することで手助けしようとします。</p>
<p>下記は、html 出力を生成することを目的とした新しい Rmd スクリプトを始めたときに表示される内容です。（前節で説明した通り）</p>
<div class="inline-figure"><img src="images/markdown/2_defaultRMD.png" width="100%" style="display: block; margin: auto;"></div>
<p>ご覧の通り、Rmd ファイル内には３つの基本コンポーネントがあります：YAML、Markdown テキスト、そして、R コードチャンクです。</p>
<p>これらが<u>生成され、文書の出力になります</u>。下記の図をご覧ください：</p>
<div class="inline-figure"><img src="images/markdown/rmarkdown_translation.png" width="100%" height="150%" style="display: block; margin: auto;"></div>
<div id="yaml-メタデータ" class="section level3 unnumbered">
<h3>YAML メタデータ<a class="anchor" aria-label="anchor" href="#yaml-%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF"><i class="fas fa-link"></i></a>
</h3>
<p>「YAML メタデータ」 あるいは単に ‘YAML’ と呼ばれる情報は、R Markdown 文書の冒頭にあります。スクリプトのこのセクションでは、Rmd ファイルに生成する出力の種類、書式設定、および文書の表題、作成者、日付などのメタデータを設定します。ここで言及しきれない他の用途があります。（「出力の生成」 で説明されます）。インデントが重要であることに注意してください。タブは利用できませんが、スペースが使用可能です。</p>
<p>このセクションは、ダッシュ３つ <code>---</code> のみの行で開始する必要があります。そして、ダッシュ３つ <code>---</code> のみの行で閉じねばなりません。YAML パラメタは、<code>key:value</code> のペアで設定されます。YAML でのコロンの場所は重要です。<code>key:value</code> ペアは、コロンで区切られます（等号記号ではありません！）。</p>
<p>YAML は文書のメタデータで開始される必要があります。これら、 YAML パラメタ（インデントされていない）の順序は重要ではありません。例えば次のような形です：</p>
<div class="sourceCode" id="cb1802"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1802-1"><a href="rmarkdown.html#cb1802-1" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"My document"</span></span>
<span id="cb1802-2"><a href="rmarkdown.html#cb1802-2" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span><span class="at"> </span><span class="st">"Me"</span></span>
<span id="cb1802-3"><a href="rmarkdown.html#cb1802-3" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span><span class="kw">:</span><span class="at"> </span><span class="st">"2022-10-04"</span></span></code></pre></div>
<p>YAML 値の中で R コードを使用するには、インラインコード（バックティック内に <code>r</code> が前置されます）としてだけてなく、引用符内の記述（上記の記述例中の <code>data:</code> 箇所をご覧ください）として記述します。</p>
<p>上記の画像内では、デフォルトの出力が html ファイルになるように選択したため、YAML 中に <code>output: html_document</code> と記述されています。しかしながら、この記述を <code>powerpoint_presentation</code>、<code>word_document</code> や <code>pdf_document</code> にも変更できます。</p>
</div>
<div id="テキスト" class="section level3 unnumbered">
<h3>テキスト<a class="anchor" aria-label="anchor" href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88"><i class="fas fa-link"></i></a>
</h3>
<p>このセクションは、題名と見出しを含めた文書の本文です。この本文は、多くの他のソフトウェアで使用されている “markdown” 言語で記述されています。</p>
<p>下記に本文を記入する核となる方法を記載します。より広範な文書は、<a href="https://rstudio.com/resources/cheatcheets/">RStudio ウェブサイト</a>上の R Markdown “cheatsheet” をご覧ください。</p>
<div id="新規行の挿入" class="section level4 unnumbered">
<h4>新規行の挿入<a class="anchor" aria-label="anchor" href="#%E6%96%B0%E8%A6%8F%E8%A1%8C%E3%81%AE%E6%8C%BF%E5%85%A5"><i class="fas fa-link"></i></a>
</h4>
<p>R Markdown の特徴として、新しい行を始めるためには、<strong>半角スペース２つ</strong> を前の行末に入力し、Enter/Return キーを押す必要があります。</p>
</div>
<div id="強調" class="section level4 unnumbered">
<h4>強調<a class="anchor" aria-label="anchor" href="#%E5%BC%B7%E8%AA%BF"><i class="fas fa-link"></i></a>
</h4>
<p>本文を下記の記号で囲むことで出力の表示方法を変更します。</p>
<ul>
<li>アンダースコアで囲む（<code>_text_</code>）あるいは、１つのアスタリスクで囲む（<code>*text*</code>）ことで <em>イタリック体</em> になります</li>
<li>アスタリスク 2 個で囲む（<code>**text**</code>）ことで、<strong>ボールド体</strong> になります。</li>
<li>バックティックで囲む（<code>text</code>）ことで文書をコード片として表示します。</li>
</ul>
<p>フォントの実際の見た目は特定のテンプレートを使用して設定できます（YAML メタデータの中で指定します。タブの例を参照してください）。</p>
</div>
<div id="文字色" class="section level4 unnumbered">
<h4>文字色<a class="anchor" aria-label="anchor" href="#%E6%96%87%E5%AD%97%E8%89%B2"><i class="fas fa-link"></i></a>
</h4>
<p>R Markdown に文字色を変えるためのシンプルな仕組みはありません。回避策の一つとして、<u>もし出力が HTML 文書であれば</u>、markdown テキストに HTML 行を挿入します。下記の HTML コードは、行内のテキストを、ボールド体で赤色に表示します。</p>
<div class="sourceCode" id="cb1803"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb1803-1"><a href="rmarkdown.html#cb1803-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color: red;"</span><span class="kw">&gt;</span>**_DANGER:_** This is a warning.<span class="kw">&lt;/span&gt;</span>  </span></code></pre></div>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> This is a warning.</span></p>
</div>
<div id="題名と見出し" class="section level4 unnumbered">
<h4>題名と見出し<a class="anchor" aria-label="anchor" href="#%E9%A1%8C%E5%90%8D%E3%81%A8%E8%A6%8B%E5%87%BA%E3%81%97"><i class="fas fa-link"></i></a>
</h4>
<p>R Markdown スクリプト内における本文中のハッシュ記号は、見出しを生成します。これは R コードチャンク内の通常の R スクリプトのコメント / 注釈 / 評価を外すためのハッシュ記号とは違います。</p>
<p>新規行の行頭に、異なる数のハッシュ記号を置くことで、異なるレベルの見出しが生成できます。ハッシュ記号 1 個は、題名や主題となる見出しとなります。ハッシュ記号 2 個は、第２レベルの見出しになります。第３レベル、第４レベルの見出しは、ハッシュ記号を連続で追加することによって生成されます。</p>
<div class="sourceCode" id="cb1804"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb1804-1"><a href="rmarkdown.html#cb1804-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 第１レベルの見出し・題名</span></span>
<span id="cb1804-2"><a href="rmarkdown.html#cb1804-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1804-3"><a href="rmarkdown.html#cb1804-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## 第２レベルの見出し</span></span>
<span id="cb1804-4"><a href="rmarkdown.html#cb1804-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1804-5"><a href="rmarkdown.html#cb1804-5" aria-hidden="true" tabindex="-1"></a><span class="fu">### 第３レベルの見出し</span></span></code></pre></div>
</div>
<div id="箇条書きと番号付き箇条書き" class="section level4 unnumbered">
<h4>箇条書きと番号付き箇条書き<a class="anchor" aria-label="anchor" href="#%E7%AE%87%E6%9D%A1%E6%9B%B8%E3%81%8D%E3%81%A8%E7%95%AA%E5%8F%B7%E4%BB%98%E3%81%8D%E7%AE%87%E6%9D%A1%E6%9B%B8%E3%81%8D"><i class="fas fa-link"></i></a>
</h4>
<p>箇条書きを作成するには、アスタリスク（<code>*</code>）を使用します。前段を書き終えたあと、半角スペースを 2 個入力し、Enter/Return キーを <u>2 回</u>入力します。それから、箇条書きを開始します。アスタリスクと、箇条書きの本文の間に半角スペース 1 個を入力します。各箇条書きの本文を入力し終わるたびに、半角スペース 2 個を入力し、Enter/Return キーを入力します。インデントを加えることで、入れ子の箇条書きが同じように機能します。番号付きの箇条書きも同じように入力しますが、アスタリスクの代わりに、1), 2) などのように入力します。下記は R Markdown スクリプトがどのように見えるかを示しています。</p>
<div class="sourceCode" id="cb1805"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb1805-1"><a href="rmarkdown.html#cb1805-1" aria-hidden="true" tabindex="-1"></a>Here are my bullets (there are two spaces after this colon):  </span>
<span id="cb1805-2"><a href="rmarkdown.html#cb1805-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1805-3"><a href="rmarkdown.html#cb1805-3" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Bullet 1 (followed by two spaces and Enter/Return)  </span>
<span id="cb1805-4"><a href="rmarkdown.html#cb1805-4" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Bullet 2 (followed by two spaces and Enter/Return)  </span>
<span id="cb1805-5"><a href="rmarkdown.html#cb1805-5" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>Sub-bullet 1 (followed by two spaces and Enter/Return)  </span>
<span id="cb1805-6"><a href="rmarkdown.html#cb1805-6" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>Sub-bullet 2 (followed by two spaces and Enter/Return)  </span>
<span id="cb1805-7"><a href="rmarkdown.html#cb1805-7" aria-hidden="true" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div id="テキストのコメントアウト" class="section level4 unnumbered">
<h4>テキストのコメントアウト<a class="anchor" aria-label="anchor" href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%AE%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%A2%E3%82%A6%E3%83%88"><i class="fas fa-link"></i></a>
</h4>
<p>“#” を使用して R チャンク内の R コード行をコメントアウトできるように、R Markdown テキストを「コメントアウト」できます。テキストを選択状態にして、Ctrl+Shift+c（Mac の場合は Cmd+Shift+c）を押すだけです。テキストは矢印で囲まれ、文字色が緑に変わります。出力には現れません。</p>
<div class="inline-figure"><img src="images/markdown/rmarkdown_hide_text.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="コードチャンク" class="section level3 unnumbered">
<h3>コードチャンク<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%83%81%E3%83%A3%E3%83%B3%E3%82%AF"><i class="fas fa-link"></i></a>
</h3>
<p>R コード実行のためのスクリプトのセクションは、「チャンク」と呼ばれます。パッケージをロードしたり、データをインポートしたり、実際のデータ管理と、視覚化を、ここで実行できます。多くのコードチャンクを利用することで、Rコードを部分的に文章によって分けて管理すると便利に使えるでしょう。注意：これらの「チャンク」は文書の本文部分とは若干異なる背景色に見えます。</p>
<p>各チャンクは、バックティック 3 個で始まる行と、チャンクのパラメタを含む中カッコ（<code><a href="https://rdrr.io/r/base/Paren.html">{ }</a></code>）で開始されます。チャンクは、更にバックティック 3 個で終了します。</p>
<p>新しいチャンクを作成するには、自分で入力するか、キーボード・ショートカット、“Ctrl + Alt + i”（Mac では Cmd + Shift + r）を使用するか、スクリプトエディタの上辺にある緑色の ‘insert a new code chunk’ アイコンをクリックします。</p>
<p>中カッコ <code><a href="https://rdrr.io/r/base/Paren.html">{ }</a></code> の内容に関する注意事項：</p>
<ul>
<li>チャンク内の言語名が R であることを示すため ’ r’ で開始されます</li>
<li>r のあとに続いて、オプションでチャンクの「名前」を記入することができます。必須ではありませんが、作業を整理するために役立ちます。チャンクに名前をつける場合、常に一意の名前をつける必要があります。そうしない場合、レンダリング時に R からエラーが通知されます</li>
<li>中カッコは他に、<code>tag=value</code> と書かれたオプションをつけることが可能です。例えば：
<ul>
<li>
<code>eval = FALSE</code> は、R コードを実行しません</li>
<li>
<code>echo = FALSE</code> は、チャンク内の R ソースコードを出力文書に含めません</li>
<li>
<code>warning = FALSE</code> は、R コードが生成する警告文を出力しません</li>
<li>
<code>message = FALSE</code> は、R コードが生成するいかなるメッセージも出力しません</li>
<li>
<code>include =</code> チャンクの出力（例、プロット）を文書に含めるかどうかを TRUE/FALSE で指定します</li>
<li>
<code>out.width =</code> と <code>out.height =</code> はスタイルを設定します <code>out.width = "75%"</code>
</li>
<li>
<code>fig.align = "center"</code> は、図がページ全体を通してどのように配置されるかを調整します</li>
<li>
<code>fig.show='hold'</code> は、チャンクが複数の図を出力し、それらを並べて出力したい場合、次のオプションとペアで使用します（<code>out.width = c("33%", "67%")</code>）。図をそれを生成するコードの下に表示する<code>fig.show='asis'</code> とともに設定可能です。<code>'hide'</code> を指定することで非表示にし、<code>'animate'</code> と指定することで複数の図を一つのアニメーションにします。</li>
</ul>
</li>
<li>チャンクヘッダは<u>一行</u>で記述されなければいけません</li>
<li>ピリオド、アンダースコア、半角スペースを使わないようにしてください。セパレータが必要な場合は、ハイフン（ - ）を使用してください</li>
</ul>
<p><strong>knitr</strong> オプションについて詳しくは、<a href="https://yihui.org/knitr/options/">こちら</a>をご覧ください。</p>
<p>上記のオプションの一部は、チャンクの右上にある設定ボタンを使用してマウス操作で設定できます。この設定ボタンでは、チャンクのどの部分をレンダリングされた文書に含めるか、つまり、コード、出力、警告文を指定できます。この指定は、中カッコに記述済みの設定として表示されます。例えば、’ Show output only’ を指定した場合、<code>echo=FALSE</code> が中カッコに記述されます。</p>
<div class="inline-figure"><img src="images/markdown/3_chunk.png" width="80%" style="display: block; margin: auto;"></div>
<p>また、チャンクの右上には、 2 個の矢印があり、チャンク内のコード、または、現在のチャンク以前のチャンク内のコードを実行するのに役立ちます。これらのアイコンにカーソルを合わせると、何を実行するかがわかります。</p>
<p>スクリプト内のすべてのチャンクにグローバルオプションを設定するには、スクリプト内の一番最初の R コードチャンクで設定できます。例えば、コード自体ではなく、各コードのチャンクの出力のみが表示されるように、次のコマンドを R コードチャンクに含めることが可能です：</p>
<div class="sourceCode" id="cb1806"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span></code></pre></div>
<div id="テキスト内-r-コード" class="section level4 unnumbered">
<h4>テキスト内 R コード<a class="anchor" aria-label="anchor" href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E5%86%85-r-%E3%82%B3%E3%83%BC%E3%83%89"><i class="fas fa-link"></i></a>
</h4>
<p>バックティック内に最小限の R コードを含めることもできます。バックティック内で、コードを “r” と半角スペースで開始します。これにより、RStudio はこのコードを、R コードとして評価します。下記の例を参照してください。</p>
<p>下記の例は、複数の見出しレベルと箇条書きを表示していて、現在の日付を返す R コード（<code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date()</a></code>）を使用して出力された日付を評価しています。</p>
<div class="inline-figure"><img src="images/markdown/2_text.png" width="80%" style="display: block; margin: auto;"></div>
<p>上記の例は、単純（現在の日付を表示する）ですが、同じシンタクスを使用して、より複雑な R コードによって生成された値を表示することができます（例、列の最小値、中央値、最大値を計算する）。スクリプト内のこれ以前の R コードチャンクで生成された R オブジェクトや、値を統合することができます。</p>
<p>例として、下記のスクリプトは、<strong>tidyverse</strong> 関数を用いて、18 歳未満のケース割合を計算し、オブジェクト <code>less18</code>、<code>total</code>、<code>less18prop</code> を生成します。この動的な値は、後続のテキストに挿入されます。word 文書に組み込んだ場合どのように見えるかを確認しましょう。</p>
<div class="inline-figure"><img src="images/markdown/3_chunktext.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="画像" class="section level3 unnumbered">
<h3>画像<a class="anchor" aria-label="anchor" href="#%E7%94%BB%E5%83%8F"><i class="fas fa-link"></i></a>
</h3>
<p>次の２つの方法のうちいずれかで R Markdown に画像を埋め込むことができます：</p>
<div class="sourceCode" id="cb1807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1807-1"><a href="rmarkdown.html#cb1807-1" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span>[](<span class="st">"path/to/image.png"</span>)  </span></code></pre></div>
<p>もし上記の方法がうまく行かなかったら、<code><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">knitr::include_graphics()</a></code> を試してください。</p>
<div class="sourceCode" id="cb1808"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"path/to/image.png"</span><span class="op">)</span></span></code></pre></div>
<p>（ファイルパスは、<strong>here</strong> パッケージを使用して記述できることを覚えていますか？）</p>
<div class="sourceCode" id="cb1809"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"path"</span>, <span class="st">"to"</span>, <span class="st">"image.png"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="表" class="section level3 unnumbered">
<h3>表<a class="anchor" aria-label="anchor" href="#%E8%A1%A8"><i class="fas fa-link"></i></a>
</h3>
<p>ハイフン（ - ）とバー（ | ）を使用して、表を組みます。バーの前やバー間のハイフンの数で、セル内のテキストが折り返されるまでの空白の数が設定されます。</p>
<div class="sourceCode" id="cb1810"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb1810-1"><a href="rmarkdown.html#cb1810-1" aria-hidden="true" tabindex="-1"></a>Column 1 |Column  2 |Column 3</span>
<span id="cb1810-2"><a href="rmarkdown.html#cb1810-2" aria-hidden="true" tabindex="-1"></a>---------|----------|--------</span>
<span id="cb1810-3"><a href="rmarkdown.html#cb1810-3" aria-hidden="true" tabindex="-1"></a>Cell A   |Cell B    |Cell C</span>
<span id="cb1810-4"><a href="rmarkdown.html#cb1810-4" aria-hidden="true" tabindex="-1"></a>Cell D   |Cell E    |Cell F</span></code></pre></div>
<p>上記のコードは下記の表を生成します：</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Cell A</td>
<td>Cell B</td>
<td>Cell C</td>
</tr>
<tr class="even">
<td>Cell D</td>
<td>Cell E</td>
<td>Cell F</td>
</tr>
</tbody>
</table></div>
</div>
<div id="タブ分けされたセクション" class="section level3 unnumbered">
<h3>タブ分けされたセクション<a class="anchor" aria-label="anchor" href="#%E3%82%BF%E3%83%96%E5%88%86%E3%81%91%E3%81%95%E3%82%8C%E3%81%9F%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3"><i class="fas fa-link"></i></a>
</h3>
<p>HTML 出力の場合、セクションを「タブ」に分けることができます。<code>.tabset</code> を<u>見出し直後の</u>中カッコ <code><a href="https://rdrr.io/r/base/Paren.html">{ }</a></code> 中に設定するだけです。この設定をした見出しより下位の見出しは（同じレベルに他の見出しが現れるまで）ユーザがクリック可能なタブとして表示されるでしょう。より詳しくは、<a href="https://bookdown.org/yihui/rmarkdown-cookbook/html-tabs.html">こちら</a>をご覧ください。</p>
<p><img src="images/markdown/tabbed_script.png" width="100%" style="display: block; margin: auto;"><img src="images/markdown/tabbed_view.gif" width="100%" style="display: block; margin: auto;"></p>
<p><code>.tabset</code> のあとに、タブに、「積み重ねられた」見た目を付与する追加のオプションである <code>.tabset-pills</code> を追加できます。タブを含む HTML 出力を表示中に、 Ctrl+f 検索は、非表示のタブではなく、「アクティブ」 なタブのみを検索することに注意してください。</p>
<!-- ======================================================= -->
</div>
</div>
<div id="ファイル構造" class="section level2" number="40.4">
<h2>
<span class="header-section-number">40.4</span> ファイル構造<a class="anchor" aria-label="anchor" href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%A7%8B%E9%80%A0"><i class="fas fa-link"></i></a>
</h2>
<p>R Markdown と関連する R スクリプトを構造化するいくつかの方法があります。各方法は、利点と欠点があります：</p>
<ul>
<li>自己内包型 R Markdown - レポートに必要な全ては、R Markdown にインポートもしくは生成されます
<ul>
<li>他のファイルを取り込む - 外部 R スクリプトを <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> コマンドで実行することができ、その出力を Rmd 内で利用できます</li>
<li>子スクリプト - <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> のもう一つの方法</li>
</ul>
</li>
<li>「runfile」 の活用 - R Markdown にレンダリングする<u>前に</u>、R スクリプト内のコマンドを実行します</li>
</ul>
<div id="自己内包型-rmd" class="section level3 unnumbered">
<h3>自己内包型 Rmd<a class="anchor" aria-label="anchor" href="#%E8%87%AA%E5%B7%B1%E5%86%85%E5%8C%85%E5%9E%8B-rmd"><i class="fas fa-link"></i></a>
</h3>
<p>比較的単純なレポートの場合、R Markdown スクリプトを「自己内包」として、外部スクリプトを含まないように構成することを選択できます。</p>
<p>コードチャンクや、パッケージの読み込みなど、R markdown を実行するために必要なものを全て、Rmd ファイルにインポートあるいは生成して含めます。「自己内包型」アプローチは、多くのデータ処理を行う必要がなく（例えば、クリーンなあるいは、セミクリーンなデータを取り込むとき）、R Markdown をレンダリングするために多くの時間を必要としない場合に適しています。</p>
<p>このシナリオの場合、R Markdown スクリプトの論理的な構成は下記のようになります：</p>
<ol style="list-style-type: decimal">
<li>グローバルな <strong>knitr</strong> オプションを設定します</li>
<li>パッケージを読み込みます</li>
<li>データをインポートします</li>
<li>データを処理します</li>
<li>出力を生成します（表、プロットなど）</li>
<li>該当する場合は、出力を保存します（.csv, .png など）</li>
</ol>
<div id="他のファイルを取り込む" class="section level4 unnumbered">
<h4>他のファイルを取り込む<a class="anchor" aria-label="anchor" href="#%E4%BB%96%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E5%8F%96%E3%82%8A%E8%BE%BC%E3%82%80"><i class="fas fa-link"></i></a>
</h4>
<p>「自己内包型」 アプローチのひとつのバリエーションは、R Markdown コードチャンクに他の R スクリプトを “source”（実行）させることです。この方法により R Markdown スクリプトが整理、単純化され、管理しやすくなります。この方法は、レポートの冒頭に、最終的な数値を表示させたいときにも役立ちます。このアプローチでは、最終的な R Markdown スクリプトは、前処理された出力を文書へ組み込むだけです。</p>
<p>このアプローチの一つの方法は、R スクリプト（ファイルパスと拡張子を含むファイル名）を <strong>base</strong> R コマンドの <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> に渡すことです。</p>
<div class="sourceCode" id="cb1811"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"your-script.R"</span>, local <span class="op">=</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_global.html">knit_global</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># or sys.source("your-script.R", envir = knitr::knit_global())</span></span></code></pre></div>
<p>R Markdown <u>内で</u> <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> を使用する場合、外部ファイルは <u>Rmd ファイルがレンダリングされる過程</u>で実行されることに注意してください。そのため、各スクリプトは、レポートをレンダリングするたびに実行されます。ゆえに、これらの <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> コマンドを R Markdown <u>内に</u>記述しても実行時間を短縮することはなく、R Markdown の生成時に出力されたエラーが引き続き出力されるため、デバッグを大幅に支援することもありません。</p>
<p>もう一つの方法は、<strong>knitr</strong> オプションの <code>child =</code> を活用することです。</p>
<p>様々な R <u>環境</u>に注意する必要があります。環境内で生成されたオブジェクトは、R Markdown で使用される環境で必ずしも利用可能とは限りません。</p>
</div>
</div>
<div id="runfile" class="section level3 unnumbered">
<h3>Runfile<a class="anchor" aria-label="anchor" href="#runfile"><i class="fas fa-link"></i></a>
</h3>
<p>このアプローチは、<code>render()</code> コマンドを含む R スクリプトを利用し、R Markdown に渡すオブジェクトを前処理します。</p>
<p>例えば、<code>render()</code> を実行する前に、パッケージを読み込んだり、データを読み込みクリーニングにしたり、目的のグラフを生成したりすることさえできます。これらのステップは、R スクリプト、または source() で取り込まれる他のスクリプトで行う必要がある可能性があります。これらのコマンドが同じ RStudio セッションで生成され、オブジェクトが環境に保存されている限り、オブジェクトを Rmd 内で呼び出すことが可能です。そのため、R markdown それ自身は、事前に作成されたオブジェクトを出力に含める、最終行程のためだけに利用されることとなります。この方法は、もし何か誤りがあるときにデバッグがはるかに容易です。</p>
<p>この方法は、下記の理由で便利です：</p>
<ul>
<li>より多くの情報を含むエラーメッセージ - エラーメッセージが、 R Markdown ではなく R スクリプトから生成されます。R Markdown ではどのチャンクにエラーがあるか表示されるだけで、どの行であるかは知らせてくれません。</li>
<li>該当する場合は、<code>render()</code> コマンドの前に長い処理を実行できます。- この処理は、１回だけしか実行されません。</li>
</ul>
<p>下記は、分割された R スクリプトの例です。前処理した <code>data</code> オブジェクトを現在の R 環境に取り込み、<code>render()</code> を使用して、“create_output.Rmd” をレンダリングしています。</p>
<div class="sourceCode" id="cb1812"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"datafile.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>       <span class="co"># データを読み込み、環境に保存する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">hospital</span>, <span class="va">weight</span><span class="op">)</span>          <span class="co"># 限定された列を選択する</span></span>
<span></span>
<span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html">render</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"create_output.Rmd"</span><span class="op">)</span>   <span class="co"># Rmd ファイルを生成する</span></span></code></pre></div>
</div>
<div id="フォルダ構成" class="section level3 unnumbered">
<h3>フォルダ構成<a class="anchor" aria-label="anchor" href="#%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E6%A7%8B%E6%88%90"><i class="fas fa-link"></i></a>
</h3>
<p>ワークフローは、作成された文書や図用の ‘output’ フォルダや、クリーンになったデータ用の ‘data’ や ‘inputs’ フォルダなど、全体的なフォルダ構造にも関与します。ここではこれ以上詳細に言及しませんが、<a href="reportfactory.html#reportfactory">定期レポート作成の効率化</a>の章をご覧ください。</p>
</div>
</div>
<div id="文書の生成" class="section level2" number="40.5">
<h2>
<span class="header-section-number">40.5</span> 文書の生成<a class="anchor" aria-label="anchor" href="#%E6%96%87%E6%9B%B8%E3%81%AE%E7%94%9F%E6%88%90"><i class="fas fa-link"></i></a>
</h2>
<p>下記の方法で、文書を生成できます：</p>
<ul>
<li>RStudio のスクリプトエディタの上辺にある “Knit” ボタンを手動で押す（素早く、簡単です）</li>
<li>
<code>render()</code> コマンドを実行する（R Markdown スクリプトの外部で実行される）</li>
</ul>
<div id="選択肢-1-knit-ボタン" class="section level3 unnumbered">
<h3>選択肢 1： “Knit” ボタン<a class="anchor" aria-label="anchor" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-1-knit-%E3%83%9C%E3%82%BF%E3%83%B3"><i class="fas fa-link"></i></a>
</h3>
<p>Rmd ファイルを開いたら、ファイルの上辺にある ‘Knit’ アイコン（ボタン）を押します。</p>
<p>R Studio は R コンソールの近くにある ’ R Markdown’ タブに進行状況を表示します。処理が完了すると、文書は自動的に開かれます。</p>
<p>文書は、R markdown スクリプトと同じフォルダに、同じ名前で保存されます（拡張子を除く）。この保存方法は、明らかにバージョン管理には理想的ではありません（文書は、手動でファイルを移動させない限り、knit するたびに上書きされます）。ファイルの名前を自分で変更する必要があるでしょう（例、日付を追加する）。</p>
<p>このボタンは、<strong>rmarkdown</strong> の <code>render()</code> 関数への RStudio のショートカットボタンです。この方法が有効なのは、必要なコンポーネントが存在する、あるいはファイル内で必要なものをソースしている自己内包型のR markdown のみです。</p>
<div class="inline-figure"><img src="images/markdown/4_progress.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="選択肢-2-render-コマンド" class="section level3 unnumbered">
<h3>選択肢 2： <code>render()</code> コマンド<a class="anchor" aria-label="anchor" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-2-render-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89"><i class="fas fa-link"></i></a>
</h3>
<p>R Markdown 出力を生成する別の方法は、（<strong>rmarkdown</strong> パッケージの）<code>render()</code> 関数を実行することです。このコマンドは、R Markdown スクリプトの<u>外で</u>実行する必要があります。つまり、分割された R スクリプト（“run file” と呼ばれることが多い）で実行するか、R コンソールでスタンドアロンコマンドとして実行する必要があります。</p>
<div class="sourceCode" id="cb1813"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html">render</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"my_report.Rmd"</span><span class="op">)</span></span></code></pre></div>
<p>“knit” と同じように、デフォルト設定では、Rmd 出力は、Rmd スクリプトと同じフォルダに、同じ名前で保存されます（ファイル拡張子を除いて）。例えば、“my_report.Rmd” が knit されると、word 文書に knit する場合 “my_report.docx” が生成されます。<code>render()</code> を使用すると、さまざまなオプションから設定を利用することができます。<code>render()</code> には、次の引数を与えることができます：</p>
<ul>
<li>
<code>output_format =</code> このオプションは、出力形式を変換します（例えば、<code>"html_document"</code>, <code>"pdf_document"</code>, <code>"word_document"</code>, や <code>"all"</code>）。このオプションを、R Markdown スクリプト内の YAML で指定することも可能です。</li>
<li>
<code>output_file =</code> このオプションは、出力ファイル（とファイルパス）の名前を指定します。以下に示すように、<code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> や <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> などの R 関数を介して生成することが可能です。</li>
<li>
<code>output_dir =</code> このオプションは、ファイルを保存するディレクトリ（フォルダ）を指定します。Rmd ファイルが保存されているディレクトリ以外の代替を指定可能です。</li>
<li>
<code>output_options =</code> スクリプト内の YAML を上書きするオプションのリストを引数として渡せます。</li>
<li>
<code>output_yaml =</code> YAML 設定を含む .yml ファイルへのファイルパスを引数として渡せます。</li>
<li>
<code>params =</code> 下記のパラメタセクションをご覧ください。</li>
<li>完全な引数のリストは<a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html">こちら</a>です。</li>
</ul>
<p>一例として、バージョン管理を改善するために、下記のコマンドは、ファイル名に現在の日付を付加し、‘outputs’ サブフォルダ内に出力ファイルを保存します。ファイル名を生成するために、<strong>stringr</strong> パッケージの <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> 関数を使用して、（平文で書かれた）静的文字列と（中カッコ内に書かれた）動的 R スクリプトを 「接着」 します。例えば、2021 年 4 月 10 日の場合、下記のファイル名は、 “Report_2021-04-10.docx” となるでしょう。<code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> についての詳細は、<a href="characters-strings.html#characters-strings">文字型・文字列型データ</a> の章をご覧ください。</p>
<div class="sourceCode" id="cb1814"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html">render</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="st">"create_output.Rmd"</span>,</span>
<span>  output_file <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"outputs/Report_{Sys.Date()}.docx"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>ファイルがレンダリングされると、RStudio コンソールに 100% の進行表示が現れ、レンダリングが完了したことを示す終了メッセージが表示されます。</p>
</div>
<div id="選択肢-3-reportfactory-パッケージ" class="section level3 unnumbered">
<h3>選択肢 3： <strong>reportfactory</strong> パッケージ<a class="anchor" aria-label="anchor" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-3-reportfactory-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fas fa-link"></i></a>
</h3>
<p>R パッケージの <strong>reportfactory</strong> は、<u>レポートを定期的に実行するシナリオ（例、日毎、週毎…）に対応する</u> R Markdown レポートを整理及び、コンパイルするための代替の方法を提供します。このパッケージにより複数の R Markdown ファイルのコンパイルと、それらの出力の管理が容易になります。一言でいうと、このパッケージは、R Markdown レポートを実行し、日付、時刻が自動的に挿入された出力のためのフォルダを生成し、“light” バージョン管理を行うことができる “factory” を提供します。</p>
<p>このワークフローについてより詳しくは、<a href="reportfactory.html#reportfactory">定期レポート作成の効率化</a> の章をご覧ください。</p>
<!-- ======================================================= -->
</div>
</div>
<div id="パラメタ化されたレポート" class="section level2" number="40.6">
<h2>
<span class="header-section-number">40.6</span> パラメタ化されたレポート<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88"><i class="fas fa-link"></i></a>
</h2>
<p>レポートを動的にするためにパラメタ化を使用することができます。これにより、特定の設定（例、特定の日付や、場所、特定の knit オプション）でレポートを実行可能です。下記では、基本的な部分を解説します。パラメタ化されたレポートについての<a href="https://bookdown.org/yihui/rmarkdown/parameterized-reports.html">詳細はオンライン</a>にあります。</p>
<p>例として、エボラ出血熱の流行をシミュレートした症例ラインリストを使用します。各病院の標準的なサーベイランスレポートを毎日実行するとします。パラメタを使用してどのように実行するかを示します。</p>
<p><u>重要：動的レポートは、フォルダ内の R スクリプト内の単純な R オブジェクトを使用して正式なパラメタ構造（<code>params:</code> なし）を取らずに構築することも可能です。このことは、このセクションの最後で説明します。</u></p>
<div id="パラメタの設定" class="section level3 unnumbered">
<h3>パラメタの設定<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fas fa-link"></i></a>
</h3>
<p>R Markdown 出力をパラメタ値を指定するためのいくつかの選択肢があります。</p>
<div id="選択肢-1yaml-内にパラメタを設定する" class="section level4 unnumbered">
<h4>選択肢 1：YAML 内にパラメタを設定する<a class="anchor" aria-label="anchor" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-1yaml-%E5%86%85%E3%81%AB%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h4>
<p>YAML に <code>params:</code> オプションを含むように編集します。定義したいパラメタごとにステートメントをインデントします。下記の例では、特定の値をもたせたパラメタ <code>data</code> と <code>hospital</code> を生成しています。これらの値は、レポートが実行されるたびに変更の対象になります。出力を生成するために “Knit” ボタンを使用する場合、パラメタは YAML で設定したデフォルト値になります。同じように、<code>render()</code> を使用した場合、<code>render()</code> コマンドで特に値を指定しない限り、パラメタは、YAML で設定したデフォルト値になります。</p>
<div class="sourceCode" id="cb1815"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1815-1"><a href="rmarkdown.html#cb1815-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb1815-2"><a href="rmarkdown.html#cb1815-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> Surveillance report</span></span>
<span id="cb1815-3"><a href="rmarkdown.html#cb1815-3" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span><span class="at"> html_document</span></span>
<span id="cb1815-4"><a href="rmarkdown.html#cb1815-4" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span><span class="kw">:</span></span>
<span id="cb1815-5"><a href="rmarkdown.html#cb1815-5" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="fu">date</span><span class="kw">:</span><span class="at"> 2021-04-10</span></span>
<span id="cb1815-6"><a href="rmarkdown.html#cb1815-6" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="fu">hospital</span><span class="kw">:</span><span class="at"> Central Hospital</span></span>
<span id="cb1815-7"><a href="rmarkdown.html#cb1815-7" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div>
<p>バックグラウンドでは、上記のパラメタ値は、<code>params</code> と呼ばれる読み込み専用のリストに含まれています。それゆえ、環境内の他の R オブジェクト・値と同じように R コード内にパラメタ値を埋め込むことができます。<code>params$</code> に続けてパラメタ名を入力するだけです。例えば、病院名を表す <code>params$hospital</code>（デフォルトでは、“Central Hospital” となります）。</p>
<p>パラメタ値は、<code>true</code> や <code>false</code> という値を保持できるため、R チャンクの <strong>knitr</strong> オプションに埋め込むこともできることに注意してください。例えば、<code>{r, eval=FALSE}</code> の代わりに <code>{r, eval=params$run}</code> を設定できます。チャンクが事項されるかどうかは、<code>run:</code> パラメタの値によって異なります。</p>
<p>日付のパラメタの場合、文字列として埋め込まれることに注意してください。つまり、<code>params$date</code> を R コードとして解釈させる場合は、<code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> やその他の似た関数に渡して日付型（Date）に変換する必要があります。</p>
</div>
<div id="選択肢-2-render-内にパラメタを設定する" class="section level4 unnumbered">
<h4>選択肢 2： <code>render()</code> 内にパラメタを設定する<a class="anchor" aria-label="anchor" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-2-render-%E5%86%85%E3%81%AB%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h4>
<p>前述のように、“Knit” ボタンを押して出力を生成する代わりに、分割したスクリプトから <code>render()</code> 関数を実行することも可能です。後者の場合、そのレンダリングで使用されるパラメタを <code>render()</code> の引数である <code>params =</code> で指定できます。</p>
<p>ここで指定されるパラメタ値は、YAML 内にデフォルト値が記述されていた場合<u>上書き</u>することに注意してください。この場合、値は character/string 値として定義されるべきなので、引用符で囲んで記述します。</p>
<p>下記のコマンドは、“surveillance_report.Rmd” をレンダリングし、動的に出力ファイル名とフォルダを指定し、そして、２つのパラメタのリストとしてその値とともに <code>params =</code> 引数へ渡します。</p>
<div class="sourceCode" id="cb1816"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html">render</a></span><span class="op">(</span></span>
<span>  input <span class="op">=</span> <span class="st">"surveillance_report.Rmd"</span>,  </span>
<span>  output_file <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"outputs/Report_{Sys.Date()}.docx"</span><span class="op">)</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>date <span class="op">=</span> <span class="st">"2021-04-10"</span>, hospital  <span class="op">=</span> <span class="st">"Central Hospital"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="選択肢-3-グラフィカルユーザーインタフェースを使用してパラメタを設定する" class="section level4 unnumbered">
<h4>選択肢 3： グラフィカルユーザーインタフェースを使用してパラメタを設定する<a class="anchor" aria-label="anchor" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-3-%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%82%AB%E3%83%AB%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h4>
<p>よりインタラクティブに操作するために、グラフィカルユーザーインタフェース（GUI: Graphical User Interface）を使用してパラメタの値を手動で選択することもできます。この操作を行うには ‘Knit’ ボタンの隣りにあるドロップダウンメニューをクリックし、‘Knit with parameters’ を選択します。</p>
<p>ポップアップが表示され、文書の YAML で設定したパラメタ値を変更できます。</p>
<div class="inline-figure"><img src="images/markdown/5_parametersGUI.png" width="50%" style="display: block; margin: auto;"></div>
<p>下記のデモのように、<code>params = "ask"</code> を指定することで <code>render()</code> コマンドを通して同じ操作を実現できます。</p>
<div class="sourceCode" id="cb1817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1817-1"><a href="rmarkdown.html#cb1817-1" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">render</span>(</span>
<span id="cb1817-2"><a href="rmarkdown.html#cb1817-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">input =</span> <span class="st">"surveillance_report.Rmd"</span>,  </span>
<span id="cb1817-3"><a href="rmarkdown.html#cb1817-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">output_file =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">"outputs/Report_{Sys.Date()}.docx"</span>),</span>
<span id="cb1817-4"><a href="rmarkdown.html#cb1817-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> “ask”)</span></code></pre></div>
<p>しかしながら、ポップアップウィンドウに値を手入力することは、エラーやスペルミスの影響を受けます。ドロップダウンメニューを利用して、入力できる値に制限を追加することをお勧めします。この操作を行うには、YAML 内の各 <code>params:</code> 項目にいくつかの指定を追加します。</p>
<ul>
<li>
<code>label:</code> その特定のドロップダウンメニューのタイトル</li>
<li>
<code>value:</code> デフォルト値（開始時の値）</li>
<li>
<code>input:</code> ドロップダウンメニューへ <code>select</code> を設定</li>
<li>
<code>choices:</code> ドロップダウンメニュー内で <code>select</code> の選択肢となる値を指定</li>
</ul>
<p>下記では、<code>hospital</code> パラメタにこれらの項目を記述しています。</p>
<div class="sourceCode" id="cb1818"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1818-1"><a href="rmarkdown.html#cb1818-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb1818-2"><a href="rmarkdown.html#cb1818-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> Surveillance report</span></span>
<span id="cb1818-3"><a href="rmarkdown.html#cb1818-3" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span><span class="at"> html_document</span></span>
<span id="cb1818-4"><a href="rmarkdown.html#cb1818-4" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span><span class="kw">:</span></span>
<span id="cb1818-5"><a href="rmarkdown.html#cb1818-5" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="fu">date</span><span class="kw">:</span><span class="at"> 2021-04-10</span></span>
<span id="cb1818-6"><a href="rmarkdown.html#cb1818-6" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="fu">hospital</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb1818-7"><a href="rmarkdown.html#cb1818-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">label</span><span class="kw">:</span><span class="at"> “Town:”</span></span>
<span id="cb1818-8"><a href="rmarkdown.html#cb1818-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">value</span><span class="kw">:</span><span class="at"> Central Hospital</span></span>
<span id="cb1818-9"><a href="rmarkdown.html#cb1818-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">input</span><span class="kw">:</span><span class="at"> select</span></span>
<span id="cb1818-10"><a href="rmarkdown.html#cb1818-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">choices</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">Central Hospital</span><span class="kw">,</span><span class="at"> Military Hospital</span><span class="kw">,</span><span class="at"> Port Hospital</span><span class="kw">,</span><span class="at"> St. Mark</span><span class="st">'s Maternity Hospital (SMMH)]</span></span>
<span id="cb1818-11"><a href="rmarkdown.html#cb1818-11" aria-hidden="true" tabindex="-1"></a><span class="st">---</span></span></code></pre></div>
<p>上記の設定で knit する（‘knit with parameters’ ボタンもしくは、 <code>render()</code> のいずれかを使用する）場合、ポップアップウィンドウにドロップダウンオプションが表示され、そこから選択することができます。</p>
<div class="inline-figure"><img src="images/markdown/5_parametersGUIB.png" width="50%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="パラメタ化の例" class="section level3 unnumbered">
<h3>パラメタ化の例<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E5%8C%96%E3%81%AE%E4%BE%8B"><i class="fas fa-link"></i></a>
</h3>
<p>下記のコードは、R Markdown 内で各々 <code>params$date</code> と <code>params$hospital</code> として利用されている <code>date</code> と <code>hospital</code> パラメタを生成します。</p>
<p>レポート出力結果内で、データが特定の病院名でどのようにフィルタされているかを確認します。グラフのタイトルは、正しい病院名と日付を示しています。ここでは、“linelist_cleaned.rds” ファイルを使用しますが、もしラインリストファイル自身にも、パラメタライズされた日付順に並ぶ日付スタンプが含まれている場合に、この方法は特に有効です。</p>
<div class="inline-figure"><img src="images/markdown/6_Rmdexample.png" width="100%" style="display: block; margin: auto;"></div>
<p>デフォルトのフォントとレイアウトで knit した場合の最終出力は下記です。</p>
<div class="inline-figure"><img src="images/markdown/6_RmdexampleB.png" width="80%" style="display: block; margin: auto;"></div>
</div>
<div id="params-を用いないパラメタ化" class="section level3 unnumbered">
<h3>
<code>params</code> を用いないパラメタ化<a class="anchor" aria-label="anchor" href="#params-%E3%82%92%E7%94%A8%E3%81%84%E3%81%AA%E3%81%84%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E5%8C%96"><i class="fas fa-link"></i></a>
</h3>
<p>分割した別のスクリプトから <code>render()</code> で R Markdown をレンダリングする場合は、<code>params:</code> 機能を使わずにパラメタ化の結果を出力できます。</p>
<p>例えば、<code>render()</code> コマンドを含んだ <u>R スクリプト</u>内で <code>render()</code> コマンドより前に、2 つの R オブジェクト（値）として <code>hospital</code> と <code>date</code> を定義するだけです。R Markdown において、YAML 内に <code>params:</code> セクションは必ずしも必要ではありません。また、<code>params$date</code> ではなく、<code>date</code> オブジェクトとして、<code>params$hospital</code> ではなく、<code>hospital</code> オブジェクトとして参照します。</p>
<div class="sourceCode" id="cb1819"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># R Markdown とは分割された R スクリプトファイル</span></span>
<span></span>
<span><span class="co"># R オブジェクトの定義</span></span>
<span><span class="va">hospital</span> <span class="op">&lt;-</span> <span class="st">"Central Hospital"</span></span>
<span><span class="va">date</span> <span class="op">&lt;-</span> <span class="st">"2021-04-10"</span></span>
<span></span>
<span><span class="co"># R markdown のレンダリング</span></span>
<span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html">render</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"create_output.Rmd"</span><span class="op">)</span> </span></code></pre></div>
<p>このアプローチを実行する場合、“knit with parameters” や、GUI の使用、knit オプションをパラメタに含めるなどができないことを意味します。しかしながら、コードが単純になるため、メリットとなる場合があります。</p>
<!-- ======================================================= -->
</div>
</div>
<div id="レポート生成を繰り返し実行する" class="section level2" number="40.7">
<h2>
<span class="header-section-number">40.7</span> レポート生成を繰り返し実行する<a class="anchor" aria-label="anchor" href="#%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E7%94%9F%E6%88%90%E3%82%92%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%97%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h2>
<p>各管轄区 / ユニットのレポートを生成するために、入力パラメタを変更して、レポート生成を複数回実行したい場合があります。これは、<a href="iteration.html#iteration">ループと反復処理・リストの操作</a> の章で詳細が説明されている<u>イテレーション</u>用のツールを用いることで実行できます。オプションには、<strong>purrr</strong> パッケージや、下記で説明する <u>for loop</u> の使用が含まれます。</p>
<p>下記では、単純な for ループを用いて、関心のあるすべての病院のサーベイランスレポートを生成します。これは、（hospital パラメタを一つ一つ手動で変更する代わりに）1 つのコマンドで実行されます。レポートをレンダリングするコマンドは、レポート用 Rmd ファイル<u>外</u>に存在する必要があります。このスクリプトには、「ループ処理（loop through）」 するための定義済みオブジェクト - 今日の日付と病院名のベクタも含まれます。</p>
<div class="sourceCode" id="cb1820"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hospitals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Central Hospital"</span>,</span>
<span>                <span class="st">"Military Hospital"</span>, </span>
<span>                <span class="st">"Port Hospital"</span>,</span>
<span>                <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span><span class="op">)</span> </span></code></pre></div>
<p>次に、ループを使用して、これらの値を <code>render()</code> コマンドへ渡します。このループは、<code>hospitals</code> ベクタの各値ごとに一度コマンドを実行します。文字 <code>i</code> は、現在のイテレーションで使用されている病院のインデクス位置（1 から 4）を表し、<code>hospital_list[1]</code> は ” Central Hospital” になります。この情報は、 <code>render()</code> コマンドの 2 つの位置で使用されます：</p>
<ol style="list-style-type: decimal">
<li>ファイル名に使用。2021 年 4 月 10 日に生成された場合、最初のイテレーション時のファイル名が “Report_Central Hospital_2021-04-10.docx” になり、作業ディレクトリの ‘output’ サブフォルダに保存される</li>
<li>
<code>params =</code> に使用。 <code>params$hospital</code> の値が呼び出されるたびに Rmd が内部で病院名を使用するようにする。この例では、各病院で 1 つずつ、合計 4 つのファイルが生成される</li>
</ol>
<div class="sourceCode" id="cb1821"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">hospitals</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html">render</a></span><span class="op">(</span></span>
<span>    input <span class="op">=</span> <span class="st">"surveillance_report.Rmd"</span>,</span>
<span>    output_file <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"output/Report_{hospitals[i]}_{Sys.Date()}.docx"</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>hospital  <span class="op">=</span> <span class="va">hospitals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>       </span></code></pre></div>
<!-- In the scenario where you are f not using this strict form of parameterisation but saving objects to the environment, as discussed at the end of the parameterisation section, the render function would look like this: -->
<!-- ```md -->
<!-- for(i in 1:length(hospital_list)){ -->
<!-- rmarkdown::render("surveillance_report.Rmd", -->
<!--                   output_file = paste0("output/Report_", hospital_list[i], refdate, ".docx") -->
<!-- }        -->
<!-- ``` -->
<!-- The text within the markdown would then need to refer to `hospital_list[i]` and `refdate`.  -->
<!-- ======================================================= -->
</div>
<div id="テンプレート" class="section level2" number="40.8">
<h2>
<span class="header-section-number">40.8</span> テンプレート<a class="anchor" aria-label="anchor" href="#%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88"><i class="fas fa-link"></i></a>
</h2>
<p>必要なフォーマットを含むテンプレート文書を使用することで、Rmd 出力の視覚的な外観を調整できます。例えば、必要な寸法、透かし、背景やフォントを含むページ ・スライドを持つ MS Word や Powerpoint ファイルを生成できます。</p>
<div id="word-文書" class="section level3 unnumbered">
<h3>Word 文書<a class="anchor" aria-label="anchor" href="#word-%E6%96%87%E6%9B%B8"><i class="fas fa-link"></i></a>
</h3>
<p>テンプレートを作成するには、新規 word 文書を開始（または、適切なフォーマットを持つ既存の出力を使用）して、スタイルを定義しフォントを編集します。スタイルにおいて、見出し 1, 2, 3 は個々の markdown 見出しレベルを示します（それぞれ <code># Header 1</code>, <code>## Header 2</code> そして <code>### Header 3</code>）。スタイルのメニュー上で右クリックし、「変更」 をクリックして、フォントの書式と段落を変更します（例えば、特定のスタイルの前にページ分割を挿入すると、間隔を空けることに役立ちます）。余白、ページサイズ、ヘッダーなどの word 文書の他の要素は、直接作業している通常の word 文書のように変更できます。</p>
<div class="inline-figure"><img src="images/markdown/7_template.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="powerpoint-文書" class="section level3 unnumbered">
<h3>Powerpoint 文書<a class="anchor" aria-label="anchor" href="#powerpoint-%E6%96%87%E6%9B%B8"><i class="fas fa-link"></i></a>
</h3>
<p>上記と同じように、新しいスライドを生成するか、適切なフォーマットを持つ既存の powerpoint ファイルを使用します。編集するには、「表示」、「スライドマスター」 をクリックします。この編集画面から、テキストボックスのテキストフォーマットと背景・ページのサイズを編集して、「マスター」 スライドの外観を変更できます。</p>
<div class="inline-figure"><img src="images/markdown/8_ppttemplate.png" width="100%" style="display: block; margin: auto;"></div>
<p>残念ながら、powerpoint ファイルの編集は、やや柔軟性にかけます：</p>
<ul>
<li>第一レベルの見出し（<code># Header 1</code>）は自動的に新規スライドのタイトルになります</li>
<li>
<code>## Header 2</code> テキストはサブタイトルとして表示されませんが、スライドのメインテキストボックスにテキストとして表示されます（スライドマスタで編集する方法を見つけない限りは）</li>
<li>出力されたプロットと表は、自動的に新規スライドに表示されます。それらを組み合わせる場合、例として、ggplot を組み合わせるための <strong>patchwork</strong> 関数を使用して、同一のページに表示されるようにします。多数の画像を一つのスライドに組み合わせるために <strong>patchwork</strong> パッケージを使う方法は、この<a href="https://mattherman.info/blog/ppt-patchwork/">ブログ記事</a>をご覧ください</li>
</ul>
<p>powerpoint プレゼンテーションでより深いレベルで機能するツールについては、<a href="https://davidgohel.github.io/officer/"><strong>officer</strong> パッケージ</a>をご覧ください。</p>
</div>
<div id="yaml-にテンプレートを統合する" class="section level3 unnumbered">
<h3>YAML にテンプレートを統合する<a class="anchor" aria-label="anchor" href="#yaml-%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E7%B5%B1%E5%90%88%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p>テンプレートが準備されたら、Rmd 内 YAML の ‘output’ 行の下、かつ、文書タイプが指定されている行の下に、その詳細を追加できます（分割された行として）。<code>reference_doc</code> は powerpoint のスライドテンプレートに使用できることに注意してください。</p>
<p>テンプレートは、Rmd ファイルが保存されているのと同じフォルダ、もしくは、そのサブフォルダに保存するのが最も簡便です。</p>
<div class="sourceCode" id="cb1822"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1822-1"><a href="rmarkdown.html#cb1822-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb1822-2"><a href="rmarkdown.html#cb1822-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> Surveillance report</span></span>
<span id="cb1822-3"><a href="rmarkdown.html#cb1822-3" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb1822-4"><a href="rmarkdown.html#cb1822-4" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="fu">word_document</span><span class="kw">:</span></span>
<span id="cb1822-5"><a href="rmarkdown.html#cb1822-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">reference_docx</span><span class="kw">:</span><span class="at"> </span><span class="st">"template.docx"</span></span>
<span id="cb1822-6"><a href="rmarkdown.html#cb1822-6" aria-hidden="true" tabindex="-1"></a><span class="fu">params</span><span class="kw">:</span></span>
<span id="cb1822-7"><a href="rmarkdown.html#cb1822-7" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="fu">date</span><span class="kw">:</span><span class="at"> 2021-04-10</span></span>
<span id="cb1822-8"><a href="rmarkdown.html#cb1822-8" aria-hidden="true" tabindex="-1"></a><span class="at"> </span><span class="fu">hospital</span><span class="kw">:</span><span class="at"> Central Hospital</span></span>
<span id="cb1822-9"><a href="rmarkdown.html#cb1822-9" aria-hidden="true" tabindex="-1"></a><span class="fu">template</span><span class="kw">:</span></span>
<span id="cb1822-10"><a href="rmarkdown.html#cb1822-10" aria-hidden="true" tabindex="-1"></a><span class="at"> </span></span>
<span id="cb1822-11"><a href="rmarkdown.html#cb1822-11" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div>
</div>
<div id="html-ファイルのフォーマット" class="section level3 unnumbered">
<h3>HTML ファイルのフォーマット<a class="anchor" aria-label="anchor" href="#html-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88"><i class="fas fa-link"></i></a>
</h3>
<p>HTML ファイルは、テンプレートを使用しませんが、YAML 内でスタイルを設定できます。HTML はインタラクティブな文書であり、特に柔軟性があります。ここでは、いくつかの基本的なオプションについて説明します。</p>
<ul>
<li><p>目次：下記の例のように <code>toc: true</code> オプションで目次を追加できます。さらに、<code>toc_float: true</code> オプションを使用することで、スクロールに合わせて、画面に表示される（フロート、“floats”）ように指定できます。</p></li>
<li><p>テーマ：Bootswatch テーマライブラリからのいくつかの既成のテーマを参照可能です。下記の例では、cerulean テーマを使用しています。他には以下のオプションがあります：journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex, と yeti。</p></li>
<li><p>ハイライト：このオプションを設定すると、ハイライトされたテキストの外観を変更できます（例、下記ではチャンク内のコード）。サポートされているスタイルは以下のものがあります、デフォルト、tango, pygments, kate, monochrome, espresso, zenburn, haddock, breezedark, や textmate。</p></li>
</ul>
<p>上記のオプションを YAML に統合する方法の例を次に示します。</p>
<div class="sourceCode" id="cb1823"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1823-1"><a href="rmarkdown.html#cb1823-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb1823-2"><a href="rmarkdown.html#cb1823-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">"HTML example"</span></span>
<span id="cb1823-3"><a href="rmarkdown.html#cb1823-3" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span></span>
<span id="cb1823-4"><a href="rmarkdown.html#cb1823-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html_document</span><span class="kw">:</span></span>
<span id="cb1823-5"><a href="rmarkdown.html#cb1823-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1823-6"><a href="rmarkdown.html#cb1823-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc_float</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1823-7"><a href="rmarkdown.html#cb1823-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">theme</span><span class="kw">:</span><span class="at"> cerulean</span></span>
<span id="cb1823-8"><a href="rmarkdown.html#cb1823-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">highlight</span><span class="kw">:</span><span class="at"> kate</span></span>
<span id="cb1823-9"><a href="rmarkdown.html#cb1823-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb1823-10"><a href="rmarkdown.html#cb1823-10" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div>
<p>以下は、フロートした目次があり、それぞれ異なるテーマとハイライトスタイルが選択されている HTML 出力の 2 つの例です：</p>
<div class="inline-figure"><img src="images/markdown/9_html.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="動的コンテンツ" class="section level2" number="40.9">
<h2>
<span class="header-section-number">40.9</span> 動的コンテンツ<a class="anchor" aria-label="anchor" href="#%E5%8B%95%E7%9A%84%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84"><i class="fas fa-link"></i></a>
</h2>
<p>HTML 出力では、動的な出力をレポートに含めることができます。下記に例を示します：</p>
<div id="表-1" class="section level3 unnumbered">
<h3>表<a class="anchor" aria-label="anchor" href="#%E8%A1%A8-1"><i class="fas fa-link"></i></a>
</h3>
<p>HTML レポートでは、フィルタとスクロールバーを付加して動的なコンテンツになるようにデータフレームやtibbles を出力できます。</p>
<p>このハンドブックで使用されている <strong>DT</strong> パッケージを用いて実現するには、次のようなコードチャンクを挿入します：</p>
<div class="inline-figure"><img src="images/markdown/10_dynamictable.png" width="100%" style="display: block; margin: auto;"></div>
<p><code>datatable()</code> は、渡されたデータフレームを読者のために動的な表として出力します。<code>rownames = FALSE</code> を設定して、表の左端を単純化できます。<code>filter = "top"</code> は、各列にフィルタを付加します。<code>option()</code> 引数は、他の指定オプションを渡します。以下に 2 例を示します：<code>pageLength = 5</code> は表示する行数を 5 行と指定します（残りの行は、矢印を用いてページング表示が可能です）。<code>scrollX=TRUE</code> は、表の最下段にスクロールバーを有効にします（列が右へ長く続く場合）。</p>
<p>もしデータセットが非常に大きい場合、<code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> をデータフレームに用いて、先頭 X 行のみ表示することを検討してください。</p>
</div>
<div id="html-ウィジェット" class="section level3 unnumbered">
<h3>HTML ウィジェット<a class="anchor" aria-label="anchor" href="#html-%E3%82%A6%E3%82%A3%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88"><i class="fas fa-link"></i></a>
</h3>
<p><a href="http://www.htmlwidgets.org/">R のための HTML ウィジェット</a>は、JavaScript ライブラリを利用してインタラクティブ性を向上させる R パッケージの特別な型です。HTML R Markdown 出力にこれらを埋め込み可能です。</p>
<p>これらのウィジェットの一般的な例は下記を含みます：</p>
<ul>
<li>Plotly （本章内や、<a href="interactive-plots.html#interactive-plots">動的な図の作成</a> の章で使用されています）</li>
<li>visNetwork （このハンドブックの <a href="transmission-chains.html#transmission-chains">感染連鎖の図式化</a> の章で使用されています）</li>
<li>Leaflet （このハンドブックの <a href="gis.html#gis">GIS の基礎</a> の章で使用されています）</li>
<li>dygraphs （時系列データのインタラクティブ表示に有用です）</li>
<li>DT （<code>datatable()</code>）（フィルタ、ソート機能などを付加された動的な表の表示に使用されます）</li>
</ul>
<p><strong>plotly</strong> パッケージの <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly()</a></code> 関数は特に簡単です。<a href="interactive-plots.html#interactive-plots">動的な図の作成</a> の章をご覧ください。</p>
</div>
</div>
<div id="参考資料-30" class="section level2" number="40.10">
<h2>
<span class="header-section-number">40.10</span> 参考資料<a class="anchor" aria-label="anchor" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-30"><i class="fas fa-link"></i></a>
</h2>
<p>さらに詳しく学びたい方は、以下のウェブサイトをご覧ください。</p>
<ul>
<li><a href="https://bookdown.org/yihui/rmarkdown/" class="uri">https://bookdown.org/yihui/rmarkdown/</a></li>
<li><a href="https://rmarkdown.rstudio.com/articles_intro.html" class="uri">https://rmarkdown.rstudio.com/articles_intro.html</a></li>
</ul>
<p>markdown と knittr, Rmarkdown についての良質な資料はこちらです。 <a href="https://stackoverflow.com/questions/40563479/relationship-between-r-markdown-knitr-pandoc-and-bookdown" class="uri">https://stackoverflow.com/questions/40563479/relationship-between-r-markdown-knitr-pandoc-and-bookdown</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></div>
<div class="next"><a href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#rmarkdown"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="nav-link" href="#%E6%BA%96%E5%82%99-31"><span class="header-section-number">40.1</span> 準備</a></li>
<li>
<a class="nav-link" href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><span class="header-section-number">40.2</span> はじめに</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#rmarkdown-r-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">rmarkdown R パッケージのインストール</a></li>
<li><a class="nav-link" href="#%E6%96%B0%E8%A6%8F-rmd-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90">新規 Rmd ファイルの作成</a></li>
<li><a class="nav-link" href="#%E7%9F%A5%E3%81%A3%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%B9%E3%81%8D%E9%87%8D%E8%A6%81%E4%BA%8B%E9%A0%85">知っておくべき重要事項</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#r-markdown-%E3%82%92%E5%BD%A2%E4%BD%9C%E3%82%8B%E9%83%A8%E5%93%81"><span class="header-section-number">40.3</span> R Markdown を形作る部品</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#yaml-%E3%83%A1%E3%82%BF%E3%83%87%E3%83%BC%E3%82%BF">YAML メタデータ</a></li>
<li><a class="nav-link" href="#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88">テキスト</a></li>
<li><a class="nav-link" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%83%81%E3%83%A3%E3%83%B3%E3%82%AF">コードチャンク</a></li>
<li><a class="nav-link" href="#%E7%94%BB%E5%83%8F">画像</a></li>
<li><a class="nav-link" href="#%E8%A1%A8">表</a></li>
<li><a class="nav-link" href="#%E3%82%BF%E3%83%96%E5%88%86%E3%81%91%E3%81%95%E3%82%8C%E3%81%9F%E3%82%BB%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3">タブ分けされたセクション</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%A7%8B%E9%80%A0"><span class="header-section-number">40.4</span> ファイル構造</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E8%87%AA%E5%B7%B1%E5%86%85%E5%8C%85%E5%9E%8B-rmd">自己内包型 Rmd</a></li>
<li><a class="nav-link" href="#runfile">Runfile</a></li>
<li><a class="nav-link" href="#%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E6%A7%8B%E6%88%90">フォルダ構成</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E6%96%87%E6%9B%B8%E3%81%AE%E7%94%9F%E6%88%90"><span class="header-section-number">40.5</span> 文書の生成</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-1-knit-%E3%83%9C%E3%82%BF%E3%83%B3">選択肢 1： “Knit” ボタン</a></li>
<li><a class="nav-link" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-2-render-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">選択肢 2： render() コマンド</a></li>
<li><a class="nav-link" href="#%E9%81%B8%E6%8A%9E%E8%82%A2-3-reportfactory-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8">選択肢 3： reportfactory パッケージ</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88"><span class="header-section-number">40.6</span> パラメタ化されたレポート</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E3%81%AE%E8%A8%AD%E5%AE%9A">パラメタの設定</a></li>
<li><a class="nav-link" href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E5%8C%96%E3%81%AE%E4%BE%8B">パラメタ化の例</a></li>
<li><a class="nav-link" href="#params-%E3%82%92%E7%94%A8%E3%81%84%E3%81%AA%E3%81%84%E3%83%91%E3%83%A9%E3%83%A1%E3%82%BF%E5%8C%96">params を用いないパラメタ化</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E7%94%9F%E6%88%90%E3%82%92%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%97%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B"><span class="header-section-number">40.7</span> レポート生成を繰り返し実行する</a></li>
<li>
<a class="nav-link" href="#%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88"><span class="header-section-number">40.8</span> テンプレート</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#word-%E6%96%87%E6%9B%B8">Word 文書</a></li>
<li><a class="nav-link" href="#powerpoint-%E6%96%87%E6%9B%B8">Powerpoint 文書</a></li>
<li><a class="nav-link" href="#yaml-%E3%81%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%92%E7%B5%B1%E5%90%88%E3%81%99%E3%82%8B">YAML にテンプレートを統合する</a></li>
<li><a class="nav-link" href="#html-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88">HTML ファイルのフォーマット</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E5%8B%95%E7%9A%84%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84"><span class="header-section-number">40.9</span> 動的コンテンツ</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E8%A1%A8-1">表</a></li>
<li><a class="nav-link" href="#html-%E3%82%A6%E3%82%A3%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88">HTML ウィジェット</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-30"><span class="header-section-number">40.10</span> 参考資料</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>疫学のための R ハンドブック</strong>" was written by the handbook team. It was last built on 2022-10-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

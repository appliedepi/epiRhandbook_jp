<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>27 生存時間解析 | 疫学のための R ハンドブック</title>
<meta name="author" content="the handbook team">
<meta name="description" content="27.1 概要 生存時間解析（survival analysis）は、個々人において観測されるイベント時間（コホート研究や集団ベースの研究では追跡期間）と呼ばれる期間の後に発生するイベント（疾病の発生、疾病からの治癒、死亡、治療に反応した後の再発など）を個人または集団について記述する事に着目した方法です。イベント時間を決定するためには、起点 (組入日や診断日などを用いることができます)...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="27 生存時間解析 | 疫学のための R ハンドブック">
<meta property="og:type" content="book">
<meta property="og:description" content="27.1 概要 生存時間解析（survival analysis）は、個々人において観測されるイベント時間（コホート研究や集団ベースの研究では追跡期間）と呼ばれる期間の後に発生するイベント（疾病の発生、疾病からの治癒、死亡、治療に反応した後の再発など）を個人または集団について記述する事に着目した方法です。イベント時間を決定するためには、起点 (組入日や診断日などを用いることができます)...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="27 生存時間解析 | 疫学のための R ハンドブック">
<meta name="twitter:description" content="27.1 概要 生存時間解析（survival analysis）は、個々人において観測されるイベント時間（コホート研究や集団ベースの研究では追跡期間）と呼ばれる期間の後に発生するイベント（疾病の発生、疾病からの治癒、死亡、治療に反応した後の再発など）を個人または集団について記述する事に着目した方法です。イベント時間を決定するためには、起点 (組入日や診断日などを用いることができます)...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script type="text/javascript">
        // window.addEventListener("load", function() {
        //     document.getElementById('toc').firstChild.innerHTML = "章目次"; 
        // });
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementsByClassName("d-flex align-items-start justify-content-between")[0].children[0].children[0].innerHTML = "疫学のための R</br>ハンドブック";
            document.getElementById('toc').firstChild.innerHTML = "章目次"; 
            document.getElementById('main-nav').children[1].firstChild.innerHTML = "総目次";
            document.getElementById('search').setAttribute("placeholder", "検索");
        });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">疫学のための R ハンドブック</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">本書について</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> 編集前記・技術注記</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> ハンドブックとデータのダウンロード</a></li>
<li class="book-part">基本編</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R の基礎</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Excel・Stata・SASとの比較</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> 推奨パッケージ</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R プロジェクト</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> データのインポート・エクスポート</a></li>
<li class="book-part">データマネジメント</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> データクリーニングと主要関数</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> データのグループ化</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> 重複データの排除</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> ループと反復処理・リストの操作</a></li>
<li class="book-part">データ分析</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> 記述統計表の作り方</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> 標準化率</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> 移動平均</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> 時系列分析とアウトブレイクの検出</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> エピデミックモデリング</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="active" href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></li>
<li class="book-part">データの可視化</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> 流行曲線（エピカーブ）</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> 人口ピラミッドとリッカート尺度</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> 感染連鎖</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> 系統樹</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></li>
<li class="book-part">レポートとダッシュボード</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> R Markdownで作るダッシュボード</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny で作るダッシュボード</a></li>
<li class="book-part">その他</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> 関数の作成</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> ディレクトリの操作</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Git と Github を使ったバージョン管理と共同作業</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> よくあるエラー</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> ヘルプ</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> ネットワークドライブで R を使用する場合</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table パッケージを使用したデータ処理</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="survival-analysis" class="section level1" number="27">
<h1>
<span class="header-section-number">27</span> 生存時間解析<a class="anchor" aria-label="anchor" href="#survival-analysis"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/survival_analysis.png" width="75%" style="display: block; margin: auto;"></div>
<!-- ======================================================= -->
<div id="概要-4" class="section level2" number="27.1">
<h2>
<span class="header-section-number">27.1</span> 概要<a class="anchor" aria-label="anchor" href="#%E6%A6%82%E8%A6%81-4"><i class="fas fa-link"></i></a>
</h2>
<p><u>生存時間解析</u>（survival analysis）は、個々人において観測される<strong><u>イベント時間</u></strong>（コホート研究や集団ベースの研究では<strong><u>追跡期間</u></strong>）と呼ばれる期間の後に発生する<strong><u>イベント</u></strong>（疾病の発生、疾病からの治癒、死亡、治療に反応した後の再発など）を個人または集団について記述する事に着目した方法です。イベント時間を決定するためには、起点 (組入日や診断日などを用いることができます) の時間を定義する必要があります。</p>
<p>つまり、生存時間解析の推測対象は、起点とイベントの間の時間となります。
近年の医学研究では、例えば治療効果を評価する臨床研究や、多種多様ながんの生存指標を評価する疫学研究などにおいて生存時間解析がよく用いられています。</p>
<p>通常、その記述結果は<strong><u>生存確率</u></strong>を通じて提示されます。また、生存確率とは、興味のあるイベントが期間 <span class="math inline">\(t\)</span> を経過した時点で発生していない確率です。</p>
<p><strong><u>打切り</u></strong>: ある個人が追跡終了時点までに興味のあるイベントを発生せず、その人の正しいイベント時間が不明な場合に打切りが発生します。この章では右側打切りに重点を置いています。打切りの詳細と一般の生存時間解析については、文献を参照してください。</p>
<!-- ======================================================= -->
</div>
<div id="準備-17" class="section level2" number="27.2">
<h2>
<span class="header-section-number">27.2</span> 準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-17"><i class="fas fa-link"></i></a>
</h2>
<div id="パッケージの読み込み-12" class="section level3 unnumbered">
<h3>パッケージの読み込み<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-12"><i class="fas fa-link"></i></a>
</h3>
<p>R において生存時間解析を行うために最もよく用いられるパッケージの1つは <strong>survival</strong> パッケージです。まず最初に、survival パッケージとこの節で用いる他のパッケージをインストールした後に、これらのパッケージの読込みを行います。</p>
<p>以下のコードを実行すると、分析に必要なパッケージが読み込まれます。このハンドブックでは、パッケージを読み込むために、pacman パッケージの p_load() を主に使用しています。p_load() は、必要に応じてパッケージをインストールし、現在の R セッションで使用するためにパッケージを読み込む関数です。また、すでにインストールされたパッケージは、R の基本パッケージである base （以下、base R）の library() を使用して読み込むこともできます。R のパッケージに関する詳細は <a href="basics.html#basics">R の基礎</a> の章をご覧ください。</p>
<div class="sourceCode" id="cb1274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># この章で必要なパッケージのインストールと読込</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>     <span class="va">survival</span>,      <span class="co"># 生存時間解析</span></span>
<span>     <span class="va">survminer</span>,     <span class="co"># 生存時間解析</span></span>
<span>     <span class="va">rio</span>,           <span class="co"># データのインポート</span></span>
<span>     <span class="va">here</span>,          <span class="co"># ファイルの相対パス</span></span>
<span>     <span class="va">janitor</span>,       <span class="co"># 表の作成</span></span>
<span>     <span class="va">SemiCompRisks</span>, <span class="co"># 事例データと準競合リスクデータのための発展的なツール</span></span>
<span>     <span class="va">tidyverse</span>,     <span class="co"># データの操作と可視化</span></span>
<span>     <span class="va">Epi</span>,           <span class="co"># 疫学の統計解析</span></span>
<span>     <span class="va">survival</span>,      <span class="co"># 生存時間解析</span></span>
<span>     <span class="va">survminer</span>      <span class="co"># 生存時間解析：発展的な Kaplan-Meier 曲線</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>この章では、前のほとんどの章でも用いられているラインリストを用いて生存時間解析を行います。また、正しい生存時間データを得るために、ラインリストにいくつかの変更を加えていきます。</p>
</div>
<div id="データセットのインポート" class="section level3 unnumbered">
<h3>データセットのインポート<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88"><i class="fas fa-link"></i></a>
</h3>
<p>エボラ出血熱の流行をシミュレートしたデータセットをインポートします。お手元の環境でこの章の内容を実行したい方は、 <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">クリック</a>して「前処理された」ラインリスト（linelist）データをダウンロードしてください&gt;（.rds 形式で取得できます）。データは <em>rio</em> パッケージの import() を利用してインポートしましょう（<em>rio</em> パッケージは、.xlsx、.csv、.rds など様々な種類のファイルを取り扱うことができます。詳細は、<a href="importing.html#importing">インポートとエクスポート</a> の章をご覧ください。）</p>
<div class="sourceCode" id="cb1275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ラインリストのインポート</span></span>
<span><span class="va">linelist_case_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="データマネジメントと変換" class="section level3 unnumbered">
<h3>データマネジメントと変換<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%9E%E3%83%8D%E3%82%B8%E3%83%A1%E3%83%B3%E3%83%88%E3%81%A8%E5%A4%89%E6%8F%9B"><i class="fas fa-link"></i></a>
</h3>
<p>簡潔に言うと、生存時間データは以下の3つの特徴を持っているといえます：</p>
<ol style="list-style-type: decimal">
<li>従属変数または反応変数は矛盾なく定義されたイベントの発生までの時間で、</li>
<li>観測値は打切りを受け、データが解析される時点で興味のあるイベントが発生していないことがいくつかの観測単位で認められ、</li>
<li>イベント発生時間に対する影響を評価またはコントロールしたい予測変数や説明変数があります。</li>
</ol>
<p>そのため、上記の構造に沿うための変数を作成してから生存時間分析を実行していきます。</p>
<p>以下のものを定義します：</p>
<ul>
<li>この解析に必要な新しいデータフレーム <code>linelist_surv</code>
</li>
<li>興味のあるイベントをここでは「死亡」とします（すると、生存確率は起点の時間からある特定の時間が経過したあとで生存している確率となります）</li>
<li>追跡時間（<code>futime</code>）を、発症時間からアウトカムの時間までの<u>日数</u>とします</li>
<li>回復した人か、または最終的なアウトカムが観測されなかった人、つまり「イベント」が観測されなかった人（<code>event=0</code>）を打切りとします。</li>
</ul>
<p><span style="color: orange;"><strong><u>注意：</u></strong> 実際のコホート研究では、起点と追跡終了の時間の情報は観測された個々人で既知であるため、発症日やアウトカムの日付が不明な観測値は削除します。また、発症日がアウトカムの日付よりも遅い場合は誤りであると考えられるため、これも削除します。</span></p>
<p><span style="color: darkgreen;"><strong><u>ヒント：</u></strong> 日付データに対して超過（&gt;）または未満（&lt;）のフィルタリングを行うと欠測値を持つ行も一緒に削除できるため、日付の誤りに対するフィルタリングによって欠測したデータを一緒に削除することができます。</span></p>
<p>次に、<code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> を用いて3つだけ水準を持つ <code>age_cat_small</code> 列を作成します。</p>
<div class="sourceCode" id="cb1276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># linelist_case_data から新しいデータ linelist_surv を作成</span></span>
<span></span>
<span><span class="va">linelist_surv</span> <span class="op">&lt;-</span> <span class="va">linelist_case_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     </span>
<span>     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>          <span class="co"># 誤りまたは発症日かアウトカムの日付に欠測がある観測値を削除</span></span>
<span>          <span class="va">date_outcome</span> <span class="op">&gt;</span> <span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     </span>
<span>     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>          <span class="co"># 死亡した人を1とし右側打切りの人を0としたイベント変数を作成</span></span>
<span>          event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|</span> <span class="va">outcome</span> <span class="op">==</span> <span class="st">"Recover"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>          </span>
<span>          <span class="co"># 追跡時間（日）の変数を作成</span></span>
<span>          futime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">date_outcome</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span>, </span>
<span>          </span>
<span>          <span class="co"># 3つだけ水準を持つ新しい年齢カテゴリ変数を作成</span></span>
<span>          age_cat_small <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span> </span>
<span>               <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">5</span>  <span class="op">~</span> <span class="st">"0-4"</span>,</span>
<span>               <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"5-19"</span>,</span>
<span>               <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">20</span>   <span class="op">~</span> <span class="st">"20+"</span><span class="op">)</span>,</span>
<span>          </span>
<span>          <span class="co"># 上のステップでは age_cat_small が character 型で作成されるため</span></span>
<span>          <span class="co"># factor 型に変換し、水準を指定します</span></span>
<span>          <span class="co"># 値が NA のものは NA のままになり、例えば水準 "unkown" などには置換されません</span></span>
<span>          <span class="co"># そのため、次の解析ではこれらを削除する必要があるので注意してください</span></span>
<span>          age_cat_small <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">age_cat_small</span>, <span class="st">"0-4"</span>, <span class="st">"5-19"</span>, <span class="st">"20+"</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span></code></pre></div>
<p><span style="color: darkgreen;"><strong><u>ヒント：</u></strong> 作成された変数 <code>futime</code> と <code>event</code> および <code>outcome</code> のクロス集計を行うことで、新しい列を検証することができます。この検証の他にも、生存時間解析の結果を解釈する時には、この集計に加えて追跡期間中央値を示すことは良い習慣です。</span></p>
<div class="sourceCode" id="cb1277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelist_surv</span><span class="op">$</span><span class="va">futime</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    6.00   10.00   11.98   16.00   64.00</code></pre>
<div class="sourceCode" id="cb1279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 作成された新しいイベント変数とアウトカム変数のクロス集計</span></span>
<span><span class="co"># 意図した通りにコードが動いているかどうかを確認する</span></span>
<span><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">tabyl</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">event</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  outcome    0    1
##    Death    0 1952
##  Recover 1547    0
##     &lt;NA&gt; 1040    0</code></pre>
<p>ここで、正しく分類できているかどうかを確認するために、新しい変数 <code>age_cat_small</code> と古い変数 <code>age_cat</code> のクロス集計を行います</p>
<div class="sourceCode" id="cb1281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">tabyl</span><span class="op">(</span><span class="va">age_cat_small</span>, <span class="va">age_cat</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  age_cat_small 0-4 5-9 10-14 15-19 20-29 30-49 50-69 70+ NA_
##            0-4 834   0     0     0     0     0     0   0   0
##           5-19   0 852   717   575     0     0     0   0   0
##            20+   0   0     0     0   862   554    69   5   0
##           &lt;NA&gt;   0   0     0     0     0     0     0   0  71</code></pre>
<p>次に、<code>linelist_surv</code> データのいくつかの変数（新しく作成された変数も含む）について、最初の10人分の観測値を確認します。</p>
<div class="sourceCode" id="cb1283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">age_cat_small</span>, <span class="va">date_onset</span>, <span class="va">date_outcome</span>, <span class="va">outcome</span>, <span class="va">event</span>, <span class="va">futime</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    case_id age_cat_small date_onset date_outcome outcome event futime
## 1   8689b7           0-4 2014-05-13   2014-05-18 Recover     0      5
## 2   11f8ea           20+ 2014-05-16   2014-05-30 Recover     0     14
## 3   893f25           0-4 2014-05-21   2014-05-29 Recover     0      8
## 4   be99c8          5-19 2014-05-22   2014-05-24 Recover     0      2
## 5   07e3e8          5-19 2014-05-27   2014-06-01 Recover     0      5
## 6   369449           0-4 2014-06-02   2014-06-07   Death     1      5
## 7   f393b4           20+ 2014-06-05   2014-06-18 Recover     0     13
## 8   1389ca           20+ 2014-06-05   2014-06-09   Death     1      4
## 9   2978ac          5-19 2014-06-06   2014-06-15   Death     1      9
## 10  fc15ef          5-19 2014-06-16   2014-07-09 Recover     0     23</code></pre>
<p>新しい年齢分類の性別ごとのより詳細な分布を得るために、列 <code>age_cat_small</code> と <code>gender</code> のクロス集計も行うことができます。ここでは、<a href="tables-descriptive.html#tables-descriptive">記述統計表の作り方</a>の章で説明した <strong>janitor</strong> パッケージの <code>tabyl()</code> と <em>adorn</em> 関数を使用します。</p>
<!-- For this we use the `stat.table()` function of the **Epi** package. -->
<div class="sourceCode" id="cb1285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">tabyl</span><span class="op">(</span><span class="va">gender</span>, <span class="va">age_cat_small</span>, show_na <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">adorn_totals</span><span class="op">(</span>where <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">adorn_percentages</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">adorn_pct_formatting</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">adorn_ns</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"front"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  gender         0-4         5-19          20+         Total
##       f 482 (22.4%) 1184 (54.9%)  490 (22.7%) 2156 (100.0%)
##       m 325 (15.0%)  880 (40.6%)  960 (44.3%) 2165 (100.0%)
##   Total 807 (18.7%) 2064 (47.8%) 1450 (33.6%) 4321 (100.0%)</code></pre>
<!-- Epi::stat.table(  -->
<!--   #give variables for the cross tabulation -->
<!--   list( -->
<!--     gender,  -->
<!--     age_cat_small -->
<!--     ), -->
<!--   #precise the function you want to call (mean,count..) -->
<!--   list(  -->
<!--     count(), -->
<!--     percent(age_cat_small) -->
<!--     ),  -->
<!--   #add margins -->
<!--   margins=T,  -->
<!--   #data used -->
<!--   data = linelist_surv  -->
<!--   ) -->
<!-- ``` -->
<!-- ======================================================= -->
</div>
</div>
<div id="生存時間解析の基本" class="section level2" number="27.3">
<h2>
<span class="header-section-number">27.3</span> 生存時間解析の基本<a class="anchor" aria-label="anchor" href="#%E7%94%9F%E5%AD%98%E6%99%82%E9%96%93%E8%A7%A3%E6%9E%90%E3%81%AE%E5%9F%BA%E6%9C%AC"><i class="fas fa-link"></i></a>
</h2>
<div id="surv-型オブジェクトの作成" class="section level3 unnumbered">
<h3>Surv 型オブジェクトの作成<a class="anchor" aria-label="anchor" href="#surv-%E5%9E%8B%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fas fa-link"></i></a>
</h3>
<p>はじめに、<strong>survival</strong> パッケージの <code>Surv()</code> を用いて、追跡時間とイベントの変数から生存時間解析のオブジェクトを作成します。</p>
<p>このステップを実行すると、時間の情報と興味のあるイベント（死亡）が観測されたかどうかの情報が集約された <em>Surv</em> 型のオブジェクトが作成されます。このオブジェクトは最終的に後で出てくるモデル式の右辺で用いられます（詳細については<a href="https://cran.r-project.org/web/packages/survival/vignettes/survival.pdf%EF%BC%89%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84">マニュアル</a>。</p>
<div class="sourceCode" id="cb1287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 右側打切りデータに Surv() 構文を使用</span></span>
<span><span class="va">survobj</span> <span class="op">&lt;-</span> <span class="fu">Surv</span><span class="op">(</span>time <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">$</span><span class="va">futime</span>,</span>
<span>                event <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></span></code></pre></div>
<!-- ```{r} -->
<!-- survobj <- with(linelist_surv, -->
<!--                 survival::Surv(futime, event) -->
<!--                 ) -->
<!-- ``` -->
<p>ここで、確認のため <code>linelist_surv</code> データのいくつかの重要な変数について最初の10行を表示します。</p>
<div class="sourceCode" id="cb1288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">date_outcome</span>, <span class="va">futime</span>, <span class="va">outcome</span>, <span class="va">event</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code>##    case_id date_onset date_outcome futime outcome event
## 1   8689b7 2014-05-13   2014-05-18      5 Recover     0
## 2   11f8ea 2014-05-16   2014-05-30     14 Recover     0
## 3   893f25 2014-05-21   2014-05-29      8 Recover     0
## 4   be99c8 2014-05-22   2014-05-24      2 Recover     0
## 5   07e3e8 2014-05-27   2014-06-01      5 Recover     0
## 6   369449 2014-06-02   2014-06-07      5   Death     1
## 7   f393b4 2014-06-05   2014-06-18     13 Recover     0
## 8   1389ca 2014-06-05   2014-06-09      4   Death     1
## 9   2978ac 2014-06-06   2014-06-15      9   Death     1
## 10  fc15ef 2014-06-16   2014-07-09     23 Recover     0</code></pre>
<p>さらに、<code>survobj</code> の最初の10要素を表示します。基本的には追跡時間のベクトルが表示され、右側打切りの観測値の場合は “+” も表示されます。各値が上の出力と下の出力でどのようになっているか確認してください。</p>
<div class="sourceCode" id="cb1290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># このベクトルの最初の10要素を表示し、どのようになっているかを確認</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">survobj</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1]  5+ 14+  8+  2+  5+  5  13+  4   9  23+</code></pre>
</div>
<div id="最初の解析の実行" class="section level3 unnumbered">
<h3>最初の解析の実行<a class="anchor" aria-label="anchor" href="#%E6%9C%80%E5%88%9D%E3%81%AE%E8%A7%A3%E6%9E%90%E3%81%AE%E5%AE%9F%E8%A1%8C"><i class="fas fa-link"></i></a>
</h3>
<p>まず、<code>survfit()</code> を用いて <u>survfit オブジェクト</u> を作成し、解析を始めます。<code>survfit()</code> は、全体（周辺）生存曲線の <strong><em>Kaplan Meier</em></strong>（KM）推定値を得るための標準の解析を行います。KM 推定値はイベントの観測時点でジャンプする階段関数となっています。最終的な <u>survfit オブジェクト</u> は1つかまたはそれ以上の生存曲線を含んでおり、モデルを指定する formula 構文の反応変数として <em>Surv</em> オブジェクトを用いることで作成されます。</p>
<p><span style="color: black;"><strong><u>注釈：</u></strong> Kaplan-Meier 推定量は生存関数のノンパラメトリック最尤推定量（maximum likelihood estimate; MLE）です（詳細についてはその他の情報を確認してください）。</span></p>
<p>この <u>survfit オブジェクト</u> は<u>生命表</u>（life table）と呼ばれるものに要約されます。追跡時間（<code>time</code>）のイベントが発生した各時間区間について（昇順で）：</p>
<ul>
<li>イベント発生のリスクに晒された（イベントも打切りも経験していない人の）人数（<code>n.risk</code>）</li>
<li>イベントが発生した人数（<code>n.event</code>）</li>
<li>上記から求めたイベントを発生して<u>いない</u>確率（死亡していない確率、または特定の時間まで生存する確率）</li>
<li>最後に、その確率の標準誤差と信頼区間が求められ表示されます</li>
</ul>
<p>以下では、上で作成した Surv 型のオブジェクト “survobj” を反応変数とした formula を用いて KM 推定値を求めます。“~ 1” は全体の生存に対するモデルを実行することを意味します。</p>
<div class="sourceCode" id="cb1292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Surv 型オブジェクト "survobj" を反応変数としたモデル式を用いて KM 推定値を求めます</span></span>
<span><span class="co"># "~ 1" は全体の生存に対するモデルを実行することを意味します</span></span>
<span><span class="va">linelistsurv_fit</span> <span class="op">&lt;-</span>  <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="va">survobj</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 詳細をみるための要約を表示</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     1   4539      30    0.993 0.00120        0.991        0.996
##     2   4500      69    0.978 0.00217        0.974        0.982
##     3   4394     149    0.945 0.00340        0.938        0.952
##     4   4176     194    0.901 0.00447        0.892        0.910
##     5   3899     214    0.852 0.00535        0.841        0.862
##     6   3592     210    0.802 0.00604        0.790        0.814
##     7   3223     179    0.757 0.00656        0.745        0.770
##     8   2899     167    0.714 0.00700        0.700        0.728
##     9   2593     145    0.674 0.00735        0.660        0.688
##    10   2311     109    0.642 0.00761        0.627        0.657
##    11   2081     119    0.605 0.00788        0.590        0.621
##    12   1843      89    0.576 0.00809        0.560        0.592
##    13   1608      55    0.556 0.00823        0.540        0.573
##    14   1448      43    0.540 0.00837        0.524        0.556
##    15   1296      31    0.527 0.00848        0.511        0.544
##    16   1152      48    0.505 0.00870        0.488        0.522
##    17   1002      29    0.490 0.00886        0.473        0.508
##    18    898      21    0.479 0.00900        0.462        0.497
##    19    798       7    0.475 0.00906        0.457        0.493
##    20    705       4    0.472 0.00911        0.454        0.490
##    21    626      13    0.462 0.00932        0.444        0.481
##    22    546       8    0.455 0.00948        0.437        0.474
##    23    481       5    0.451 0.00962        0.432        0.470
##    24    436       4    0.447 0.00975        0.428        0.466
##    25    378       4    0.442 0.00993        0.423        0.462
##    26    336       3    0.438 0.01010        0.419        0.458
##    27    297       1    0.436 0.01017        0.417        0.457
##    29    235       1    0.435 0.01030        0.415        0.455
##    38     73       1    0.429 0.01175        0.406        0.452</code></pre>
<p><code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> を用いる際には <code>times</code> オプションを追加することができ、求めたい特定の時点における生存確率などの情報を確認することができます。</p>
<div class="sourceCode" id="cb1294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 特定の時点における要約を表示</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     5   3899     656    0.852 0.00535        0.841        0.862
##    10   2311     810    0.642 0.00761        0.627        0.657
##    20    705     446    0.472 0.00911        0.454        0.490
##    30    210      39    0.435 0.01030        0.415        0.455
##    60      2       1    0.429 0.01175        0.406        0.452</code></pre>
<p>また、<code><a href="https://rdrr.io/r/base/print.html">print()</a></code> を用いることもできます。引数に <code>print.rmean = TRUE</code> を指定すると、平均生存時間と標準誤差を表示することができます。</p>
<p><span style="color: black;"><strong><u>注釈：</u></strong> 制限付き平均生存時間（restricted mean survival time; RMST）は生存の要約指標の 1 つであり、がんの生存時間解析で使われるようになってきています。RMST は、しばしば制限時間 <span class="math inline">\(T\)</span> までに観測された人に対して求めた生存曲線の曲線下面積として定義されます（詳細についてはその他の情報の節を確認してください）。</span></p>
<div class="sourceCode" id="cb1296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># linelistsurv_fit オブジェクトを平均生存時間とその標準誤差とともに表示します</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span>, print.rmean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##         n events rmean* se(rmean) median 0.95LCL 0.95UCL
## [1,] 4539   1952   33.1     0.539     17      16      18
##     * restricted mean with upper limit =  64</code></pre>
<p><span style="color: darkgreen;"><strong><u>ヒント：</u></strong> <u>Surv オブジェクト</u> を <code>survfit()</code> の中に直接書くこともでき、コードを1行節約することができます。その場合、次のように書きます：<code>linelistsurv_quick &lt;- survfit(Surv(futime, event) ~ 1, data = linelist_surv)</code>。</span></p>
</div>
<div id="累積ハザード" class="section level3 unnumbered">
<h3>累積ハザード<a class="anchor" aria-label="anchor" href="#%E7%B4%AF%E7%A9%8D%E3%83%8F%E3%82%B6%E3%83%BC%E3%83%89"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> 以外にも、<code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> を用いて <code>survfit()</code> オブジェクトの構造についての詳細を確認できます。<code>survfit()</code> オブジェクトは16個の要素を持つリストになっています。</p>
<p>これらの要素の中には重要な要素（<code>cumhaz</code> という実数型のベクトル）があります。これは<strong><u>累積ハザード</u></strong>の図示に用いることができます。<strong><u>ハザード</u></strong>は<strong><u>瞬間イベント発生率</u></strong>です（文献を確認してください）。</p>
<div class="sourceCode" id="cb1298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span><span class="op">)</span></span></code></pre></div>
<pre><code>## List of 16
##  $ n        : int 4539
##  $ time     : num [1:59] 1 2 3 4 5 6 7 8 9 10 ...
##  $ n.risk   : num [1:59] 4539 4500 4394 4176 3899 ...
##  $ n.event  : num [1:59] 30 69 149 194 214 210 179 167 145 109 ...
##  $ n.censor : num [1:59] 9 37 69 83 93 159 145 139 137 121 ...
##  $ surv     : num [1:59] 0.993 0.978 0.945 0.901 0.852 ...
##  $ std.err  : num [1:59] 0.00121 0.00222 0.00359 0.00496 0.00628 ...
##  $ cumhaz   : num [1:59] 0.00661 0.02194 0.05585 0.10231 0.15719 ...
##  $ std.chaz : num [1:59] 0.00121 0.00221 0.00355 0.00487 0.00615 ...
##  $ type     : chr "right"
##  $ logse    : logi TRUE
##  $ conf.int : num 0.95
##  $ conf.type: chr "log"
##  $ lower    : num [1:59] 0.991 0.974 0.938 0.892 0.841 ...
##  $ upper    : num [1:59] 0.996 0.982 0.952 0.91 0.862 ...
##  $ call     : language survfit(formula = survobj ~ 1)
##  - attr(*, "class")= chr "survfit"</code></pre>
<!-- ======================================================= -->
</div>
<div id="kaplanmeier-曲線の作成" class="section level3 unnumbered">
<h3>Kaplan–Meier 曲線の作成<a class="anchor" aria-label="anchor" href="#kaplanmeier-%E6%9B%B2%E7%B7%9A%E3%81%AE%E4%BD%9C%E6%88%90"><i class="fas fa-link"></i></a>
</h3>
<p>KM 推定値が計算されていれば、「Kaplan-Meier 曲線」を描画できる基本の <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> を用いて、時間を通じた生存確率を視覚化できます。言い換えると、以下の曲線は集団全体における生存状況を標準的な図で表したものです。</p>
<p>この曲線から、追跡時間の最小値と最大値を容易に確認できます。</p>
<p>簡単な解釈を説明すると、時点0においては全ての人が生存しており生存確率は100%です。この確率は死亡が発生するにつれて時間とともに減少していきます。追跡時間が60日が経過した後の生存割合は約40%です。</p>
<div class="sourceCode" id="cb1300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>,     <span class="co"># x 軸のラベル</span></span>
<span>     ylab <span class="op">=</span> <span class="st">"Survival Probability"</span>,  <span class="co"># y 軸のラベル</span></span>
<span>     main <span class="op">=</span> <span class="st">"Overall survival curve"</span> <span class="co"># 図のタイトル</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-914-1.png" width="672"></div>
<p>KM 推定値の信頼区間もデフォルトで描画されますが、<code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> コマンドの <code>conf.int = FALSE</code> オプションを追加することで信頼区間を非表示にできます。</p>
<p>興味のあるイベントは「死亡」であるため、1から生存割合を引いたものの曲線を描くと累積発生率の図が得られます。これは <code><a href="https://rdrr.io/r/graphics/lines.html">lines()</a></code> で描くことができ、元々あるプロットに情報が追加されます。</p>
<div class="sourceCode" id="cb1301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># オリジナルのプロット</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>     <span class="va">linelistsurv_fit</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>,       </span>
<span>     ylab <span class="op">=</span> <span class="st">"Survival Probability"</span>,       </span>
<span>     mark.time <span class="op">=</span> <span class="cn">TRUE</span>,              <span class="co"># 曲線上にイベントのマークを追加："+" を全てのイベント時点に表示</span></span>
<span>     conf.int <span class="op">=</span> <span class="cn">FALSE</span>,              <span class="co"># 信頼区間を非表示</span></span>
<span>     main <span class="op">=</span> <span class="st">"Overall survival curve and cumulative mortality"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 元のプロットに追加の曲線を描画</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span></span>
<span>     <span class="va">linelistsurv_fit</span>,</span>
<span>     lty <span class="op">=</span> <span class="fl">3</span>,             <span class="co"># 分かりやすくするために異なる線種を使用</span></span>
<span>     fun <span class="op">=</span> <span class="st">"event"</span>,       <span class="co"># 生存ではなく累積イベントを描画</span></span>
<span>     mark.time <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     conf.int <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># プロットに凡例を追加</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>     <span class="st">"topright"</span>,                               <span class="co"># 凡例の位置</span></span>
<span>     legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Survival"</span>, <span class="st">"Cum. Mortality"</span><span class="op">)</span>, <span class="co"># 凡例のテキスト</span></span>
<span>     lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,                            <span class="co"># 凡例で用いる線種</span></span>
<span>     cex <span class="op">=</span> <span class="fl">.85</span>,                                <span class="co"># 凡例テキストのサイズを定義するパラメータ</span></span>
<span>     bty <span class="op">=</span> <span class="st">"n"</span>                                 <span class="co"># 凡例にボックスを非表示</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-915-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="生存曲線の比較" class="section level2" number="27.4">
<h2>
<span class="header-section-number">27.4</span> 生存曲線の比較<a class="anchor" aria-label="anchor" href="#%E7%94%9F%E5%AD%98%E6%9B%B2%E7%B7%9A%E3%81%AE%E6%AF%94%E8%BC%83"><i class="fas fa-link"></i></a>
</h2>
<p>観測された参加者または患者における異なる群の生存を比較するためには、最初にそれぞれの生存曲線を確認し、独立した群間の差を評価する仮説検定を行う必要があるかもしれません。この比較は、性別、年齢、治療法、合併症などに基づいたグループに関するものになるかもしれません。</p>
<div id="ログランク検定" class="section level3 unnumbered">
<h3>ログランク検定<a class="anchor" aria-label="anchor" href="#%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%B3%E3%82%AF%E6%A4%9C%E5%AE%9A"><i class="fas fa-link"></i></a>
</h3>
<p>ログランク検定（log-rank test）は、2つまたはそれ以上の<u>独立</u>した群における生存状況を比較する主要な仮説検定で、生存曲線が同一（重なっている）かそうでないかの仮説検定と考えることができます（帰無仮説として群間の生存確率に差がないことを仮定しています）。<strong>survival パッケージ</strong>の <code>survdiff()</code> は、オプションで <code>rho = 0</code> を指定した場合（デフォルトの設定がこれになっています）にログランク検定を実行できます。ログランク統計量はカイ二乗検定統計量と同様に漸近的にカイ二乗分布に従うため、この仮説検定の結果としてカイ二乗統計量と p 値が出力されます。</p>
<p>まずは性別ごとの生存曲線を比較してみましょう。そのため、最初に視覚化を行ってみます（2つの生存曲線が重なるかどうかを確認します）。新しい <u>survfit オブジェクト</u> は少し異なる formula を用いて作成されます。そして、<u>survdiff オブジェクト</u> が作成されます。</p>
<p>モデル式を記述している formula の右辺に <code>~ gender</code> を指定することで、全体の生存ではなく性別ごとのプロットを作成できます。</p>
<div class="sourceCode" id="cb1302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 性別に基づいて新しい survfit オブジェクトを作成</span></span>
<span><span class="va">linelistsurv_fit_sex</span> <span class="op">&lt;-</span>  <span class="fu">survfit</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span>, data <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">)</span></span></code></pre></div>
<p>新しいオブジェクトを作成すると、性別ごとの生存曲線を作成できます。色や凡例を決める前に、性別の列の水準の順番を見てみましょう。</p>
<div class="sourceCode" id="cb1303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 色を設定</span></span>
<span><span class="va">col_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightgreen"</span>, <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># プロットを作成</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>     <span class="va">linelistsurv_fit_sex</span>,</span>
<span>     col <span class="op">=</span> <span class="va">col_sex</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Survival Probability"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 凡例の追加</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>     <span class="st">"topright"</span>,</span>
<span>     legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span>,</span>
<span>     col <span class="op">=</span> <span class="va">col_sex</span>,</span>
<span>     lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     cex <span class="op">=</span> <span class="fl">.9</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-916-1.png" width="672"></div>
<p>そして、<code>survdiff()</code> を用いて生存曲線の群間差の仮説検定を行うことができます。</p>
<div class="sourceCode" id="cb1304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 生存曲線の差の仮説検定を実行</span></span>
<span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survdiff.html">survdiff</a></span><span class="op">(</span></span>
<span>     <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span>, </span>
<span>     data <span class="op">=</span> <span class="va">linelist_surv</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>## Call:
## survival::survdiff(formula = Surv(futime, event) ~ gender, data = linelist_surv)
## 
## n=4321, 218 observations deleted due to missingness.
## 
##             N Observed Expected (O-E)^2/E (O-E)^2/V
## gender=f 2156      924      909     0.255     0.524
## gender=m 2165      929      944     0.245     0.524
## 
##  Chisq= 0.5  on 1 degrees of freedom, p= 0.5</code></pre>
<p>女性と男性の生存曲線が重なっているのが分かり、ログランク検定の結果も生存状況の性差を示唆していませんでした。</p>
<p>他の R パッケージでも生存曲線の群間差の図示と群間差の仮説検定を同時に行うことができます。<strong>survminer</strong> パッケージの <code>ggsurvplot()</code> を用いると、各群の生存曲線とリスク集合の表とログランク検定の p 値を表示することができます。</p>
<p><span style="color: orange;"><strong><u>注意：</u></strong> <strong>ggsurvplot()</strong> では survfit オブジェクト <u>に加えて</u> そのオブジェクトを作成するのに用いたデータを再度指定する必要があります。エラーメッセージが表示されてしまうので、忘れずに指定してください。</span></p>
<div class="sourceCode" id="cb1306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span></span>
<span>     <span class="va">linelistsurv_fit_sex</span>, </span>
<span>     data <span class="op">=</span> <span class="va">linelist_surv</span>,          <span class="co"># linelistsurv_fit_sex を作成するのに用いたデータを再度指定</span></span>
<span>     conf.int <span class="op">=</span> <span class="cn">FALSE</span>,              <span class="co"># KM 推定値の信頼区間を非表示</span></span>
<span>     surv.scale <span class="op">=</span> <span class="st">"percent"</span>,        <span class="co"># y 軸の確率を % で表示</span></span>
<span>     break.time.by <span class="op">=</span> <span class="fl">10</span>,            <span class="co"># x 軸の時間を 10 日刻みで表示</span></span>
<span>     xlab <span class="op">=</span> <span class="st">"Follow-up days"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Survival Probability"</span>,</span>
<span>     pval <span class="op">=</span> <span class="cn">T</span>,                      <span class="co"># ログランク検定の p 値を表示</span></span>
<span>     pval.coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">.91</span><span class="op">)</span>,       <span class="co"># 座標を指定して p 値を表示</span></span>
<span>     risk.table <span class="op">=</span> <span class="cn">T</span>,                <span class="co"># 下にリスク集合の表を表示</span></span>
<span>     legend.title <span class="op">=</span> <span class="st">"Gender"</span>,       <span class="co"># 凡例のタイトル</span></span>
<span>     legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>, <span class="st">"Male"</span><span class="op">)</span>,</span>
<span>     font.legend <span class="op">=</span> <span class="fl">10</span>, </span>
<span>     palette <span class="op">=</span> <span class="st">"Dark2"</span>,             <span class="co"># カラーパレットの指定</span></span>
<span>     surv.median.line <span class="op">=</span> <span class="st">"hv"</span>,       <span class="co"># 生存時間中央値の位置に縦と横の補助線を描画</span></span>
<span>     ggtheme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span>        <span class="co"># シンプルなテーマを使用</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-918-1.png" width="672"></div>
<p>また、感染源（汚染源）による生存の違いを検証したい場合があるかもしれません。</p>
<p>このケースについては、<code>alpha = 0.05</code> でのログランク検定により十分な生存確率の差があると考えることにします。葬儀により感染した患者の生存確率は他の場所で感染した患者の生存確率よりも高く、生存に対するベネフィットがあるのかもしれません。</p>
<div class="sourceCode" id="cb1307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelistsurv_fit_source</span> <span class="op">&lt;-</span>  <span class="fu">survfit</span><span class="op">(</span></span>
<span>     <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">source</span>,</span>
<span>     data <span class="op">=</span> <span class="va">linelist_surv</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># プロット</span></span>
<span><span class="fu">ggsurvplot</span><span class="op">(</span> </span>
<span>     <span class="va">linelistsurv_fit_source</span>,</span>
<span>     data <span class="op">=</span> <span class="va">linelist_surv</span>,</span>
<span>     size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"strata"</span>,   <span class="co"># 線種</span></span>
<span>     conf.int <span class="op">=</span> <span class="cn">T</span>,</span>
<span>     surv.scale <span class="op">=</span> <span class="st">"percent"</span>,  </span>
<span>     break.time.by <span class="op">=</span> <span class="fl">10</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Follow-up days"</span>,</span>
<span>     ylab<span class="op">=</span> <span class="st">"Survival Probability"</span>,</span>
<span>     pval <span class="op">=</span> <span class="cn">T</span>,</span>
<span>     pval.coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">.91</span><span class="op">)</span>,</span>
<span>     risk.table <span class="op">=</span> <span class="cn">T</span>,</span>
<span>     legend.title <span class="op">=</span> <span class="st">"Source of \ninfection"</span>,</span>
<span>     legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Funeral"</span>, <span class="st">"Other"</span><span class="op">)</span>,</span>
<span>     font.legend <span class="op">=</span> <span class="fl">10</span>,</span>
<span>     palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#E7B800"</span>, <span class="st">"#3E606F"</span><span class="op">)</span>,</span>
<span>     surv.median.line <span class="op">=</span> <span class="st">"hv"</span>, </span>
<span>     ggtheme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-919-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="cox-回帰分析" class="section level2" number="27.5">
<h2>
<span class="header-section-number">27.5</span> Cox 回帰分析<a class="anchor" aria-label="anchor" href="#cox-%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90"><i class="fas fa-link"></i></a>
</h2>
<p>Cox の比例ハザードモデル（Cox proportional hazards model / Cox regression model）は生存時間解析の最も一般的な回帰モデルの一つです。Cox 回帰モデルは、比例ハザード性の仮定などの適切に用いるために検証を必要とする <u>重要な仮定</u> をおくため、他のモデルを用いることもできます。詳細は文献を確認してください。</p>
<p>Cox の比例ハザードモデルにおける効果の尺度は <strong><u>ハザード率</u></strong>（hazard rate）で、これは特定の時点までイベントが発生しなかった人のイベント発生リスク（この章の例では、死亡のリスク）になっています。通常、<u>独立</u>な群におけるハザードの比較に興味があるためハザード比（hazard ratio; HR）を用います。ハザード比は多重ロジスティック回帰分析におけるオッズ比に相当する指標です。<strong>survival</strong> パッケージの <code>coxph()</code> は、Cox 回帰モデルの当てはめに用いられます。<strong>survival</strong> パッケージの <code>cox.zph()</code> は、当てはめたモデルについて比例ハザード性の仮定に対する仮説検定に用いることができます。</p>
<p><span style="color: black;"><strong>注釈：</strong> 確率は0から1の間の値をとります。一方で、ハザードは単位時間当たりのイベント発生数の期待値を表しています。</span></p>
<ul>
<li>ある説明変数に対するハザード比が1に近ければ、その説明変数は生存に影響を与えていません</li>
<li>ハザード比が1より小さければ、その説明変数は保護的です（すなわち、生存の改善に関連があります）</li>
<li>ハザード比が1より大きければ、その説明変数はリスクの上昇（生存の悪化）に関連があります。</li>
</ul>
<div id="cox-回帰モデルの当てはめ" class="section level3 unnumbered">
<h3>Cox 回帰モデルの当てはめ<a class="anchor" aria-label="anchor" href="#cox-%E5%9B%9E%E5%B8%B0%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%BD%93%E3%81%A6%E3%81%AF%E3%82%81"><i class="fas fa-link"></i></a>
</h3>
<p>まずは、年齢と性別が生存に与える影響を評価するために、モデルの当てはめを行います。モデルの当てはめ結果を表示するだけで、以下の情報が得られます：</p>
<ul>
<li>回帰係数の推定値 <code>coef</code>、この値は説明変数とアウトカムの間の関連を定量化したものです</li>
<li>これらの値を解釈のために指数変換した <code>exp(coef)</code>、これは<u>ハザード比</u>になっています</li>
<li>これらの値の標準誤差 <code>se(coef)</code>
</li>
<li>z スコア：回帰係数の推定値が 0 から何標準誤差離れているか</li>
<li>p 値：回帰係数が 0 かどうかの仮説検定における p 値。</li>
</ul>
<p>Cox 回帰モデルのオブジェクトに <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> を適用すると、ハザード比の推定値の信頼区間や別の仮説検定の結果などのより詳細な情報が得られます。</p>
<p>最初の共変量 <code>gender</code> の効果は最初の行に表示されています。ここには <code>genderm</code>（男性）と表示されており、最初の水準（“f”）、つまり女性が性別の参照水準となっていることが分かります。そのため、パラメータは女性に対する男性の結果として解釈します。また、p 値から、性別によるハザードの期待値に対する影響または性別と全死亡率の間に関連があるとは言えないです。</p>
<p>同様に、年齢群についても差があるとは言えないです。</p>
<div class="sourceCode" id="cb1308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cox 回帰モデルの当てはめ</span></span>
<span><span class="va">linelistsurv_cox_sexage</span> <span class="op">&lt;-</span>  <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span><span class="op">(</span></span>
<span>     <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age_cat_small</span>, </span>
<span>     data <span class="op">=</span> <span class="va">linelist_surv</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># モデルの当てはめ結果の表示</span></span>
<span><span class="va">linelistsurv_cox_sexage</span></span></code></pre></div>
<pre><code>## Call:
## survival::coxph(formula = Surv(futime, event) ~ gender + age_cat_small, 
##     data = linelist_surv)
## 
##                       coef exp(coef) se(coef)      z     p
## genderm           -0.03149   0.96900  0.04767 -0.661 0.509
## age_cat_small5-19  0.09400   1.09856  0.06454  1.456 0.145
## age_cat_small20+   0.05032   1.05161  0.06953  0.724 0.469
## 
## Likelihood ratio test=2.8  on 3 df, p=0.4243
## n= 4321, number of events= 1853 
##    (218 observations deleted due to missingness)</code></pre>
<div class="sourceCode" id="cb1310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># モデルの要約</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_cox_sexage</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Call:
## survival::coxph(formula = Surv(futime, event) ~ gender + age_cat_small, 
##     data = linelist_surv)
## 
##   n= 4321, number of events= 1853 
##    (218 observations deleted due to missingness)
## 
##                       coef exp(coef) se(coef)      z Pr(&gt;|z|)
## genderm           -0.03149   0.96900  0.04767 -0.661    0.509
## age_cat_small5-19  0.09400   1.09856  0.06454  1.456    0.145
## age_cat_small20+   0.05032   1.05161  0.06953  0.724    0.469
## 
##                   exp(coef) exp(-coef) lower .95 upper .95
## genderm               0.969     1.0320    0.8826     1.064
## age_cat_small5-19     1.099     0.9103    0.9680     1.247
## age_cat_small20+      1.052     0.9509    0.9176     1.205
## 
## Concordance= 0.514  (se = 0.007 )
## Likelihood ratio test= 2.8  on 3 df,   p=0.4
## Wald test            = 2.78  on 3 df,   p=0.4
## Score (logrank) test = 2.78  on 3 df,   p=0.4</code></pre>
<p>モデルの当てはめを行い結果を見るのは面白いですが、最初に比例ハザード性の仮定が成り立つかどうかを検討しておくと、時間の節約になります。</p>
<div class="sourceCode" id="cb1312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_ph_sexage</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cox.zph.html">cox.zph</a></span><span class="op">(</span><span class="va">linelistsurv_cox_sexage</span><span class="op">)</span></span>
<span><span class="va">test_ph_sexage</span></span></code></pre></div>
<pre><code>##               chisq df    p
## gender        0.454  1 0.50
## age_cat_small 0.838  2 0.66
## GLOBAL        1.399  3 0.71</code></pre>
<p><span style="color: black;"><strong>注釈：</strong> Cox モデルの当てはめでは2つ目の引数 <u>method</u> を指定でき、タイの取り扱い方法を変更することができます。<u>デフォルト</u>は “efron” で、他にも “breslow” や “exact” が指定できます。</span></p>
<p>他のモデルとして感染源や発症から入院までの日数をリスク因子として追加します。今回は、まず比例ハザード性の仮定の評価を先に行ってみます。</p>
<p>このモデルには連続値の説明変数（<code>days_onset_hosp</code>）が含まれています。このような場合、パラメータ推定値の解釈は、説明変数が1単位増加したときに増加する対数相対ハザードの期待値、となります。まずは、比例ハザード性の仮定の評価を行います。</p>
<div class="sourceCode" id="cb1314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># モデルの当てはめ</span></span>
<span><span class="va">linelistsurv_cox</span> <span class="op">&lt;-</span>  <span class="fu">coxph</span><span class="op">(</span></span>
<span>     <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age_years</span> <span class="op">+</span> <span class="va">source</span> <span class="op">+</span> <span class="va">days_onset_hosp</span>,</span>
<span>     data <span class="op">=</span> <span class="va">linelist_surv</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># 比例ハザード性の仮説検定</span></span>
<span><span class="va">linelistsurv_ph_test</span> <span class="op">&lt;-</span> <span class="fu">cox.zph</span><span class="op">(</span><span class="va">linelistsurv_cox</span><span class="op">)</span></span>
<span><span class="va">linelistsurv_ph_test</span></span></code></pre></div>
<pre><code>##                    chisq df       p
## gender           0.45062  1    0.50
## age_years        0.00199  1    0.96
## source           1.79622  1    0.18
## days_onset_hosp 31.66167  1 1.8e-08
## GLOBAL          34.08502  4 7.2e-07</code></pre>
<p>また、<strong>survminer</strong> パッケージの <code>ggcoxzph()</code> を用いて、この仮定に対する視覚的な評価を行うことができます。</p>
<div class="sourceCode" id="cb1316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggcoxzph.html">ggcoxzph</a></span><span class="op">(</span><span class="va">linelistsurv_ph_test</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-920-1.png" width="672"></div>
<p>モデルの当てはめ結果から、発症から入院までの日数と全死亡率の間に負の関連があることが示唆されます。ハザードの期待値は、性別などを固定したもとで、発症から入院までの日数が1日遅くなると0.9倍となっていました。もっと直接的に説明すると、発症から入院までの日数が1日伸びると、死亡のリスクが10.7%（<code>coef *100</code>）減少する、となります。</p>
<p>また、モデルの結果は感染源と全死亡率の間の正の関連も示していました。これについては、他の感染による患者は葬儀で感染した患者と比べて死亡リスクが高い（1.21倍）という結果でした。</p>
<div class="sourceCode" id="cb1317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># モデルの要約を表示</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_cox</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(futime, event) ~ gender + age_years + source + 
##     days_onset_hosp, data = linelist_surv)
## 
##   n= 2772, number of events= 1180 
##    (1767 observations deleted due to missingness)
## 
##                      coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
## genderm          0.004710  1.004721  0.060827  0.077   0.9383    
## age_years       -0.002249  0.997753  0.002421 -0.929   0.3528    
## sourceother      0.178393  1.195295  0.084291  2.116   0.0343 *  
## days_onset_hosp -0.104063  0.901169  0.014245 -7.305 2.77e-13 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
##                 exp(coef) exp(-coef) lower .95 upper .95
## genderm            1.0047     0.9953    0.8918    1.1319
## age_years          0.9978     1.0023    0.9930    1.0025
## sourceother        1.1953     0.8366    1.0133    1.4100
## days_onset_hosp    0.9012     1.1097    0.8764    0.9267
## 
## Concordance= 0.566  (se = 0.009 )
## Likelihood ratio test= 71.31  on 4 df,   p=1e-14
## Wald test            = 59.22  on 4 df,   p=4e-12
## Score (logrank) test = 59.54  on 4 df,   p=4e-12</code></pre>
<p>この関係を表にして確認することもできます：</p>
<div class="sourceCode" id="cb1319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist_case_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">tabyl</span><span class="op">(</span><span class="va">days_onset_hosp</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu">adorn_percentages</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>     <span class="fu">adorn_pct_formatting</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  days_onset_hosp Death Recover   NA_
##                0 44.3%   31.4% 24.3%
##                1 46.6%   32.2% 21.2%
##                2 43.0%   32.8% 24.2%
##                3 45.0%   32.3% 22.7%
##                4 41.5%   38.3% 20.2%
##                5 40.0%   36.2% 23.8%
##                6 32.2%   48.7% 19.1%
##                7 31.8%   38.6% 29.5%
##                8 29.8%   38.6% 31.6%
##                9 30.3%   51.5% 18.2%
##               10 16.7%   58.3% 25.0%
##               11 36.4%   45.5% 18.2%
##               12 18.8%   62.5% 18.8%
##               13 10.0%   60.0% 30.0%
##               14 10.0%   50.0% 40.0%
##               15 28.6%   42.9% 28.6%
##               16 20.0%   80.0%  0.0%
##               17  0.0%  100.0%  0.0%
##               18  0.0%  100.0%  0.0%
##               22  0.0%  100.0%  0.0%
##               NA 52.7%   31.2% 16.0%</code></pre>
<p>このデータにおいて、なぜこの様な関連が見られたのかについて考え、検討する必要があります。入院まで時間がかかっていても生き延びていた患者はもともと重症度が低かった可能性があるという説明が可能です。また、別の説明も考えられ、シミュレーションによる疑似データセットを使用したため、このパターンが現実を反映していないのかもしれません。</p>
<!-- ======================================================= -->
</div>
<div id="フォレストプロット-1" class="section level3 unnumbered">
<h3>フォレストプロット<a class="anchor" aria-label="anchor" href="#%E3%83%95%E3%82%A9%E3%83%AC%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%83%83%E3%83%88-1"><i class="fas fa-link"></i></a>
</h3>
<p>Cox 回帰モデルの結果について、<strong>survminer</strong> パッケージの <code>ggforest()</code> を用いて、フォレストプロットによる可視化を行うことができます。</p>
<div class="sourceCode" id="cb1321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggforest</span><span class="op">(</span><span class="va">linelistsurv_cox</span>, data <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/forestp-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="生存時間モデルにおける時間依存性共変量" class="section level2" number="27.6">
<h2>
<span class="header-section-number">27.6</span> 生存時間モデルにおける時間依存性共変量<a class="anchor" aria-label="anchor" href="#%E7%94%9F%E5%AD%98%E6%99%82%E9%96%93%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E6%99%82%E9%96%93%E4%BE%9D%E5%AD%98%E6%80%A7%E5%85%B1%E5%A4%89%E9%87%8F"><i class="fas fa-link"></i></a>
</h2>
<p>以下の節の一部は、<a href="https://www.emilyzabor.com/">Dr. Emily Zabor</a> の許可を得て <a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html">Survival analysis in R</a> の素晴らしい解説から引用しています。</p>
<p>前の節では、Cox 回帰モデルを用いて興味のある共変量と生存アウトカムの間の関連を評価する方法を説明しました。しかし、これらの解析では、共変量がベースライン時点、つまりイベントの追跡が始まる前に測定されていること想定していました。</p>
<p>興味のある共変量が追跡を開始した<strong>後で</strong>測定されているとどうなるでしょうか？もしくは、時間で変化する共変量がある場合はどうなるでしょう？</p>
<p>例えば、臨床検査値を繰り返し測定した臨床データを扱っている場合、その値は時間の経過とともに変化する可能性があります。これは <strong>時間依存性共変量（Time Dependent Covariate）</strong> の一例です。時間依存性共変量を扱うためには特別な準備が必要です。しかし、幸運なことに Cox 回帰モデルはとても柔軟であり、また、<strong>survival</strong> パッケージと一連のツールを用いてこのタイプのデータをモデル化することができます。</p>
<div id="時間依存性共変量の設定" class="section level3 unnumbered">
<h3>時間依存性共変量の設定<a class="anchor" aria-label="anchor" href="#%E6%99%82%E9%96%93%E4%BE%9D%E5%AD%98%E6%80%A7%E5%85%B1%E5%A4%89%E9%87%8F%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fas fa-link"></i></a>
</h3>
<p>R において時間依存性共変量の解析を行うためには特別なデータセットを準備する必要があります。興味があれば <strong>survival</strong> パッケージの著者による、より詳細な説明（<a href="https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf%EF%BC%89">Using Time Dependent Covariates and Time Dependent Coefficients in the Cox Model</a> を確認してください。</p>
<p>ここでは、<code>SemiCompRisks</code> パッケージの <code>BMT</code> という新しいデータセットを使用します。このデータは137名の骨髄移植患者のデータです。この節で扱う変数は以下の通りです：</p>
<ul>
<li>
<code>T1</code> - 死亡時間または最終追跡時間 (日)</li>
<li>
<code>delta1</code> - 死亡の指示変数；1-死亡、0-生存<br>
</li>
<li>
<code>TA</code> - 急性移植片対宿主病発生までの時間</li>
<li>
<code>deltaA</code> - 急性移植片対宿主病の指示変数；</li>
<li>1 - 急性移植片対宿主病の発生あり</li>
<li>0 - 急性移植片対宿主病の発生なし</li>
</ul>
<p><strong>base</strong> の R コマンド <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> を用いて、<strong>SemiCompRisks</strong> パッケージからこのデータセットを読み込みます。このコマンドは R パッケージに含まれているデータを読み込むことができます。以下を実行すると、<code>BMT</code> というデータフレームが R 上に読み込まれます。</p>
<div class="sourceCode" id="cb1322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">BMT</span>, package <span class="op">=</span> <span class="st">"SemiCompRisks"</span><span class="op">)</span></span></code></pre></div>
<div id="患者固有の-id-の追加" class="section level4 unnumbered">
<h4>患者固有の ID の追加<a class="anchor" aria-label="anchor" href="#%E6%82%A3%E8%80%85%E5%9B%BA%E6%9C%89%E3%81%AE-id-%E3%81%AE%E8%BF%BD%E5%8A%A0"><i class="fas fa-link"></i></a>
</h4>
<p><code>BMT</code> データには患者固有の ID がありませんが、時間依存性共変量の解析には固有の ID 変数が必要です。そのため、<strong>tidyverse</strong> の <strong>tibble</strong> パッケージの <code><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column()</a></code> を用いて <code>my_id</code> という新しい ID の列を作成します（データフレームの最初に1から始まる連番の ID の列を追加します）。そして、このデータフレームの名前は <code>bmt</code> としました。</p>
<div class="sourceCode" id="cb1323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op">(</span><span class="va">BMT</span>, <span class="st">"my_id"</span><span class="op">)</span></span></code></pre></div>
<p>このデータセットは以下のようになります：</p>
<div id="htmlwidget-e6a26f02bbcda35f89c4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e6a26f02bbcda35f89c4">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[2081,1602,1496,1462,1433,1377,1330,996,226,1199,1111,530,1182,1167,418,417,276,156,781,172,487,716,194,371,526,122,1279,110,243,86,466,262,162,262,1,107,269,350,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,2246,1870,1799,1709,1674,1568,1527,1324,957,932,847,848,1850,1843,1535,1447,1384,414,2204,1063,481,105,641,390,288,522,79,1156,583,48,431,1074,393,10,53,80,35,1499,704,653,222,1356,2640,2430,2252,2140,2133,1238,1631,2024,1345,1136,845,491,162,1298,121,2,62,265,547,341,318,195,469,93,515,183,105,128,164,129,122,80,677,73,168,74,16,248,732,105,392,63,97,153,363],[2081,1602,1496,1462,1433,1377,1330,996,226,1199,1111,530,1182,1167,418,383,276,104,609,172,487,662,194,230,526,122,129,74,122,86,466,192,109,55,1,107,110,332,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,2246,1870,1799,1709,1674,1568,1527,1324,957,932,847,848,1850,1843,1535,1447,1384,414,2204,1063,481,105,641,390,288,421,79,748,486,48,272,1074,381,10,53,80,35,248,704,211,219,606,2640,2430,2252,2140,2133,1238,1631,2024,1345,1136,845,422,162,84,100,2,47,242,456,268,318,32,467,47,390,183,105,115,164,93,120,80,677,64,168,74,16,157,625,48,273,63,76,113,363],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,1,0,1,0,0,1,1,1,0,0,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,1,0,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,1,1,1,0,1,1,1,1,0,0,1,0,1,1,0,0,1,0,0,0,1,1,1,1,0,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[67,1602,1496,70,1433,1377,1330,72,226,1199,1111,38,1182,39,418,417,276,28,781,22,487,716,194,371,526,88,1279,110,243,86,466,10,162,262,1,107,269,350,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,52,1870,1799,20,1674,1568,1527,25,957,29,847,848,1850,1843,1535,1447,1384,414,2204,1063,30,21,641,390,18,25,16,1156,583,48,431,1074,393,10,53,10,35,1499,36,653,222,1356,2640,2430,2252,2140,2133,1238,1631,2024,32,1136,845,491,162,1298,28,2,62,265,547,21,318,195,469,93,515,183,105,128,164,129,122,21,677,73,168,29,16,248,732,105,392,38,97,153,363],[1,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0],[121,139,307,95,236,123,96,121,226,91,1111,84,112,487,220,417,81,156,781,172,76,716,94,184,121,122,1279,110,243,86,119,84,162,262,1,107,120,350,2569,2506,2409,2218,260,1829,1562,180,200,210,860,120,380,230,140,348,1674,1568,1527,1324,957,932,847,155,1850,1843,1535,220,200,414,2204,240,120,105,641,390,100,140,79,180,583,48,431,120,100,10,53,80,35,1499,155,653,123,1356,2640,2430,150,220,250,250,150,180,360,140,845,180,162,1298,121,2,62,210,130,100,140,195,90,93,515,130,105,128,164,129,122,80,150,73,200,74,16,100,732,105,122,63,97,153,363],[1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,0,0,0,1,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,0,1,0,0,0,1,1,0,0,0,0,0,1,0,1,0,0,0,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1,1,0,1,0,0,1,0,0,0,0,0,0,1,0,1,0,0,1,0,0,1,0,0,0,0],[13,18,12,13,12,12,17,12,10,29,22,34,22,1167,21,16,21,20,26,37,22,17,25,9,11,13,22,49,23,86,100,59,40,24,1,107,27,33,21,17,16,11,15,19,18,14,12,14,15,66,15,16,12,19,24,14,13,15,69,7,16,16,9,19,21,24,19,27,12,16,24,15,11,11,288,20,79,18,11,14,12,19,16,10,53,80,35,9,18,23,52,14,22,14,17,18,17,18,40,16,14,15,20,491,13,1298,65,2,11,14,24,17,12,16,20,28,31,21,105,12,164,51,12,0,8,38,48,24,16,52,18,30,24,16,97,59,19],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1],[26,21,26,17,32,22,20,22,18,24,19,17,24,27,18,15,18,20,27,40,22,28,26,39,15,20,17,28,37,17,15,29,36,23,42,30,29,22,19,31,35,16,29,19,26,27,13,25,25,30,45,33,32,23,37,15,22,46,18,27,28,23,37,34,35,33,21,21,25,50,35,37,26,50,45,28,43,14,17,32,30,30,33,34,33,30,23,35,29,23,28,33,18,29,35,27,36,24,27,35,50,47,40,22,22,8,39,20,27,32,31,20,35,36,35,7,23,11,14,37,19,37,25,35,15,45,32,41,27,33,39,17,43,44,48,31,52],[33,37,35,21,36,31,17,24,21,40,28,28,23,22,14,20,5,33,27,37,20,32,32,31,20,26,20,25,38,26,18,32,43,16,48,19,20,20,13,34,31,16,35,18,30,34,24,29,31,16,39,30,23,28,34,19,12,31,17,30,29,26,36,32,32,28,18,15,19,38,36,34,24,48,43,30,43,19,14,33,23,32,28,54,41,35,25,18,21,16,30,22,23,26,31,17,39,28,21,41,36,27,39,21,23,2,48,19,25,32,28,23,40,39,33,2,25,7,18,35,32,34,29,28,14,42,43,29,36,39,43,14,50,37,56,25,48],[1,1,1,0,1,1,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,0,1,1,0,1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,0,0,0,0,0,1,0,1,1,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,1,0,1,1,1,1,1,0,0,1,0,1,1,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,0,1],[0,1,1,1,1,1,0,0,1,1,1,1,0,1,1,1,0,1,0,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,1,0,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1],[1,0,1,0,1,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,1,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,1,0,1,0,1,1,0,0,0,1,0,1,1,0,1,1,1,0,0,1,1,0,0,0,1,1,1,0,1,0,1,0,0,1,0,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1],[1,0,0,0,1,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,0,0,0,1,0,1,0,0,1,0,0,0,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,0,0,0,0,1,1,0,1,0,1,1,0,1,1,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,0,1,1,0,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0],[98,1720,127,168,93,2187,1006,1319,208,174,236,151,203,191,110,824,146,85,187,129,128,84,329,147,943,2616,937,303,170,239,508,74,393,331,196,178,361,834,270,60,120,60,90,210,90,240,90,210,180,180,105,225,120,90,60,90,450,75,90,60,75,180,180,270,180,150,120,120,60,270,90,120,90,120,90,90,90,60,120,150,120,150,120,240,180,150,150,30,105,90,120,210,750,24,120,210,240,240,690,105,120,900,210,210,300,105,210,75,90,180,630,180,300,90,120,135,210,120,150,270,285,240,510,780,150,180,150,750,180,180,150,210,240,360,330,240,180],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,0,0,0,1,0,0,1,0,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,0,1,0,0,0],[1,1,1,1,1,1,1,1,1,3,3,3,2,2,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,4,4,4,3,3,1,1,1,1,1,1,2,4,4,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,4,4,4,4,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,1,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>my_id<\/th>\n      <th>g<\/th>\n      <th>T1<\/th>\n      <th>T2<\/th>\n      <th>delta1<\/th>\n      <th>delta2<\/th>\n      <th>delta3<\/th>\n      <th>TA<\/th>\n      <th>deltaA<\/th>\n      <th>TC<\/th>\n      <th>deltaC<\/th>\n      <th>TP<\/th>\n      <th>deltaP<\/th>\n      <th>Z1<\/th>\n      <th>Z2<\/th>\n      <th>Z3<\/th>\n      <th>Z4<\/th>\n      <th>Z5<\/th>\n      <th>Z6<\/th>\n      <th>Z7<\/th>\n      <th>Z8<\/th>\n      <th>Z9<\/th>\n      <th>Z10<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="患者の行の展開" class="section level4 unnumbered">
<h4>患者の行の展開<a class="anchor" aria-label="anchor" href="#%E6%82%A3%E8%80%85%E3%81%AE%E8%A1%8C%E3%81%AE%E5%B1%95%E9%96%8B"><i class="fas fa-link"></i></a>
</h4>
<p>次に、時間依存性共変量のために再構成したデータセットを作成するために、補助関数 <code>event()</code> および <code>tdc()</code> とともに <code>tmerge()</code> を使用していきます。目標は、各患者のデータが異なる値の <code>deltaA</code> を持つ時間区間になるように分割し、データセットを再構成することです。このデータの場合、各患者は急性移植片対宿主病を発症したか否かに応じて、最大で2行のデータを持つことができます。以下では、急性移植片対宿主病を発症したかどうかの新しい指示変数を <code>agvhd</code> と呼ぶことにします。</p>
<ul>
<li>
<code>tmerge()</code> は各患者の異なる共変量の値に応じて複数の時間区間の縦長の long 型データセットを作成します</li>
<li>
<code>event()</code> は新しく作成された時間区間に対応する新しいイベントの指示変数を作成します</li>
<li>
<code>tdc()</code> は新しく作成された時間区間に対応する新しい時間依存性共変量の列（<code>agvhd</code>）を作成します</li>
</ul>
<div class="sourceCode" id="cb1324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">td_dat</span> <span class="op">&lt;-</span> </span>
<span>     <span class="fu">tmerge</span><span class="op">(</span></span>
<span>          data1 <span class="op">=</span> <span class="va">bmt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span><span class="op">)</span>, </span>
<span>          data2 <span class="op">=</span> <span class="va">bmt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span>, <span class="va">TA</span>, <span class="va">deltaA</span><span class="op">)</span>, </span>
<span>          id <span class="op">=</span> <span class="va">my_id</span>, </span>
<span>          death <span class="op">=</span> <span class="fu">event</span><span class="op">(</span><span class="va">T1</span>, <span class="va">delta1</span><span class="op">)</span>,</span>
<span>          agvhd <span class="op">=</span> <span class="fu">tdc</span><span class="op">(</span><span class="va">TA</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span></code></pre></div>
<p>上記のコードで何が行われるのか、最初の5人の患者のデータを見てみましょう。</p>
<p>元のデータにおける各変数の値は以下のようになっていました：</p>
<div class="sourceCode" id="cb1325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span>, <span class="va">TA</span>, <span class="va">deltaA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">my_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   my_id   T1 delta1   TA deltaA
## 1     1 2081      0   67      1
## 2     2 1602      0 1602      0
## 3     3 1496      0 1496      0
## 4     4 1462      0   70      1
## 5     5 1433      0 1433      0</code></pre>
<p>新しいデータセットにおける同じ患者のデータは以下のようになります：</p>
<div class="sourceCode" id="cb1327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">td_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">my_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   my_id   T1 delta1 tstart tstop death agvhd
## 1     1 2081      0      0    67     0     0
## 2     1 2081      0     67  2081     0     1
## 3     2 1602      0      0  1602     0     0
## 4     3 1496      0      0  1496     0     0
## 5     4 1462      0      0    70     0     0
## 6     4 1462      0     70  1462     0     1
## 7     5 1433      0      0  1433     0     0</code></pre>
<p>このデータでは、一部の患者は2つの行を持っており、各行が新しい変数 <code>agvhd</code> に異なる値を持つ2つの区間に対応するようになっています。例えば、患者1は <code>agvhd</code> の値が0の時間0から67の区間と、<code>agvhd</code> の値が1の時間67から2081の区間の2つの行を持っています。</p>
</div>
</div>
<div id="時間依存性共変量を持つ-cox-回帰モデル" class="section level3 unnumbered">
<h3>時間依存性共変量を持つ Cox 回帰モデル<a class="anchor" aria-label="anchor" href="#%E6%99%82%E9%96%93%E4%BE%9D%E5%AD%98%E6%80%A7%E5%85%B1%E5%A4%89%E9%87%8F%E3%82%92%E6%8C%81%E3%81%A4-cox-%E5%9B%9E%E5%B8%B0%E3%83%A2%E3%83%87%E3%83%AB"><i class="fas fa-link"></i></a>
</h3>
<p>データを再構成し、新しく時間依存性共変量の変数 <code>aghvd</code> が追加されたので、単純な1つの時間依存性共変量を持つ Cox 回帰モデルを当てはめてみましょう。前の節で用いたものと同じ <code>coxph()</code> を用いることができますが、<code>Surv()</code> で各区間の開始時間と終了時間を指定する必要があります。これは引数 <code>time1 =</code> と <code>time2 =</code> で指定します。</p>
<div class="sourceCode" id="cb1329"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmt_td_model</span> <span class="op">=</span> <span class="fu">coxph</span><span class="op">(</span></span>
<span>     <span class="fu">Surv</span><span class="op">(</span>time <span class="op">=</span> <span class="va">tstart</span>, time2 <span class="op">=</span> <span class="va">tstop</span>, event <span class="op">=</span> <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="va">agvhd</span>, </span>
<span>     data <span class="op">=</span> <span class="va">td_dat</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bmt_td_model</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(time = tstart, time2 = tstop, event = death) ~ 
##     agvhd, data = td_dat)
## 
##   n= 163, number of events= 80 
## 
##         coef exp(coef) se(coef)    z Pr(&gt;|z|)
## agvhd 0.3351    1.3980   0.2815 1.19    0.234
## 
##       exp(coef) exp(-coef) lower .95 upper .95
## agvhd     1.398     0.7153    0.8052     2.427
## 
## Concordance= 0.535  (se = 0.024 )
## Likelihood ratio test= 1.33  on 1 df,   p=0.2
## Wald test            = 1.42  on 1 df,   p=0.2
## Score (logrank) test = 1.43  on 1 df,   p=0.2</code></pre>
<p>また、<strong>survminer</strong> パッケージの <code>ggforest()</code> を用いて Cox 回帰モデルの結果を可視化してみます：</p>
<div class="sourceCode" id="cb1331"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggforest</span><span class="op">(</span><span class="va">bmt_td_model</span>, data <span class="op">=</span> <span class="va">td_dat</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-929-1.png" width="672"></div>
<p>フォレストプロット、信頼区間、および p 値から分かるように、この単純なモデルにおいては死亡と急性移植片対宿主病の間に強い関連があるとは言えませんでした。</p>
<!-- ======================================================= -->
</div>
</div>
<div id="参考資料-19" class="section level2" number="27.7">
<h2>
<span class="header-section-number">27.7</span> 参考資料<a class="anchor" aria-label="anchor" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-19"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2394262/">Survival Analysis Part I: Basic concepts and first analyses</a></p>
<p><a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html">Survival Analysis in R</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2954271/">Survival analysis in infectious disease research: Describing events in time</a></p>
<p><a href="https://data.princeton.edu/wws509/notes/c7.pdf">Chapter on advanced survival models Princeton</a></p>
<p><a href="https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf">Using Time Dependent Covariates and Time Dependent Coefficients in the Cox Model</a></p>
<p><a href="https://publicifsv.sund.ku.dk/~ts/survival/survival-cheat.pdf">Survival analysis cheatsheet R</a></p>
<p><a href="https://paulvanderlaken.files.wordpress.com/2017/08/survminer_cheatsheet.pdf">Survminer cheatsheet</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6322561/">Paper on different survival measures for cancer registry data with Rcode provided as supplementary materials</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></div>
<div class="next"><a href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#survival-analysis"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="nav-link" href="#%E6%A6%82%E8%A6%81-4"><span class="header-section-number">27.1</span> 概要</a></li>
<li>
<a class="nav-link" href="#%E6%BA%96%E5%82%99-17"><span class="header-section-number">27.2</span> 準備</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-12">パッケージの読み込み</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88">データセットのインポート</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%9E%E3%83%8D%E3%82%B8%E3%83%A1%E3%83%B3%E3%83%88%E3%81%A8%E5%A4%89%E6%8F%9B">データマネジメントと変換</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E7%94%9F%E5%AD%98%E6%99%82%E9%96%93%E8%A7%A3%E6%9E%90%E3%81%AE%E5%9F%BA%E6%9C%AC"><span class="header-section-number">27.3</span> 生存時間解析の基本</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#surv-%E5%9E%8B%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90">Surv 型オブジェクトの作成</a></li>
<li><a class="nav-link" href="#%E6%9C%80%E5%88%9D%E3%81%AE%E8%A7%A3%E6%9E%90%E3%81%AE%E5%AE%9F%E8%A1%8C">最初の解析の実行</a></li>
<li><a class="nav-link" href="#%E7%B4%AF%E7%A9%8D%E3%83%8F%E3%82%B6%E3%83%BC%E3%83%89">累積ハザード</a></li>
<li><a class="nav-link" href="#kaplanmeier-%E6%9B%B2%E7%B7%9A%E3%81%AE%E4%BD%9C%E6%88%90">Kaplan–Meier 曲線の作成</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E7%94%9F%E5%AD%98%E6%9B%B2%E7%B7%9A%E3%81%AE%E6%AF%94%E8%BC%83"><span class="header-section-number">27.4</span> 生存曲線の比較</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%B3%E3%82%AF%E6%A4%9C%E5%AE%9A">ログランク検定</a></li></ul>
</li>
<li>
<a class="nav-link" href="#cox-%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90"><span class="header-section-number">27.5</span> Cox 回帰分析</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cox-%E5%9B%9E%E5%B8%B0%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%BD%93%E3%81%A6%E3%81%AF%E3%82%81">Cox 回帰モデルの当てはめ</a></li>
<li><a class="nav-link" href="#%E3%83%95%E3%82%A9%E3%83%AC%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%83%83%E3%83%88-1">フォレストプロット</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E7%94%9F%E5%AD%98%E6%99%82%E9%96%93%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E6%99%82%E9%96%93%E4%BE%9D%E5%AD%98%E6%80%A7%E5%85%B1%E5%A4%89%E9%87%8F"><span class="header-section-number">27.6</span> 生存時間モデルにおける時間依存性共変量</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%99%82%E9%96%93%E4%BE%9D%E5%AD%98%E6%80%A7%E5%85%B1%E5%A4%89%E9%87%8F%E3%81%AE%E8%A8%AD%E5%AE%9A">時間依存性共変量の設定</a></li>
<li><a class="nav-link" href="#%E6%99%82%E9%96%93%E4%BE%9D%E5%AD%98%E6%80%A7%E5%85%B1%E5%A4%89%E9%87%8F%E3%82%92%E6%8C%81%E3%81%A4-cox-%E5%9B%9E%E5%B8%B0%E3%83%A2%E3%83%87%E3%83%AB">時間依存性共変量を持つ Cox 回帰モデル</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-19"><span class="header-section-number">27.7</span> 参考資料</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>疫学のための R ハンドブック</strong>" was written by the handbook team. It was last built on 2022-10-10.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>35 フローチャート・サンキー図・タイムライン | 疫学のための R ハンドブック</title>
<meta name="author" content="the handbook team">
<meta name="description" content="この章では、以下の図を作成するためのコードについて説明します。 DiagrammeR と DOT 言語を使ったフローチャート 沖積図（Alluvial diagram）やサンキー図（Sankey diagram） イベントタイムライン  35.1 準備  パッケージを読み込む...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="35 フローチャート・サンキー図・タイムライン | 疫学のための R ハンドブック">
<meta property="og:type" content="book">
<meta property="og:description" content="この章では、以下の図を作成するためのコードについて説明します。 DiagrammeR と DOT 言語を使ったフローチャート 沖積図（Alluvial diagram）やサンキー図（Sankey diagram） イベントタイムライン  35.1 準備  パッケージを読み込む...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="35 フローチャート・サンキー図・タイムライン | 疫学のための R ハンドブック">
<meta name="twitter:description" content="この章では、以下の図を作成するためのコードについて説明します。 DiagrammeR と DOT 言語を使ったフローチャート 沖積図（Alluvial diagram）やサンキー図（Sankey diagram） イベントタイムライン  35.1 準備  パッケージを読み込む...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script type="text/javascript">
        // window.addEventListener("load", function() {
        //     document.getElementById('toc').firstChild.innerHTML = "章目次"; 
        // });
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementsByClassName("d-flex align-items-start justify-content-between")[0].children[0].children[0].innerHTML = "疫学のための R</br>ハンドブック";
            document.getElementById('toc').firstChild.innerHTML = "章目次"; 
            document.getElementById('main-nav').children[1].firstChild.innerHTML = "総目次";
            document.getElementById('search').setAttribute("placeholder", "検索");
        });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">疫学のための R ハンドブック</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">本書について</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> 編集前記・技術注記</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> ハンドブックとデータのダウンロード</a></li>
<li class="book-part">基本編</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R の基礎</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Excel・Stata・SASとの比較</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> 推奨パッケージ</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R プロジェクト</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> データのインポート・エクスポート</a></li>
<li class="book-part">データマネジメント</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> データクリーニングと主要関数</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> データのグループ化</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> 重複データの排除</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> ループと反復処理・リストの操作</a></li>
<li class="book-part">データ分析</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> 記述統計表の作り方</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> 標準化率</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> 移動平均</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> 時系列分析とアウトブレイクの検出</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> エピデミックモデリング</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></li>
<li class="book-part">データの可視化</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> 流行曲線（エピカーブ）</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> 人口ピラミッドとリッカート尺度</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></li>
<li><a class="active" href="diagrams.html"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> 感染連鎖</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> 系統樹</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></li>
<li class="book-part">レポートとダッシュボード</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> R Markdownで作るダッシュボード</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny で作るダッシュボード</a></li>
<li class="book-part">その他</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> 関数の作成</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> ディレクトリの操作</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Git と Github を使ったバージョン管理と共同作業</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> よくあるエラー</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> ヘルプ</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> ネットワークドライブで R を使用する場合</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table パッケージを使用したデータ処理</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="diagrams" class="section level1" number="35">
<h1>
<span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン<a class="anchor" aria-label="anchor" href="#diagrams"><i class="fas fa-link"></i></a>
</h1>
<p><img src="images/flow_chart.png" width="50%"><img src="images/sankey_diagram.png" width="50%"></p>
<p>この章では、以下の図を作成するためのコードについて説明します。</p>
<ul>
<li>
<strong>DiagrammeR</strong> と DOT 言語を使ったフローチャート</li>
<li>沖積図（Alluvial diagram）やサンキー図（Sankey diagram）</li>
<li>イベントタイムライン</li>
</ul>
<!-- * DAGs (Directed Acyclic Graphs)   --><!-- * GANTT charts   --><!-- ======================================================= --><div id="準備-27" class="section level2" number="35.1">
<h2>
<span class="header-section-number">35.1</span> 準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-27"><i class="fas fa-link"></i></a>
</h2>
<div id="パッケージを読み込む-5" class="section level3 unnumbered">
<h3>パッケージを読み込む<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80-5"><i class="fas fa-link"></i></a>
</h3>
<p>以下のコードを実行すると、図の作成に必要なパッケージが読み込まれます。このハンドブックでは、パッケージを読み込むために、<strong>pacman</strong> パッケージの <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> を主に使用しています。<code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> は、必要に応じてパッケージをインストールし、現在の R セッションで使用するためにパッケージを読み込む関数です。また、すでにインストールされたパッケージは、R の基本パッケージである <strong>base</strong> の <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> を使用して読み込むこともできます。R のパッケージについての詳細は、<a href="basics.html#basics">R の基礎</a> を参照してください。</p>
<div class="sourceCode" id="cb1648"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">DiagrammeR</span>,     <span class="co"># フロー図</span></span>
<span>  <span class="va">networkD3</span>,      <span class="co"># 沖積図・サンキー図</span></span>
<span>  <span class="va">tidyverse</span><span class="op">)</span>      <span class="co"># データ管理と図作成</span></span></code></pre></div>
</div>
<div id="データをインポート-1" class="section level3 unnumbered">
<h3>データをインポート<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88-1"><i class="fas fa-link"></i></a>
</h3>
<p>この章では、ほとんどデータセットを必要としません。しかし、サンキー図（Sankey diagram） のセクションでは、エボラ出血熱の流行をシミュレートした症例ラインリストを使用します。お手元の環境でこの章の内容を実行したい方は、<a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds">こちら</a> をクリックして「前処理済みの」ラインリストをダウンロードしてください（.rds 形式でダウンロードされます）。データは <strong>rio</strong> パッケージの <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> を利用してインポートしましょう（<strong>rio</strong> パッケージは、.xlsx、.csv、.rds など様々な種類のファイルを取り扱うことができます。詳細は、<a href="importing.html#importing">データのインポート・エクスポート</a> の章をご覧ください）。</p>
<div class="sourceCode" id="cb1649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ラインリストをインポート</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>ラインリストの最初の 50 行を以下に表示します。</p>
<div id="htmlwidget-ef79ab8c06e3ff0c55cf" style="width:100%;height:auto;" class="datatables html-widget"></div>
</div>
</div>
<div id="フローチャート" class="section level2" number="35.2">
<h2>
<span class="header-section-number">35.2</span> フローチャート<a class="anchor" aria-label="anchor" href="#%E3%83%95%E3%83%AD%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E3%83%88"><i class="fas fa-link"></i></a>
</h2>
<p>R パッケージの <strong>DiagrammeR</strong> を使って、フローチャートを作成することができます。グラフは静的なものもあれば、データセットの変化に基づいて動的に調整することもできます。</p>
<p><strong>ツール</strong></p>
<p>“Graphviz” で図を作成するには、<code>grViz()</code> を用います。この関数は、<u>図を作成するための指示を含む文字列の入力を</u>受け付けます。この文字列の中には、<a href="https://graphviz.org/doc/info/lang.html">DOT</a> と呼ばれる別の言語で書かれた指示が含まれていますが、基本は容易に学ぶことができます。</p>
<p><strong>基本的な構造</strong></p>
<ol style="list-style-type: decimal">
<li>指示を開始する <code>grViz("</code>
</li>
<li>グラフの方向性と名前を指定し、波括弧を開く - 例：<code>digraph my_flow_chart {</code>
</li>
<li>グラフ文（Graph 文） - レイアウト、ランク方向</li>
<li>ノード文 （Node 文） - ノードを作成</li>
<li>エッジ文（Edge 文） - ノード間のリンクを与える</li>
<li>指示を閉じる <code>}"</code>
</li>
</ol>
<div id="簡単な例-1" class="section level3 unnumbered">
<h3>簡単な例<a class="anchor" aria-label="anchor" href="#%E7%B0%A1%E5%8D%98%E3%81%AA%E4%BE%8B-1"><i class="fas fa-link"></i></a>
</h3>
<p>以下に 2 つの簡単な例を示します。</p>
<p>最小限のプロットを作成します。</p>
<div class="sourceCode" id="cb1650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 最小限のプロット</span></span>
<span><span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DiagrammeR/man/grViz.html">grViz</a></span><span class="op">(</span><span class="st">"digraph {</span></span>
<span><span class="st">  </span></span>
<span><span class="st">graph[layout = dot, rankdir = LR]</span></span>
<span><span class="st"></span></span>
<span><span class="st">a</span></span>
<span><span class="st">b</span></span>
<span><span class="st">c</span></span>
<span><span class="st"></span></span>
<span><span class="st">a -&gt; b -&gt; c</span></span>
<span><span class="st">}"</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-efaf02d43d533486a303" style="width:50%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-efaf02d43d533486a303">{"x":{"diagram":"digraph {\n  \ngraph[layout = dot, rankdir = LR]\n\na\nb\nc\n\na -> b -> c\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>もう一つは、公衆衛生の文脈でもう少し応用が効く例です。</p>
<div class="sourceCode" id="cb1651"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grViz</span><span class="op">(</span><span class="st">"                           # すべての指示は大きな文字列の中にある</span></span>
<span><span class="st">digraph surveillance_diagram {    # digraph は directional graph という意味で、その後にグラフ名が入る</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  # graph statement</span></span>
<span><span class="st">  #################</span></span>
<span><span class="st">  graph [layout = dot,</span></span>
<span><span class="st">         rankdir = TB,</span></span>
<span><span class="st">         overlap = true,</span></span>
<span><span class="st">         fontsize = 10]</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  # nodes</span></span>
<span><span class="st">  #######</span></span>
<span><span class="st">  node [shape = circle,           # shape = circle</span></span>
<span><span class="st">       fixedsize = true</span></span>
<span><span class="st">       width = 1.3]               # circle の大きさ</span></span>
<span><span class="st">  </span></span>
<span><span class="st">  １番目                          # ノードの名称</span></span>
<span><span class="st">  ２番目</span></span>
<span><span class="st">  ３番目</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # edges</span></span>
<span><span class="st">  #######</span></span>
<span><span class="st">  １番目   -&gt; ２番目 [label = '症例移送']</span></span>
<span><span class="st">  ２番目   -&gt; ３番目 [label = '症例移送']</span></span>
<span><span class="st">}</span></span>
<span><span class="st">"</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-e8f2b945a7c8eab1468e" style="width:50%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-e8f2b945a7c8eab1468e">{"x":{"diagram":"                           # すべての指示は大きな文字列の中にある\ndigraph surveillance_diagram {    # digraph は directional graph という意味で、その後にグラフ名が入る\n  \n  # graph statement\n  #################\n  graph [layout = dot,\n         rankdir = TB,\n         overlap = true,\n         fontsize = 10]\n  \n  # nodes\n  #######\n  node [shape = circle,           # shape = circle\n       fixedsize = true\n       width = 1.3]               # circle の大きさ\n  \n  １番目                          # ノードの名称\n  ２番目\n  ３番目\n\n  # edges\n  #######\n  １番目   -> ２番目 [label = \"症例移送\"]\n  ２番目   -> ３番目 [label = \"症例移送\"]\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="構文" class="section level3 unnumbered">
<h3>構文<a class="anchor" aria-label="anchor" href="#%E6%A7%8B%E6%96%87"><i class="fas fa-link"></i></a>
</h3>
<p><strong>基本的な構文</strong></p>
<p>ノード名とエッジ文は、スペース、セミコロン、改行で区切ることができます。</p>
<p><strong>ランクの方向</strong></p>
<p>グラフ文の <code>rankdir</code> 引数を調整することで、プロットを左から右へと移動させることができます。デフォルトは TB（top-to-bottom）ですが、LR（left-to-right）、RL、BT のいずれかを指定できます。</p>
<p><strong>ノード名</strong></p>
<p>ノード名は、上の例のように単一の単語で構いません。複数の単語や特殊文字（括弧やダッシュなど）を使用する場合は、ノード名を一重引用符（<code>' '</code>）で囲みます。ノード名を短くして、以下のように角括弧（<code>[ ]</code>）で囲んで<u>ラベル</u>を割り当てる方が簡単な場合があります。ノード名の中に改行を入れたい場合は、ラベルを介して行う必要があります。以下のように、一重引用符で囲んだノードラベルの中に <code>\n</code> を使用してください。</p>
<p><strong>サブグループ</strong></p>
<p>エッジ文の中で、サブグループはエッジの両側に波括弧（<code><a href="https://rdrr.io/r/base/Paren.html">{ }</a></code>）で作成できます。エッジは括弧内のすべてのノードに適用され、省略可能です。</p>
<p><strong>レイアウト</strong></p>
<ul>
<li>dot（<code>rankdir</code> を TB、LR、RL、BT のいずれかに設定）</li>
<li>neato</li>
<li>twopi</li>
<li>circo</li>
</ul>
<p><strong>ノード - 属性値</strong></p>
<ul>
<li><p><code>label</code>（テキスト、半角スペースを含む場合は一重引用符で囲む）<br></p></li>
<li><p><code>fillcolor</code>（多数の色が使用可能）<br></p></li>
<li><p><code>fontcolor</code><br></p></li>
<li><p><code>alpha</code>（透明度 0-1）<br></p></li>
<li><p><code>shape</code>（ellipse、oval、diamond、egg、plaintext、point、square、triangle）<br></p></li>
<li><p><code>style</code><br></p></li>
<li><p><code>sides</code><br></p></li>
<li><p><code>peripheries</code><br></p></li>
<li><p><code>fixedsize</code>（縦（高さ）x 横（幅））<br></p></li>
<li><p><code>height</code><br></p></li>
<li><p><code>width</code><br></p></li>
<li><p><code>distortion</code><br></p></li>
<li><p><code>penwidth</code> （境界線の太さ）</p></li>
<li><p><code>x</code>（左・右への変位）<br></p></li>
<li><p><code>y</code>（上・下への変位）<br></p></li>
<li><p><code>fontname</code><br></p></li>
<li><p><code>fontsize</code><br></p></li>
<li><p><code>icon</code></p></li>
</ul>
<p><strong>エッジ - 属性値</strong></p>
<ul>
<li><p><code>arrowsize</code><br></p></li>
<li><p><code>arrowhead</code>（normal、box、crow、curve、diamond、dot、inv、none、tee、vee）<br></p></li>
<li><p><code>arrowtail</code><br></p></li>
<li><p><code>dir</code>（direction, ）<br></p></li>
<li><p><code>style</code>（dashed, …）<br></p></li>
<li><p><code>color</code><br></p></li>
<li><p><code>alpha</code><br></p></li>
<li><p><code>headport</code> （矢印の前のテキスト）</p></li>
<li><p><code>tailport</code> （矢印の後のテキスト）</p></li>
<li><p><code>fontname</code><br></p></li>
<li><p><code>fontsize</code><br></p></li>
<li><p><code>fontcolor</code><br></p></li>
<li><p><code>penwidth</code> （矢の太さ）</p></li>
<li><p><code>minlen</code> （長さの最長値）</p></li>
</ul>
<p><strong>色名</strong>：16 進数の値または ‘X11’ の色名、X11 の詳細は <a href="http://rich-iannone.github.io/DiagrammeR/graphviz_and_mermaid.html">こちら</a> を参照してください。</p>
</div>
<div id="複雑な例" class="section level3 unnumbered">
<h3>複雑な例<a class="anchor" aria-label="anchor" href="#%E8%A4%87%E9%9B%91%E3%81%AA%E4%BE%8B"><i class="fas fa-link"></i></a>
</h3>
<p>以下の例は、上で作成した surveillance_diagram を発展させたもので、複雑なノード名、グループ化されたエッジ、色、スタイルを追加しています。</p>
<pre><code>DiagrammeR::grViz("               # すべての指示は大きな文字列の中にあります。
digraph surveillance_diagram {    # digraph は directional graph という意味で、その後にグラフ名が入ります。
  
  # graph 文
  #################
  graph [layout = dot,
         rankdir = TB,            # layout top-to-bottom
         fontsize = 10]
  

  # ノード (円)
  #################
  node [shape = circle,           # shape = circle
       fixedsize = true
       width = 1.3]                      
  
  Primary   [label = '第一\n施設'] 
  Secondary [label = '第二\n施設'] 
  Tertiary  [label = '第三\n施設'] 
  SC        [label = 'サーベイランス\n調整',
             fontcolor = darkgreen] 
  
  # エッジ
  #######
  Primary   -&gt; Secondary [label = ' 症例移送',
                          fontcolor = red,
                          color = red]
  Secondary -&gt; Tertiary [label = ' 症例移送',
                          fontcolor = red,
                          color = red]
  
  # エッジのグループ
  {Primary Secondary Tertiary} -&gt; SC [label = '症例報告',
                                      fontcolor = darkgreen,
                                      color = darkgreen,
                                      style = dashed]
}
")</code></pre>
<div id="htmlwidget-cea464481e9ba8a82c1e" style="width:50%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-cea464481e9ba8a82c1e">{"x":{"diagram":"               # すべての指示は大きな文字列の中にある\ndigraph surveillance_diagram {    # digraph は directional graph という意味で、その後にグラフ名が入る\n  \n  # グラフ文\n  #################\n  graph [layout = dot,\n         rankdir = TB,            # layout top-to-bottom\n         fontsize = 10]\n  \n\n  # ノード (円)\n  #################\n  node [shape = circle,           # shape = circle\n       fixedsize = true\n       width = 1.3]                      \n  \n  Primary   [label = \"第一\n施設\"] \n  Secondary [label = \"第二\n施設\"] \n  Tertiary  [label = \"第三\n施設\"] \n  SC        [label = \"サーベイランス\n調整\",\n             fontcolor = darkgreen] \n  \n  # エッジ\n  #######\n  Primary   -> Secondary [label = \"症例移送\",\n                          fontcolor = red,\n                          color = red]\n  Secondary -> Tertiary [label = \"症例移送\",\n                          fontcolor = red,\n                          color = red]\n  \n  # エッジグループ\n  {Primary Secondary Tertiary} -> SC [label = \"症例報告\",\n                                      fontcolor = darkgreen,\n                                      color = darkgreen,\n                                      style = dashed]\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p><strong>サブグラフのクラスター</strong></p>
<p>ノードをボックス型のクラスターにまとめるには、同じ名前のサブグラフ（<code>subgraph name {}</code>）の中にノードを入れます。各サブグラフをバウンディングボックス内で識別するには、以下の 4 つのボックスで示すように、サブグラフの名前を “cluster” で始めます。</p>
<pre><code>DiagrammeR::grViz("             # すべての指示は大きな文字列の中にある
digraph surveillance_diagram {  # digraph は directional graph という意味で、その後にグラフ名が入る
  
  # グラフ文
  #################
  graph [layout = dot,
         rankdir = TB,            
         overlap = true,
         fontsize = 10]
  

  # ノード (円)
  #################
  node [shape = circle,                  # shape = circle
       fixedsize = true
       width = 1.3]                      # circle の大きさ
  
  subgraph cluster_passive {
    Primary   [label = '第一\n施設] 
    Secondary [label = '第二\n施設'] 
    Tertiary  [label = '第三\n施設'] 
    SC        [label = 'サーベイランス\n調整',
               fontcolor = darkgreen] 
  }
  
  # ノード (ボックス)
  ###############
  node [shape = box,                     # ノードの形状
        fontname = Helvetica]            # ノード中のフォント
  
  subgraph cluster_active {
    Active [label = '能動的\nサーベイランス'] 
    HCF_active [label = 'HCF\n能動的探索']
  }
  
  subgraph cluster_EBD {
    EBS [label = 'イベントベース\nサーベイランス (EBS)'] 
    社会メディア
    ラジオ
  }
  
  subgraph cluster_CBS {
    CBS [label = '地域参加型\nサーベイランス (CBS)']
    RECOs
  }


  # エッジ
  #######
  {Primary Secondary Tertiary} -&gt; SC [label = '症例報告']

  Primary   -&gt; Secondary [label = '症例移送',
                          fontcolor = red]
  Secondary -&gt; Tertiary [label = '症例移送',
                          fontcolor = red]
  
  HCF_active -&gt; Active
  
  {社会メディア ラジオ} -&gt; EBS
  
  RECOs -&gt; CBS
}
")</code></pre>
<div id="htmlwidget-572aacc48f9f200be53d" style="width:120%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-572aacc48f9f200be53d">{"x":{"diagram":"             # すべての指示は大きな文字列の中にある\ndigraph surveillance_diagram {  # digraph は directional graph という意味で、その後にグラフ名が入る\n  \n  # グラフ文\n  #################\n  graph [layout = dot,\n         rankdir = TB,            \n         overlap = true,\n         fontsize = 10]\n  \n\n  # ノード (円)\n  #################\n  node [shape = circle,                  # shape = circle\n       fixedsize = true\n       width = 1.3]                      # circle の大きさ\n  \n  subgraph cluster_passive {\n    Primary   [label = \"第一\n施設\"] \n    Secondary [label = \"第二\n施設\"] \n    Tertiary  [label = \"第三\n施設\"] \n    SC        [label = \"サーベイランス\n調整\",\n               fontcolor = darkgreen] \n  }\n  \n  # ノード (ボックス)\n  ###############\n  node [shape = box,                     # ノードの形状\n        fontname = Helvetica]            # ノード内のフォント\n  \n  subgraph cluster_active {\n    Active [label = \"能動的\nサーベイランス\"] \n    HCF_active [label = \"HCF\n能動的探索\"]\n  }\n  \n  subgraph cluster_EBD {\n    EBS [label = \"イベントベース\nサーベイランス (EBS)\"] \n    社会メディア\n    ラジオ\n  }\n  \n  subgraph cluster_CBS {\n    CBS [label = \"地域参加型\nサーベイランス (CBS)\"]\n    RECOs\n  }\n\n  \n  # エッジ\n  #######\n  {Primary Secondary Tertiary} -> SC [label = \"症例報告\"]\n\n  Primary   -> Secondary [label = \"症例移送\",\n                          fontcolor = red]\n  Secondary -> Tertiary [label = \"症例移送\",\n                          fontcolor = red]\n  \n  HCF_active -> Active\n  \n  {社会メディア ラジオ} -> EBS\n  \n  RECOs -> CBS\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p><strong>ノードの形状</strong></p>
<p>以下の例は、<a href="http://rich-iannone.github.io/DiagrammeR/">こちらのチュートリアル</a> から引用したもので、適用されたノード形状と、連続するエッジ接続の略記法を示しています。</p>
<div class="sourceCode" id="cb1654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DiagrammeR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DiagrammeR/man/grViz.html">grViz</a></span><span class="op">(</span><span class="st">"digraph {</span></span>
<span><span class="st"></span></span>
<span><span class="st">graph [layout = dot, rankdir = LR]</span></span>
<span><span class="st"></span></span>
<span><span class="st"># ノードのグローバル・スタイルを定義します。必要に応じてボックス内でこれらを上書きすることができます。</span></span>
<span><span class="st">node [shape = rectangle, style = filled, fillcolor = Linen]</span></span>
<span><span class="st"></span></span>
<span><span class="st">data1 [label = 'データ 1', shape = folder, fillcolor = Beige]</span></span>
<span><span class="st">data2 [label = 'データ 2', shape = folder, fillcolor = Beige]</span></span>
<span><span class="st">process [label =  'データ \n 処理']</span></span>
<span><span class="st">statistical [label = '統計 \n 解析']</span></span>
<span><span class="st">results [label= '結果']</span></span>
<span><span class="st"></span></span>
<span><span class="st"># ノードIDを持つエッジ定義</span></span>
<span><span class="st">{data1 data2}  -&gt; process -&gt; statistical -&gt; results</span></span>
<span><span class="st">}"</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-01a2a867d3364ea6bf7e" style="width:75%;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-01a2a867d3364ea6bf7e">{"x":{"diagram":"digraph {\n\ngraph [layout = dot, rankdir = LR]\n\n# ノードのグローバル・スタイルを定義します。必要に応じてボックス内でこれらを上書きすることができます。\nnode [shape = rectangle, style = filled, fillcolor = Linen]\n\ndata1 [label = \"データ 1\", shape = folder, fillcolor = Beige]\ndata2 [label = \"データ 2\", shape = folder, fillcolor = Beige]\nprocess [label =  \"データ \n 処理\"]\nstatistical [label = \"統計 \n 解析\"]\nresults [label= \"結果\"]\n\n# ノードIDを持つエッジ定義\n{data1 data2}  -> process -> statistical -> results\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="出力" class="section level3 unnumbered">
<h3>出力<a class="anchor" aria-label="anchor" href="#%E5%87%BA%E5%8A%9B"><i class="fas fa-link"></i></a>
</h3>
<p>出力の取り扱いと保存方法</p>
<ul>
<li>出力結果は、RStudio の Viewer ペインに表示されます。デフォルトでは右下に Files、Plots、Packages、Help と並んで表示されます。</li>
<li>出力結果をエクスポートしたい場合は、Viewer ペインから “Save as image” （「画像として保存」）または “Copy to clipboard” （「クリップボードにコピー」）を選択してください。画像は指定したサイズに調整されます。</li>
</ul>
</div>
<div id="パラメータ化された図形" class="section level3 unnumbered">
<h3>パラメータ化された図形<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E5%9B%B3%E5%BD%A2"><i class="fas fa-link"></i></a>
</h3>
<p>以下は、<a href="https://mikeyharper.uk/flowcharts-in-r-using-diagrammer/">こちらのチュートリアル</a> からの引用です。</p>
<p>「パラメータ化された図形:：R で図形を設計することの大きな利点は、R の値をフローチャートに直接読み込んで、図形を分析に直結させることができることです。例えば、プロセスの各段階の後に値を削除するフィルタリングプロセスを作成したとすると、プロセスの各段階の後にデータセットに残っている値の数を図に表示することができます。これを実現するには、図の中で @<span class="citation">@X</span> 記号を直接使用し、プロットのフッターで [X]: を使用して参照します（X は一意の数値インデックス）。」</p>
<p>パラメータ化された図形に興味をお持ちの方は、引用元のチュートリアルをご覧ください。</p>
<!-- And below is some example code from this tutorial. -->
<!-- ```{r, eval=F} -->
<!-- # Define some sample data -->
<!-- data <- list(a=1000, b=800, c=600, d=400) -->
<!-- DiagrammeR::grViz(" -->
<!-- digraph graph2 { -->
<!-- graph [layout = dot] -->
<!-- # node definitions with substituted label text -->
<!-- node [shape = rectangle, width = 4, fillcolor = Biege] -->
<!-- a [label = '@@1'] -->
<!-- b [label = '@@2'] -->
<!-- c [label = '@@3'] -->
<!-- d [label = '@@4'] -->
<!-- a -> b -> c -> d -->
<!-- } -->
<!-- [1]:  paste0('Raw Data (n = ', data$a, ')') -->
<!-- [2]: paste0('Remove Errors (n = ', data$b, ')') -->
<!-- [3]: paste0('Identify Potential Customers (n = ', data$c, ')') -->
<!-- [4]: paste0('Select Top Priorities (n = ', data$d, ')') -->
<!-- ") -->
<!-- ``` -->
<!-- ### CONSORT diagram  {.unnumbered} -->
<!-- THIS SECTION IS UNDER CONSTRUCTION   -->
<!-- https://scriptsandstatistics.wordpress.com/2017/12/22/how-to-draw-a-consort-flow-diagram-using-r-and-graphviz/ -->
<!-- Note above is out of date via DiagrammeR -->
<!-- ======================================================= -->
</div>
</div>
<div id="沖積図サンキー図" class="section level2" number="35.3">
<h2>
<span class="header-section-number">35.3</span> 沖積図・サンキー図<a class="anchor" aria-label="anchor" href="#%E6%B2%96%E7%A9%8D%E5%9B%B3%E3%82%B5%E3%83%B3%E3%82%AD%E3%83%BC%E5%9B%B3"><i class="fas fa-link"></i></a>
</h2>
<div id="パッケージを読み込む-6" class="section level3 unnumbered">
<h3>パッケージを読み込む<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80-6"><i class="fas fa-link"></i></a>
</h3>
<p>以下のコードを実行すると、図の作成に必要なパッケージが読み込まれます。このハンドブックでは、パッケージを読み込むために、<strong>pacman</strong> パッケージの <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> を主に使用しています。<code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> は、必要に応じてパッケージをインストールし、現在の R セッションで使用するためにパッケージを読み込む関数です。また、すでにインストールされたパッケージは、R の基本パッケージである <strong>base</strong> の <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> を使用して読み込むこともできます。R パッケージの詳細については、<a href="basics.html#basics">R の基礎</a> の章を参照してください。</p>
<p>ここでは、図を作成するために <strong>networkD3</strong> パッケージを読み込み、データ操作のための <strong>tidyverse</strong> パッケージも読み込んでいます。</p>
<div class="sourceCode" id="cb1655"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">networkD3</span>,</span>
<span>  <span class="va">tidyverse</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="データセットからプロット" class="section level3 unnumbered">
<h3>データセットからプロット<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%81%8B%E3%82%89%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"><i class="fas fa-link"></i></a>
</h3>
<p>データセット内のつながりをプロットします。以下では、<strong>networkD3</strong> パッケージを <code>linelist</code> という症例ラインリストで使ってみます。オンラインチュートリアルをご覧になりたい方は、<a href="https://r-graph-gallery.com/321-introduction-to-interactive-sankey-diagram-2.html">こちら</a> を参照ください。</p>
<p>まず、年齢区分と病院の組み合わせごとに、症例数を集計します。わかりやすくするために、年齢区分が欠落している症例は除外しました。また、<code>hospital</code> 列と <code>age_cat</code> 列の列名をそれぞれ <code>source</code> と <code>target</code> に変更します。これらの列は、沖積図の 2 つの面になります。</p>
<div class="sourceCode" id="cb1656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 病院と年齢区分で集計</span></span>
<span><span class="va">links</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">hospital</span>,</span>
<span>         target <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span></span></code></pre></div>
<p>データセットは次のようになります。</p>
<div id="htmlwidget-79d934e180f2e25955cc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-79d934e180f2e25955cc">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Other","Other","Other","Other","Other","Other","Other","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)"],["0-4","5-9","10-14","15-19","20-29","30-49","50-69","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","0-4","5-9","10-14","15-19","20-29","30-49","50-69","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+"],[84,84,82,58,73,57,7,171,176,121,106,180,121,7,2,281,268,219,196,275,177,22,3,163,154,162,104,167,104,19,331,318,267,234,309,248,32,65,95,90,45,69,47,8,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>source<\/th>\n      <th>target<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>次に、すべてのダイアグラム・ノードのデータフレームを、<code>name</code> という列で作成します。<code>name</code> 列は、<code>hospital</code> 列と <code>age_cat</code> 列のすべての値で構成されます。<code>name</code> 列を作成する前に、<code>hospital</code> 列と <code>age_cat</code> 列のデータ型が文字型となっているか確認してください。また、後述のコードで作成する ID 列（<code>IDsource</code> 列と <code>IDtarget</code> 列）をラベルではなく数字型に変更します。</p>
<div class="sourceCode" id="cb1657"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ユニークなノード名</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">links</span><span class="op">$</span><span class="va">source</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">links</span><span class="op">$</span><span class="va">target</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">nodes</span>  <span class="co"># 表示</span></span></code></pre></div>
<pre><code>##                                    name
## 1                      Central Hospital
## 2                     Military Hospital
## 3                               Missing
## 4                                 Other
## 5                         Port Hospital
## 6  St. Mark's Maternity Hospital (SMMH)
## 7                                   0-4
## 8                                   5-9
## 9                                 10-14
## 10                                15-19
## 11                                20-29
## 12                                30-49
## 13                                50-69
## 14                                  70+</code></pre>
<p>次に、上述の <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> で作成した <code>links</code> データフレームを編集します。 2 つの数値列 <code>IDsource</code> と <code>IDtarget</code> を追加します。これらはノード間のリンクを実際に反映・作成します。 これらの列にはソースノードとターゲットノードの行番号（位置）が入ります。 ポジション番号が（1 ではなく）0 から始まるように、1 を引きます。</p>
<div class="sourceCode" id="cb1659"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 名前ではなく数値にマッチング</span></span>
<span><span class="va">links</span><span class="op">$</span><span class="va">IDsource</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">links</span><span class="op">$</span><span class="va">source</span>, <span class="va">nodes</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span> </span>
<span><span class="va">links</span><span class="op">$</span><span class="va">IDtarget</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">links</span><span class="op">$</span><span class="va">target</span>, <span class="va">nodes</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span></span></code></pre></div>
<p><code>links</code> データセットは以下のようになります。</p>
<div id="htmlwidget-f2939b2120457928ce8f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f2939b2120457928ce8f">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Other","Other","Other","Other","Other","Other","Other","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)"],["0-4","5-9","10-14","15-19","20-29","30-49","50-69","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","0-4","5-9","10-14","15-19","20-29","30-49","50-69","0-4","5-9","10-14","15-19","20-29","30-49","50-69","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+"],[84,84,82,58,73,57,7,171,176,121,106,180,121,7,2,281,268,219,196,275,177,22,3,163,154,162,104,167,104,19,331,318,267,234,309,248,32,65,95,90,45,69,47,8,1],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5],[6,7,8,9,10,11,12,6,7,8,9,10,11,12,13,6,7,8,9,10,11,12,13,6,7,8,9,10,11,12,6,7,8,9,10,11,12,6,7,8,9,10,11,12,13]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>source<\/th>\n      <th>target<\/th>\n      <th>n<\/th>\n      <th>IDsource<\/th>\n      <th>IDtarget<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>では、<code>sankeyNetwork()</code> を使用してサンキー図をプロットしてみましょう。 コンソールで <code>?sankeyNetwork</code> を実行すると、関数内で使用される各引数について詳細を確認することができます。 なお、<code>iterations = 0</code> を設定しないと、ノードの順番が期待通りにならないことがあります。</p>
<div class="sourceCode" id="cb1660"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot</span></span>
<span><span class="co">######</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">sankeyNetwork</span><span class="op">(</span></span>
<span>  Links <span class="op">=</span> <span class="va">links</span>,</span>
<span>  Nodes <span class="op">=</span> <span class="va">nodes</span>,</span>
<span>  Source <span class="op">=</span> <span class="st">"IDsource"</span>,</span>
<span>  Target <span class="op">=</span> <span class="st">"IDtarget"</span>,</span>
<span>  Value <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>  NodeID <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"TWh"</span>,</span>
<span>  fontSize <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  nodeWidth <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  iterations <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>        <span class="co"># ノードの順序をデータ順にする</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div id="htmlwidget-412aa6c62ca186ebb8a4" style="width:672px;height:480px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-412aa6c62ca186ebb8a4">{"x":{"links":{"source":[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5],"target":[6,7,8,9,10,11,12,6,7,8,9,10,11,12,13,6,7,8,9,10,11,12,13,6,7,8,9,10,11,12,6,7,8,9,10,11,12,6,7,8,9,10,11,12,13],"value":[84,84,82,58,73,57,7,171,176,121,106,180,121,7,2,281,268,219,196,275,177,22,3,163,154,162,104,167,104,19,331,318,267,234,309,248,32,65,95,90,45,69,47,8,1]},"nodes":{"name":["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+"],"group":["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)","0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+"]},"options":{"NodeID":"name","NodeGroup":"name","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":12,"fontFamily":null,"nodeWidth":30,"nodePadding":10,"units":"TWh","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p>次に、患者のアウトカムも含まれている例を示します。 なお、データ準備・前処理の段階で、年齢層と 病院、またこれとは別に病院とアウトカムの間の症例の数を計算し、<code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> で両者のカウントを結合しています。</p>
<div class="sourceCode" id="cb1661"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 病院と年齢区分で集計</span></span>
<span><span class="va">age_hosp_links</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">age_cat</span>,          <span class="co"># 列名の変更</span></span>
<span>         target <span class="op">=</span> <span class="va">hospital</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hosp_out_links</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>source <span class="op">=</span> <span class="va">hospital</span>,       <span class="co"># 列名の変更</span></span>
<span>           target <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># リンクを結合</span></span>
<span><span class="va">links</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">age_hosp_links</span>, <span class="va">hosp_out_links</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ユニークなノード名</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">links</span><span class="op">$</span><span class="va">source</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">links</span><span class="op">$</span><span class="va">target</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># ID番号を生成</span></span>
<span><span class="va">links</span><span class="op">$</span><span class="va">IDsource</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">links</span><span class="op">$</span><span class="va">source</span>, <span class="va">nodes</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span> </span>
<span><span class="va">links</span><span class="op">$</span><span class="va">IDtarget</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">links</span><span class="op">$</span><span class="va">target</span>, <span class="va">nodes</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span></span>
<span></span>
<span><span class="co"># プロットする</span></span>
<span><span class="co">######</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">sankeyNetwork</span><span class="op">(</span>Links <span class="op">=</span> <span class="va">links</span>,</span>
<span>                   Nodes <span class="op">=</span> <span class="va">nodes</span>,</span>
<span>                   Source <span class="op">=</span> <span class="st">"IDsource"</span>,</span>
<span>                   Target <span class="op">=</span> <span class="st">"IDtarget"</span>,</span>
<span>                   Value <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>                   NodeID <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>                   units <span class="op">=</span> <span class="st">"TWh"</span>,</span>
<span>                   fontSize <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                   nodeWidth <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                   iterations <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<div id="htmlwidget-e0367a11112f84fc850a" style="width:672px;height:480px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-e0367a11112f84fc850a">{"x":{"links":{"source":[0,1,2,3,4,5,6,0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,0,1,2,3,4,5,6,0,1,2,3,4,5,6,7,8,8,8,9,9,9,10,10,10,11,11,11,12,12,12,13,13,13],"target":[8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,14,15,16,14,15,16,14,15,16,14,15,16,14,15,16,14,15,16],"value":[84,84,82,58,73,57,7,171,176,121,106,180,121,7,2,281,268,219,196,275,177,22,3,163,154,162,104,167,104,19,331,318,267,234,309,248,32,65,95,90,45,69,47,8,1,191,162,92,393,307,184,599,506,336,391,285,197,778,570,391,198,125,97]},"nodes":{"name":["0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Death","Recover",null],"group":["0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+","Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Death","Recover",null]},"options":{"NodeID":"name","NodeGroup":"name","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":12,"fontFamily":null,"nodeWidth":30,"nodePadding":10,"units":"TWh","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":0,"sinksRight":true}},"evals":[],"jsHooks":[]}</script><p><a href="https://www.displayr.com/sankey-diagrams-r/" class="uri">https://www.displayr.com/sankey-diagrams-r/</a></p>
<!-- ======================================================= -->
</div>
</div>
<div id="イベントのタイムライン" class="section level2" number="35.4">
<h2>
<span class="header-section-number">35.4</span> イベントのタイムライン<a class="anchor" aria-label="anchor" href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%A9%E3%82%A4%E3%83%B3"><i class="fas fa-link"></i></a>
</h2>
<p>特定のイベントを表示するタイムラインを作るには、<strong>vistime</strong> パッケージを使用します。</p>
<p>詳細は、<a href="https://cran.r-project.org/web/packages/vistime/vignettes/vistime-vignette.html#ex.-2-project-planning">こちらのドキュメント</a> をご覧ください。</p>
<div class="sourceCode" id="cb1662"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># パッケージの読み込み</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">vistime</span>,  <span class="co"># タイムラインを作成</span></span>
<span>               <span class="va">plotly</span>    <span class="co"># インタラクティブな可視化</span></span>
<span>               <span class="op">)</span></span></code></pre></div>
<p>ここでは、まず関心のあるイベントが含まれているデータセットをご紹介します。</p>
<div id="htmlwidget-f2f0c8860b9397b9e948" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f2f0c8860b9397b9e948">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["                       Event 1","                       Event 1","                       Event 1","                       Event 1","                       Event 1","                       Event 1","                       Event 1","                       Event 1","                       Event 1","                       Event 2","                       Event 2","                       Event 2","                       Event 2","                       Event 2"],[" Group A"," Group B"," Group C"," Group D"," Group E"," Group F"," Group G"," Group H"," Group I"," Group A"," Group C"," Group J"," Group J"," Group J"],["2020-01-22","2020-01-23","2020-01-23","2020-01-25","2020-01-25","2020-01-26","2020-01-27","2020-01-27","2020-01-27","2020-01-28","2020-01-28","2020-01-28","2020-01-28","2020-01-28"],["2020-01-22","2020-01-23","2020-01-23","2020-01-25","2020-01-25","2020-01-26","2020-01-27","2020-01-27","2020-01-27","2020-01-28","2020-01-28","2020-01-28","2020-01-28","2020-01-28"],[" #90caf9"," #90caf9"," #1565c0"," #f44336"," #90caf9"," #8d6e63"," #1565c0"," #90caf9"," #90a4ae"," #fc8d62"," #6a3d9a"," #90caf9"," #fc8d62"," #1565c0"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>event<\/th>\n      <th>group<\/th>\n      <th>start<\/th>\n      <th>end<\/th>\n      <th>color<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb1663"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">vistime</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>    <span class="co"># vistime を適用  </span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># step 1: リストに変換  </span></span>
<span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/plotly/man/plotly_build.html">plotly_build</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># step 2: マーカーの大きさ  </span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"markers"</span><span class="op">)</span> <span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">marker</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># step 3: テキストの大きさ  </span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"text"</span><span class="op">)</span> <span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">textfont</span><span class="op">$</span><span class="va">size</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># step 4: テキストの位置  </span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"text"</span><span class="op">)</span> <span class="va">pp</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">textposition</span> <span class="op">&lt;-</span> <span class="st">"right"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 表示  </span></span>
<span><span class="va">pp</span></span></code></pre></div>
<div id="htmlwidget-d43fe18542e898df9744" style="width:672px;height:480px;" class="plotly html-widget"></div>
</div>
<div id="dags" class="section level2" number="35.5">
<h2>
<span class="header-section-number">35.5</span> DAGs<a class="anchor" aria-label="anchor" href="#dags"><i class="fas fa-link"></i></a>
</h2>
<p>前述のように、<strong>DiagammeR</strong> パッケージと DOT 言語を使って手動で DAG を構築することができます。</p>
<p>また、<strong>ggdag</strong> や <strong>daggity</strong> などのパッケージもあります。</p>
<p><a href="https://cran.r-project.org/web/packages/ggdag/vignettes/intro-to-dags.html">DAG の紹介 ggdag に関するドキュメント</a></p>
<p><a href="https://www.r-bloggers.com/2019/08/causal-inference-with-dags-in-r/#:~:text=In%20a%20DAG%20all%20the,for%20drawing%20analyzing%20DAGs.">R で dags を使用した統計的因果推論</a></p>
<!-- ======================================================= -->
</div>
<div id="参考資料-26" class="section level2" number="35.6">
<h2>
<span class="header-section-number">35.6</span> 参考資料<a class="anchor" aria-label="anchor" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-26"><i class="fas fa-link"></i></a>
</h2>
<p>本章の DOT言語に関する大部分は<a href="https://mikeyharper.uk/flowcharts-in-r-using-diagrammer/">こちら</a> のチュートリアルを参考にしています。</p>
<p>より詳細な DiagammeR に関するチュートリアルは、<a href="http://rich-iannone.github.io/DiagrammeR/">こちら</a> を参照ください。</p>
<p>サンキー図については、<a href="https://www.displayr.com/sankey-diagrams-r/">こちら</a> のウェブサイトも参考にしてください。</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></div>
<div class="next"><a href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#diagrams"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li>
<a class="nav-link" href="#%E6%BA%96%E5%82%99-27"><span class="header-section-number">35.1</span> 準備</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80-5">パッケージを読み込む</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88-1">データをインポート</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E3%83%95%E3%83%AD%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E3%83%88"><span class="header-section-number">35.2</span> フローチャート</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E7%B0%A1%E5%8D%98%E3%81%AA%E4%BE%8B-1">簡単な例</a></li>
<li><a class="nav-link" href="#%E6%A7%8B%E6%96%87">構文</a></li>
<li><a class="nav-link" href="#%E8%A4%87%E9%9B%91%E3%81%AA%E4%BE%8B">複雑な例</a></li>
<li><a class="nav-link" href="#%E5%87%BA%E5%8A%9B">出力</a></li>
<li><a class="nav-link" href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%8C%96%E3%81%95%E3%82%8C%E3%81%9F%E5%9B%B3%E5%BD%A2">パラメータ化された図形</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E6%B2%96%E7%A9%8D%E5%9B%B3%E3%82%B5%E3%83%B3%E3%82%AD%E3%83%BC%E5%9B%B3"><span class="header-section-number">35.3</span> 沖積図・サンキー図</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%80-6">パッケージを読み込む</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%BB%E3%83%83%E3%83%88%E3%81%8B%E3%82%89%E3%83%97%E3%83%AD%E3%83%83%E3%83%88">データセットからプロット</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E3%82%A4%E3%83%99%E3%83%B3%E3%83%88%E3%81%AE%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%A9%E3%82%A4%E3%83%B3"><span class="header-section-number">35.4</span> イベントのタイムライン</a></li>
<li><a class="nav-link" href="#dags"><span class="header-section-number">35.5</span> DAGs</a></li>
<li><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-26"><span class="header-section-number">35.6</span> 参考資料</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>疫学のための R ハンドブック</strong>" was written by the handbook team. It was last built on 2022-10-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

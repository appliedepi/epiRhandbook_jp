<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>13 データのグループ化 | 疫学のための R ハンドブック</title>
<meta name="author" content="the handbook team">
<meta name="description" content="本章では、記述的分析のためにデータをグループ化および集約する方法について、一般的で機能が使いやすい tidyverse ファミリーのパッケージを用いて説明します。 データのグループ化は、データ管理と分析の核となる主要な要素です。グループ化されたデータは、グループごとに統計的に要約され、グループごとにプロットできます。dplyr パッケージ（tidyverse...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="13 データのグループ化 | 疫学のための R ハンドブック">
<meta property="og:type" content="book">
<meta property="og:description" content="本章では、記述的分析のためにデータをグループ化および集約する方法について、一般的で機能が使いやすい tidyverse ファミリーのパッケージを用いて説明します。 データのグループ化は、データ管理と分析の核となる主要な要素です。グループ化されたデータは、グループごとに統計的に要約され、グループごとにプロットできます。dplyr パッケージ（tidyverse...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="13 データのグループ化 | 疫学のための R ハンドブック">
<meta name="twitter:description" content="本章では、記述的分析のためにデータをグループ化および集約する方法について、一般的で機能が使いやすい tidyverse ファミリーのパッケージを用いて説明します。 データのグループ化は、データ管理と分析の核となる主要な要素です。グループ化されたデータは、グループごとに統計的に要約され、グループごとにプロットできます。dplyr パッケージ（tidyverse...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script type="text/javascript">
        // window.addEventListener("load", function() {
        //     document.getElementById('toc').firstChild.innerHTML = "章目次"; 
        // });
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementsByClassName("d-flex align-items-start justify-content-between")[0].children[0].children[0].innerHTML = "疫学のための R</br>ハンドブック";
            document.getElementById('toc').firstChild.innerHTML = "章目次"; 
            document.getElementById('main-nav').children[1].firstChild.innerHTML = "総目次";
            document.getElementById('search').setAttribute("placeholder", "検索");
        });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">疫学のための R ハンドブック</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">本書について</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> 編集前記・技術注記</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> ハンドブックとデータのダウンロード</a></li>
<li class="book-part">基本編</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R の基礎</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Excel・Stata・SASとの比較</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> 推奨パッケージ</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R プロジェクト</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> データのインポート・エクスポート</a></li>
<li class="book-part">データマネジメント</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> データクリーニングと主要関数</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></li>
<li><a class="active" href="grouping.html"><span class="header-section-number">13</span> データのグループ化</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> 重複データの排除</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> ループと反復処理・リストの操作</a></li>
<li class="book-part">データ分析</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> 記述統計表の作り方</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> 標準化率</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> 移動平均</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> 時系列分析とアウトブレイクの検出</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> エピデミックモデリング</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></li>
<li class="book-part">データの可視化</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> 流行曲線（エピカーブ）</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> 人口ピラミッドとリッカート尺度</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> 感染連鎖</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> 系統樹</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></li>
<li class="book-part">レポートとダッシュボード</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> R Markdownで作るダッシュボード</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny で作るダッシュボード</a></li>
<li class="book-part">その他</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> 関数の作成</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> ディレクトリの操作</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Git と Github を使ったバージョン管理と共同作業</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> よくあるエラー</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> ヘルプ</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> ネットワークドライブで R を使用する場合</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table パッケージを使用したデータ処理</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="grouping" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> データのグループ化<a class="anchor" aria-label="anchor" href="#grouping"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/Grouping_1500x500.png" width="100%"></div>
<p>本章では、記述的分析のためにデータをグループ化および集約する方法について、一般的で機能が使いやすい <strong>tidyverse</strong> ファミリーのパッケージを用いて説明します。</p>
<p>データのグループ化は、データ管理と分析の核となる主要な要素です。グループ化されたデータは、グループごとに統計的に要約され、グループごとにプロットできます。<strong>dplyr</strong> パッケージ（<strong>tidyverse</strong> の一部）の関数を使用すると、グループ化とその後の操作が非常に簡単になります。</p>
<p>本章では、以下の項目について説明します。</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> によってデータをグループ化する<br>
</li>
<li>データのグループ化を解除する<br>
</li>
<li>グループ化されたデータを <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> で統計的に要約する<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> と <code><a href="https://dplyr.tidyverse.org/reference/count.html">tally()</a></code> の違い<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> をグループ化されたデータに使う<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> をグループ化されたデータに使う<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> をグループ化されたデータに使う<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> をグループ化されたデータに使う<br>
</li>
<li>代替の方法として、R の基本パッケージである <strong>base</strong> の <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code> を使う</li>
</ul>
<!-- ======================================================= --><div id="準備-4" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> 準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-4"><i class="fas fa-link"></i></a>
</h2>
<div id="パッケージの読み込み-5" class="section level3 unnumbered">
<h3>パッケージの読み込み<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-5"><i class="fas fa-link"></i></a>
</h3>
<p>以下のコードを実行すると、分析に必要なパッケージが読み込まれます。このハンドブックでは、パッケージを読み込むために、<strong>pacman</strong> パッケージの p_load() を主に使用しています。p_load() は、必要に応じてパッケージをインストールし、現在の R セッションで使用するためにパッケージを読み込む関数です。また、すでにインストールされたパッケージは、R の基本パッケージである <strong>base</strong> の library() を使用して読み込むこともできます。R パッケージの詳細については、 <a href="basics.html#basics">R の基礎</a> の章を参照してください。</p>
<div class="sourceCode" id="cb624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>,       <span class="co"># データの読み込み</span></span>
<span>  <span class="va">here</span>,      <span class="co"># ファイルをみつける</span></span>
<span>  <span class="va">tidyverse</span>, <span class="co"># データのクリーニング、処理、プロット (dplyr を含む)</span></span>
<span>  <span class="va">janitor</span><span class="op">)</span>   <span class="co"># 列と行の合計を追加する</span></span></code></pre></div>
</div>
<div id="データのインポート-5" class="section level3 unnumbered">
<h3>データのインポート<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88-5"><i class="fas fa-link"></i></a>
</h3>
<p>エボラ出血熱の流行をシミュレートしたデータセットをインポートします。お手元の環境でこの章の内容を実行したい方は、<a href="https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds">こちら</a> をクリックして「前処理された」ラインリスト（linelist）をダウンロードしてください（.rds 形式で取得できます）。 データは <strong>rio</strong> パッケージの <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> を利用してインポートしましょう。データをインポートする様々な方法については、<a href="importing.html#importing">データのインポート・エクスポート</a> の章を参照してください。</p>
<div class="sourceCode" id="cb625"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>以下に、<code>linelist</code> の最初の 50 行を表示します。</p>
<div id="htmlwidget-0a77002c516c45e18de7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0a77002c516c45e18de7">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="グループ化" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> グループ化<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96"><i class="fas fa-link"></i></a>
</h2>
<p><strong>dplyr</strong> の <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> は、指定された列の値によって、行をグループ化する関数です。複数の列が指定されている場合は、列の値の組み合わせによって、行がグループ化されます。それぞれの一意の値（または値の組み合わせ）でグループが構成されます。データセットがグループ化された後は、データセットの変更や計算は各グループ内で実行されます。</p>
<p>たとえば、次のコマンドは <code>linelist</code> を <code>outcome</code> 列の値で行をグループ化し、出力結果を新しいデータフレーム <code>ll_by_outcome</code> として保存します。グループ化する列は <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> の括弧内に書きます。</p>
<div class="sourceCode" id="cb626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ll_by_outcome</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> を実行した後も、<strong>データセットには目に見える変化がないことに注意してください。</strong> 「グループ化された」データフレームに <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>、 <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code>、 <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> などの別の <strong>dplyr</strong> 関数を適用するまで、目に見える変化はありません。</p>
<p>ただし、データフレームを <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> で出力すると、グループ化を「見る」ことができます。出力されたデータフレームを確認すると、それが <a href="https://tibble.tidyverse.org/"><code>tibble</code> 型のオブジェクト</a> に変換されていることがわかります。また、グループ化に使用された列名ならびにグループの数がヘッダー行のすぐ上に表示されています。</p>
<div class="sourceCode" id="cb627"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 表示して、適用されたグループ化を確認</span></span>
<span><span class="va">ll_by_outcome</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 30
## # Groups:   outcome [3]
##    case_id generation date_inf…¹ date_onset date_hos…² date_out…³ outcome gender
##    &lt;chr&gt;        &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt; 
##  1 5fe599           4 2014-05-08 2014-05-13 2014-05-15 NA         &lt;NA&gt;    m     
##  2 8689b7           4 NA         2014-05-13 2014-05-14 2014-05-18 Recover f     
##  3 11f8ea           2 NA         2014-05-16 2014-05-18 2014-05-30 Recover m     
##  4 b8812a           3 2014-05-04 2014-05-18 2014-05-20 NA         &lt;NA&gt;    f     
##  5 893f25           3 2014-05-18 2014-05-21 2014-05-22 2014-05-29 Recover m     
##  6 be99c8           3 2014-05-03 2014-05-22 2014-05-23 2014-05-24 Recover f     
##  7 07e3e8           4 2014-05-22 2014-05-27 2014-05-29 2014-06-01 Recover f     
##  8 369449           4 2014-05-28 2014-06-02 2014-06-03 2014-06-07 Death   f     
##  9 f393b4           4 NA         2014-06-05 2014-06-06 2014-06-18 Recover m     
## 10 1389ca           4 NA         2014-06-05 2014-06-07 2014-06-09 Death   f     
## # … with 5,878 more rows, 22 more variables: age &lt;dbl&gt;, age_unit &lt;chr&gt;,
## #   age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;, hospital &lt;chr&gt;, lon &lt;dbl&gt;,
## #   lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;, ht_cm &lt;dbl&gt;,
## #   ct_blood &lt;dbl&gt;, fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;, aches &lt;chr&gt;,
## #   vomit &lt;chr&gt;, temp &lt;dbl&gt;, time_admission &lt;chr&gt;, bmi &lt;dbl&gt;,
## #   days_onset_hosp &lt;dbl&gt;, and abbreviated variable names ¹​date_infection,
## #   ²​date_hospitalisation, ³​date_outcome</code></pre>
<div id="一意のグループ" class="section level3 unnumbered">
<h3>一意のグループ<a class="anchor" aria-label="anchor" href="#%E4%B8%80%E6%84%8F%E3%81%AE%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97"><i class="fas fa-link"></i></a>
</h3>
<p><strong>複数の列を使用してデータをグループ化する場合、グループ化に使用された列の値の一意の組み合わせによって各グループが作成されます。</strong></p>
<p>作成された各グループと各グループに含まれる行数を確認する場合は、グループ化されたデータを <code><a href="https://dplyr.tidyverse.org/reference/count.html">tally()</a></code> に渡します。各グループに含まれる行数を表示せずに一意のグループだけを表示したい場合は、<code><a href="https://dplyr.tidyverse.org/reference/group_data.html">group_keys()</a></code> に渡します。</p>
<p>下の例では、グループ化に使用された列 <code>outcome</code> の結果には、「Death」、「Recover」、<code>NA</code> の 3 つの一意の値があります。2582 行の deaths, 1983 行の recover, 1323 行の NA（outcome の記録なし）があることがわかります。</p>
<div class="sourceCode" id="cb629"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   outcome     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Death    2582
## 2 Recover  1983
## 3 &lt;NA&gt;     1323</code></pre>
<p>複数の列でグループ化することもできます。下の例では、データフレームが <code>outcome</code> 列と <code>gender</code> 列の組み合わせごとにグループ化され、集計されています。 <code>outcome</code> 列と <code>gender</code> 列の一意の組み合わせが、いずれかの列の欠損値も含めて、独自のグループとして作成されていることに注意してください。</p>
<div class="sourceCode" id="cb631"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 9 × 3
## # Groups:   outcome [3]
##   outcome gender     n
##   &lt;chr&gt;   &lt;chr&gt;  &lt;int&gt;
## 1 Death   f       1227
## 2 Death   m       1228
## 3 Death   &lt;NA&gt;     127
## 4 Recover f        953
## 5 Recover m        950
## 6 Recover &lt;NA&gt;      80
## 7 &lt;NA&gt;    f        627
## 8 &lt;NA&gt;    m        625
## 9 &lt;NA&gt;    &lt;NA&gt;      71</code></pre>
</div>
<div id="新しい列" class="section level3 unnumbered">
<h3>新しい列<a class="anchor" aria-label="anchor" href="#%E6%96%B0%E3%81%97%E3%81%84%E5%88%97"><i class="fas fa-link"></i></a>
</h3>
<p>グループ化に使用する列を、<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> のコード内で新しく作成することもできます。これは、 <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> を実行する前に <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> を呼び出すのと同じです。このスタイルは簡素な集計作業には便利ですが、コードをわかりやすくするために <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> で先に新しい列を作成してから、<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> にパイプすることをおすすめします。</p>
<div class="sourceCode" id="cb633"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  group_by() コマンド内で作成されたバイナリ変数（列）によってグループ化する</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span></span>
<span>    age_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span>, <span class="st">"adult"</span>, <span class="st">"child"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span>sort <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   age_class     n
##   &lt;chr&gt;     &lt;int&gt;
## 1 child      3618
## 2 adult      2184
## 3 &lt;NA&gt;         86</code></pre>
</div>
<div id="グループ化した列の追加削除" class="section level3 unnumbered">
<h3>グループ化した列の追加・削除<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E5%88%97%E3%81%AE%E8%BF%BD%E5%8A%A0%E5%89%8A%E9%99%A4"><i class="fas fa-link"></i></a>
</h3>
<p>デフォルトでは、すでにグループ化されているデータに対して <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> を実行すると、古いグループが削除され、新しく作成されたグループが適用されます。すでに作成されたグループに新しいグループを追加したい場合は、引数に <code>.add = TRUE</code> を含めてください。</p>
<div class="sourceCode" id="cb635"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># outcome毎にグループ化</span></span>
<span><span class="va">by_outcome</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># さらに性別によるグループ化を追加</span></span>
<span><span class="va">by_outcome_gender</span> <span class="op">&lt;-</span> <span class="va">by_outcome</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">gender</span>, .add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>すべてのグループの保持</strong></p>
<p>因子型（factor）の列でデータをグループ化すると、現時点でデータに存在していない因子（factor）のレベルが存在する可能性があります。このような列でグループ化すると、デフォルトでは、存在しないレベルは削除され、グループとして含まれません。すべてのレベルが（データに存在しない場合でも）グループとして表示されるように変更したい場合は、<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> コマンドで <code>.drop = FALSE</code> と設定します。</p>
</div>
</div>
<div id="グループ化の解除" class="section level2 unnumbered">
<h2>グループ化の解除<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%AE%E8%A7%A3%E9%99%A4"><i class="fas fa-link"></i></a>
</h2>
<p>グループ化されたデータは <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> でグループ化が解除されるまで、グループ化されたままになります。グループ化を解除せずに計算を行うと、期待通りの結果にならない可能性があります！<br>
以下は、すべてのグループを解除する例です。</p>
<div class="sourceCode" id="cb636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> 内に列名を書くと、特定の列のみのグループ化を解除することもできます。</p>
<div class="sourceCode" id="cb637"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="va">gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="co"># gender によるグループ化を解除し、outcome によるグループ化は残す</span></span></code></pre></div>
<p><strong>注：</strong> <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> は、カウントを行った後にデータのグループ化を自動的に解除します。</p>
</div>
<div id="group_summarise" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> グループ化したデータの要約<a class="anchor" aria-label="anchor" href="#group_summarise"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> を使用して要約統計量の表を作成する方法の詳細については、<a href="tables-descriptive.html#tables-descriptive">記述統計表の作り方</a> の章の <strong>dplyr</strong> セクションを参照してください。ここでは、<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> をグループ化されたデータに適用したときに、<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> の動作がどのように変化するかについて簡単に説明します。</p>
<p><strong>dplyr</strong> パッケージに含まれている <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> （または <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>）は、データフレームを受け取り、あなたが定義した要約統計量を含む、新しい要約データフレームに変換します。グループ化されていないデータフレームでは、サマリー統計量はデータフレーム内のすべての行から計算されます。<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> がグループ化されたデータに適用されると、各グループの要約統計量が生成されます。</p>
<p>以下に示すように、通常、<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> の構文は、新しく作成される要約列の名前、等号（<code>=</code>）、そしてデータに適用する統計関数（例えば <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>、 <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>、 <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>、 <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> など）を指定します。統計関数の中に、操作する列と関連する引数を書きます（例：<code>na.rm = TRUE</code>）。 <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> を使用して、指定する論理条件を満たす行の数を数えることもできます（<code>==</code> を使用します）。</p>
<p>以下は、グループ化されていないデータセットに適用された <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> の例です。データセット全体から計算された結果が返されます。</p>
<div class="sourceCode" id="cb638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># グループ化されていないラインリストの要約統計量</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n_cases  <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    max_age  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    min_age  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    n_males  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   n_cases mean_age max_age min_age n_males
## 1    5888 16.01831      84       0    2803</code></pre>
<p>対照的に、以下はグループ化されたデータに適用される同じ <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> を使用したコマンドです。統計は <code>outcome</code> グループごとに計算されます。グループ化された列が新しいデータフレームにどのように引き継がれるかに注意してください。</p>
<div class="sourceCode" id="cb640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># グループ化されてたラインリストの要約統計量</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    n_cases  <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    max_age  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    min_age  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    n_males    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   outcome n_cases mean_age max_age min_age n_males
##   &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;
## 1 Death      2582     15.9      76       0    1228
## 2 Recover    1983     16.1      84       0     950
## 3 &lt;NA&gt;       1323     16.2      69       0     625</code></pre>
<p><span style="color: darkgreen;"><strong>ヒント</strong>： summarise 関数は、イギリス英語とアメリカ英語のどちらの綴りで書いても機能します。<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> と <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>は同じ関数を呼び出します。</span></p>
</div>
<div id="グループ化したデータの集計" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> グループ化したデータの集計<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%9B%86%E8%A8%88"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> と <code><a href="https://dplyr.tidyverse.org/reference/count.html">tally()</a></code> は同じような処理を行いますが、異なる関数です。<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> と <code><a href="https://dplyr.tidyverse.org/reference/count.html">tally()</a></code> の違いに関する詳細は、<a href="https://dplyr.tidyverse.org/reference/tally.html">こちら</a> をご覧ください。</p>
<div id="tally" class="section level3 unnumbered">
<h3>
<code>tally()</code><a class="anchor" aria-label="anchor" href="#tally"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/count.html">tally()</a></code> は <code>summarise(n = n())</code> の省略形であり、データをグループ化しません。グループ化された集計を行うには、 <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> コマンドの後に書く必要があります。 <code>sort = TRUE</code> を追加すると、最大のグループが一番上に表示されます。</p>
<div class="sourceCode" id="cb642"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      n
## 1 5888</code></pre>
<div class="sourceCode" id="cb644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span>sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   outcome     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Death    2582
## 2 Recover  1983
## 3 &lt;NA&gt;     1323</code></pre>
</div>
<div id="count" class="section level3 unnumbered">
<h3>
<code>count()</code><a class="anchor" aria-label="anchor" href="#count"><i class="fas fa-link"></i></a>
</h3>
<p>対照的に <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> は以下を行います。</p>
<ol style="list-style-type: decimal">
<li>指定された列に <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> を適用する<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> を適用し、各グループに含まれている行数である <code>n</code> 列を返す<br>
</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> を適用する</li>
</ol>
<div class="sourceCode" id="cb646"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   outcome    n
## 1   Death 2582
## 2 Recover 1983
## 3    &lt;NA&gt; 1323</code></pre>
<p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> と同様に、<code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> コマンド内で新しい列を作成できます。</p>
<div class="sourceCode" id="cb648"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span>age_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span>, <span class="st">"adult"</span>, <span class="st">"child"</span><span class="op">)</span>, sort <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   age_class    n
## 1     child 3618
## 2     adult 2184
## 3      &lt;NA&gt;   86</code></pre>
<p><code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> は「ロールアップ」機能を使用して複数回呼び出すことができます。例えば、病院の数を性別ごとに計算したい場合は、次のように行います。わかりやすくするために、（<code>name  =</code> を使って）最後の列の名前がデフォルトの「n」から変更されていることに注意してください。</p>
<div class="sourceCode" id="cb650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># 一意なoutcome - genderグループをカウントします</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># 性別ごとに行を集計し（3）、性別ごとに病院の数を数えます（6）</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">gender</span>, name <span class="op">=</span> <span class="st">"hospitals per gender"</span> <span class="op">)</span> </span></code></pre></div>
<pre><code>##   gender hospitals per gender
## 1      f                    6
## 2      m                    6
## 3   &lt;NA&gt;                    6</code></pre>
</div>
<div id="総数を追加する" class="section level3 unnumbered">
<h3>総数を追加する<a class="anchor" aria-label="anchor" href="#%E7%B7%8F%E6%95%B0%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> と <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> とは対照的に、<code><a href="https://dplyr.tidyverse.org/reference/count.html">add_count()</a></code> を使用すると、<u>データフレーム内の他のすべての列を保持しつつ</u>、グループごとの行数を含む新しい列 <code>n</code> を<u>追加</u>できます。</p>
<p>各グループに含まれる行数が新しい列 <code>n</code> に出力され、それぞれグループの各行に表示されます。出力結果を確認するため、この新しい列 <code>n</code> 列を追加した後、見やすくなるように列を並べ替えます。他の例については、本章後半の <a href="grouping.html#group_filter_grp_size">グループ化したデータを変換する</a> のセクションを参照してください。</p>
<div class="sourceCode" id="cb652"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                   <span class="co"># 出力が綺麗になるようにtibbleに変換</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">add_count</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>           <span class="co"># 病院ごとのカウント列n を追加</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">n</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># デモ目的に列を並び替え</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 31
##    hospital        n case_id gener…¹ date_inf…² date_onset date_hos…³ date_out…⁴
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    
##  1 Other         885 5fe599        4 2014-05-08 2014-05-13 2014-05-15 NA        
##  2 Missing      1469 8689b7        4 NA         2014-05-13 2014-05-14 2014-05-18
##  3 St. Mark's…   422 11f8ea        2 NA         2014-05-16 2014-05-18 2014-05-30
##  4 Port Hospi…  1762 b8812a        3 2014-05-04 2014-05-18 2014-05-20 NA        
##  5 Military H…   896 893f25        3 2014-05-18 2014-05-21 2014-05-22 2014-05-29
##  6 Port Hospi…  1762 be99c8        3 2014-05-03 2014-05-22 2014-05-23 2014-05-24
##  7 Missing      1469 07e3e8        4 2014-05-22 2014-05-27 2014-05-29 2014-06-01
##  8 Missing      1469 369449        4 2014-05-28 2014-06-02 2014-06-03 2014-06-07
##  9 Missing      1469 f393b4        4 NA         2014-06-05 2014-06-06 2014-06-18
## 10 Missing      1469 1389ca        4 NA         2014-06-05 2014-06-07 2014-06-09
## # … with 5,878 more rows, 23 more variables: outcome &lt;chr&gt;, gender &lt;chr&gt;,
## #   age &lt;dbl&gt;, age_unit &lt;chr&gt;, age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;,
## #   lon &lt;dbl&gt;, lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;,
## #   ht_cm &lt;dbl&gt;, ct_blood &lt;dbl&gt;, fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;,
## #   aches &lt;chr&gt;, vomit &lt;chr&gt;, temp &lt;dbl&gt;, time_admission &lt;chr&gt;, bmi &lt;dbl&gt;,
## #   days_onset_hosp &lt;dbl&gt;, and abbreviated variable names ¹​generation,
## #   ²​date_infection, ³​date_hospitalisation, ⁴​date_outcome</code></pre>
</div>
<div id="合計を追加する" class="section level3 unnumbered">
<h3>合計を追加する<a class="anchor" aria-label="anchor" href="#%E5%90%88%E8%A8%88%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/count.html">tally()</a></code> か <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> を使用した後、合計行または列の<u>合計</u>を簡単に追加するには、<a href="#Descriptive%20tables">記述統計表の作り方</a> の章の <strong>janitor</strong> セクションを参照してください。<strong>janitor</strong> パッケージは、<code>adorn_totals()</code> や <code>adorn_percentages()</code> のような、合計を追加してパーセンテージを表示する関数を提供します。以下は簡単な例です。</p>
<div class="sourceCode" id="cb654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                                  <span class="co"># 症例のラインリスト</span></span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">age_cat</span>, <span class="va">gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                  <span class="co"># 2 つの列の数をクロス集計</span></span>
<span>  <span class="fu">adorn_totals</span><span class="op">(</span>where <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>             <span class="co"># 合計行を追加</span></span>
<span>  <span class="fu">adorn_percentages</span><span class="op">(</span>denominator <span class="op">=</span> <span class="st">"col"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># 列の分母を使用して比率に変換</span></span>
<span>  <span class="fu">adorn_pct_formatting</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                  <span class="co"># 比率をパーセントに変換</span></span>
<span>  <span class="fu">adorn_ns</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"front"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>            <span class="co"># 「数（パーセント）」と表示</span></span>
<span>  <span class="fu">adorn_title</span><span class="op">(</span>                                <span class="co"># タイトルを調整</span></span>
<span>    row_name <span class="op">=</span> <span class="st">"Age Category"</span>,</span>
<span>    col_name <span class="op">=</span> <span class="st">"Gender"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##                      Gender                           
##  Age Category             f             m          NA_
##           0-4  640  (22.8%)  416  (14.8%)  39  (14.0%)
##           5-9  641  (22.8%)  412  (14.7%)  42  (15.1%)
##         10-14  518  (18.5%)  383  (13.7%)  40  (14.4%)
##         15-19  359  (12.8%)  364  (13.0%)  20   (7.2%)
##         20-29  468  (16.7%)  575  (20.5%)  30  (10.8%)
##         30-49  179   (6.4%)  557  (19.9%)  18   (6.5%)
##         50-69    2   (0.1%)   91   (3.2%)   2   (0.7%)
##           70+    0   (0.0%)    5   (0.2%)   1   (0.4%)
##          &lt;NA&gt;    0   (0.0%)    0   (0.0%)  86  (30.9%)
##         Total 2807 (100.0%) 2803 (100.0%) 278 (100.0%)</code></pre>
<p>より複雑な合計行、たとえば合計以外の要約統計量を含む行を新しく追加したい場合は、 <a href="tables-descriptive.html#tbl_dplyr_totals">記述統計表の作り方の章のこちらのセクション</a> をご覧ください。</p>
</div>
</div>
<div id="日付によるグループ化" class="section level2" number="13.5">
<h2>
<span class="header-section-number">13.5</span> 日付によるグループ化<a class="anchor" aria-label="anchor" href="#%E6%97%A5%E4%BB%98%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96"><i class="fas fa-link"></i></a>
</h2>
<p>データを日付でグループ化する場合は、対象の日付単位（たとえば「日」、「疫学週」、「月」など）の列が必要です。（なければ作成する必要があります）。この列は <a href="dates.html#dates">日付型データ</a> の章の <a href="dates.html#dates_epi_wks">疫学週のセクション</a> で説明されているように、<strong>lubridate</strong> の <code>floor_date()</code> を使用して作成することもできます。 この列を作成後、<strong>dplyr</strong> の <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> を使用し、これらの一意の日付で行をグループ化し、カウントすることができます。</p>
<p>日付の処理に共通して、よく必要となる追加手順は、データに存在しない日付を追加して埋めることです。そのような場合は、<strong>tidyr</strong> の <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> を使用すると、集計された日付系列の、範囲内のすべての日付単位に関して、日付が完全にそろいます。この手順がないと、症例が報告されていない 週はデータに表示されないかもしれません！</p>
<p><code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> 内で、日付列を最小から最大までの一連の日付 <code><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date()</a></code>として再定義することで、日付列の値が拡張・展開されます。デフォルトでは、新しく「展開された」行の症例数のカウント値は <code>NA</code> になります。<code>NA</code> ではなく 0 と表示したい場合は、<code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> の引数 <code>fill =</code> にカウント値の列名をリスト形式で指定します（新しく作成された症例数のカウント列の名前が n であれば <code>fill = list(n = 0)</code> と書きます）。詳細については <code><a href="https://tidyr.tidyverse.org/reference/complete.html">?complete</a></code> を、使用例をご覧になりたい方は、日付型データの章の <a href="dates.html#dates_epi_wks">日付の操作のセクション</a> を参照してください。</p>
<div id="ラインリストの症例を日でグループ化" class="section level3 unnumbered">
<h3>ラインリストの症例を日でグループ化<a class="anchor" aria-label="anchor" href="#%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E7%97%87%E4%BE%8B%E3%82%92%E6%97%A5%E3%81%A7%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96"><i class="fas fa-link"></i></a>
</h3>
<p>こちらは <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> を使用<u>せずに</u>、症例を日数でグループ化する例です。以下の例では、最初の行で症例のない日をスキップすることに注意してください。</p>
<div class="sourceCode" id="cb656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>        <span class="co"># date_onset の値がないものを削除する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span>              <span class="co"># 一意な日付ごとの行数をカウントする</span></span></code></pre></div>
<div id="htmlwidget-81effa64ebf26d541844" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-81effa64ebf26d541844">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05","2014-05-06","2014-05-07","2014-05-08","2014-05-09","2014-05-10","2014-05-11","2014-05-12","2014-05-13","2014-05-14","2014-05-16","2014-05-17","2014-05-18","2014-05-19","2014-05-20","2014-05-21","2014-05-22","2014-05-23","2014-05-24","2014-05-25","2014-05-26","2014-05-27","2014-05-28","2014-05-29","2014-05-30","2014-05-31","2014-06-02","2014-06-03","2014-06-05","2014-06-06","2014-06-07","2014-06-08","2014-06-09","2014-06-10","2014-06-11","2014-06-12","2014-06-13","2014-06-14","2014-06-15","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-21","2014-06-22","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-28","2014-06-29","2014-06-30","2014-07-01","2014-07-02","2014-07-03","2014-07-04","2014-07-05","2014-07-06","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-21","2014-07-22","2014-07-23","2014-07-24","2014-07-25","2014-07-26","2014-07-27","2014-07-28","2014-07-29","2014-07-30","2014-07-31","2014-08-01","2014-08-02","2014-08-03","2014-08-04","2014-08-05","2014-08-06","2014-08-07","2014-08-08","2014-08-09","2014-08-10","2014-08-11","2014-08-12","2014-08-13","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-25","2014-08-26","2014-08-27","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-08","2014-09-09","2014-09-10","2014-09-11","2014-09-12","2014-09-13","2014-09-14","2014-09-15","2014-09-16","2014-09-17","2014-09-18","2014-09-19","2014-09-20","2014-09-21","2014-09-22","2014-09-23","2014-09-24","2014-09-25","2014-09-26","2014-09-27","2014-09-28","2014-09-29","2014-09-30","2014-10-01","2014-10-02","2014-10-03","2014-10-04","2014-10-05","2014-10-06","2014-10-07","2014-10-08","2014-10-09","2014-10-10","2014-10-11","2014-10-12","2014-10-13","2014-10-14","2014-10-15","2014-10-16","2014-10-17","2014-10-18","2014-10-19","2014-10-20","2014-10-21","2014-10-22","2014-10-23","2014-10-24","2014-10-25","2014-10-26","2014-10-27","2014-10-28","2014-10-29","2014-10-30","2014-10-31","2014-11-01","2014-11-02","2014-11-03","2014-11-04","2014-11-05","2014-11-06","2014-11-07","2014-11-08","2014-11-09","2014-11-10","2014-11-11","2014-11-12","2014-11-13","2014-11-14","2014-11-15","2014-11-16","2014-11-17","2014-11-18","2014-11-19","2014-11-20","2014-11-21","2014-11-22","2014-11-23","2014-11-24","2014-11-25","2014-11-26","2014-11-27","2014-11-28","2014-11-29","2014-11-30","2014-12-01","2014-12-02","2014-12-03","2014-12-04","2014-12-05","2014-12-06","2014-12-07","2014-12-08","2014-12-09","2014-12-10","2014-12-11","2014-12-12","2014-12-13","2014-12-14","2014-12-15","2014-12-16","2014-12-17","2014-12-18","2014-12-19","2014-12-20","2014-12-21","2014-12-22","2014-12-23","2014-12-24","2014-12-25","2014-12-26","2014-12-27","2014-12-28","2014-12-29","2014-12-30","2014-12-31","2015-01-01","2015-01-02","2015-01-03","2015-01-04","2015-01-05","2015-01-06","2015-01-07","2015-01-08","2015-01-09","2015-01-10","2015-01-11","2015-01-12","2015-01-13","2015-01-14","2015-01-15","2015-01-16","2015-01-17","2015-01-18","2015-01-19","2015-01-20","2015-01-21","2015-01-22","2015-01-23","2015-01-24","2015-01-25","2015-01-26","2015-01-27","2015-01-28","2015-01-29","2015-01-30","2015-01-31","2015-02-01","2015-02-02","2015-02-03","2015-02-04","2015-02-05","2015-02-06","2015-02-07","2015-02-08","2015-02-09","2015-02-10","2015-02-11","2015-02-12","2015-02-13","2015-02-14","2015-02-15","2015-02-16","2015-02-17","2015-02-18","2015-02-19","2015-02-20","2015-02-21","2015-02-22","2015-02-23","2015-02-24","2015-02-25","2015-02-26","2015-02-27","2015-02-28","2015-03-01","2015-03-02","2015-03-03","2015-03-04","2015-03-05","2015-03-06","2015-03-07","2015-03-08","2015-03-09","2015-03-10","2015-03-11","2015-03-12","2015-03-13","2015-03-14","2015-03-15","2015-03-16","2015-03-17","2015-03-18","2015-03-19","2015-03-20","2015-03-21","2015-03-22","2015-03-23","2015-03-24","2015-03-25","2015-03-26","2015-03-27","2015-03-28","2015-03-29","2015-03-30","2015-03-31","2015-04-01","2015-04-02","2015-04-03","2015-04-04","2015-04-05","2015-04-06","2015-04-07","2015-04-08","2015-04-09","2015-04-10","2015-04-11","2015-04-12","2015-04-13","2015-04-14","2015-04-15","2015-04-16","2015-04-17","2015-04-18","2015-04-19","2015-04-20","2015-04-21","2015-04-22","2015-04-23","2015-04-24","2015-04-25","2015-04-26","2015-04-27","2015-04-28","2015-04-29","2015-04-30"],[1,1,2,1,1,1,2,1,1,1,3,2,2,2,1,1,2,3,3,2,3,4,2,1,3,1,2,1,3,3,10,1,1,1,2,5,3,4,4,5,1,5,5,3,1,1,2,5,6,4,2,3,7,3,4,2,6,5,3,1,2,2,6,4,3,5,6,5,3,3,7,7,5,4,6,6,10,10,6,6,10,7,11,4,6,11,9,10,7,12,6,15,14,8,9,16,13,18,18,9,9,9,10,13,17,7,17,12,17,31,13,14,14,19,17,26,19,25,21,16,24,23,25,25,22,27,25,28,30,22,33,30,36,33,23,31,27,30,42,40,50,37,38,38,49,52,35,50,37,38,33,33,39,39,45,34,44,29,40,50,41,39,35,28,36,34,37,36,36,34,43,28,38,33,37,29,33,44,43,24,37,30,35,24,37,44,34,40,30,34,26,29,33,31,22,26,26,19,30,24,29,24,21,19,11,22,20,23,32,33,28,15,20,24,18,20,19,22,17,32,21,20,23,17,15,18,20,19,18,21,18,16,20,15,18,15,18,18,15,15,19,18,19,11,15,19,11,13,13,12,11,14,18,17,10,15,16,12,17,19,14,12,18,14,14,15,11,13,21,11,14,11,13,12,14,11,10,16,10,15,13,13,10,11,8,11,11,11,8,9,8,8,10,8,9,11,13,13,16,13,11,16,6,8,10,16,11,11,8,11,16,9,10,8,14,7,10,11,11,7,5,11,6,8,9,13,9,7,9,4,9,7,13,2,7,9,5,5,10,12,10,3,6,4,5,11,3,7,6,7,9,3,7,4,9,6,5,5,9,4,4,4,9,7,8,2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>下の例では <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> コマンドを追加して、範囲内のすべての日が確実に表示されるようにしました。</p>
<div class="sourceCode" id="cb657"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">daily_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                 <span class="co"># date_onset 列の値がないものを削除する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                   <span class="co"># 一意な日付ごとの行数をカウントする</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span>                               <span class="co"># 症例がない日もすべて表示する</span></span>
<span>    date_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>                <span class="co"># 列を日付シーケンスとして再定義する</span></span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, </span>
<span>      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_onset</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 新しく行を追加して列 n に（デフォルトの NAの代わりに）0 を表示する</span></span></code></pre></div>
<div id="htmlwidget-e9a910b3f38b1a8bf06c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e9a910b3f38b1a8bf06c">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05","2014-05-06","2014-05-07","2014-05-08","2014-05-09","2014-05-10","2014-05-11","2014-05-12","2014-05-13","2014-05-14","2014-05-16","2014-05-17","2014-05-18","2014-05-19","2014-05-20","2014-05-21","2014-05-22","2014-05-23","2014-05-24","2014-05-25","2014-05-26","2014-05-27","2014-05-28","2014-05-29","2014-05-30","2014-05-31","2014-06-02","2014-06-03","2014-06-05","2014-06-06","2014-06-07","2014-06-08","2014-06-09","2014-06-10","2014-06-11","2014-06-12","2014-06-13","2014-06-14","2014-06-15","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-21","2014-06-22","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-28","2014-06-29","2014-06-30","2014-07-01","2014-07-02","2014-07-03","2014-07-04","2014-07-05","2014-07-06","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-21","2014-07-22","2014-07-23","2014-07-24","2014-07-25","2014-07-26","2014-07-27","2014-07-28","2014-07-29","2014-07-30","2014-07-31","2014-08-01","2014-08-02","2014-08-03","2014-08-04","2014-08-05","2014-08-06","2014-08-07","2014-08-08","2014-08-09","2014-08-10","2014-08-11","2014-08-12","2014-08-13","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-25","2014-08-26","2014-08-27","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-08","2014-09-09","2014-09-10","2014-09-11","2014-09-12","2014-09-13","2014-09-14","2014-09-15","2014-09-16","2014-09-17","2014-09-18","2014-09-19","2014-09-20","2014-09-21","2014-09-22","2014-09-23","2014-09-24","2014-09-25","2014-09-26","2014-09-27","2014-09-28","2014-09-29","2014-09-30","2014-10-01","2014-10-02","2014-10-03","2014-10-04","2014-10-05","2014-10-06","2014-10-07","2014-10-08","2014-10-09","2014-10-10","2014-10-11","2014-10-12","2014-10-13","2014-10-14","2014-10-15","2014-10-16","2014-10-17","2014-10-18","2014-10-19","2014-10-20","2014-10-21","2014-10-22","2014-10-23","2014-10-24","2014-10-25","2014-10-26","2014-10-27","2014-10-28","2014-10-29","2014-10-30","2014-10-31","2014-11-01","2014-11-02","2014-11-03","2014-11-04","2014-11-05","2014-11-06","2014-11-07","2014-11-08","2014-11-09","2014-11-10","2014-11-11","2014-11-12","2014-11-13","2014-11-14","2014-11-15","2014-11-16","2014-11-17","2014-11-18","2014-11-19","2014-11-20","2014-11-21","2014-11-22","2014-11-23","2014-11-24","2014-11-25","2014-11-26","2014-11-27","2014-11-28","2014-11-29","2014-11-30","2014-12-01","2014-12-02","2014-12-03","2014-12-04","2014-12-05","2014-12-06","2014-12-07","2014-12-08","2014-12-09","2014-12-10","2014-12-11","2014-12-12","2014-12-13","2014-12-14","2014-12-15","2014-12-16","2014-12-17","2014-12-18","2014-12-19","2014-12-20","2014-12-21","2014-12-22","2014-12-23","2014-12-24","2014-12-25","2014-12-26","2014-12-27","2014-12-28","2014-12-29","2014-12-30","2014-12-31","2015-01-01","2015-01-02","2015-01-03","2015-01-04","2015-01-05","2015-01-06","2015-01-07","2015-01-08","2015-01-09","2015-01-10","2015-01-11","2015-01-12","2015-01-13","2015-01-14","2015-01-15","2015-01-16","2015-01-17","2015-01-18","2015-01-19","2015-01-20","2015-01-21","2015-01-22","2015-01-23","2015-01-24","2015-01-25","2015-01-26","2015-01-27","2015-01-28","2015-01-29","2015-01-30","2015-01-31","2015-02-01","2015-02-02","2015-02-03","2015-02-04","2015-02-05","2015-02-06","2015-02-07","2015-02-08","2015-02-09","2015-02-10","2015-02-11","2015-02-12","2015-02-13","2015-02-14","2015-02-15","2015-02-16","2015-02-17","2015-02-18","2015-02-19","2015-02-20","2015-02-21","2015-02-22","2015-02-23","2015-02-24","2015-02-25","2015-02-26","2015-02-27","2015-02-28","2015-03-01","2015-03-02","2015-03-03","2015-03-04","2015-03-05","2015-03-06","2015-03-07","2015-03-08","2015-03-09","2015-03-10","2015-03-11","2015-03-12","2015-03-13","2015-03-14","2015-03-15","2015-03-16","2015-03-17","2015-03-18","2015-03-19","2015-03-20","2015-03-21","2015-03-22","2015-03-23","2015-03-24","2015-03-25","2015-03-26","2015-03-27","2015-03-28","2015-03-29","2015-03-30","2015-03-31","2015-04-01","2015-04-02","2015-04-03","2015-04-04","2015-04-05","2015-04-06","2015-04-07","2015-04-08","2015-04-09","2015-04-10","2015-04-11","2015-04-12","2015-04-13","2015-04-14","2015-04-15","2015-04-16","2015-04-17","2015-04-18","2015-04-19","2015-04-20","2015-04-21","2015-04-22","2015-04-23","2015-04-24","2015-04-25","2015-04-26","2015-04-27","2015-04-28","2015-04-29","2015-04-30"],[1,1,2,1,1,1,2,1,1,1,3,2,2,2,1,1,2,3,3,2,3,4,2,1,3,1,2,1,3,3,10,1,1,1,2,5,3,4,4,5,1,5,5,3,1,1,2,5,6,4,2,3,7,3,4,2,6,5,3,1,2,2,6,4,3,5,6,5,3,3,7,7,5,4,6,6,10,10,6,6,10,7,11,4,6,11,9,10,7,12,6,15,14,8,9,16,13,18,18,9,9,9,10,13,17,7,17,12,17,31,13,14,14,19,17,26,19,25,21,16,24,23,25,25,22,27,25,28,30,22,33,30,36,33,23,31,27,30,42,40,50,37,38,38,49,52,35,50,37,38,33,33,39,39,45,34,44,29,40,50,41,39,35,28,36,34,37,36,36,34,43,28,38,33,37,29,33,44,43,24,37,30,35,24,37,44,34,40,30,34,26,29,33,31,22,26,26,19,30,24,29,24,21,19,11,22,20,23,32,33,28,15,20,24,18,20,19,22,17,32,21,20,23,17,15,18,20,19,18,21,18,16,20,15,18,15,18,18,15,15,19,18,19,11,15,19,11,13,13,12,11,14,18,17,10,15,16,12,17,19,14,12,18,14,14,15,11,13,21,11,14,11,13,12,14,11,10,16,10,15,13,13,10,11,8,11,11,11,8,9,8,8,10,8,9,11,13,13,16,13,11,16,6,8,10,16,11,11,8,11,16,9,10,8,14,7,10,11,11,7,5,11,6,8,9,13,9,7,9,4,9,7,13,2,7,9,5,5,10,12,10,3,6,4,5,11,3,7,6,7,9,3,7,4,9,6,5,5,9,4,4,4,9,7,8,2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="ラインリストの症例を週でグループ化" class="section level3 unnumbered">
<h3>ラインリストの症例を週でグループ化<a class="anchor" aria-label="anchor" href="#%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E7%97%87%E4%BE%8B%E3%82%92%E9%80%B1%E3%81%A7%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96"><i class="fas fa-link"></i></a>
</h3>
<p>同じ原則でデータを週でもグループ化することができます。最初に「症例が発症した週」という新しい列を <code>floor_date()</code> の <code>unit = "week"</code> を使って作成します。 次に前述のように <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> を使って週毎の症例数を集計します。最後に <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> で症例がない週もすべて表示されるようにします。</p>
<div class="sourceCode" id="cb658"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 週毎の症例数のデータセットを作る</span></span>
<span><span class="va">weekly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                 <span class="co"># date_onset 列の値がないものを削除します</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># 発症した週という新しい列</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">week</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                         <span class="co"># データを週毎にグループ化し、グループごとに行をカウントします。</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span>                               <span class="co"># ケースがない場合でも、すべての日が表示されるようにします</span></span>
<span>    week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>                      <span class="co"># 列を日付シーケンスとして再定義します</span></span>
<span>      from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">week</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, </span>
<span>      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">week</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>                   <span class="co"># 新しく行を追加して列 n に（デフォルトの NA の代わりに）0 を表示します</span></span></code></pre></div>
<p>データフレームの最初の 50 行を以下に表示します。</p>
<div id="htmlwidget-106916fd5bc4f986229c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-106916fd5bc4f986229c">{"x":{"filter":"none","vertical":false,"data":[["2014-04-06","2014-04-13","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26"],[1,1,4,4,12,14,14,21,21,18,30,23,31,35,55,58,80,86,114,122,159,187,210,294,278,270,263,252,243,241,223,176,140,170,151,130,123,122,94,101,106,99,87,80,66,80,80,76,68,61,51,58,39,45,37,28]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="ラインリストの症例を月でグループ化" class="section level3 unnumbered">
<h3>ラインリストの症例を月でグループ化<a class="anchor" aria-label="anchor" href="#%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E7%97%87%E4%BE%8B%E3%82%92%E6%9C%88%E3%81%A7%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96"><i class="fas fa-link"></i></a>
</h3>
<p>症例を月毎に集約するには、<strong>lubridate</strong> パッケージの <code>floor_date()</code> を使用しますが、引数は <code>unit = "months"</code> です。 これにより、各日付はその月の 1 日に切り捨て・切り上げられます。出力結果は、<code>Date</code> 型になります。 <code><a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a></code> でも <code>by = "months"</code> と指定することに注意してください。</p>
<div class="sourceCode" id="cb659"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 月毎の症例数のデータセットを作る</span></span>
<span><span class="va">monthly_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, unit <span class="op">=</span> <span class="st">"months"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># 新しい列、発症月の 1 日</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                          <span class="co"># 月ごとの症例数をカウント</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span></span>
<span>    month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">month</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,     <span class="co"># 症例が報告されていない月も含めてすべての月を組み込む</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">month</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>      by<span class="op">=</span><span class="st">"month"</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-a905236b6d27f1212fe0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a905236b6d27f1212fe0">{"x":{"filter":"none","vertical":false,"data":[["2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01"],[7,64,100,226,528,1070,1112,763,562,431,306,277,186]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>month<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="日毎の集計数を週毎に" class="section level3 unnumbered">
<h3>日毎の集計数を週毎に<a class="anchor" aria-label="anchor" href="#%E6%97%A5%E6%AF%8E%E3%81%AE%E9%9B%86%E8%A8%88%E6%95%B0%E3%82%92%E9%80%B1%E6%AF%8E%E3%81%AB"><i class="fas fa-link"></i></a>
</h3>
<p>日毎の集計を週毎に集約するには、上記のように <code>floor_date()</code> を使用します。ただし、 <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> の代わりに <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> と <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> を使用します。週あたりの行数をカウントするだけでなく、日毎の症例数を <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> する必要があるためです。</p>
</div>
<div id="日毎の集計を月毎に" class="section level3 unnumbered">
<h3>日毎の集計を月毎に<a class="anchor" aria-label="anchor" href="#%E6%97%A5%E6%AF%8E%E3%81%AE%E9%9B%86%E8%A8%88%E3%82%92%E6%9C%88%E6%AF%8E%E3%81%AB"><i class="fas fa-link"></i></a>
</h3>
<p>日毎の集計を月毎に集約するには、上記のように <code>floor_date()</code> と <code>unit = "month"</code> を使用します。ただし、 <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> の代わりに <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> と <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> を使用します。月毎の行数をカウントするだけでなく、日毎の症例数を <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> する必要があるためです。</p>
</div>
</div>
<div id="グループ化したデータの並び替え" class="section level2" number="13.6">
<h2>
<span class="header-section-number">13.6</span> グループ化したデータの並び替え<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%B8%A6%E3%81%B3%E6%9B%BF%E3%81%88"><i class="fas fa-link"></i></a>
</h2>
<p><strong>dplyr</strong> の <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> を使用してデータフレーム内の行を並べ替えると、引数に <code>.by_group = TRUE</code> を設定しない限り、データがグループ化されたときに同じように動作します。この場合、行はまずグループ化に適用された列、次に <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> に指定した列の順番で並び替えられます。</p>
</div>
<div id="グループ化したデータのフィルタリング" class="section level2" number="13.7">
<h2>
<span class="header-section-number">13.7</span> グループ化したデータのフィルタリング<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0"><i class="fas fa-link"></i></a>
</h2>
<div id="filter" class="section level3 unnumbered">
<h3>
<code>filter()</code><a class="anchor" aria-label="anchor" href="#filter"><i class="fas fa-link"></i></a>
</h3>
<p>データフレームを評価する関数（ <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code>, <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> など）と組み合わせて <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> を適用すると、これらの関数が各グループに適用されます。たとえば、フィルタリングによって患者が年齢の中央値を超えている行のみを保持する場合、グループごとにフィルタリングが適用され、各グループの年齢の中央値を超える行が保持されます。</p>
</div>
<div id="グループごとにスライスする" class="section level3 unnumbered">
<h3>グループごとにスライスする<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%94%E3%81%A8%E3%81%AB%E3%82%B9%E3%83%A9%E3%82%A4%E3%82%B9%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://dplyr.tidyverse.org/reference/slice.html">データ内の位置に基づいて行をフィルタリングする</a> <strong>dplyr</strong> の <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> も、グループごとに適用できます。期待通りにデータを「スライス」するためためには、各グループ内のデータを並べ替えることを忘れないでください。</p>
<p>例えば、各病院で一番最近入院した 5 つの症例を取得したい場合は、次のように行います。</p>
<ol style="list-style-type: decimal">
<li>
<code>hospital</code> 列でラインリストをグループ化する<br>
</li>
<li>
<u>各病院グループ内で</u> <code>date_hospitalisation</code> 列を最新の日付から古い日付へ降順で並べ替える<br>
</li>
<li>スライスして各病院から最初の 5 行を抽出する</li>
</ol>
<div class="sourceCode" id="cb660"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">date_hospitalisation</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                            <span class="co"># 表示用</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">hospital</span>, <span class="va">date_hospitalisation</span><span class="op">)</span>  <span class="co"># 表示用</span></span></code></pre></div>
<pre><code>## # A tibble: 30 × 3
## # Groups:   hospital [6]
##    case_id hospital          date_hospitalisation
##    &lt;chr&gt;   &lt;chr&gt;             &lt;date&gt;              
##  1 20b688  Central Hospital  2014-05-06          
##  2 d58402  Central Hospital  2014-05-10          
##  3 b8f2fd  Central Hospital  2014-05-13          
##  4 acf422  Central Hospital  2014-05-28          
##  5 275cc7  Central Hospital  2014-05-28          
##  6 d1fafd  Military Hospital 2014-04-17          
##  7 974bc1  Military Hospital 2014-05-13          
##  8 6a9004  Military Hospital 2014-05-13          
##  9 09e386  Military Hospital 2014-05-14          
## 10 865581  Military Hospital 2014-05-15          
## # … with 20 more rows</code></pre>
<p><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head()</a></code> - 上から n 行を選択する<br><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_tail()</a></code> - 最後から n 行を選択する<br><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample()</a></code> - n 行をランダムに選択する<br><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_min()</a></code> - <code>order_by =</code> 列で最も高い値を持つ n 行を選択する（<code>with_ties = TRUE</code> を使用すると同点を保持する）<br><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_max()</a></code> - <code>order_by =</code> 列で最も低い値を持つ n 行を選択する（<code>with_ties = TRUE</code> を使用すると同点を保持する）</p>
<p><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> の他の例と詳細をご覧になりたい方は、<a href="#De-duplication">重複データの排除</a> を参照ください。</p>
</div>
<div id="group_filter_grp_size" class="section level3 unnumbered">
<h3>グループの大きさでフィルタリングする<a class="anchor" aria-label="anchor" href="#group_filter_grp_size"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://dplyr.tidyverse.org/reference/count.html">add_count()</a></code> は、元のデータに列 <code>n</code> を追加し、括弧内で指定した行のグループごとの行数を計算する関数です。</p>
<p>以下の例では、<code><a href="https://dplyr.tidyverse.org/reference/count.html">add_count()</a></code> が <code>hospital</code> 列に適用され、新しい列 <code>n</code> の各行の値は、その行の病院の総症例数となります。<code>n</code> 列の値がどのように繰り返されるているかに注意してください。以下の例の列名 <code>n</code> は、 <code><a href="https://dplyr.tidyverse.org/reference/count.html">add_count()</a></code> 内の <code>name =</code> を使用して変更できます。結果をわかりやすく表示するため、 <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> を使用して列を並べ替えています。</p>
<div class="sourceCode" id="cb662"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">add_count</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>          <span class="co"># 「この行と同じ病院に入院した行数」を追加する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">n</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 31
##    hospital        n case_id gener…¹ date_inf…² date_onset date_hos…³ date_out…⁴
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    
##  1 Other         885 5fe599        4 2014-05-08 2014-05-13 2014-05-15 NA        
##  2 Missing      1469 8689b7        4 NA         2014-05-13 2014-05-14 2014-05-18
##  3 St. Mark's…   422 11f8ea        2 NA         2014-05-16 2014-05-18 2014-05-30
##  4 Port Hospi…  1762 b8812a        3 2014-05-04 2014-05-18 2014-05-20 NA        
##  5 Military H…   896 893f25        3 2014-05-18 2014-05-21 2014-05-22 2014-05-29
##  6 Port Hospi…  1762 be99c8        3 2014-05-03 2014-05-22 2014-05-23 2014-05-24
##  7 Missing      1469 07e3e8        4 2014-05-22 2014-05-27 2014-05-29 2014-06-01
##  8 Missing      1469 369449        4 2014-05-28 2014-06-02 2014-06-03 2014-06-07
##  9 Missing      1469 f393b4        4 NA         2014-06-05 2014-06-06 2014-06-18
## 10 Missing      1469 1389ca        4 NA         2014-06-05 2014-06-07 2014-06-09
## # … with 5,878 more rows, 23 more variables: outcome &lt;chr&gt;, gender &lt;chr&gt;,
## #   age &lt;dbl&gt;, age_unit &lt;chr&gt;, age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;,
## #   lon &lt;dbl&gt;, lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;,
## #   ht_cm &lt;dbl&gt;, ct_blood &lt;dbl&gt;, fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;,
## #   aches &lt;chr&gt;, vomit &lt;chr&gt;, temp &lt;dbl&gt;, time_admission &lt;chr&gt;, bmi &lt;dbl&gt;,
## #   days_onset_hosp &lt;dbl&gt;, and abbreviated variable names ¹​generation,
## #   ²​date_infection, ³​date_hospitalisation, ⁴​date_outcome</code></pre>
<p>こうすれば「小さな」病院、たとえば 500 人未満の患者が入院した病院、に入院した症例列を簡単にフィルタリングできるようになります。</p>
<div class="sourceCode" id="cb664"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">add_count</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&lt;</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="グループ化したデータを変換する" class="section level2" number="13.8">
<h2>
<span class="header-section-number">13.8</span> グループ化したデータを変換する<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h2>
<p>すべての列と（要約ではない）行を保持したまま、グループ統計を含む新しい列を追加するには <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> ではなく、 <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> の後に <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> を使用します。</p>
<p>これは、他のすべての列を残したまま、グループ統計を算出するときに便利です。例えば、ある行の値をその行を含むグループの値と比較する計算などです。</p>
<p>以下の例では、ある症例（行）の入院までに所要した日数（入院の遅れ）と、病院全体の入院までに所要した日数の平均値との差を計算します。 手順は次のとおりです。</p>
<ol style="list-style-type: decimal">
<li>データを病院ごとにグループ化する<br>
</li>
<li>
<code>days_onset_hosp</code> 列を使って、病院全体の遅れの平均を含む新しい列を作成する<br>
</li>
<li>2 つの列の差を計算する</li>
</ol>
<p>結果をわかりやすく表示するために、表示する列のみを <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> で選択しています。</p>
<div class="sourceCode" id="cb665"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># 病院ごとのグループデータ（ラインリストへの変更はまだ保存されていない）</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># 新しい列</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># 病院ごとの入院までの平均日数（小数点第1位を四捨五入）</span></span>
<span>    group_delay_admit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">days_onset_hosp</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># 各行の遅延と病院の平均遅延の差（小数点以下第1位を四捨五入）</span></span>
<span>    diff_to_group     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">days_onset_hosp</span> <span class="op">-</span> <span class="va">group_delay_admit</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># 特定の行のみを選択 - 表示の目的で</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">hospital</span>, <span class="va">days_onset_hosp</span>, <span class="va">group_delay_admit</span>, <span class="va">diff_to_group</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
## # Groups:   hospital [6]
##    case_id hospital                             days_onset_hosp group_…¹ diff_…²
##    &lt;chr&gt;   &lt;chr&gt;                                          &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 5fe599  Other                                              2      2       0  
##  2 8689b7  Missing                                            1      2.1    -1.1
##  3 11f8ea  St. Mark's Maternity Hospital (SMMH)               2      2.1    -0.1
##  4 b8812a  Port Hospital                                      2      2.1    -0.1
##  5 893f25  Military Hospital                                  1      2.1    -1.1
##  6 be99c8  Port Hospital                                      1      2.1    -1.1
##  7 07e3e8  Missing                                            2      2.1    -0.1
##  8 369449  Missing                                            1      2.1    -1.1
##  9 f393b4  Missing                                            1      2.1    -1.1
## 10 1389ca  Missing                                            2      2.1    -0.1
## # … with 5,878 more rows, and abbreviated variable names ¹​group_delay_admit,
## #   ²​diff_to_group</code></pre>
</div>
<div id="グループ化したデータの選択" class="section level2" number="13.9">
<h2>
<span class="header-section-number">13.9</span> グループ化したデータの選択<a class="anchor" aria-label="anchor" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%81%B8%E6%8A%9E"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> はグループ化されたデータに対して機能しますが、グループ化した列は常に（ <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> で指定されていない場合でも）含まれます。グループ化した列を含みたくない場合は、最初に <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> を使用してください。</p>
<!-- ======================================================= -->
</div>
<div id="参考資料-6" class="section level2" number="13.10">
<h2>
<span class="header-section-number">13.10</span> 参考資料<a class="anchor" aria-label="anchor" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-6"><i class="fas fa-link"></i></a>
</h2>
<p>詳細については、以下の資料をご参照ください。</p>
<ul>
<li><p>グループ化されたデータには、いかなる要約機能でも適用することができます。 <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf">RStudio data transformation cheat sheet</a> を参照ください。</p></li>
<li><p>The Data Carpentry が作成した <a href="https://datacarpentry.org/R-genomics/04-dplyr.html"><strong>dplyr</strong></a> のページ<br><strong>tidyverse</strong> 公式ドキュメントの <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a> と <a href="https://dplyr.tidyverse.org/articles/grouping.html">grouping</a> のページ</p></li>
<li><p><a href="https://itsalocke.com/files/DataManipulationinR.pdf">Data manipulation</a> に関するページ</p></li>
<li><p><a href="https://stackoverflow.com/questions/23528862/summarize-with-conditions-in-dplyr">Summarize with conditions in dplyr</a></p></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></div>
<div class="next"><a href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#grouping"><span class="header-section-number">13</span> データのグループ化</a></li>
<li>
<a class="nav-link" href="#%E6%BA%96%E5%82%99-4"><span class="header-section-number">13.1</span> 準備</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-5">パッケージの読み込み</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88-5">データのインポート</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96"><span class="header-section-number">13.2</span> グループ化</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E4%B8%80%E6%84%8F%E3%81%AE%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97">一意のグループ</a></li>
<li><a class="nav-link" href="#%E6%96%B0%E3%81%97%E3%81%84%E5%88%97">新しい列</a></li>
<li><a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E5%88%97%E3%81%AE%E8%BF%BD%E5%8A%A0%E5%89%8A%E9%99%A4">グループ化した列の追加・削除</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%AE%E8%A7%A3%E9%99%A4">グループ化の解除</a></li>
<li><a class="nav-link" href="#group_summarise"><span class="header-section-number">13.3</span> グループ化したデータの要約</a></li>
<li>
<a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%9B%86%E8%A8%88"><span class="header-section-number">13.4</span> グループ化したデータの集計</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tally">tally()</a></li>
<li><a class="nav-link" href="#count">count()</a></li>
<li><a class="nav-link" href="#%E7%B7%8F%E6%95%B0%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">総数を追加する</a></li>
<li><a class="nav-link" href="#%E5%90%88%E8%A8%88%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">合計を追加する</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E6%97%A5%E4%BB%98%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96"><span class="header-section-number">13.5</span> 日付によるグループ化</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E7%97%87%E4%BE%8B%E3%82%92%E6%97%A5%E3%81%A7%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96">ラインリストの症例を日でグループ化</a></li>
<li><a class="nav-link" href="#%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E7%97%87%E4%BE%8B%E3%82%92%E9%80%B1%E3%81%A7%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96">ラインリストの症例を週でグループ化</a></li>
<li><a class="nav-link" href="#%E3%83%A9%E3%82%A4%E3%83%B3%E3%83%AA%E3%82%B9%E3%83%88%E3%81%AE%E7%97%87%E4%BE%8B%E3%82%92%E6%9C%88%E3%81%A7%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96">ラインリストの症例を月でグループ化</a></li>
<li><a class="nav-link" href="#%E6%97%A5%E6%AF%8E%E3%81%AE%E9%9B%86%E8%A8%88%E6%95%B0%E3%82%92%E9%80%B1%E6%AF%8E%E3%81%AB">日毎の集計数を週毎に</a></li>
<li><a class="nav-link" href="#%E6%97%A5%E6%AF%8E%E3%81%AE%E9%9B%86%E8%A8%88%E3%82%92%E6%9C%88%E6%AF%8E%E3%81%AB">日毎の集計を月毎に</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E4%B8%A6%E3%81%B3%E6%9B%BF%E3%81%88"><span class="header-section-number">13.6</span> グループ化したデータの並び替え</a></li>
<li>
<a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0"><span class="header-section-number">13.7</span> グループ化したデータのフィルタリング</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#filter">filter()</a></li>
<li><a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%94%E3%81%A8%E3%81%AB%E3%82%B9%E3%83%A9%E3%82%A4%E3%82%B9%E3%81%99%E3%82%8B">グループごとにスライスする</a></li>
<li><a class="nav-link" href="#group_filter_grp_size">グループの大きさでフィルタリングする</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B"><span class="header-section-number">13.8</span> グループ化したデータを変換する</a></li>
<li><a class="nav-link" href="#%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E5%8C%96%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E9%81%B8%E6%8A%9E"><span class="header-section-number">13.9</span> グループ化したデータの選択</a></li>
<li><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-6"><span class="header-section-number">13.10</span> 参考資料</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>疫学のための R ハンドブック</strong>" was written by the handbook team. It was last built on 2022-10-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

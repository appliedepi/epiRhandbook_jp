<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>30 ggplot の基本 | 疫学のための R ハンドブック</title>
<meta name="author" content="the handbook team">
<meta name="description" content="ggplot2 パッケージは、最も人気のあるデータビジュアライゼーションの R パッケージです。ggplot() はこのパッケージの中核であり、このアプローチ全体が “ggplot” として口語的に知られており、結果として得られる図は親しみを込めて “ggplots” と呼ばれることもあります。これらの名前の “gg” は、図を作成するために使用される “grammar of...">
<meta name="generator" content="bookdown 0.31 with bs4_book()">
<meta property="og:title" content="30 ggplot の基本 | 疫学のための R ハンドブック">
<meta property="og:type" content="book">
<meta property="og:description" content="ggplot2 パッケージは、最も人気のあるデータビジュアライゼーションの R パッケージです。ggplot() はこのパッケージの中核であり、このアプローチ全体が “ggplot” として口語的に知られており、結果として得られる図は親しみを込めて “ggplots” と呼ばれることもあります。これらの名前の “gg” は、図を作成するために使用される “grammar of...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="30 ggplot の基本 | 疫学のための R ハンドブック">
<meta name="twitter:description" content="ggplot2 パッケージは、最も人気のあるデータビジュアライゼーションの R パッケージです。ggplot() はこのパッケージの中核であり、このアプローチ全体が “ggplot” として口語的に知られており、結果として得られる図は親しみを込めて “ggplots” と呼ばれることもあります。これらの名前の “gg” は、図を作成するために使用される “grammar of...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.26/datatables.js"></script><link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script type="text/javascript">
        // window.addEventListener("load", function() {
        //     document.getElementById('toc').firstChild.innerHTML = "章目次"; 
        // });
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementsByClassName("d-flex align-items-start justify-content-between")[0].children[0].children[0].innerHTML = "疫学のための R</br>ハンドブック";
            document.getElementById('toc').firstChild.innerHTML = "章目次"; 
            document.getElementById('main-nav').children[1].firstChild.innerHTML = "総目次";
            document.getElementById('search').setAttribute("placeholder", "検索");
        });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">疫学のための R ハンドブック</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">本書について</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> 編集前記・技術注記</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> ハンドブックとデータのダウンロード</a></li>
<li class="book-part">基本編</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R の基礎</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Excel・Stata・SASとの比較</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> 推奨パッケージ</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R プロジェクト</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> データのインポート・エクスポート</a></li>
<li class="book-part">データマネジメント</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> データクリーニングと主要関数</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> データのグループ化</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> 重複データの排除</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> ループと反復処理・リストの操作</a></li>
<li class="book-part">データ分析</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> 記述統計表の作り方</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> 標準化率</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> 移動平均</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> 時系列分析とアウトブレイクの検出</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> エピデミックモデリング</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></li>
<li class="book-part">データの可視化</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></li>
<li><a class="active" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> 流行曲線（エピカーブ）</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> 人口ピラミッドとリッカート尺度</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> 感染連鎖</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> 系統樹</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></li>
<li class="book-part">レポートとダッシュボード</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> R Markdownで作るダッシュボード</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny で作るダッシュボード</a></li>
<li class="book-part">その他</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> 関数の作成</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> ディレクトリの操作</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Git と Github を使ったバージョン管理と共同作業</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> よくあるエラー</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> ヘルプ</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> ネットワークドライブで R を使用する場合</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table パッケージを使用したデータ処理</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ggplot-basics" class="section level1" number="30">
<h1>
<span class="header-section-number">30</span> ggplot の基本<a class="anchor" aria-label="anchor" href="#ggplot-basics"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/ggplot_basics_top.png" width="100%" style="display: block; margin: auto;"></div>
<p><strong>ggplot2</strong> パッケージは、最も人気のあるデータビジュアライゼーションの R パッケージです。<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> はこのパッケージの中核であり、このアプローチ全体が “ggplot” として口語的に知られており、結果として得られる図は親しみを込めて “ggplots” と呼ばれることもあります。これらの名前の “gg” は、図を作成するために使用される “<strong>g</strong>rammar of <strong>g</strong>raphics” を反映しています。 <strong>ggplot2</strong> パッケージ は、その機能性をさらに向上させるさまざまな補助的な R パッケージの恩恵を受けています。</p>
<p>構文は <code>R</code> の <strong>base</strong> で描画する方法とは大きく異なり、それに伴って知識を獲得できるまで時間がかかります。<strong>ggplot2</strong> パッケージを使用するには、一般的にユーザーは <strong>tidyverse</strong> パッケージとの互換性が高い方法でデータをフォーマットする必要があり、結果的にこれらのパッケージを一緒に使用することは非常に効果的です。</p>
<p>この章では、<strong>ggplot2</strong> パッケージを使った描画の基礎を説明します。プロットをきれいに見せるための提案や高度なテクニックについては、<a href="ggplot-tips.html#ggplot-tips">ggplot のヒント</a>の章を参照してください。</p>
<p>リソースセクションにリンクされているいくつかの広い範囲をカバーした <strong>ggplot2</strong> パッケージのチュートリアルがあります。また、RStudio のウェブサイトから <a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">ggplot によるデータビジュアライゼーションのチートシート</a>をダウンロードすることができます。データを創造的に可視化する方法のインスピレーションを得たい場合は、<a href="https://www.r-graph-gallery.com/">R graph gallery</a> や<a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a> のようなウェブサイトを参照することをお勧めします。</p>
<!-- ======================================================= -->
<div id="準備-20" class="section level2" number="30.1">
<h2>
<span class="header-section-number">30.1</span> 準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-20"><i class="fas fa-link"></i></a>
</h2>
<div id="パッケージの読み込み-14" class="section level3 unnumbered">
<h3>パッケージの読み込み<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-14"><i class="fas fa-link"></i></a>
</h3>
<p>以下のコードを実行すると、分析に必要なパッケージが読み込まれます。このハンドブックでは、パッケージを読み込むために、pacman パッケージの p_load() を主に使用しています。p_load() は、必要に応じてパッケージをインストールし、現在の R セッションで使用するためにパッケージを読み込む関数です。また、すでにインストールされたパッケージは、R の基本パッケージである base （以下、base R）の library() を使用して読み込むこともできます。R のパッケージに関する詳細は <a href="basics.html#basics">R の基礎</a> の章をご覧ください。</p>
<div class="sourceCode" id="cb1415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">tidyverse</span>,      <span class="co"># ggplot2 やその他データマネジメントに関するツールが含まれています</span></span>
<span>  <span class="va">rio</span>,            <span class="co"># インポートとエクスポート</span></span>
<span>  <span class="va">here</span>,           <span class="co"># ファイル・ロケーター</span></span>
<span>  <span class="va">stringr</span>         <span class="co"># 文字列に関する作業   </span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="データのインポート-12" class="section level3 unnumbered">
<h3>データのインポート<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88-12"><i class="fas fa-link"></i></a>
</h3>
<p>エボラ出血熱の流行をシミュレートしたデータセットをインポートします。お手元の環境でこの章の内容を実行したい方は、 <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">クリック</a>して「前処理された」ラインリスト（linelist）データをダウンロードしてください&gt;（.rds 形式で取得できます）。データは <em>rio</em> パッケージの import() を利用してインポートしましょう（<em>rio</em> パッケージは、.xlsx、.csv、.rds など様々な種類のファイルを取り扱うことができます。詳細は、<a href="importing.html#importing">インポートとエクスポート</a> の章をご覧ください）。</p>
<div class="sourceCode" id="cb1416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>ラインリストの最初の 50 行を以下に表示します。ここでは、連続変数である <code>age</code>、<code>wt_kg</code>（キログラム単位の体重）、<code>ct_blood</code>（CT値）、<code>days_onset_hosp</code>（発症日と入院日の差）に注目します。</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-95b4ed3d3098cf14b96c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-95b4ed3d3098cf14b96c">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="一般的なクリーニング" class="section level3 unnumbered">
<h3>一般的なクリーニング<a class="anchor" aria-label="anchor" href="#%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0"><i class="fas fa-link"></i></a>
</h3>
<p>プロット用のデータを準備する際には、できるだけ <a href="https://r4ds.had.co.nz/tidy-data.html">「tidy な（整然とした）」 データの基準</a>に沿うようにするのがよいでしょう。その方法については、本ハンドブックのデータ管理の章、<a href="cleaning.html#cleaning">データクリーニングと主要関数</a> などで説明しています。</p>
<p>プロットに適したデータを準備する簡単な方法としては、データの内容を表示に適したものにすることが挙げられますが、これは必ずしもデータ操作に適しているとは限りません。例えば、次のようなことです。</p>
<ul>
<li>文字列の <code>NA</code> 値を “Unknown” という文字列で置き換える。</li>
<li>列の値が所定の序列レベルになるように<u>因子</u>型に変換することを検討する。</li>
<li>アンダースコアなどの「データに適した」値を通常のテキストまたはタイトルケースに変更するように、一部の列をクリーニングする（<a href="cleaning.html#cleaning">データクリーニングと主要関数</a> を参照）。</li>
</ul>
<p>以下に、この作業の例を示します。</p>
<div class="sourceCode" id="cb1417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 列の表示をより分かりやすい名前にします</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    gender_disp <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span> <span class="op">~</span> <span class="st">"Male"</span>,        <span class="co"># m を Male に</span></span>
<span>                            <span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span> <span class="op">~</span> <span class="st">"Female"</span>,      <span class="co"># f を Female に</span></span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Unknown"</span><span class="op">)</span>,    <span class="co"># NA を Unknown に</span></span>
<span>    </span>
<span>    outcome_disp <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Unknown"</span><span class="op">)</span>          <span class="co"># outcome の NA を Unknown に置換</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div id="縦長のデータへの転回" class="section level3 unnumbered">
<h3>縦長のデータへの転回<a class="anchor" aria-label="anchor" href="#%E7%B8%A6%E9%95%B7%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%B8%E3%81%AE%E8%BB%A2%E5%9B%9E"><i class="fas fa-link"></i></a>
</h3>
<p>データ構造の問題として、<strong>ggplot2</strong> パッケージではデータを転回して<u>縦に長い</u>フォーマットにしたいこともよくあります。詳しくは<a href="pivoting.html#pivoting">データの縦横変換</a>の章をご覧ください。</p>
<div class="inline-figure"><img src="images/pivoting/pivot_longer_new.png" width="100%" style="display: block; margin: auto;"></div>
<p>例えば、<code>linelist</code> に登録されている各症例とその症状のような、「横に広い」フォーマットのデータについてプロットしたいとします。以下では、<code>symptoms_data</code> という mini-linelist を作成し、<code>case_id</code> と症状の列のみを格納します。</p>
<div class="sourceCode" id="cb1418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">symptoms_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>この mini-linelist の最初の 50 行は次のようになっています。それぞれの症状を列にして「横に広く」フォーマットされているのが分かります。</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-91213fabc4b58373ea09" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-91213fabc4b58373ea09">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>特定の症状を持つ症例の数をプロットしたい場合、各症状が特定の列であるという事実によって制限されます。しかし、症状の列を<u>転回</u>して、次のように縦に長いフォーマットにすることができます。</p>
<div class="sourceCode" id="cb1419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">symptoms_data_long</span> <span class="op">&lt;-</span> <span class="va">symptoms_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    <span class="co"># symptoms_data と名付けた "mini" linelist から始めます</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                       <span class="co"># case_id を除いた全ての列（全ての症状に関する列）を転回します</span></span>
<span>    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,             <span class="co"># 症状に関する新しい列の名前を割り当てます</span></span>
<span>    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co">#  「はい、もしくはいいえ」の値をもつ新しい列の名前を割り当てます</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>symptom_is_present <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="co"># NA を unknown に変換します</span></span></code></pre></div>
<p>こちらが最初の 50 行です。case には 5 つの行があることに注意してください - それぞれの症状ごとに 1 つの列があります。新しい列である <code>symptom_name</code> と <code>symptom_is_present</code> は、転回した結果です。このフォーマットは、他の操作にはあまり役に立たないかもしれませんが、プロットには便利であることに注意してください。</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-72b3efc18564c82efa9b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-72b3efc18564c82efa9b">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","5fe599","5fe599","5fe599","5fe599","8689b7","8689b7","8689b7","8689b7","8689b7","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","b8812a","b8812a","b8812a","b8812a","b8812a","893f25","893f25","893f25","893f25","893f25","be99c8","be99c8","be99c8","be99c8","be99c8","07e3e8","07e3e8","07e3e8","07e3e8","07e3e8","369449","369449","369449","369449","369449","f393b4","f393b4","f393b4","f393b4","f393b4","1389ca","1389ca","1389ca","1389ca","1389ca"],["fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit"],["no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","no","no","no","no","no","no","no","yes","no","yes","no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","no","no","yes","no","yes","no","no","yes","no","yes","no","no","yes","no","no"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>symptom_name<\/th>\n      <th>symptom_is_present<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="ggplotの基礎" class="section level2" number="30.2">
<h2>
<span class="header-section-number">30.2</span> ggplotの基礎<a class="anchor" aria-label="anchor" href="#ggplot%E3%81%AE%E5%9F%BA%E7%A4%8E"><i class="fas fa-link"></i></a>
</h2>
<p><strong>「グラフィックの文法」- ggplot2</strong></p>
<p><strong>ggplot2</strong> パッケージでのプロットは、作図レイヤーやデザイン要素を重ねて「追加」することが基本で、各コマンドはプラス記号（ <code>+</code> ）で前のコマンドに追加されます。その結果として、保存、修正、印刷、エクスポートなどが可能なマルチレイヤーの作図オブジェクトができあがります。</p>
<p>ggplot オブジェクトは非常に複雑になることがありますが、基本的なレイヤーの順番は、通常次のようになります。</p>
<ol style="list-style-type: decimal">
<li>土台となる <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドから始めます。これは ggplot を「開く」もので、次に続く関数を <code>+</code> で追加することができます。一般的には、データセットもこのコマンドで指定します。</li>
<li>“geom” レイヤーの追加 - これらの関数は、データを棒グラフ、折れ線グラフ、散布図、ヒストグラムなどの<u>幾何学（図形）</u>として視覚化します（組み合わせも可能です）。これらの関数は、すべて接頭辞として <code>geom_</code> で始まります。</li>
<li>軸ラベル、タイトル、フォント、サイズ、配色、凡例、軸回転などのデザイン要素をプロットに追加することができます。</li>
</ol>
<p>骨格となるコードの簡単な例を以下に示します。それぞれの要素については，以下のセクションで説明します。</p>
<div class="sourceCode" id="cb1420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># my_data の列を赤い点としてデータをプロットします</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">my_data</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># "my_data" というデータを使います</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>                             <span class="co"># 点（ドット）のレイヤーを追加します</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">col1</span>, y <span class="op">=</span> <span class="va">col2</span><span class="op">)</span>,    <span class="co"># "map" の列を軸にします</span></span>
<span>    color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># geom の他の設定</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                 <span class="co"># タイトル、軸ラベル、などを追加します</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span><span class="op">)</span>                                 <span class="co"># 色、フォント、サイズなどデータではない要素（軸やタイトルなど）を編集します</span></span></code></pre></div>
</div>
<div id="ggplot" class="section level2" number="30.3">
<h2>
<span class="header-section-number">30.3</span> <code>ggplot()</code><a class="anchor" aria-label="anchor" href="#ggplot"><i class="fas fa-link"></i></a>
</h2>
<p>ggplot2 のプロットの最初のコマンドは <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> です。このコマンドは、レイヤーを追加するための真っ白なキャンバスを作成します。さらに、<code>+</code> 記号でレイヤーを追加するための方法を「開放」します。</p>
<p>通常、<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドは、プロットのために <code>data =</code> 引数を含みます。これは、プロットの後続のレイヤーに使用されるデフォルトのデータセットを設定します。</p>
<p>このコマンドは、閉じた括弧の後に <code>+</code> を付けて終了します。これは、コマンドを「オープン」な状態にします。ggplot は、完全なコマンドが最後に + の<u>ない</u>最後のレイヤーを含む場合にのみ、実行/表示されます。</p>
<div class="sourceCode" id="cb1421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># これは真っ白なキャンバスであるプロットを作成します</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="geoms" class="section level2" number="30.4">
<h2>
<span class="header-section-number">30.4</span> Geoms<a class="anchor" aria-label="anchor" href="#geoms"><i class="fas fa-link"></i></a>
</h2>
<p>真っ白なキャンバスはもちろん十分ではありません。データから幾何学（図形）を作成する必要があります（例：棒グラフ、ヒストグラム、散布図、箱ひげ図）。</p>
<p>これは、最初の <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドにレイヤー “geom” を追加することで行います。“geom” を作成する多くの <strong>ggplot2</strong> パッケージの関数があります。これらの関数はそれぞれ “geom_” で始まるので、ここでは <code>geom_XXXX()</code> と一般的に呼びます。<strong>ggplot2</strong> パッケージには 40 以上の geom があり、ggplot2 のファンが作ったものもたくさんあります。<a href="https://exts.ggplot2.tidyverse.org/gallery/">ggplot2 gallery</a> でそれらを見ることができます。いくつかの一般的な geom を以下に示します。</p>
<ul>
<li>ヒストグラム - <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code>
</li>
<li>棒グラフ - <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> あるいは <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> （棒グラフのセクションをご覧ください）</li>
<li>箱ひげ図 - <code><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot()</a></code>
</li>
<li>点（例：散布図） - <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>
</li>
<li>折れ線グラフ - <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> あるいは <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path()</a></code>
</li>
<li>傾向線 - <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code>
</li>
</ul>
<p>1 つのプロットで、1 つまたは複数の geom を表示できます。それぞれの geom は、前の <strong>ggplot2</strong> パッケージのコマンドに <code>+</code> で追加され、後の geom が前の geom の上にプロットされるように、順次プロットされます。</p>
</div>
<div id="ggplot_basics_mapping" class="section level2" number="30.5">
<h2>
<span class="header-section-number">30.5</span> データをプロットにマッピングする<a class="anchor" aria-label="anchor" href="#ggplot_basics_mapping"><i class="fas fa-link"></i></a>
</h2>
<p>ほとんどの geom 関数は、形状を作成するために<u>何を</u>使用するかを指示する必要があります。つまり、軸、形状の色、形状のサイズなどのプロットの構成要素にどのように<u>データの列をマッピング（割り当て）</u>するかを指示する必要があります。ほとんどの geom では、データの列にマッピングされなければならない<u>必要不可欠な</u>要素は、x 軸と（必要に応じて）y 軸です。</p>
<p>この「マッピング」は、<code>mapping =</code> という引数で行われます。<code>mapping</code> に与えるマッピングは、<code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> でラップしなければならないので、以下に示すように、<code>mapping = aes(x = col1, y = col2)</code> のように記述します。</p>
<p>以下、<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドでは、<code>linelist</code> の症例がデータとして設定されています。<code>mapping = aes()</code> の引数では、<code>age</code> 列が x 軸に、<code>wt_kg</code> 列が y 軸にマッピングされています。</p>
<p><code>+</code> の後にプロットコマンドが続きます。“geom” 関数の <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> で図形を作成します。この geom は、上記の <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドのマッピングを<u>継承しています</u>。つまり、geom はどの軸と列がグラフに割り当てられているかをすでに知っている状態であり、それらの関係をキャンパス上の<u>点</u>として視覚化していきます。</p>
<div class="sourceCode" id="cb1422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1032-1.png" width="672"></div>
<p>別の例として、以下のコマンドでは、同じデータを使用して、少しだけ違うマッピングと異なる geom を利用しています。<code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> では、x 軸にマッピングされた列が必要なだけで、y 軸のカウントは自動的に生成されます。</p>
<div class="sourceCode" id="cb1423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1033-1.png" width="672"></div>
<div id="プロットの視覚的特性エステティック" class="section level3 unnumbered">
<h3>プロットの視覚的特性（エステティック）<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E8%A6%96%E8%A6%9A%E7%9A%84%E7%89%B9%E6%80%A7%E3%82%A8%E3%82%B9%E3%83%86%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF"><i class="fas fa-link"></i></a>
</h3>
<p>ggplot の用語では、プロットのエステティック（aesthetic）には特定の意味があります。これは、<u>プロットされたデータ</u>の視覚的特性を意味します。ここでの「エステティック」は、<u>プロットされたデータの幾何学的形状</u>を意味しており、タイトル、軸ラベル、背景色など、一般的な英語で「エステティック」という言葉から連想されるような周辺の表示は含まれていないことに注意してください。ggplot では、これらの詳細は “theme” と呼ばれ、<code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> コマンドで調整されます（<a href="ggplot-basics.html#ggplot_basics_themes">このセクション</a>を参照）。</p>
<p>したがって、プロットオブジェクトの<u>視覚的特性</u>とは、<u>プロットされたデータ</u>の色、サイズ、透過性、配置などのことです。すべての geom が同じオプションを持つわけではありませんが、多くの geom で使用することができます。以下にいくつかの例を示します。</p>
<ul>
<li>
<code>shape =</code> <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> で指定した点を、点、星、三角、四角…のように表示します。</li>
<li>
<code>fill =</code> 棒グラフや箱ひげ図などの内側を塗りつぶす色</li>
<li>
<code>color =</code> 棒グラフや箱ひげ図などの外郭線、または <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> を使用する場合は点の色。</li>
<li>
<code>size =</code> 大きさ（線の太さ、点の大きさなど）</li>
<li>
<code>alpha =</code> 透過度（1 = 不透明、0 = 不可視）</li>
<li>
<code>binwidth =</code> ヒストグラムの階級の幅</li>
<li>
<code>width =</code> “棒グラフ” の列の幅</li>
<li>
<code>linetype =</code> 線の種類 (例：実線、破線、点線)</li>
</ul>
<p>これらのプロットオブジェクトの視覚的特性は、2 つの方法で値を割り当てることができます。</p>
<ol style="list-style-type: decimal">
<li>静的な値（例：<code>color = "blue"</code>）を割り当て、プロットされたすべてのオブザベーションに適用する。</li>
<li>データの列に割り当てられ（例：<code>color = "hospital"</code>）、各観測値の表示はその列の値に依存する。</li>
</ol>
<!-- *These non-axis aesthetics can be assigned static values (e.g. `size = 1`) or can be mapped to a column (e.g. `size = age`).* If you want the aesthetic to be assigned a static value, the assignment is placed *outside* the `mapping = aes()`. If you want the aesthetic to be scaled/depend on the value in each row of data, the assignment is made *inside* the `mapping = aes()`.   -->
</div>
<div id="静的な値の設定" class="section level3 unnumbered">
<h3>静的な値の設定<a class="anchor" aria-label="anchor" href="#%E9%9D%99%E7%9A%84%E3%81%AA%E5%80%A4%E3%81%AE%E8%A8%AD%E5%AE%9A"><i class="fas fa-link"></i></a>
</h3>
<p>プロットオブジェクトの視覚的特性を静的なものにしたい場合、つまり、データの中のすべての観測値に対して同じものにしたい場合は、geom の中にその割り当てを記述しますが、<code>mapping = aes()</code> の引数の外に記述します。これらの割り当ては、<code>size = 1</code> や <code>color = "blue"</code> のようになります。以下に 2 つの例を示します。</p>
<ul>
<li>1 つ目の例では、<code>mapping = aes()</code> は <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドの中にあり、軸にはデータの中の年齢と体重の列がマッピングされています。プロットの視覚的特性である <code>color =</code>, <code>size =</code>, <code>alpha =</code> （透明度）は静的な値に割り当てられています。わかりやすくするために、これは <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> の中で行われていますが、後から他の geom を追加してプロットの視覚的特性に異なる値を設定することもできます。</li>
<li>2 つ目の例では、ヒストグラムでは x 軸のみを列にマッピングする必要があります。ヒストグラムの <code>binwidth =</code>, <code>color =</code>, <code>fill =</code>（内部色）, <code>alpha =</code> は、再び geom 内で静的な値に設定されます。</li>
</ul>
<div class="sourceCode" id="cb1424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 散布図</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># データと軸のマッピングを設定</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>         <span class="co"># 静的な点の視覚的特性を設定</span></span>
<span></span>
<span><span class="co"># ヒストグラム</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>       <span class="co"># データと軸を設定</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>              <span class="co"># ヒストグラムを表示</span></span>
<span>    binwidth <span class="op">=</span> <span class="fl">7</span>,                <span class="co"># 階級の広さ</span></span>
<span>    color <span class="op">=</span> <span class="st">"red"</span>,               <span class="co"># 階級の線の色</span></span>
<span>    fill <span class="op">=</span> <span class="st">"blue"</span>,               <span class="co"># 階級の内側の色</span></span>
<span>    alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>                 <span class="co"># 階級の透過度</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1034-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1034-2.png" width="50%"></p>
</div>
<div id="列の値に応じたスケーリング" class="section level3 unnumbered">
<h3>列の値に応じたスケーリング<a class="anchor" aria-label="anchor" href="#%E5%88%97%E3%81%AE%E5%80%A4%E3%81%AB%E5%BF%9C%E3%81%98%E3%81%9F%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0"><i class="fas fa-link"></i></a>
</h3>
<p>もう一つの方法は、プロットオブジェクトの美しさを列の値に応じて調整することです。この方法では、この視覚的特性の表示は、データのその列における観測値に依存することになります。列の値が連続的であれば、その視覚的特性の表示尺度（凡例）は連続的になります。列の値が離散的であれば、凡例には各値が表示され、プロットされたデータは明確に「グループ化」されているように見えます（詳しくはこの章の<a href="ggplot-basics.html#ggplotgroups">グループ化</a>のセクションをご覧ください）。</p>
<p>これを実現するには、プロットの視覚的特性を<u>列名</u>（引用符で囲まれていないもの）にマッピングします。これは、<u><code>mapping = aes()</code> 内で</u>行う必要があります（注：<a href="#id_#ggplot_basics_map_loc">後述するように</a>、コード内にはマッピングの割り当てを行う場所がいくつかあります）。</p>
<p>以下に 2 つの例を示します。</p>
<ul>
<li>1 つ目の例では、（各ポイントの）<code>color =</code> が <code>age</code> の列にマッピングされ、凡例にスケールが表示されています。この例では、目盛りが存在していることを覚えておいてください。後ほどそれらを修正する方法を示します。</li>
<li>2 つ目の例では、2 つの新しいプロットの視覚的特性が列にマッピングされています（<code>color =</code> と <code>size =</code>）。一方、プロットの視覚的特性である <code>shape =</code> と <code>alpha =</code> は、<code>mapping = aes()</code> を使わずに、静的な値にマッピングされています。</li>
</ul>
<div class="sourceCode" id="cb1425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 散布図</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># データを設定</span></span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>     <span class="co"># 列名をマッピング</span></span>
<span>         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># x 軸に age をマッピング</span></span>
<span>         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># y 軸に weight をマッピング</span></span>
<span>         color <span class="op">=</span> <span class="va">age</span><span class="op">)</span></span>
<span>       <span class="op">)</span><span class="op">+</span>     <span class="co"># color に age をマッピング</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span>         <span class="co"># データを点として表示 </span></span>
<span></span>
<span><span class="co"># 散布図</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># データを設定</span></span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>     <span class="co"># 列名をマッピング</span></span>
<span>         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># x 軸に age をマッピング           </span></span>
<span>         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># y 軸に weight をマッピング</span></span>
<span>         color <span class="op">=</span> <span class="va">age</span>,       <span class="co"># color に age をマッピング</span></span>
<span>         size <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># size に age をマッピング</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>             <span class="co"># データを点として表示</span></span>
<span>    shape <span class="op">=</span> <span class="st">"diamond"</span>,      <span class="co"># 点を菱形として表示</span></span>
<span>    alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>            <span class="co"># 点の透過度を30%として表示</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1035-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1035-2.png" width="50%"></p>
<p>注：軸の割り当ては、常にデータの列に割り当てられます（静的な値ではありません）。これは常に <code>mapping = aes()</code> 内で行われます。</p>
<p>複数の geom を持つプロットなど、より複雑なプロットを作成する場合には、プロットのレイヤーと視覚的特性を把握しておくことが重要になります。以下の例では、<code>size =</code> が <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> と <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> の 2 回割り当てられていますが、どちらも静的な値です。</p>
<div class="sourceCode" id="cb1426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>           <span class="co"># 列名をマッピング</span></span>
<span>         x <span class="op">=</span> <span class="va">age</span>,</span>
<span>         y <span class="op">=</span> <span class="va">wt_kg</span>,</span>
<span>         color <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span></span>
<span>       <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>                   <span class="co"># データの各行に点を追加</span></span>
<span>    size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>                  <span class="co"># トレンドラインの追加</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,              <span class="co"># 線形性に基づく方法</span></span>
<span>    size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>                   <span class="co"># サイズ（線の太さ）を2に</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1036-1.png" width="672"></div>
</div>
<div id="ggplot_basics_map_loc" class="section level3 unnumbered">
<h3>マッピングのアサインをする場所<a class="anchor" aria-label="anchor" href="#ggplot_basics_map_loc"><i class="fas fa-link"></i></a>
</h3>
<p><code>mapping = aes()</code> 内のマッピングは、プロットコマンドの中のいくつかの場所に書くことができ、また複数回書くこともできます。これは、一番最初の <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドの中に書くこともできますし、その下の個々の geom ごとに書くこともできます。ニュアンスは以下の通りです。</p>
<ul>
<li>トップの <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドで作成されたマッピング割り当ては、 <code>x =</code> と <code>y =</code> が継承されるように、下にあるすべての geom でデフォルトとして継承されます。</li>
<li>1 つの geom 内で行われたマッピング割り当ては、その geom にのみ適用されます。</li>
</ul>
<p>同様に、トップの <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> で指定された <code>data =</code> は、それ以下のすべての geom にデフォルトで適用されますが、geom ごとにデータを指定することもできます（ただし、これはより難しいです）。</p>
<p>このように、以下の各コマンドは同じプロットを作成します。</p>
<div class="sourceCode" id="cb1427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># これらのコマンドは、同じプロットを作成します</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="ggplotgroups" class="section level3 unnumbered">
<h3>グループ<a class="anchor" aria-label="anchor" href="#ggplotgroups"><i class="fas fa-link"></i></a>
</h3>
<p>データをグループ化して「グループ別にプロット」することも簡単にできます。実際に、あなたはすでにこれを行っています。</p>
<p><code>mapping = aes()</code> の中で、「グループ化」列を適切なプロットの視覚的特性に割り当てます。上の例では、連続値の場合、<code>age</code> 列にポイント <code>size =</code> を割り当てました。しかし、これは離散的・カテゴリカルな列にも同じように作用します。</p>
<p>例えば、ポイントを性別ごとに表示したい場合は、<code>mapping = aes(color = gender)</code> とします。凡例が自動的に表示されます。この割り当ては、トップの <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドの中の <code>mapping = aes()</code> の中で行うことができます（そして、geom に継承されます）。また、geom の中の別の <code>mapping = aes()</code> の中で設定することもできます。両方の方法を以下に示します。</p>
<div class="sourceCode" id="cb1428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1038-1.png" width="672"></div>
<div class="sourceCode" id="cb1429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># この代替コードも、同じプロットを生成します</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>geom に応じて、データをグループ化するために異なる引数を使用する必要があることに注意してください。<code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> の場合は、<code>color =</code>, <code>shape =</code>, <code>size =</code> のいずれかを使用することになるでしょう。 一方、<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> の場合は、<code>fill =</code> を使用することになるでしょう。 これは、geom と、グループ化を反映させたいプロットの美しさに依存しています。</p>
<p>参考までに、データをグループ化する最も基本的な方法は、<code>mapping = aes()</code> の<code>group =</code> 引数のみを使用することです。しかし、これだけでは、色、塗りつぶし、形は変わりません。また、凡例も作成されません。しかし、データはグループ化されているので、統計表示には影響があるかもしれません。</p>
<p>プロット内のグループの順序を調整するには、<a href="ggplot-tips.html#ggplot-tips">ggplot のヒント</a>の章または<a href="factors.html#factors">因子（ファクタ）型データ</a>の章を参照してください。グループ化されたプロットの例は、以下の連続データやカテゴリーデータのプロットのセクションにたくさんあります。</p>
</div>
</div>
<div id="ggplot_basics_facet" class="section level2" number="30.6">
<h2>
<span class="header-section-number">30.6</span> Facets / Small-multiples<a class="anchor" aria-label="anchor" href="#ggplot_basics_facet"><i class="fas fa-link"></i></a>
</h2>
<p>ファセット、もしくは、“small-multiples” とは、 1 つのプロットを複数のパネルに分割するためのもので、データグループごとに 1 つのパネル（「ファセット」）が用意されている。同じ種類のプロットが複数回作成され、それぞれが同じデータセットのサブグループを使用してものになります。</p>
<p>ファセット化は <strong>ggplot2</strong> パッケージに付属する機能で、ファセット化された「パネル」の凡例と軸は自動的に整列します。<a href="ggplot-tips.html#ggplot-tips">ggplot のヒント</a>の章で説明されている他のパッケージ（<strong>cowplot</strong> パッケージや <strong>patchwork</strong> パッケージ）もあり、まったく異なるプロットを 1 つの図にまとめるのにも使われます。</p>
<p>ファセット化は、以下の <strong>ggplot2</strong> パッケージの関数のいずれかで行います。</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> <u>一つの変数</u>の各レベルごとに異なるパネルを表示する。例の一つとしては、地域の病院ごとに異なる流行曲線（エピカーブ）を表示することができます。ファセットは、変数が他の順序が定義された因子でない限り、アルファベット順に並べられます。</li>
</ol>
<ul>
<li>ファセットのレイアウトを決定するために、特定のオプションを呼び出すことができます。例えば、<code>nrow = 1</code> または <code>ncol = 1</code> で、ファセット化されたプロットが配置される行または列の数を制御することができます。</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> これは、第二の変数をファセットの配置に加えたいときに使用します。ここでは、グリッドの各パネルは、<u>2 つの列</u>の値の間の交点を示しています。例えば、病院と年齢グループの組み合わせごとに、病院が上（列）に、年齢グループが横（行）に沿った疫学曲線を示します。</li>
</ol>
<ul>
<li>サブグループがグリッドで表示されるため、<code>nrow</code> および <code>ncol</code> は関係ありません。</li>
</ul>
<p>これらの関数はそれぞれ、ファセット化する列を指定するための数式シンタックスを受け付けます。両方とも、チルダ <code>~</code> の両側に 1 つずつ、最大 2 つの列を受け入れます。</p>
<ul>
<li><p><code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code>では、多くの場合、<code>facet_wrap(~hospital)</code> のようにチルダ <code>~</code> を先行させて 1 つの列だけを記述します。しかし、<code>facet_wrap(outcome ~ hospital)</code> のように 2 つの列を書くこともできます。それぞれのユニークな組み合わせは、別のパネルに表示されますが、グリッドには配置されません。見出しには結合された用語が表示され、これらは列と行の間の特定のロジックではありません。ファセット変数を 1 つだけ指定する場合は、ピリオド <code>.</code> が数式の反対側のプレースホルダーとして使用されます（コード例を参照）。</p></li>
<li><p><code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> では、数式に 1 つまたは 2 つの列を指定することもできます（グリッドの <code>row ~ columns</code> ）。1 つだけ指定したい場合は、<code>facet_grid(. ~ hospital)</code> や <code>facet_grid(hospital ~ .)</code> のように、チルダの反対側にピリオド <code>.</code> を置くことができます。</p></li>
</ul>
<p>ファセットはすぐに圧倒的な量の情報を含むことができるので、ファセットを選択する各変数のレベルが多すぎないようにするのが良いでしょう。ここでは、malaria データセット（<a href="data-used.html#data-used">ハンドブックとデータのダウンロード</a>を参照）を使った簡単な例を紹介します。malaria データセットは、施設におけるマラリアの毎日の症例数を年齢層別に集計したものです。</p>
<p>以下では、インポートして、簡単な修正を行います。</p>
<div class="sourceCode" id="cb1430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># これらのデータは、マラリアの症例を施設ごとに日ごとにカウントしたものです</span></span>
<span><span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># インポート</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">submitted_date</span>, <span class="op">-</span><span class="va">Province</span>, <span class="op">-</span><span class="va">newid</span><span class="op">)</span>                                 <span class="co"># 不要な列の削除</span></span></code></pre></div>
<p>malaria データの最初の 50 行を以下に示します。<code>malaria_tot</code> という列がありますが、年齢グループ別のカウントの列もあります（これらは 2 番目の <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> の例で使用されます）。</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-71cbd1f0498dc0b5c8a9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-71cbd1f0498dc0b5c8a9">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1596499200000\" data-max=\"1597190400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"81\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"56\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"96\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"233\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 2","Facility 3","Facility 4","Facility 5","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 7","Facility 8","Facility 9","Facility 10","Facility 11","Facility 12","Facility 13","Facility 14","Facility 15","Facility 16","Facility 17","Facility 18","Facility 19","Facility 19","Facility 20","Facility 21","Facility 19","Facility 22","Facility 23","Facility 23","Facility 24","Facility 25","Facility 26","Facility 27","Facility 28","Facility 29","Facility 30","Facility 30","Facility 31","Facility 31","Facility 32","Facility 33","Facility 33","Facility 7","Facility 30","Facility 30","Facility 30","Facility 30","Facility 34","Facility 35"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-09","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-09","2020-08-11","2020-08-11","2020-08-12","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-06","2020-08-04","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-07","2020-08-09","2020-08-10","2020-08-11","2020-08-11","2020-08-10"],["Spring","Bolo","Dingo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Bolo","Spring","Bolo","Spring","Dingo","Bolo","Dingo","Barnard","Barnard","Barnard","Bolo","Bolo","Bolo","Barnard","Bolo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Spring","Dingo","Bolo","Bolo","Dingo","Dingo","Spring","Barnard","Barnard","Spring","Bolo","Bolo","Bolo","Bolo","Dingo","Spring"],[11,11,8,16,9,3,4,15,11,19,12,7,27,0,17,36,0,5,6,9,4,7,12,4,14,28,5,11,8,8,21,7,3,7,9,19,28,9,11,7,26,0,4,8,5,25,21,9,4,81],[12,10,5,16,2,1,0,14,11,15,7,1,8,10,15,36,0,1,3,9,4,0,2,7,9,18,3,4,7,7,0,3,2,4,7,4,14,8,2,10,35,2,4,9,9,14,25,20,9,56],[23,5,5,17,6,4,3,13,13,15,13,20,18,24,28,62,0,10,2,16,1,6,18,41,14,5,24,13,16,16,41,13,5,11,33,23,54,10,11,16,30,8,2,11,29,31,38,26,17,96],[46,26,18,49,17,8,7,42,35,49,32,28,53,34,60,134,0,16,11,34,9,13,32,52,37,51,32,28,31,31,62,23,10,22,49,46,96,27,24,33,91,10,10,28,43,70,84,55,30,233]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>malaria_rdt_0-4<\/th>\n      <th>malaria_rdt_5-14<\/th>\n      <th>malaria_rdt_15<\/th>\n      <th>malaria_tot<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="facet_wrap" class="section level3 unnumbered">
<h3>
<code>facet_wrap()</code><a class="anchor" aria-label="anchor" href="#facet_wrap"><i class="fas fa-link"></i></a>
</h3>
<p>とりあえず、<code>malaria_tot</code> と <code>District</code> の列に注目してみましょう。年齢別カウントの列は今回は無視します。<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> を使って流行曲線（エピカーブ）をプロットします。これは、<code>malaria_tot</code> 列で指定された y 軸の高さに、各日の列を生成します（データはすでに日ごとのカウントなので、<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> を使います - <a href="ggplot-basics.html#ggplot_basics_bars">棒グラフ</a>を参照）。</p>
<p><code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> コマンドを追加する際には、チルダを指定し、次にファセットする列を指定します（ここでは <code>District</code> ）。チルダの左側に別の列を配置することもできますが、これは各組み合わせに対して 1 つのファセットを作成することになりますので、代わりに <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> で行うことをお勧めします。この使用例では、<code>District</code> のユニークな値ごとに 1 つのファセットが作成されます。</p>
<div class="sourceCode" id="cb1431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># District によってファセットされたプロット</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># カウントデータを列としてプロットします</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                              <span class="co"># 背景のパネルを簡素化します</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>                                         <span class="co"># プロットのラベルやタイトルなどを追加します</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date of report"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Malaria cases by district"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">District</span><span class="op">)</span>                       <span class="co"># ファセットが作られます</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1042-1.png" width="672"></div>
</div>
<div id="facet_grid" class="section level3 unnumbered">
<h3>
<code>facet_grid()</code><a class="anchor" aria-label="anchor" href="#facet_grid"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> を使って、2 つの変数をクロスさせることができます。例えば、<code>District</code> と age を交差させたいとしましょう。さて、これらのデータを ggplot が好む「縦に長い」フォーマットにするために、年齢の列にいくつかのデータ変換を行う必要があります。年齢グループはそれぞれ独自の列を持っていますが、ここでは <code>age_group</code> という 1 つの列と <code>num_cases</code> という別の列に分けます。このプロセスの詳細については、<a href="pivoting.html#pivoting">データの縦横変換</a>の章を参照してください。</p>
<div class="sourceCode" id="cb1432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">malaria_age</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">malaria_tot</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"malaria_rdt_"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># 縦長に転回する列を選びます</span></span>
<span>    names_to <span class="op">=</span> <span class="st">"age_group"</span>,      <span class="co"># 列名を age_group にします</span></span>
<span>    values_to <span class="op">=</span> <span class="st">"num_cases"</span>      <span class="co"># 値を 1 つの列（num_cases）にまとめます</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    age_group <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="st">"malaria_rdt_"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>    age_group <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="st">"5-14"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>これで、最初の 50 行のデータは次のようになります。</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8767f5a45dc8b8e5276b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8767f5a45dc8b8e5276b">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1596844800000\" data-max=\"1597104000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-14&quot;,&quot;15&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"62\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 1","Facility 1","Facility 2","Facility 2","Facility 2","Facility 3","Facility 3","Facility 3","Facility 4","Facility 4","Facility 4","Facility 5","Facility 5","Facility 5","Facility 6","Facility 6","Facility 6","Facility 6","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 7","Facility 7","Facility 7","Facility 8","Facility 8","Facility 8","Facility 9","Facility 9","Facility 9","Facility 10","Facility 10","Facility 10","Facility 11","Facility 11","Facility 11","Facility 12","Facility 12","Facility 12","Facility 13","Facility 13"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-09","2020-08-09","2020-08-09","2020-08-08","2020-08-08","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11"],["Spring","Spring","Spring","Bolo","Bolo","Bolo","Dingo","Dingo","Dingo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Dingo","Dingo","Dingo","Dingo","Dingo","Dingo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Spring","Spring","Spring","Bolo","Bolo","Bolo","Spring","Spring","Spring","Bolo","Bolo","Bolo","Spring","Spring","Spring","Dingo","Dingo","Dingo","Bolo","Bolo"],["0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14"],[11,12,23,11,10,5,8,5,5,16,16,17,9,2,6,3,1,4,4,0,3,15,14,13,11,11,13,19,15,15,12,7,13,7,1,20,27,8,18,0,10,24,17,15,28,36,36,62,0,0]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>age_group<\/th>\n      <th>num_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>2 つの変数を <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> に渡すとき、x が行、y が列である数式表記 (例: <code>x ~ y</code> ) を使用するのが最も簡単です。ここでは、<code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> を使って、 <code>age_group</code> と<code>District</code> の列の組み合わせごとにプロットを表示しています。</p>
<div class="sourceCode" id="cb1433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">malaria_age</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">num_cases</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkred"</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date of report"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Malaria cases by district and age group"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">District</span> <span class="op">~</span> <span class="va">age_group</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1045-1.png" width="672"></div>
</div>
<div id="自由または固定軸" class="section level3 unnumbered">
<h3>自由または固定軸<a class="anchor" aria-label="anchor" href="#%E8%87%AA%E7%94%B1%E3%81%BE%E3%81%9F%E3%81%AF%E5%9B%BA%E5%AE%9A%E8%BB%B8"><i class="fas fa-link"></i></a>
</h3>
<p>ファセット化の際に表示される軸のスケールは、デフォルトでは必ずしも常に適切ではありません。これは、相互比較には便利ですが、必ずしも適切ではありません。</p>
<p><code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> または <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> を使用する場合、<code>scales = "free_y"</code> を追加することで、各パネルで固定された y 軸のスケールを開放（自由に）して、そのデータサブセットを適切な範囲で表示させることができます。これは、サブカテゴリーの 1 つで実際のカウントが小さく、トレンドが見えにくい場合に特に有効です。また、“free_y” の代わりに “free_x” と書けば、x 軸（日付など）にも同じことができますし、両方の軸を同様に開放するために、引数の値として “free” と設定することもできます。<code>facet_grid</code> では、同じ行のファセットでは y スケールが同じになり、同じ列のファセットでは x スケールが同じになることに注意してください。</p>
<p><code>facet_grid</code> のみを使用する場合、<code>space = "free_y"</code> または <code>space = "free_x"</code> を追加することで、ファセットの実際の高さまたは幅が中の図の値に重み付けされます。これは、<code>scales = "free"</code>（y または x）がすでに適用されている場合にのみ機能します。</p>
<div class="sourceCode" id="cb1434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 自由な y 軸</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># カウントデータを列としてプロットします</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                              <span class="co"># 背景のパネルを簡素化します</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>                                         <span class="co"># プロットのラベルやタイトルなどを追加します</span></span>
<span>    x <span class="op">=</span> <span class="st">"Date of report"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Malaria cases by district - 'free' x and y axes"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">District</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span>        <span class="co"># ファセットが作られます</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1046-1.png" width="672"></div>
<!-- ```{r fig.show='hold', message=FALSE, warning=FALSE, out.width=c('50%', '50%')} -->
<!-- # A) Facet hospitalsation date by hospital, free y axis -->
<!-- ggplot(data = linelist %>% filter(hospital != "Missing"), # filter removes unknown hospital -->
<!--        aes(x = date_hospitalisation ))+ -->
<!--   geom_histogram(binwidth=7) + # Bindwidth = 7 days -->
<!--   labs(title = "A) Histogram with free y axis scales")+ -->
<!--   facet_grid(hospital~., # Facet with hospital as the row  -->
<!--              scales = "free_y") # Free the y scale of each facet -->
<!-- # B) Facet hospitalisation date by hospital, free y axis and vertical spacing -->
<!-- ggplot(data = linelist %>% filter(hospital != "Missing"), # filter removes unknown hospital -->
<!--        aes(x = date_hospitalisation ))+ -->
<!--   geom_histogram(binwidth=7) + # Bindwidth = 7 days -->
<!--   labs(title = "B) Histogram with free y axis scales and spacing")+ -->
<!--   facet_grid(hospital~., # Facet with hospital as the row  -->
<!--              scales = "free_y", # Free the y scale of each facet -->
<!--              space = "free_y") # Free the vertical spacing of each facet to optimise space -->
<!-- ``` -->
</div>
<div id="ファセット内の因子レベルの順序" class="section level3 unnumbered">
<h3>ファセット内の因子レベルの順序<a class="anchor" aria-label="anchor" href="#%E3%83%95%E3%82%A1%E3%82%BB%E3%83%83%E3%83%88%E5%86%85%E3%81%AE%E5%9B%A0%E5%AD%90%E3%83%AC%E3%83%99%E3%83%AB%E3%81%AE%E9%A0%86%E5%BA%8F"><i class="fas fa-link"></i></a>
</h3>
<p><u>ファセット内</u>の因子レベルの順序を変更する方法については、こちらの<a href="https://juliasilge.com/blog/reorder-within/">記事</a>を参照してください。</p>
</div>
</div>
<div id="プロットの保存-1" class="section level2" number="30.7">
<h2>
<span class="header-section-number">30.7</span> プロットの保存<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E4%BF%9D%E5%AD%98-1"><i class="fas fa-link"></i></a>
</h2>
<div id="プロットの保存-2" class="section level3 unnumbered">
<h3>プロットの保存<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E4%BF%9D%E5%AD%98-2"><i class="fas fa-link"></i></a>
</h3>
<p>デフォルトでは <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> コマンドを実行すると、プロットは RStudio の Plots ペインに表示されます。しかし、代入演算子 <code>&lt;-</code> を使い、名前を付けてプロットをオブジェクトとして保存することもできます。そうすれば、オブジェクト名自体が呼び出されて実行されない限り、表示されません。プロット名を <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> で囲んで表示することもできますが、これは、複数のプロットを一度に表示するための <u>for ループ</u>の中でプロットを作成する場合など、特定の状況でのみ必要となります（<a href="iteration.html#iteration">ループと反復処理・リストの操作</a>の章を参照）。</p>
<div class="sourceCode" id="cb1435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># プロットを定義します</span></span>
<span><span class="va">age_by_wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 表示する</span></span>
<span><span class="va">age_by_wt</span>    </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1047-1.png" width="672"></div>
</div>
<div id="保存されたプロットの修正" class="section level3 unnumbered">
<h3>保存されたプロットの修正<a class="anchor" aria-label="anchor" href="#%E4%BF%9D%E5%AD%98%E3%81%95%E3%82%8C%E3%81%9F%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E4%BF%AE%E6%AD%A3"><i class="fas fa-link"></i></a>
</h3>
<p><strong>ggplot2</strong> パッケージの良いところは、（上記のように）プロットを定義して、その名前から始まるレイヤーを追加できることです。元のプロットを作ったすべてのコマンドを繰り返す必要はありません。</p>
<p>例えば、上で定義したプロット <code>age_by_wt</code> を修正して、50 歳のところに縦線を入れるには、単に <code>+</code> と記載して、続けてプロットに新しいレイヤーを追加し始めることができます。</p>
<div class="sourceCode" id="cb1436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_by_wt</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1048-1.png" width="672"></div>
</div>
<div id="プロットのエクスポート" class="section level3 unnumbered">
<h3>プロットのエクスポート<a class="anchor" aria-label="anchor" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88"><i class="fas fa-link"></i></a>
</h3>
<p>ggplot のエクスポートは、<strong>ggplot2</strong> パッケージの <code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave()</a></code> で簡単にできます。この関数は 2 つの方法で動作させることができます。</p>
<ul>
<li>
<p>プロットオブジェクトの名前を指定した後、ファイルのパスと拡張子付きの名前を指定します。</p>
<ul>
<li>例： <code>ggsave(my_plot, here("plots", "my_plot.png"))</code>
</li>
</ul>
</li>
<li>
<p>ファイルパスのみを指定してコマンドを実行すると、最後に出力されたプロットが保存されます。</p>
<ul>
<li>例： <code>ggsave(here("plots", "my_plot.png"))</code>
</li>
</ul>
</li>
</ul>
<p>ファイルパスに拡張子を指定することで、png、pdf、jpeg、tiff、bmp、svgなどのファイル形式でエクスポートすることができます。</p>
<p>また、引数として、<code>width =</code>、<code>height =</code>、<code>units =</code>（“in”、“cm”、“mm” のいずれか）を指定することができます。また、プロットの解像度を表す数字（例：300）で <code>dpi ＝</code> を指定することもできます。関数の詳細については、<code><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">?ggsave</a></code> を入力するか、<a href="https://ggplot2.tidyverse.org/reference/ggsave.html">オンラインのドキュメント</a>を参照してください。</p>
<p>また、<code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> 構文を使って、必要なファイルパスを指定することもできます。詳しくは、データのインポート・エクスポート](#importing)の章をご覧ください。</p>
</div>
</div>
<div id="ラベル" class="section level2" number="30.8">
<h2>
<span class="header-section-number">30.8</span> ラベル<a class="anchor" aria-label="anchor" href="#%E3%83%A9%E3%83%99%E3%83%AB"><i class="fas fa-link"></i></a>
</h2>
<p>グラフを作成していると、必ずプロットのラベルを追加したり調整したくなるでしょう。これらは、<code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> の中で行うことが、最も簡単な方法です。<code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> は、geom と同じように <code>+</code> でプロットに追加されます。</p>
<p><code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> では、これらの引数に文字列を指定することができます。</p>
<ul>
<li>
<code>x =</code> と <code>y =</code> x 軸と y 軸のタイトル（ラベル）<br>
</li>
<li>
<code>title =</code> プロットのメインタイトル<br>
</li>
<li>
<code>subtitle =</code> プロットのサブタイトル、タイトルの下に小さいテキストで表示<br>
</li>
<li>
<code>caption =</code> プロットのキャプション、デフォルトでは右下に表示される</li>
</ul>
<p>以下は、以前に作成したプロットですが、ラベルがより良いものになっています。</p>
<div class="sourceCode" id="cb1437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_by_wt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># データを設定</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>     <span class="co"># map aesthetics to column values</span></span>
<span>         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># x 軸に age をマッピング</span></span>
<span>         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># y 軸に weight をマッピング</span></span>
<span>         color <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     <span class="co"># 色に age をマッピング</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>           <span class="co"># データを点として表示</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Age and weight distribution"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Fictional Ebola outbreak, 2014"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age in years"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Weight in kilos"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Age"</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Data as of {max(linelist$date_hospitalisation, na.rm=T)}"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">age_by_wt</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1049-1.png" width="672"></div>
<p>キャプションの割り当てでは、<strong>stringr</strong> パッケージの <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> を使って、文字列テキストの中にダイナミックな R コードを埋め込んだことに注目してください。キャプションには、“Data as of:” キャプションには、linelist の最大入院日を反映した “Data as of:”の日付が表示されます。詳しくは、<a href="characters-strings.html#characters-strings">文字型・文字列型データ</a>の章をご覧ください。</p>
<p><u>凡例</u>のタイトルを指定する際の注意点：凡例には複数の尺度を設定できるため、「凡例タイトル」の引数は 1 つではありません。<code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> の中で、凡例の作成に使われるプロットの視覚的特性の引数を書き、この方法でタイトルを指定することができます。たとえば、上記では、<code>color = age</code> を割り当てて凡例を作成しました。したがって、<code>color =</code> を <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> に指定し、希望する凡例のタイトル（大文字の A の “Age” ）を割り当てます。<code>aes(fill = COLUMN)</code> で凡例を作成した場合は、<code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> で <code>fill =</code> と書き、その凡例のタイトルを調整します。<a href="ggplot-tips.html#ggplot-tips">ggplot のヒント</a>の章のカラースケールのセクションでは、凡例の編集についての詳細と、<code>scales_()</code> を使った別の方法が紹介されています。</p>
</div>
<div id="ggplot_basics_themes" class="section level2" number="30.9">
<h2>
<span class="header-section-number">30.9</span> テーマ<a class="anchor" aria-label="anchor" href="#ggplot_basics_themes"><i class="fas fa-link"></i></a>
</h2>
<p><strong>ggplot2</strong> パッケージの優れた点の 1 つは、プロットを自由にコントロールできることです-何でも定義できます！前述したように、データの形や幾何学的形状に関係のないプロットのデザインは、<code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> 内で調整されます。例えば、プロットの背景色、グリッドラインの有無、テキスト（タイトル、サブタイトル、キャプション、軸テキスト…）のフォント／サイズ／色／配置などです。これらの調整は、次の 2 つの方法で行うことができます。</p>
<ul>
<li>全体的な調整を行うための<a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">完全なテーマ</a> <code>theme_()</code> の追加 - <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic()</a></code> 、<code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal()</a></code> 、<code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_dark()</a></code> 、<code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light()</a></code> 、<code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_grey()</a></code> 、<code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw()</a></code> などがあります。<br>
</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> 内でプロットの個別の要素を調整する</li>
</ul>
<div id="完全なテーマ" class="section level3 unnumbered">
<h3>完全なテーマ<a class="anchor" aria-label="anchor" href="#%E5%AE%8C%E5%85%A8%E3%81%AA%E3%83%86%E3%83%BC%E3%83%9E"><i class="fas fa-link"></i></a>
</h3>
<p>完全なテーマ関数の使い方は複雑ではなく非常に簡単なので、ここではその機能を紹介し、詳細な説明を省略します。なお、<code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> による微調整は、完全なテーマを使用した<u>後</u>に行う必要があります。</p>
<p>完全なテーマの終わりに、空の括弧をつけて書いてください。</p>
<div class="sourceCode" id="cb1438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme classic"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme bw"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme minimal"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme gray"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1050-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1050-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1050-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1050-4.png" width="50%"></p>
</div>
<div id="modify-theme" class="section level3 unnumbered">
<h3>Modify theme<a class="anchor" aria-label="anchor" href="#modify-theme"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> は多数の引数を設定することができ、それぞれの設定がプロットの特定の要素を編集します。すべての引数を網羅することはできませんが、一般的なパターンを説明し、必要な引数名を見つける方法を示します。基本的な構文は以下の通りです。</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> 内で、編集したいプロット要素の引数名を <code>plot.title =</code> のように書きます。</li>
<li>その引数に <code>element_()</code> を与えます。</li>
<li>よく使うのは <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code> ですが、キャンバスの背景色を指定する <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect()</a></code> や、プロット要素を削除する <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> などもあります。</li>
</ol>
<!-- --><ol start="4" style="list-style-type: decimal">
<li>
<code>element_()</code> の中で、引数の設定を書いてあなたの望む微調整を行ってください。</li>
</ol>
<p>さて、ここまでの説明はかなり抽象的でしたので、いくつか例を挙げてみましょう。</p>
<p>下のプロットはとてもくだらなく感じるかもしれませんが、プロットを調整するための様々な方法を示すことができます。</p>
<ul>
<li>まず上で定義した <code>age_by_wt</code> というプロットに <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic()</a></code> を追加します。<br>
</li>
<li>より細かい調整のために、<code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> を追加し、調整する各プロット要素に 1 つの引数を加えます。</li>
</ul>
<p>引数を logical sections で整理すると良いでしょう。以下に使用されている引数のいくつかを説明します。</p>
<ul>
<li>
<code>legend.position =</code> は、“bottom” 、“top” 、“left” 、“right” といった単純な値を受け付ける点で独特です。しかし、一般的にテキスト関連の引数は、 <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code> <u>内に</u>詳細を記述する必要があります。<br>
</li>
<li>
<code>element_text(size = 30)</code> でタイトルの大きさを設定します。<br>
</li>
<li>
<code>element_text(hjust = 0)</code> でキャプションの水平方向の配置（右から左へ）を設定します。<br>
</li>
<li>サブタイトルのイタリック化を <code>element_text(face = "italic")</code> で設定します。</li>
</ul>
<div class="sourceCode" id="cb1439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_by_wt</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                 <span class="co"># 事前に設定されたテーマの調整</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># 凡例を下に移動</span></span>
<span>    </span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,          <span class="co"># タイトルのサイズを30に</span></span>
<span>    plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,        <span class="co"># 左揃えのキャプション</span></span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>, <span class="co"># サブタイトルを斜体に</span></span>
<span>    </span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">15</span>, angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>, <span class="co"># x 軸テキストのみの調整</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,         <span class="co"># y 軸テキストのみの調整</span></span>
<span>    </span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>           <span class="co"># 両方の軸の調整</span></span>
<span>    <span class="op">)</span>     </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1051-1.png" width="672"></div>
<p>ここでは、特によく使われる <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> の引数を紹介します。例えば、<code>.x</code> や <code>.y</code> を付加して 1 つの軸だけに変更を適用するなど、いくつかのパターンに気づくでしょう。</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="32%">
<col width="67%">
</colgroup>
<thead><tr class="header">
<th>
<code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> の引数</th>
<th>調整する内容</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>plot.title = element_text()</code></td>
<td>タイトル</td>
</tr>
<tr class="even">
<td><code>plot.subtitle = element_text()</code></td>
<td>サブタイトル</td>
</tr>
<tr class="odd">
<td><code>plot.caption = element_text()</code></td>
<td>キャプション（ファミリー、フェイス、カラー、サイズ、アンル、vjust、hjust…）</td>
</tr>
<tr class="even">
<td><code>axis.title = element_text()</code></td>
<td>軸タイトル（ x と y の両方）（サイズ、面、角度、色…）</td>
</tr>
<tr class="odd">
<td><code>axis.title.x = element_text()</code></td>
<td>軸タイトル x 軸のみ（ y 軸のみの場合は <code>.y</code> を使用）</td>
</tr>
<tr class="even">
<td><code>axis.text = element_text()</code></td>
<td>軸のテキスト（xとyの両方）</td>
</tr>
<tr class="odd">
<td><code>axis.text.x = element_text()</code></td>
<td>軸テキスト x 軸のみ ( y 軸のみの場合は <code>.y</code> を使用）</td>
</tr>
<tr class="even">
<td><code>axis.ticks = element_blank()</code></td>
<td>軸の目盛りの削除</td>
</tr>
<tr class="odd">
<td><code>axis.line = element_line()</code></td>
<td>軸線（色、サイズ、線の種類：実線、破線、点線など）</td>
</tr>
<tr class="even">
<td><code>strip.text = element_text()</code></td>
<td>ファセットストリップテキスト（色、面、サイズ、角度など）</td>
</tr>
<tr class="odd">
<td><code>strip.background = element_rect()</code></td>
<td>ファセットストリップ（フィル、カラー、サイズなど）</td>
</tr>
</tbody>
</table></div>
<p>しかし、テーマの引数は非常に多いです。これら全てをどうやって覚えればよいのでしょうか？心配しないでください。すべてを覚えるのは不可能です。幸いなことに、あなたを助けるためのツールがいくつかあります。</p>
<p>引数に関する完全なリストは、<a href="https://ggplot2.tidyverse.org/reference/theme.html">テーマの修正</a>に関する <strong>tidyverse</strong> パッケージの文書にあります。</p>
&lt;style=“color: darkgreen;”&gt;<u><strong>ヒント</strong></u>：<strong>ggplot2</strong> パッケージから <code><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_get()</a></code> を実行すると、90 以上の <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> 引数のリストがコンソールに表示されます。

&lt;style=“color: darkgreen;”&gt;<u><strong>TIP：</strong></u> もしプロットの要素を削除したくなったら、<code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> を通して行うこともできます。<code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank()</a></code> を引数に渡せば、その要素は完全に消えてしまいます。凡例については、<code>legend.position = "none"</code> と設定します。

</div>
</div>
<div id="色" class="section level2" number="30.10">
<h2>
<span class="header-section-number">30.10</span> 色<a class="anchor" aria-label="anchor" href="#%E8%89%B2"><i class="fas fa-link"></i></a>
</h2>
<p><a href="ggplot-tips.html#ggplot_tips_colors">ggplot tipsの章のカラースケール</a>の項をご覧ください。</p>
</div>
<div id="ggplot2へのパイピング" class="section level2" number="30.11">
<h2>
<span class="header-section-number">30.11</span> ggplot2へのパイピング<a class="anchor" aria-label="anchor" href="#ggplot2%E3%81%B8%E3%81%AE%E3%83%91%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0"><i class="fas fa-link"></i></a>
</h2>
<p>パイプを使ってデータをクリーニング・変換すると、変換したデータを <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> に簡単に渡すことができます。</p>
<p>関数から関数へデータセットを渡すパイプは、<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> が呼ばれると <code>+</code> に移行します。なお、この場合、パイプでつながれたデータセットとして自動的に定義されるので、<code>data =</code> 引数を指定する必要はありません。</p>
<p>これは、次のようになります。</p>
<div class="sourceCode" id="cb1440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                                                     <span class="co"># linelist から始めます</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     <span class="co"># 列を選択します</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>                                                  <span class="co"># 縦長のデータに転回します</span></span>
<span>    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                                  </span>
<span>    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>                                                        <span class="co"># 欠測値を置換します</span></span>
<span>    symptom_is_present <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>                                                        <span class="co"># ggplotの開始！</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">symptom_name</span>, fill <span class="op">=</span> <span class="va">symptom_is_present</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>                    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Symptom"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Symptom status (proportion)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1052-1.png" width="672"></div>
</div>
<div id="連続データのプロット" class="section level2" number="30.12">
<h2>
<span class="header-section-number">30.12</span> 連続データのプロット<a class="anchor" aria-label="anchor" href="#%E9%80%A3%E7%B6%9A%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"><i class="fas fa-link"></i></a>
</h2>
<p>この章では、連続データをプロットする多くの例を見てきました。ここでは、これらを簡単に整理し、いくつかのバリエーションを紹介します。 ここで扱う可視化は以下の通りです。</p>
<ul>
<li>
<p>1 つの連続変数のプロット：</p>
<ul>
<li>
<strong>ヒストグラム</strong>、連続変数の分布を示す典型的なグラフ。</li>
<li>
<strong>箱ひげ図</strong>（Box and Whiskerとも呼ばれる）、25、50、75 パーセントタイル、分布の最後尾、外れ値（<a href="https://www.data-to-viz.com/caveat/boxplot.html">重要な制限</a>）を示します。</li>
<li>
<strong>ジッタープロット</strong>、すべての値を ‘ジッター’ された点として表示し、2 つの値が同じであっても、（ほとんど）すべてを見ることができます。</li>
<li>
<strong>バイオリンプロット</strong>、連続変数の分布を、‘バイオリン’ の対称的な幅に基づいて表示します。</li>
<li>
<strong>Sinaプロット</strong>、ジッタープロットとバイオリンプロットを組み合わせたもので、個々の点が分布の対称的な形で表示されます（ <strong>ggforce</strong> パッケージを使用）。</li>
</ul>
</li>
<li><p>2 つの連続変数の<strong>散布図</strong></p></li>
<li><p>3 つの連続変数の<strong>ヒートマップ</strong>（ <a href="heatmaps.html#heatmaps">ヒートマップ</a> の章へのリンク）</p></li>
</ul>
<div id="ヒストグラム" class="section level3 unnumbered">
<h3>ヒストグラム<a class="anchor" aria-label="anchor" href="#%E3%83%92%E3%82%B9%E3%83%88%E3%82%B0%E3%83%A9%E3%83%A0"><i class="fas fa-link"></i></a>
</h3>
<p>ヒストグラムは棒グラフに似ていますが、<u>連続変数</u>の分布を測定するという点で異なります。「棒」の間にはスペースがなく、<code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> には 1 つの列しか与えられません。</p>
<p>以下は、<strong>ヒストグラム</strong>を生成するためのコードです。ヒストグラムは、連続データを範囲に分け、高さの異なる隣り合った棒で表示します。これは <code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> を使って行われます。<code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> 、<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 、<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> の違いについては、ggplot の基本の章の <a href="ggplot-basics.html#ggplot_basics_bars">「棒グラフ」の項</a>を参照してください。</p>
<p>ここでは、症例の年齢分布を表示します。<code>mapping = aes()</code> で、分布を見たい列を指定します。この列は、x 軸にも y 軸にも割り当てることができます。</p>
<p>行は、数値化された年齢に基づいて「階級」に割り当てられ、これらの階級は棒でグラフ化されます。<code>bins =</code> で階級の数を指定すると、ヒストグラムの最小値と最大値の間に等間隔でブレークポイントが置かれます。<code>bins =</code> が指定されていない場合は、適切な階級の数が推測され、プロットの後にこのメッセージが表示されます。</p>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><code>bins =</code> に階級の数を指定したくない場合は、代わりに軸の単位で <code>binwidth =</code> を指定することができます。ここでは、さまざまな階級と階級幅を示す例をいくつか紹介します。</p>
<div class="sourceCode" id="cb1442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A) 一般的なヒストグラム</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># x 変数を与えます</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Default histogram (30 bins)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># B) より多い階級</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># x 変数を与えます</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Set to 50 bins"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># C) より少ない階級</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># x 変数を与えます</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"C) Set to 5 bins"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># D) より多い階級</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># x 変数を与えます</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"D) binwidth of 1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1053-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1053-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1053-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1053-4.png" width="50%"></p>
<p>滑らかに描画した各階級の割合を見るには、<code><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density()</a></code> を使用します。</p>
<div class="sourceCode" id="cb1443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 平滑化した割合の軸</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional density"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 積み上げ・平滑化した割合の軸</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"'Stacked' proportional densities"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1054-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1054-2.png" width="50%"></p>
<p>（連続した列のデータの）「積み上げられた」ヒストグラムを得るには、以下のいずれかの方法があります。</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> の <code>fill =</code> 引数を <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> 内で使用し、グループ化された列に割り当てます。</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly()</a></code> を使用します。こちらの方が読みやすいでしょう（<code>binwidth =</code> を設定できます）。<br>
</li>
<li>すべての値の比率を見るには、<code>y = after_stat(density)</code> を設定します（この構文を正確に使用してください-あなたのデータに応じて変更しないでください）。注意：これらの比率はグループ<u>ごとに</u>表示されます。</li>
</ol>
<p>それぞれを以下に示します（*それぞれで <code>color =</code> vs <code>fill =</code> を使用していることに注意）。</p>
<div class="sourceCode" id="cb1444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#「積み上げられた」ヒストグラム</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"'Stacked' histogram"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 頻度</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Freqpoly"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 割合の軸</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_freqpoly</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional freqpoly"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 平滑化した割合の軸</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional, smoothed with geom_density()"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1055-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-4.png" width="50%"></p>
<p>少し楽しみたい方は、<strong>ggridges</strong> パッケージの <code>geom_density_ridges</code> を試してみてください（<a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html">ビニエット（vignette）はこちら</a>）。</p>
<p>ヒストグラムについての詳細は、<code>tidyverse</code> の <a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram() のページ</a>を参照してください。</p>
</div>
<div id="箱ひげ図" class="section level3 unnumbered">
<h3>箱ひげ図<a class="anchor" aria-label="anchor" href="#%E7%AE%B1%E3%81%B2%E3%81%92%E5%9B%B3"><i class="fas fa-link"></i></a>
</h3>
<p>箱ひげ図は一般的ですが、重要な制限があります。例えば、両峰性の分布など、実際の分布が不明瞭になることがあります。詳しくは、<a href="https://www.r-graph-gallery.com/boxplot.html">R graph gallery</a> や <a href="https://www.data-to-viz.com/caveat/boxplot.html">data-to-viz article</a> の記事を参照してください。しかし、四分位範囲と外れ値はきれいに表示されるので、分布をより詳細に表示する他の種類のグラフの上に重ねて表示することができます。</p>
<p>以下に、箱ひげ図の構成要素を示します。</p>
<div class="inline-figure"><img src="images/boxplot.png" width="100%" style="display: block; margin: auto;"></div>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot()</a></code> を使って箱ひげ図を作成する場合、通常は <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> 内で 1 つの軸（x または y）のみをマッピングします。指定された軸は、プロットが水平か垂直かを決定します。</p>
<p>ほとんどの geom では、<code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> 内で <code>color =</code> や <code>fill =</code> などに列を視覚的特性をとして割り当てることで、グループごとにプロットを作成します。しかし、箱ひげ図の場合は、グループ化された列を割り当てられていない軸（ x または y ）に割り当てることで実現します。下のコードは、データセット内の<u>すべての</u>年齢値を箱ひげ図にしたもので、次のコードは、データセット内の（欠損していない）性別ごとに 1 つの箱ひげ図を表示するものです。<code>NA</code>（欠損）の値は、削除しない限り、別の箱ひげ図として表示されることに注意してください。この例では、各プロットが異なる色になるように、<code>outcome</code> の列を <code>fill</code> に設定していますが、これは必須ではありません。</p>
<div class="sourceCode" id="cb1445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A) 箱ひげ図</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># y 軸だけマッピング ( x はなし)</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Overall boxplot"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># B) グループごとの箱ひげ図</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>, x <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                     </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># 凡例を除く</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Boxplot by gender"</span><span class="op">)</span>      </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1057-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1057-2.png" width="50%"></p>
<p>散布図の端に箱ひげ図を追加するコード（“marginal” プロット）については、<a href="ggplot-tips.html#ggplot-tips">ggplot のヒント</a>の章をご覧ください。</p>
</div>
<div id="バイオリンプロットジッタープロットsinaプロット" class="section level3 unnumbered">
<h3>バイオリンプロット、ジッタープロット、sinaプロット<a class="anchor" aria-label="anchor" href="#%E3%83%90%E3%82%A4%E3%82%AA%E3%83%AA%E3%83%B3%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%82%B8%E3%83%83%E3%82%BF%E3%83%BC%E3%83%97%E3%83%AD%E3%83%83%E3%83%88sina%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"><i class="fas fa-link"></i></a>
</h3>
<p>以下は、分布を示す<strong>バイオリンプロット</strong>（<code>geom_violin</code>）と<strong>ジッタープロット</strong>（<code>geom_jitter</code>）を作成するコードです。<code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> 内にこれらのオプションを挿入することで、塗りつぶしや色もデータによって決定されるように指定できます。</p>
<div class="sourceCode" id="cb1446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A) グループごとのジッタープロット</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>,      <span class="co"># 欠損値を除く</span></span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,                     <span class="co"># 連続値</span></span>
<span>           x <span class="op">=</span> <span class="va">outcome</span>,                           <span class="co"># グループ化する変数</span></span>
<span>           color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># 色の変数</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                  <span class="co"># ジッタープロットを作成</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) jitter plot by gender"</span><span class="op">)</span>     </span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># B) グループごとのバイオリンプロット</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>,       <span class="co"># 欠損値を除く</span></span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,                      <span class="co"># 連続値</span></span>
<span>           x <span class="op">=</span> <span class="va">outcome</span>,                            <span class="co"># グループ化する変数</span></span>
<span>           fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># 塗りつぶしの変数</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                   <span class="co"># バイオリンプロットを作成</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) violin plot by gender"</span><span class="op">)</span>    </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1058-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1058-2.png" width="50%"></p>
<p><strong>ggforce</strong> パッケージの <code>geom_sina()</code> を使って、この 2 つを組み合わせることができます。sinaは、ジッターポイントをバイオリンプロットの形でプロットします。バイオリンプロットに重ねて表示すると（透明度を調整して）、視覚的に解釈しやすくなります。</p>
<div class="sourceCode" id="cb1447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A) グループごとの sina プロット</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,           <span class="co"># 数値の変数</span></span>
<span>      x <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>    <span class="co"># グループ化する変数</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>, <span class="co"># バイオリンの背景の色</span></span>
<span>    color <span class="op">=</span> <span class="st">"white"</span>,     <span class="co"># 白の輪郭</span></span>
<span>    alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>        <span class="co"># 透過度</span></span>
<span>  <span class="fu">geom_sina</span><span class="op">(</span></span>
<span>    size<span class="op">=</span><span class="fl">1</span>,                <span class="co"># ジッターのサイズの変更</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># 点の色</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>       <span class="co"># death/recoverごとにバイオリンの背景の色</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span> <span class="op">=</span> <span class="st">"#bf5300"</span>, </span>
<span>              <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#11118c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>      <span class="co"># death/recoverごとに点の色</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span> <span class="op">=</span> <span class="st">"#bf5300"</span>, </span>
<span>              <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#11118c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                                <span class="co"># グレイの背景の削除</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>                <span class="co"># 不要な凡例の削除</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) violin and sina plot by gender, with extra formatting"</span><span class="op">)</span>      </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1059-1.png" width="672"></div>
</div>
<div id="つの連続変数" class="section level3 unnumbered">
<h3>2 つの連続変数<a class="anchor" aria-label="anchor" href="#%E3%81%A4%E3%81%AE%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0"><i class="fas fa-link"></i></a>
</h3>
<p>同様の構文で <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> を使用すると、2 つの連続変数を互いに<strong>散布図</strong>にプロットすることができます。これは、分布ではなく実際の値を示すのに便利です。年齢と体重の基本的な散布図を (A) に示します。(B) では、<code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code> を使って、linelist の 2 つの連続変数の関係を示しています。</p>
<div class="sourceCode" id="cb1448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># weight と age の基本的な散布図 </span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, </span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Scatter plot of weight and age"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 性別とエボラのアウトカムごとの weight と age の基本的な散布図</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">outcome</span><span class="op">)</span>, <span class="co"># gender/outcome について欠損値がないものを保持</span></span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Scatter plot of weight and age faceted by gender and outcome"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">~</span> <span class="va">outcome</span><span class="op">)</span> </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1060-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1060-2.png" width="50%"></p>
</div>
<div id="つの連続変数-1" class="section level3 unnumbered">
<h3>3 つの連続変数<a class="anchor" aria-label="anchor" href="#%E3%81%A4%E3%81%AE%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0-1"><i class="fas fa-link"></i></a>
</h3>
<p>3 つの連続変数を表示するには、<code>fill =</code> 引数を利用して<u>ヒートプロット</u>を作成します。各「セル」の色は、3 つ目の連続データの列の値を反映します。詳しくは<a href="ggplot-tips.html#ggplot-tips">ggplot のヒント</a>の章と、<a href="heatmaps.html#heatmaps">ヒートマップ</a>の章に例があります。</p>
<p>R で 3D プロットを作成する方法はありますが、実践的な疫学では解釈が難しいことが多く、意思決定にはあまり役に立ちません。</p>
</div>
</div>
<div id="カテゴリカルなデータのプロット" class="section level2" number="30.13">
<h2>
<span class="header-section-number">30.13</span> カテゴリカルなデータのプロット<a class="anchor" aria-label="anchor" href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%82%AB%E3%83%AB%E3%81%AA%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"><i class="fas fa-link"></i></a>
</h2>
<p>カテゴリカルなデータには、文字値、ロジカル値（TRUE ／ FALSE）、因子（<a href="factors.html#factors">因子（ファクタ）型データ</a>の章を参照）などがあります。</p>
<div id="準備-21" class="section level3 unnumbered">
<h3>準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-21"><i class="fas fa-link"></i></a>
</h3>
<div id="データの構造" class="section level4 unnumbered">
<h4>データの構造<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%A7%8B%E9%80%A0"><i class="fas fa-link"></i></a>
</h4>
<p>カテゴリカルなデータについて最初に理解すべきことは、それが linelist の症例のような生の観測値として存在しているのか、それとも数や割合を保持するようやくまたは集約したデータフレームとして存在しているのかということです。データの状態によって、使用するプロット関数が変わります。</p>
<ul>
<li>データが生の観測値で、観測ごとに 1 行の場合は、 <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> を使用するでしょう。</li>
<li>データがすでにカウントや割合に集約されている場合は、<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> を使用するでしょう。</li>
</ul>
</div>
<div id="列のデータ型と値の順序" class="section level4 unnumbered">
<h4>列のデータ型と値の順序<a class="anchor" aria-label="anchor" href="#%E5%88%97%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E5%9E%8B%E3%81%A8%E5%80%A4%E3%81%AE%E9%A0%86%E5%BA%8F"><i class="fas fa-link"></i></a>
</h4>
<p>次に、プロットしたい列のデータ型を調べます。ここでは、まず <strong>base R</strong> の <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> を使って <code>hospital</code> を、そして <strong>janitor</strong> パッケージの <code>tabyl()</code> を使って調べます。</p>
<div class="sourceCode" id="cb1449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># hospital 列のデータ型を確認する - それは文字列である</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<div class="sourceCode" id="cb1451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 病院の列の中の値と割合を見る</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span></span></code></pre></div>
<pre><code>##                              hospital    n    percent
##                      Central Hospital  454 0.07710598
##                     Military Hospital  896 0.15217391
##                               Missing 1469 0.24949049
##                                 Other  885 0.15030571
##                         Port Hospital 1762 0.29925272
##  St. Mark's Maternity Hospital (SMMH)  422 0.07167120</code></pre>
<p>デフォルトの設定では、アルファベット順に並んだ病院名が文字として表示されていることが確認できます。‘other’ と ‘missing’ の値がありますが、これらは、内訳を表示する際に最後に表示するサブカテゴリにする方が好ましいです。そこで、この列を因子型に変更し、並び替えを行います。この内容については、<a href="factors.html#factors">因子（ファクタ）型データ</a>の章で詳しく説明しています。</p>
<div class="sourceCode" id="cb1453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 因子に変換し、順序を定義することで、"Other" と "Missing" が最後になります</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    hospital <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">hospital</span>, </span>
<span>      <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,</span>
<span>      <span class="st">"Port Hospital"</span>, </span>
<span>      <span class="st">"Central Hospital"</span>,</span>
<span>      <span class="st">"Military Hospital"</span>,</span>
<span>      <span class="st">"Other"</span>,</span>
<span>      <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb1454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "St. Mark's Maternity Hospital (SMMH)"
## [2] "Port Hospital"                       
## [3] "Central Hospital"                    
## [4] "Military Hospital"                   
## [5] "Other"                               
## [6] "Missing"</code></pre>
</div>
</div>
<div id="ggplot_basics_bars" class="section level3 unnumbered">
<h3>
<code>geom_bar()</code><a class="anchor" aria-label="anchor" href="#ggplot_basics_bars"><i class="fas fa-link"></i></a>
</h3>
<p>棒の高さ（または積み重ねられた棒の高さ）に<u>データの関連する行の数</u>を反映させたい場合は、<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> を使用します。これらの棒は、 <code>width =</code> が調整されない限り、棒の間に隙間ができます。</p>
<ul>
<li><p>軸列の割り当ては 1 つだけにしてください（通常は x 軸）。x と y を指定すると、<code>Error: stat_count() can only have an x or y aesthetic.</code> が表示されます。</p></li>
<li><p><code>mapping = aes()</code> 内で <code>fill =</code> の割り当てを追加することで、積み上げ棒グラフを作成できます。</p></li>
<li><p>反対側の軸は、行数を表すため、デフォルトでは “count” というタイトルになります。</p></li>
</ul>
<p>下の例では、y 軸に outcome を割り当てていますが、x 軸にしても問題ありません。文字の値が長い場合は、棒を横にして凡例を下に配置した方が見栄えが良い場合があります。この場合、<code><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev()</a></code> で反転させ、missing と other を一番下にしています。</p>
<div class="sourceCode" id="cb1456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A) 全症例のアウトカム</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Number of cases by hospital"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># B) 病院ごとの全症例のアウトカム</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Number of recovered and dead Ebola cases, by hospital"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1064-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1064-2.png" width="50%"></p>
</div>
<div id="geom_col" class="section level3 unnumbered">
<h3>
<code>geom_col()</code><a class="anchor" aria-label="anchor" href="#geom_col"><i class="fas fa-link"></i></a>
</h3>
<p>棒グラフの高さ（または積み重ねられた棒グラフの高さ）に、データに含まれる事前に計算された値を反映させたい場合は、<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> を使用します。多くの場合、これらは要約や「集約」された数や割合です。</p>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> に<u>両軸</u>の列を割り当てます。一般的に、x 軸の列は離散的で、y 軸の列は数値です。</p>
<p>例えば、次のようなデータセットの <code>outcome</code> があるとします：</p>
<pre><code>## # A tibble: 2 × 3
##   outcome     n proportion
##   &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
## 1 Death    1022       56.2
## 2 Recover   796       43.8</code></pre>
<p>以下は、エボラ出血熱患者の転帰の分布を示す簡単な棒グラフを作成するための <code>geom_col</code> を使用したコードです。geom_col では、x と y の両方を指定する必要があります。ここで、x は x 軸に沿ったカテゴリー変数、y は生成された <code>proportion</code> の列の割合です。</p>
<div class="sourceCode" id="cb1458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 全ての症例のアウトカム</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">outcomes</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">outcome</span>, y <span class="op">=</span> <span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Number of recovered and dead Ebola cases"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1066-1.png" width="432"></div>
<p>病院別の内訳を表示するには、より多くの情報を含み、「縦に長い」形式の表が必要です。この表は、<code>outcome</code> と <code>hospital</code> を組み合わせたカテゴリーの頻度で作成します（グループ化のtipsについては、<a href="grouping.html#grouping">データのグループ化</a>の章を参照）。</p>
<div class="sourceCode" id="cb1459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcomes2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># 病院別、アウトカム別の数を取得</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>        <span class="co"># 割合は病院全体に対するものなのでグループ化する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="co"># 病院全体の割合を計算する</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">outcomes2</span><span class="op">)</span> <span class="co"># データのプレビュー</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
## # Groups:   hospital [3]
##   hospital                             outcome     n proportion
##   &lt;fct&gt;                                &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
## 1 St. Mark's Maternity Hospital (SMMH) Death     199       61.2
## 2 St. Mark's Maternity Hospital (SMMH) Recover   126       38.8
## 3 Port Hospital                        Death     785       57.6
## 4 Port Hospital                        Recover   579       42.4
## 5 Central Hospital                     Death     193       53.9
## 6 Central Hospital                     Recover   165       46.1</code></pre>
<p>そして、フォーマットを追加した ggplot を作成します。</p>
<ul>
<li>
<strong>軸の反転</strong>：<code><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip()</a></code> で軸を反転させて、病院名を読めるようにしました。</li>
<li>
<strong>列を横に並べる</strong>：<code>position = "dodge"</code> という引数を追加し、死亡と回復の棒を重ねるのではなく、並べて表示するようにしました。積み重ねられた棒はデフォルトです。</li>
<li>
<strong>列の幅</strong>：‘width’ を指定して、可能な限りの幅の半分の幅で列を表示します。</li>
<li>
<strong>列の順序</strong>：<code>scale_x_discrete(limit=rev)</code> を使用して、‘Other’ と ‘Missing’ が最下部になるように、y 軸のカテゴリの順序を反転させました。<code>scale_y_discrete</code> ではなくそれを使ったのは、視覚的には y 軸上にあっても、病院は <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> の <code>x</code> 引数で述べられているからであることに注意してください。ggplot は、私たちがそうしないように指示しない限り、カテゴリーを後ろ向きに表示するようですので、このようにしています。</li>
<li>
<strong>その他の詳細</strong>：<code>labs</code> と <code>scale_fill_color</code> にそれぞれラベル／タイトルと色が追加されました。</li>
</ul>
<div class="sourceCode" id="cb1461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 病院別の全症例のアウトカム</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">outcomes2</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">proportion</span>,                 <span class="co"># あらかじめ計算された割合の表示</span></span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>,          <span class="co"># レベル順を逆にして、一番下に Missing と other</span></span>
<span>      fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>,                <span class="co"># aアウトカムごとに積み上げ</span></span>
<span>    width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>                    <span class="co"># より細い棒</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># 最小限のテーマ</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Number of recovered and dead Ebola cases, by hospital"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Outcome"</span>,             <span class="co"># 凡例のタイトル</span></span>
<span>       y <span class="op">=</span> <span class="st">"Count"</span>,                  <span class="co"># y 軸のタイトル</span></span>
<span>       x <span class="op">=</span> <span class="st">"Hospital of admission"</span><span class="op">)</span><span class="op">+</span> <span class="co"># x 軸のタイトル</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>                 <span class="co"># 色を手動で追加</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span><span class="op">=</span> <span class="st">"#3B1c8C"</span>,</span>
<span>               <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#21908D"</span> <span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1068-1.png" width="768"></div>
<p>割合は二値をとるので、‘recover’ を削除して、死亡した人の割合だけを表示した方が好ましいかもしれません。この処理は単に描画の目的のためだけのものです。</p>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code> を日付データ（例：集計データからのエピカーブ）で使用する場合は、棒の間の「ギャップ」ラインを取り除くために、<code>width =</code> 引数を調整する必要があります。日次データを使用する場合は <code>width = 1</code> とします。週単位の場合は、<code>width = 7</code> です。月ごとに日数が異なるため、月を指定することはできません。</p>
</div>
<div id="geom_histogram" class="section level3 unnumbered">
<h3>
<code>geom_histogram()</code><a class="anchor" aria-label="anchor" href="#geom_histogram"><i class="fas fa-link"></i></a>
</h3>
<p>ヒストグラムは棒グラフのように見えるかもしれませんが、連続変数の分布を測定するという点で異なります。「棒」の間にはスペースがなく、<code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code> には 1 つの列しか与えられません。<code>bin_width =</code> や <code>breaks =</code> といったヒストグラム特有の引数があり、データの階級分け方法を指定します。上記の連続データのセクションと<a href="epicurves.html#epicurves">流行曲線（エピカーブ）</a>の章に詳細が記載されています。</p>
</div>
</div>
<div id="参考資料-22" class="section level2" number="30.14">
<h2>
<span class="header-section-number">30.14</span> 参考資料<a class="anchor" aria-label="anchor" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-22"><i class="fas fa-link"></i></a>
</h2>
<p>特に ggplot については、膨大な量のヘルプがオンラインで提供されています。次をご覧ください。</p>
<ul>
<li><a href="http://r-statistics.co/ggplot2-cheatsheet.html">ggplot2 cheat sheet</a></li>
<li><a href="https://biostats.w.uib.no/the-ggplot2-cheat-sheet-by-rstudio/">another cheat sheet</a></li>
<li><a href="https://ggplot2.tidyverse.org/reference/">tidyverse ggplot basics page</a></li>
<li><a href="http://www.sthda.com/english/articles/32-r-graphics-essentials/131-plot-two-continuous-variables-scatter-graph-and-alternatives/">plotting continuous variables</a></li>
<li>R for Data Science pages on <a href="https://r4ds.had.co.nz/data-visualisation.html">data visualization</a>
</li>
<li><a href="https://r4ds.had.co.nz/graphics-for-communication.html">graphics for communicaton</a></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></div>
<div class="next"><a href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot-basics"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li>
<a class="nav-link" href="#%E6%BA%96%E5%82%99-20"><span class="header-section-number">30.1</span> 準備</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-14">パッケージの読み込み</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88-12">データのインポート</a></li>
<li><a class="nav-link" href="#%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0">一般的なクリーニング</a></li>
<li><a class="nav-link" href="#%E7%B8%A6%E9%95%B7%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%B8%E3%81%AE%E8%BB%A2%E5%9B%9E">縦長のデータへの転回</a></li>
</ul>
</li>
<li><a class="nav-link" href="#ggplot%E3%81%AE%E5%9F%BA%E7%A4%8E"><span class="header-section-number">30.2</span> ggplotの基礎</a></li>
<li><a class="nav-link" href="#ggplot"><span class="header-section-number">30.3</span> ggplot()</a></li>
<li><a class="nav-link" href="#geoms"><span class="header-section-number">30.4</span> Geoms</a></li>
<li>
<a class="nav-link" href="#ggplot_basics_mapping"><span class="header-section-number">30.5</span> データをプロットにマッピングする</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E8%A6%96%E8%A6%9A%E7%9A%84%E7%89%B9%E6%80%A7%E3%82%A8%E3%82%B9%E3%83%86%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF">プロットの視覚的特性（エステティック）</a></li>
<li><a class="nav-link" href="#%E9%9D%99%E7%9A%84%E3%81%AA%E5%80%A4%E3%81%AE%E8%A8%AD%E5%AE%9A">静的な値の設定</a></li>
<li><a class="nav-link" href="#%E5%88%97%E3%81%AE%E5%80%A4%E3%81%AB%E5%BF%9C%E3%81%98%E3%81%9F%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%AA%E3%83%B3%E3%82%B0">列の値に応じたスケーリング</a></li>
<li><a class="nav-link" href="#ggplot_basics_map_loc">マッピングのアサインをする場所</a></li>
<li><a class="nav-link" href="#ggplotgroups">グループ</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ggplot_basics_facet"><span class="header-section-number">30.6</span> Facets / Small-multiples</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#facet_wrap">facet_wrap()</a></li>
<li><a class="nav-link" href="#facet_grid">facet_grid()</a></li>
<li><a class="nav-link" href="#%E8%87%AA%E7%94%B1%E3%81%BE%E3%81%9F%E3%81%AF%E5%9B%BA%E5%AE%9A%E8%BB%B8">自由または固定軸</a></li>
<li><a class="nav-link" href="#%E3%83%95%E3%82%A1%E3%82%BB%E3%83%83%E3%83%88%E5%86%85%E3%81%AE%E5%9B%A0%E5%AD%90%E3%83%AC%E3%83%99%E3%83%AB%E3%81%AE%E9%A0%86%E5%BA%8F">ファセット内の因子レベルの順序</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E4%BF%9D%E5%AD%98-1"><span class="header-section-number">30.7</span> プロットの保存</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E4%BF%9D%E5%AD%98-2">プロットの保存</a></li>
<li><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E3%81%95%E3%82%8C%E3%81%9F%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E4%BF%AE%E6%AD%A3">保存されたプロットの修正</a></li>
<li><a class="nav-link" href="#%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88">プロットのエクスポート</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E3%83%A9%E3%83%99%E3%83%AB"><span class="header-section-number">30.8</span> ラベル</a></li>
<li>
<a class="nav-link" href="#ggplot_basics_themes"><span class="header-section-number">30.9</span> テーマ</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%AE%8C%E5%85%A8%E3%81%AA%E3%83%86%E3%83%BC%E3%83%9E">完全なテーマ</a></li>
<li><a class="nav-link" href="#modify-theme">Modify theme</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E8%89%B2"><span class="header-section-number">30.10</span> 色</a></li>
<li><a class="nav-link" href="#ggplot2%E3%81%B8%E3%81%AE%E3%83%91%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0"><span class="header-section-number">30.11</span> ggplot2へのパイピング</a></li>
<li>
<a class="nav-link" href="#%E9%80%A3%E7%B6%9A%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"><span class="header-section-number">30.12</span> 連続データのプロット</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%92%E3%82%B9%E3%83%88%E3%82%B0%E3%83%A9%E3%83%A0">ヒストグラム</a></li>
<li><a class="nav-link" href="#%E7%AE%B1%E3%81%B2%E3%81%92%E5%9B%B3">箱ひげ図</a></li>
<li><a class="nav-link" href="#%E3%83%90%E3%82%A4%E3%82%AA%E3%83%AA%E3%83%B3%E3%83%97%E3%83%AD%E3%83%83%E3%83%88%E3%82%B8%E3%83%83%E3%82%BF%E3%83%BC%E3%83%97%E3%83%AD%E3%83%83%E3%83%88sina%E3%83%97%E3%83%AD%E3%83%83%E3%83%88">バイオリンプロット、ジッタープロット、sinaプロット</a></li>
<li><a class="nav-link" href="#%E3%81%A4%E3%81%AE%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0">2 つの連続変数</a></li>
<li><a class="nav-link" href="#%E3%81%A4%E3%81%AE%E9%80%A3%E7%B6%9A%E5%A4%89%E6%95%B0-1">3 つの連続変数</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%82%AB%E3%83%AB%E3%81%AA%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"><span class="header-section-number">30.13</span> カテゴリカルなデータのプロット</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%BA%96%E5%82%99-21">準備</a></li>
<li><a class="nav-link" href="#ggplot_basics_bars">geom_bar()</a></li>
<li><a class="nav-link" href="#geom_col">geom_col()</a></li>
<li><a class="nav-link" href="#geom_histogram">geom_histogram()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-22"><span class="header-section-number">30.14</span> 参考資料</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>疫学のための R ハンドブック</strong>" was written by the handbook team. It was last built on 2023-01-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

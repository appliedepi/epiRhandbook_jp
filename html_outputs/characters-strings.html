<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>10 文字型・文字列型データ | 疫学のための R ハンドブック</title>
<meta name="author" content="the handbook team">
<meta name="description" content="本章では、stringr パッケージを使用して、文字（character）と文字列（string）を評価し、処理する方法を紹介します。 結合、並べ替え、分割 - str_c(), str_glue(), str_order(), str_split() 整理と標準化 長さの調整 - str_pad(), str_trunc(), str_wrap() 大文字小文字の変更 -...">
<meta name="generator" content="bookdown 0.31 with bs4_book()">
<meta property="og:title" content="10 文字型・文字列型データ | 疫学のための R ハンドブック">
<meta property="og:type" content="book">
<meta property="og:description" content="本章では、stringr パッケージを使用して、文字（character）と文字列（string）を評価し、処理する方法を紹介します。 結合、並べ替え、分割 - str_c(), str_glue(), str_order(), str_split() 整理と標準化 長さの調整 - str_pad(), str_trunc(), str_wrap() 大文字小文字の変更 -...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="10 文字型・文字列型データ | 疫学のための R ハンドブック">
<meta name="twitter:description" content="本章では、stringr パッケージを使用して、文字（character）と文字列（string）を評価し、処理する方法を紹介します。 結合、並べ替え、分割 - str_c(), str_glue(), str_order(), str_split() 整理と標準化 長さの調整 - str_pad(), str_trunc(), str_wrap() 大文字小文字の変更 -...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.26/datatables.js"></script><link href="libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.2/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.1/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script><script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script type="text/javascript">
        // window.addEventListener("load", function() {
        //     document.getElementById('toc').firstChild.innerHTML = "章目次"; 
        // });
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementsByClassName("d-flex align-items-start justify-content-between")[0].children[0].children[0].innerHTML = "疫学のための R</br>ハンドブック";
            document.getElementById('toc').firstChild.innerHTML = "章目次"; 
            document.getElementById('main-nav').children[1].firstChild.innerHTML = "総目次";
            document.getElementById('search').setAttribute("placeholder", "検索");
        });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">疫学のための R ハンドブック</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">本書について</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> 編集前記・技術注記</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> ハンドブックとデータのダウンロード</a></li>
<li class="book-part">基本編</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R の基礎</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Excel・Stata・SASとの比較</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> 推奨パッケージ</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R プロジェクト</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> データのインポート・エクスポート</a></li>
<li class="book-part">データマネジメント</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> データクリーニングと主要関数</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></li>
<li><a class="active" href="characters-strings.html"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> データのグループ化</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> 重複データの排除</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> ループと反復処理・リストの操作</a></li>
<li class="book-part">データ分析</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> 記述統計表の作り方</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> 標準化率</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> 移動平均</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> 時系列分析とアウトブレイクの検出</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> エピデミックモデリング</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></li>
<li class="book-part">データの可視化</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> 流行曲線（エピカーブ）</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> 人口ピラミッドとリッカート尺度</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> 感染連鎖</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> 系統樹</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></li>
<li class="book-part">レポートとダッシュボード</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> R Markdownで作るダッシュボード</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny で作るダッシュボード</a></li>
<li class="book-part">その他</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> 関数の作成</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> ディレクトリの操作</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Git と Github を使ったバージョン管理と共同作業</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> よくあるエラー</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> ヘルプ</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> ネットワークドライブで R を使用する場合</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table パッケージを使用したデータ処理</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="characters-strings" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> 文字型・文字列型データ<a class="anchor" aria-label="anchor" href="#characters-strings"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/Characters_Strings_1500x500.png" width="100%"></div>
<p>本章では、<strong>stringr</strong> パッケージを使用して、文字（character）と文字列（string）を評価し、処理する方法を紹介します。</p>
<ol style="list-style-type: decimal">
<li><p>結合、並べ替え、分割 - <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_order.html">str_order()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a></code><br></p></li>
<li>
<p>整理と標準化</p>
<ul>
<li>長さの調整 - <code><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_trunc.html">str_trunc()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap()</a></code><br>
</li>
<li>大文字小文字の変更 - <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_sentence()</a></code><br>
</li>
</ul>
</li>
<li><p>位置による評価と抽出 - <code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/word.html">word()</a></code><br></p></li>
<li>
<p>パターン認識</p>
<ul>
<li>検出と検索 - <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_match.html">str_match()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract()</a></code><br>
</li>
<li>修正と置換 - <code><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub()</a></code>, <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all()</a></code><br>
</li>
</ul>
</li>
<li><p>正規表現（“regex”）</p></li>
</ol>
<p>使用例を簡単に表示するため、ほとんどの例で短い文字ベクトルを用いていますが、本章の内容はデータフレーム内の列にも簡単に適用できます。</p>
<p>本章は、こちらの <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html">stringr のウェブサイト</a> を参考に作成されました。</p>
<!-- ======================================================= -->
<div id="準備-1" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> 準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-1"><i class="fas fa-link"></i></a>
</h2>
<div id="パッケージの読み込み-2" class="section level3 unnumbered">
<h3>パッケージの読み込み<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-2"><i class="fas fa-link"></i></a>
</h3>
<p><strong>stringr</strong> およびその他の <strong>tidyverse</strong> パッケージをインストールまたは読み込みます。</p>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># パッケージのインストール・読み込み</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">stringr</span>,    <span class="co"># 文字列を扱うための多くの関数</span></span>
<span>  <span class="va">tidyverse</span>,  <span class="co"># データ操作のための追加の関数</span></span>
<span>  <span class="va">tools</span><span class="op">)</span>      <span class="co"># タイトルケースに変更するための関数</span></span></code></pre></div>
</div>
<div id="データの読み込み" class="section level3 unnumbered">
<h3>データの読み込み<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF"><i class="fas fa-link"></i></a>
</h3>
<p>エボラ出血熱の流行をシミュレートしたデータセットをインポートします。お手元の環境でこの章の内容を実行したい方は、<a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">こちら</a> をクリックして「前処理された」ラインリスト（linelist）をダウンロードしてください（.rds 形式で取得できます）。 データは <strong>rio</strong> パッケージの <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> を利用してインポートしましょう（<code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> は、.xlsx、.csv、.rdsなど、様々な形式のファイルを扱うことができます）。インポートの詳細については、<a href="importing.html#importing">データのインポート・エクスポート</a> の章を参照してください。</p>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 症例ラインリストの読み込み </span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>インポートしたラインリストの最初の 50 行を以下に表示します。</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4960bce95f338d607d6f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4960bce95f338d607d6f">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="結合分割配列" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> 結合、分割、配列<a class="anchor" aria-label="anchor" href="#%E7%B5%90%E5%90%88%E5%88%86%E5%89%B2%E9%85%8D%E5%88%97"><i class="fas fa-link"></i></a>
</h2>
<p>このセクションでは以下の項目について説明します。</p>
<ul>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code>、<code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code>、<code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> を使った文字列の結合<br>
</li>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_order.html">str_order()</a></code> を使った文字列の並べ替え<br>
</li>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a></code> と <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> 文字列の分割</li>
</ul>
<!-- ======================================================= --><div id="文字列の結合" class="section level3 unnumbered">
<h3>文字列の結合<a class="anchor" aria-label="anchor" href="#%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E7%B5%90%E5%90%88"><i class="fas fa-link"></i></a>
</h3>
<p>複数の文字列を 1 つの文字列に結合する場合は、<strong>stringr</strong> の <code>str_c</code> を使うことをおすすめします。結合するそれぞれの文字列を、コンマで区切って指定します。</p>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"String1"</span>, <span class="st">"String2"</span>, <span class="st">"String3"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "String1String2String3"</code></pre>
<p>引数 <code>sep =</code> は、与えられた各引数の間に指定した文字値を挿入します（例：コンマ、スペース、改行 <code>"\n"</code>）。</p>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"String1"</span>, <span class="st">"String2"</span>, <span class="st">"String3"</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "String1, String2, String3"</code></pre>
<p>引数 <code>collapse =</code> は <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> に複数の値を<u>ベクトルで</u>入力する場合に使用します。これは、コード実行後に<u>出力される</u>ベクトルの要素を区切るために使用され、出力されるベクトルが 1 つの長い文字列のみを要素として持つようにします。</p>
<p>以下の例では、2 つのベクトルを 1 つにまとめています（姓と名）。また、似たような例として、管轄区域とその症例数があります。姓名を使用する例では、</p>
<ul>
<li>姓と名の間に <code>sep =</code> で指定した値が表示されます<br>
</li>
<li>各姓名の間に <code>collapse =</code> で指定した値が表示されます</li>
</ul>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abdul"</span>, <span class="st">"fahruk"</span>, <span class="st">"janice"</span><span class="op">)</span> </span>
<span><span class="va">last_names</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hussein"</span>, <span class="st">"akinleye"</span>, <span class="st">"okeke"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sep には入力された文字列（ここでは姓と名）を繋ぐ際間に挿入される文字（列）を指定</span></span>
<span><span class="co"># collapse には繋がれた文字列同士（ここでは各姓名）の間に挿入される文字（列）を指定</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">first_names</span>, <span class="va">last_names</span>, sep <span class="op">=</span> <span class="st">" "</span>, collapse <span class="op">=</span> <span class="st">";  "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "abdul hussein;  fahruk akinleye;  janice okeke"</code></pre>
<p>注釈：出力結果をどのように表示したいかによって、正しく表示されるように<code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> を使用したコード全体を <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> で囲む必要があります。例えば、以下のように、結合された文字列を改行して表示したい場合などです。</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 改行を正しく表示するためにフレーズ全体をcat()で囲む</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">first_names</span>, <span class="va">last_names</span>, sep <span class="op">=</span> <span class="st">" "</span>, collapse <span class="op">=</span> <span class="st">";\n"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## abdul hussein;
## fahruk akinleye;
## janice okeke</code></pre>
<!-- ======================================================= -->
</div>
<div id="動的文字列" class="section level3 unnumbered">
<h3>動的文字列<a class="anchor" aria-label="anchor" href="#%E5%8B%95%E7%9A%84%E6%96%87%E5%AD%97%E5%88%97"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> を使うと、文字列に動的な R コードを加えることができます。以下のように、動的なプロットキャプション（見出しや説明文など）を作成する際に非常に便利な関数です。</p>
<ul>
<li>すべての内容を二重引用符で囲んでください。<code>str_glue("")</code><br>
</li>
<li>動的なコードやあらかじめ定義された値への参照は、二重引用符の中の波括弧 <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code> に入力します。1つの <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> コマンド中に複数の波括弧を入れることができます。</li>
<li>文字として引用符 ’’ を表示したい場合は、二重引用符の中に<u>一重</u>引用符を使用します（例：日付の書式を指定する場合など。以下の例を参照ください）。<br>
</li>
<li>ヒント：<code>\n</code> で改行することができます。<br>
</li>
<li>ヒント：<code><a href="https://rdrr.io/r/base/format.html">format()</a></code> で日付の表示を調整し、<code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date()</a></code> で現在の日付を表示することができます。</li>
</ul>
<p>以下に、動的なプロットキャプションの簡単な例を示します。</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Data include {nrow(linelist)} cases and are current to {format(Sys.Date(), '%d %b %Y')}."</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Data include 5888 cases and are current to 12 Jan 2023.</code></pre>
<p>もう一つの方法は、以下のように波括弧内に仮置きの変数を挿入し、<code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> の最後にそれらを定義する方法です。これにより、表示したいプロットキャプションが長い場合でも、コードが読みやすくなります。</p>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Linelist as of {current_date}.\nLast case hospitalized on {last_hospital}.\n{n_missing_onset} cases are missing date of onset and not shown"</span>,</span>
<span>         current_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'%d %b %Y'</span><span class="op">)</span>,</span>
<span>         last_hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_hospitalisation</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>, <span class="st">'%d %b %Y'</span><span class="op">)</span>,</span>
<span>         n_missing_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>         <span class="op">)</span></span></code></pre></div>
<pre><code>## Linelist as of 12 Jan 2023.
## Last case hospitalized on 30 Apr 2015.
## 256 cases are missing date of onset and not shown</code></pre>
<p><strong>データフレームからの抜き出し</strong></p>
<p>データフレームからデータを取り出して、文字列としてまとめておくと便利な場合があります。以下にデータフレームの例を示します。これを使って、管轄区域、新規および総症例数についての要約文を作成します。</p>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 症例データフレームの作成</span></span>
<span><span class="va">case_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  zone        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Zone 1"</span>, <span class="st">"Zone 2"</span>, <span class="st">"Zone 3"</span>, <span class="st">"Zone 4"</span>, <span class="st">"Zone 5"</span><span class="op">)</span>,</span>
<span>  new_cases   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">7</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span>,</span>
<span>  total_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">4</span>, <span class="fl">25</span>, <span class="fl">10</span>, <span class="fl">103</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-47443bddd2bae3991008" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-47443bddd2bae3991008">{"x":{"filter":"none","vertical":false,"data":[["Zone 1","Zone 2","Zone 3","Zone 4","Zone 5"],[3,0,7,0,15],[40,4,25,10,103]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>zone<\/th>\n      <th>new_cases<\/th>\n      <th>total_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue_data()</a></code> を使用して、データフレームの各行から取り出した情報を文字列にまとめることができます。</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue_data</a></span><span class="op">(</span><span class="st">"{zone}: {new_cases} ({total_cases} total cases)"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Zone 1: 3 (40 total cases)
## Zone 2: 0 (4 total cases)
## Zone 3: 7 (25 total cases)
## Zone 4: 0 (10 total cases)
## Zone 5: 15 (103 total cases)</code></pre>
<p><strong>異なる行の文字列を結合する</strong></p>
<p>複数の行の値を結合して 1 つの行にまとめる場合など、データフレームの値を列に沿って結合したい場合は、<a href="#de-duplication">重複データの排除</a> の章内の <a href="deduplication.html#str_rollup">ロールアップした値</a> のセクションを参照してください。</p>
<p><strong>データフレームを 1 行の文字列にまとめる</strong></p>
<p><code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> でデータフレーム名と列名を指定し、<code>sep =</code> と <code>collapse =</code> の引数を与えることで、データフレーム内の情報を 1 行に表示させることができます。</p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">case_table</span><span class="op">$</span><span class="va">zone</span>, <span class="va">case_table</span><span class="op">$</span><span class="va">new_cases</span>, sep <span class="op">=</span> <span class="st">" = "</span>, collapse <span class="op">=</span> <span class="st">";  "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Zone 1 = 3;  Zone 2 = 0;  Zone 3 = 7;  Zone 4 = 0;  Zone 5 = 15"</code></pre>
<p>さらにもう一度 <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> で先に書いた <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> を包むことで、文の先頭に文字列 “New Cases:” を追加することができます（“New Cases:” が元の <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 内にあった場合、複数回表示されます）。</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"New Cases: "</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">case_table</span><span class="op">$</span><span class="va">zone</span>, <span class="va">case_table</span><span class="op">$</span><span class="va">new_cases</span>, sep <span class="op">=</span> <span class="st">" = "</span>, collapse <span class="op">=</span> <span class="st">";  "</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "New Cases: Zone 1 = 3;  Zone 2 = 0;  Zone 3 = 7;  Zone 4 = 0;  Zone 5 = 15"</code></pre>
</div>
<div id="str_unite" class="section level3 unnumbered">
<h3>列の結合<a class="anchor" aria-label="anchor" href="#str_unite"><i class="fas fa-link"></i></a>
</h3>
<p>データフレーム中の複数の列を文字列にまとめるには、<strong>tidyr</strong> パッケージの <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> を用います。これは <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> の逆の操作にあたります。</p>
<p>まず新しく統合される列の名前を指定します。次に結合したい列の名前を指定します。</p>
<ul>
<li>デフォルトではアンダースコア <code>_</code> によって各列の値が結合されますが、これは <code>sep =</code> によって変更できます。<br>
</li>
<li>
<code>remove =</code> は入力に用いた列をデータフレームから削除します（デフォルトでは TRUE）。</li>
<li>
<code>na.rm =</code> は結合時に欠損値を除外します（デフォルトでは FALSE）。</li>
</ul>
<p>以下に、例として小さいなデータフレームを作成して説明します。</p>
<div class="sourceCode" id="cb415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  case_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>  symptoms  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"jaundice, fever, chills"</span>,     <span class="co"># 患者 1</span></span>
<span>                <span class="st">"chills, aches, pains"</span>,        <span class="co"># 患者 2 </span></span>
<span>                <span class="st">"fever"</span>,                       <span class="co"># 患者 3</span></span>
<span>                <span class="st">"vomiting, diarrhoea"</span>,         <span class="co"># 患者 4</span></span>
<span>                <span class="st">"bleeding from gums, fever"</span>,   <span class="co"># 患者 5</span></span>
<span>                <span class="st">"rapid pulse, headache"</span><span class="op">)</span>,      <span class="co"># 患者 6</span></span>
<span>  outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Recover"</span>, <span class="st">"Death"</span>, <span class="st">"Death"</span>, <span class="st">"Recover"</span>, <span class="st">"Recover"</span>, <span class="st">"Recover"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">symptoms</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sym_1"</span>, <span class="st">"sym_2"</span>, <span class="st">"sym_3"</span><span class="op">)</span>, extra <span class="op">=</span> <span class="st">"merge"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 2 rows [3, 4].</code></pre>
<p>以下に、作成したデータフレームを表示します。</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0384d37fd006449106d0" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0384d37fd006449106d0">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6],["jaundice","chills","fever","vomiting","bleeding","rapid"],["fever","aches",null,"diarrhoea","from","pulse"],["chills","pains",null,null,"gums, fever","headache"],["Recover","Death","Death","Recover","Recover","Recover"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_ID<\/th>\n      <th>sym_1<\/th>\n      <th>sym_2<\/th>\n      <th>sym_3<\/th>\n      <th>outcome<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>以下のコマンドで、症状が入力された 3 つの列を統一します。</p>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_split</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span></span>
<span>    col <span class="op">=</span> <span class="st">"all_symptoms"</span>,         <span class="co"># 新しく作られる列の名前</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sym_1"</span>, <span class="st">"sym_2"</span>, <span class="st">"sym_3"</span><span class="op">)</span>, <span class="co"># 結合する列</span></span>
<span>    sep <span class="op">=</span> <span class="st">", "</span>,                   <span class="co"># 区切りに使われる結合子</span></span>
<span>    remove <span class="op">=</span> <span class="cn">TRUE</span>,                <span class="co"># TRUEの場合、結合元の列をデータフレームから削除する</span></span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span>                  <span class="co"># TRUEの場合、欠損値を無視して結合する</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code>##   case_ID                all_symptoms outcome
## 1       1     jaundice, fever, chills Recover
## 2       2        chills, aches, pains   Death
## 3       3                       fever   Death
## 4       4         vomiting, diarrhoea Recover
## 5       5 bleeding, from, gums, fever Recover
## 6       6      rapid, pulse, headache Recover</code></pre>
<!-- ======================================================= -->
</div>
<div id="分割" class="section level3 unnumbered">
<h3>分割<a class="anchor" aria-label="anchor" href="#%E5%88%86%E5%89%B2"><i class="fas fa-link"></i></a>
</h3>
<p>パターンに基づいて文字列を分割するには、<code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a></code> を使います。文字（列）を評価し、新たに分割された値からなる文字ベクトルの <code>list</code> を返します。</p>
<p>以下の簡単な例では、1 つの文字列を 3 つに分割しています。デフォルトでは、最初に与えられた文字列ごとに 1 つの要素（文字ベクトル）を持つ <code>list</code> を返します。<code>simplify = TRUE</code> の場合は、文字行列を返します。</p>
<p>この例では、1 つの文字列が与えられ、コマンドを実行すると、1 つの要素を持つリスト （つまり 3 つの値を持つ文字ベクトル）が出力されます。</p>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span>string <span class="op">=</span> <span class="st">"jaundice, fever, chills"</span>,</span>
<span>          pattern <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] "jaundice" " fever"   " chills"</code></pre>
<p>出力が保存されていれば、角括弧 <code>[ ]</code> を使って任意の値（n 番目の値）にアクセスし、抽出できます。特定の値を抽出するには、次のような構文を使用できます。<code>the_returned_object[[1]][2]</code></p>
<p>この例では、最初に評価された文字列から 2 番目の値（“fever”）を抽出します。要素の抽出の詳細については、<a href="basics.html#basics">R の基礎</a> の章をご覧ください。</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt1_symptoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="st">"jaundice, fever, chills"</span>, <span class="st">","</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pt1_symptoms</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>  <span class="co"># リスト内の1つ目（かつここでは唯一）の要素内にある2つ目の値を返す</span></span></code></pre></div>
<pre><code>## [1] " fever"</code></pre>
<p><code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a></code> で複数の文字列を指定した場合、出力されるリストには複数の要素が含まれます。</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">symptoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"jaundice, fever, chills"</span>,     <span class="co"># 患者 1</span></span>
<span>              <span class="st">"chills, aches, pains"</span>,        <span class="co"># 患者 2 </span></span>
<span>              <span class="st">"fever"</span>,                       <span class="co"># 患者 3</span></span>
<span>              <span class="st">"vomiting, diarrhoea"</span>,         <span class="co"># 患者 4</span></span>
<span>              <span class="st">"bleeding from gums, fever"</span>,   <span class="co"># 患者 5</span></span>
<span>              <span class="st">"rapid pulse, headache"</span><span class="op">)</span>       <span class="co"># 患者 6</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">symptoms</span>, <span class="st">","</span><span class="op">)</span>                     <span class="co"># 各患者の症状を分割する</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] "jaundice" " fever"   " chills" 
## 
## [[2]]
## [1] "chills" " aches" " pains"
## 
## [[3]]
## [1] "fever"
## 
## [[4]]
## [1] "vomiting"   " diarrhoea"
## 
## [[5]]
## [1] "bleeding from gums" " fever"            
## 
## [[6]]
## [1] "rapid pulse" " headache"</code></pre>
<p>出力結果を後にデータフレームの列にしたい場合、次のように <code>simplify = TRUE</code> を設定し、文字行列を出力すると便利です。</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">symptoms</span>, <span class="st">","</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      [,1]                 [,2]         [,3]     
## [1,] "jaundice"           " fever"     " chills"
## [2,] "chills"             " aches"     " pains" 
## [3,] "fever"              ""           ""       
## [4,] "vomiting"           " diarrhoea" ""       
## [5,] "bleeding from gums" " fever"     ""       
## [6,] "rapid pulse"        " headache"  ""</code></pre>
<p>また <code>n =</code> を使って、分割する数を調整することもできます。例えば、以下の例は分割数を 2 に制限するもので、それ以上のコンマは 2 番目の値の中に残ります。</p>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">symptoms</span>, <span class="st">","</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      [,1]                 [,2]            
## [1,] "jaundice"           " fever, chills"
## [2,] "chills"             " aches, pains" 
## [3,] "fever"              ""              
## [4,] "vomiting"           " diarrhoea"    
## [5,] "bleeding from gums" " fever"        
## [6,] "rapid pulse"        " headache"</code></pre>
<p><u>注釈：<code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split_fixed()</a></code> を使用しても同じ結果が出力されますが、その場合は <code>simplify</code> 引数を与えず、代わりに列数（<code>n</code>）を指定しなければなりません。</u></p>
<div class="sourceCode" id="cb430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split_fixed</a></span><span class="op">(</span><span class="va">symptoms</span>, <span class="st">","</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="列の分割" class="section level3 unnumbered">
<h3>列の分割<a class="anchor" aria-label="anchor" href="#%E5%88%97%E3%81%AE%E5%88%86%E5%89%B2"><i class="fas fa-link"></i></a>
</h3>
<p>データフレームの列を分割する場合は、<strong>dplyr</strong> パッケージの <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> が最適です。この関数は、文字列を要素に持つ 1 つの列を複数の列に分割することができます。</p>
<p>例えば、先述の<a href="characters-strings.html#str_unite">列の結合</a>のセクションで作成した簡単なデータフレーム <code>df</code> を見てみましょう。このデータフレームには <code>case_ID</code> の列、多くの症状をまとめた文字列からなる列、そして予後を示す列が含まれています。ここでは、複数の症状が含まれている <code>symptoms</code> 列を症状ごとの列に分割し、各列が単一の症状を表すようにすることを目的とします。</p>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-2946ad6634988e7aa54d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2946ad6634988e7aa54d">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6],["jaundice, fever, chills","chills, aches, pains","fever","vomiting, diarrhoea","bleeding from gums, fever","rapid pulse, headache"],["Recover","Death","Death","Recover","Recover","Recover"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_ID<\/th>\n      <th>symptoms<\/th>\n      <th>outcome<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>データを <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> で処理する場合、まず分離する列を指定します。次に、以下のように新しい列名を含むベクトル <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> を <code>into =</code> 引数に指定します。</p>
<ul>
<li><p><code>sep =</code> 分割する位置を、文字または数字で指定します。</p></li>
<li><p><code>remove =</code> デフォルトではFALSE。入力された列を削除します。<br></p></li>
<li><p><code>convert =</code> デフォルトではFALSE。文字列 “NA”を <code>NA</code> に変換します。</p></li>
<li>
<p><code>extra =</code> 分離によって作成された値の数が、指定された新規列の名前よりも多い場合の動作を制御します。</p>
<ul>
<li>
<code>extra = "warn"</code> は、警告を表示し、過剰な値は削除されます（<strong>デフォルト</strong>）。</li>
<li>
<code>extra = "drop"</code> は、警告を表示せずに余分な値を削除します。</li>
<li>
<strong><code>extra = "merge"</code> は、<code>into =</code> で指定された新しい列の数だけ分割します。-</strong> <u>この設定では全ての入力データが保存されます。</u>
</li>
</ul>
</li>
</ul>
<p><code>extra = "merge"</code> を使用した例を以下に示します（ここではデータは失われません）。2 つの新しい列が定義され、3 つ目の症状は 2 つ目の列に入ります。</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3つ目の症状は2つ目の新しい列に組み込まれる</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">symptoms</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sym_1"</span>, <span class="st">"sym_2"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">","</span>, extra <span class="op">=</span> <span class="st">"merge"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [3].</code></pre>
<pre><code>##   case_ID              sym_1          sym_2 outcome
## 1       1           jaundice  fever, chills Recover
## 2       2             chills   aches, pains   Death
## 3       3              fever           &lt;NA&gt;   Death
## 4       4           vomiting      diarrhoea Recover
## 5       5 bleeding from gums          fever Recover
## 6       6        rapid pulse       headache Recover</code></pre>
<p>デフォルトの <code>extra = "drop"</code> に設定した場合、以下のように警告が表示されます。</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3番目の症状は失われる</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">symptoms</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sym_1"</span>, <span class="st">"sym_2"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 2 rows [1, 2].</code></pre>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [3].</code></pre>
<pre><code>##   case_ID              sym_1      sym_2 outcome
## 1       1           jaundice      fever Recover
## 2       2             chills      aches   Death
## 3       3              fever       &lt;NA&gt;   Death
## 4       4           vomiting  diarrhoea Recover
## 5       5 bleeding from gums      fever Recover
## 6       6        rapid pulse   headache Recover</code></pre>
<p><span style="color: orange;"><strong>注意：</strong><code>into =</code> に入力された値の数（新規列の名前）が不足していると、データが切り捨てられる可能性があります。</span></p>
<!-- ======================================================= -->
</div>
<div id="アルファベット順に並べる" class="section level3 unnumbered">
<h3>アルファベット順に並べる<a class="anchor" aria-label="anchor" href="#%E3%82%A2%E3%83%AB%E3%83%95%E3%82%A1%E3%83%99%E3%83%83%E3%83%88%E9%A0%86%E3%81%AB%E4%B8%A6%E3%81%B9%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p>複数の文字列をアルファベット順に並べることができます。<code><a href="https://stringr.tidyverse.org/reference/str_order.html">str_order()</a></code> を使用すると、順序が返され、<code><a href="https://stringr.tidyverse.org/reference/str_order.html">str_sort()</a></code> はその順序に並べ替えた文字列を返します。</p>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 文字列の定義</span></span>
<span><span class="va">health_zones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alba"</span>, <span class="st">"Takota"</span>, <span class="st">"Delta"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># アルファベット順を返す</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_order.html">str_order</a></span><span class="op">(</span><span class="va">health_zones</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 1 3 2</code></pre>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># アルファベット順に並び替える</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_order.html">str_sort</a></span><span class="op">(</span><span class="va">health_zones</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Alba"   "Delta"  "Takota"</code></pre>
<p>英語以外の他のアルファベットを使用したい場合は、引数 <code>locale =</code> を追加します。R コンソールで <code><a href="https://rdrr.io/pkg/stringi/man/stri_locale_list.html">stringi::stri_locale_list()</a></code> と入力すると、指定可能なアルファベットの一覧を表示することができます。</p>
<!-- ======================================================= -->
</div>
<div id="r-の基本関数" class="section level3 unnumbered">
<h3>R の基本関数<a class="anchor" aria-label="anchor" href="#r-%E3%81%AE%E5%9F%BA%E6%9C%AC%E9%96%A2%E6%95%B0"><i class="fas fa-link"></i></a>
</h3>
<p>R の <strong>base</strong> パッケージに含まれている関数である <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> や <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> は、与えられたベクトルのすべての要素を文字に変換した後、結合して 1 つの文字列を返すためによく使われます。これらの関数は <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> と似ていますが、使用される構文はより複雑で、括弧の中では各部分がコンマで区切られています。括弧内の各部分は、引用符で囲まれた文字テキストまたはすでに定義されたコードオブジェクト（引用符なし）です。例えば、以下のようになります。</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_beds</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">n_masks</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Regional hospital needs "</span>, <span class="va">n_beds</span>, <span class="st">" beds and "</span>, <span class="va">n_masks</span>, <span class="st">" masks."</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Regional hospital needs 10 beds and 20 masks."</code></pre>
<p><code>sep =</code> と <code>collapse =</code> の引数を指定できます。<code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> は、<code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> で <code>sep = " "</code>（半角スペース）を使用した場合と同じです。</p>
</div>
</div>
<div id="整理と標準化" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> 整理と標準化<a class="anchor" aria-label="anchor" href="#%E6%95%B4%E7%90%86%E3%81%A8%E6%A8%99%E6%BA%96%E5%8C%96"><i class="fas fa-link"></i></a>
</h2>
<!-- ======================================================= -->
<div id="大文字小文字の変更" class="section level3 unnumbered">
<h3>大文字小文字の変更<a class="anchor" aria-label="anchor" href="#%E5%A4%A7%E6%96%87%E5%AD%97%E5%B0%8F%E6%96%87%E5%AD%97%E3%81%AE%E5%A4%89%E6%9B%B4"><i class="fas fa-link"></i></a>
</h3>
<p>管轄区域の名称など、大文字小文字を変更しなければならない場合がよくあります。その場合は、以下のように <strong>stringr</strong> に含まれる <code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper()</a></code>、<code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower()</a></code>、<code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title()</a></code> を使用すると便利です。</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper</a></span><span class="op">(</span><span class="st">"California"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "CALIFORNIA"</code></pre>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="st">"California"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "california"</code></pre>
<p><strong>base</strong> R の <code><a href="https://rdrr.io/r/base/chartr.html">toupper()</a></code>、<code><a href="https://rdrr.io/r/base/chartr.html">tolower()</a></code> を使用しても同じ処理をすることができます。</p>
<p><strong>語頭を大文字にする</strong></p>
<p>各単語の語頭を大文字にしたい場合は、<code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title()</a></code> を使います。</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="st">"go to the US state of california "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Go To The Us State Of California "</code></pre>
<p><strong>tools</strong> パッケージの <code>toTitleCase()</code> を使うことで、より厳密に（“to”、“the”、“of” のような単語は大文字化されずに）語頭を大文字にすることができます。</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/toTitleCase.html">toTitleCase</a></span><span class="op">(</span><span class="st">"This is the US state of california"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "This is the US State of California"</code></pre>
<p>また、<code><a href="https://stringr.tidyverse.org/reference/case.html">str_to_sentence()</a></code> を使うと、文字列の最初の文字の語頭のみを大文字にすることができます。</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_sentence</a></span><span class="op">(</span><span class="st">"the patient must be transported"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "The patient must be transported"</code></pre>
</div>
<div id="str_pad" class="section level3 unnumbered">
<h3>文字列を伸長する<a class="anchor" aria-label="anchor" href="#str_pad"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad()</a></code> を用いると、文字列に特定の文字を足すことで、指定した長さまで文字列を伸ばすことができますデフォルトではスペース（空白）が追加されますが、<code>pad =</code> によってピリオドなど他の文字を指定することも可能です。</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 異なる長さのICDコード</span></span>
<span><span class="va">ICD_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"R10.13"</span>,</span>
<span>               <span class="st">"R10.819"</span>,</span>
<span>               <span class="st">"R17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 最低7文字になるよう右側に空白を足したICDコード</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">ICD_codes</span>, <span class="fl">7</span>, <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "R10.13 " "R10.819" "R17    "</code></pre>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 空白の代わりにピリオドで文字列を伸長</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">ICD_codes</span>, <span class="fl">7</span>, <span class="st">"right"</span>, pad <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "R10.13." "R10.819" "R17...."</code></pre>
<p>例えば、<code>pad = "0"</code> により先頭に 0 を足すことで、時間や分のように数字で構成される文字列の長さが少なくとも 2 になるように処理することができます。</p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 先頭に0を足して2桁にする（例：時間・分の表示）</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="st">"4"</span>, <span class="fl">2</span>, pad <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## [1] "04"</code></pre>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># "hours"という名前の数字列を作る場合</span></span>
<span><span class="co"># hours &lt;- str_pad(hours, 2, pad = "0")</span></span></code></pre></div>
</div>
<div id="文字列を短縮する" class="section level3 unnumbered">
<h3>文字列を短縮する<a class="anchor" aria-label="anchor" href="#%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E7%9F%AD%E7%B8%AE%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_trunc.html">str_trunc()</a></code> で文字列の長さの最大値を設定できます。与えられた文字列の長さが指定した最大値を超える場合、その文字列は短縮され、省略記号（…）が挿入されます。このとき、省略記号は文字数にカウントされることに注意してください。使用される省略記号は <code>ellipsis =</code> で指定することができます。また <code>side =</code> によって、省略記号がどこに挿入されるか（“left”、 “right”、 “center”）を指定することができます。</p>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">original</span> <span class="op">&lt;-</span> <span class="st">"Symptom onset on 4/3/2020 with vomiting"</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trunc.html">str_trunc</a></span><span class="op">(</span><span class="va">original</span>, <span class="fl">10</span>, <span class="st">"center"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Symp...ing"</code></pre>
</div>
<div id="長さの標準化" class="section level3 unnumbered">
<h3>長さの標準化<a class="anchor" aria-label="anchor" href="#%E9%95%B7%E3%81%95%E3%81%AE%E6%A8%99%E6%BA%96%E5%8C%96"><i class="fas fa-link"></i></a>
</h3>
<p>文字列の長さの最大値を <code><a href="https://stringr.tidyverse.org/reference/str_trunc.html">str_trunc()</a></code> で指定し、さらに <code><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad()</a></code> を用いて短い文字列をその長さまで伸長することができます。以下の例では、最大値を 6 に設定し（1 つの文字列が短縮されます）、次に設定された最大値 6 に満たない文字列がその長さまで伸長されます。</p>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 異なる長さのICDコード</span></span>
<span><span class="va">ICD_codes</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"R10.13"</span>,</span>
<span>                 <span class="st">"R10.819"</span>,</span>
<span>                 <span class="st">"R17"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 最大の長さが6になるよう文字列を短縮</span></span>
<span><span class="va">ICD_codes_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trunc.html">str_trunc</a></span><span class="op">(</span><span class="va">ICD_codes</span>, <span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">ICD_codes_2</span></span></code></pre></div>
<pre><code>## [1] "R10.13" "R10..." "R17"</code></pre>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 最小の長さが6になるよう文字列を伸長</span></span>
<span><span class="va">ICD_codes_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html">str_pad</a></span><span class="op">(</span><span class="va">ICD_codes_2</span>, <span class="fl">6</span>, <span class="st">"right"</span><span class="op">)</span></span>
<span><span class="va">ICD_codes_3</span></span></code></pre></div>
<pre><code>## [1] "R10.13" "R10..." "R17   "</code></pre>
</div>
<div id="先頭末尾の空白を削除する" class="section level3 unnumbered">
<h3>先頭・末尾の空白を削除する<a class="anchor" aria-label="anchor" href="#%E5%85%88%E9%A0%AD%E6%9C%AB%E5%B0%BE%E3%81%AE%E7%A9%BA%E7%99%BD%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim()</a></code> を用いて文字列の端にある空白、改行（<code>\n</code>）、タブ （<code>\t</code>）を削除できます。<code>"right"</code>、<code>"left"</code>、または <code>"both"</code> を指定することにより、どちらの端から削除するかを選択することができます（例：<code>str_trim(x, "right")</code>）。</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 右端に余分な空白を持つID</span></span>
<span><span class="va">IDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"provA_1852  "</span>, <span class="co"># 2つの余分な空白あり</span></span>
<span>         <span class="st">"provA_2345"</span>,   <span class="co"># 余分な空白なし</span></span>
<span>         <span class="st">"provA_9460 "</span><span class="op">)</span>  <span class="co"># 1つの余分な空白あり</span></span>
<span></span>
<span><span class="co"># 右端から空白を削除</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="va">IDs</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "provA_1852" "provA_2345" "provA_9460"</code></pre>
</div>
<div id="繰り返される空白の削除" class="section level3 unnumbered">
<h3>繰り返される空白の削除<a class="anchor" aria-label="anchor" href="#%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%95%E3%82%8C%E3%82%8B%E7%A9%BA%E7%99%BD%E3%81%AE%E5%89%8A%E9%99%A4"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_squish()</a></code> を用いて文字列の内部に連続して現れる空白を削除できます。例えば、2 つ続きになっている空白を 1 つの空白に変更できます。<code><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim()</a></code> と同様、文字列の端にある空白、改行、タブを削除することもできます。</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 元の文字列は内部に余分な空白を含む</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_squish</a></span><span class="op">(</span><span class="st">"  Pt requires   IV saline\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Pt requires IV saline"</code></pre>
<p>R コンソールに <code><a href="https://stringr.tidyverse.org/reference/str_trim.html">?str_trim</a></code>、<code><a href="https://stringr.tidyverse.org/reference/str_pad.html">?str_pad</a></code> と入力すると、詳細を確認できます。</p>
</div>
<div id="指定の文字数で文章を改行する" class="section level3 unnumbered">
<h3>指定の文字数で文章を改行する<a class="anchor" aria-label="anchor" href="#%E6%8C%87%E5%AE%9A%E3%81%AE%E6%96%87%E5%AD%97%E6%95%B0%E3%81%A7%E6%96%87%E7%AB%A0%E3%82%92%E6%94%B9%E8%A1%8C%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap()</a></code> を用いることで、長い文章を指定した文字数で改行し整理することができます。任意の文字数を指定すれば、アルゴリズムにより以下のように文章中に改行（<code>\n</code>）が挿入されます。</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt_course</span> <span class="op">&lt;-</span> <span class="st">"Symptom onset 1/4/2020 vomiting chills fever. Pt saw traditional healer in home village on 2/4/2020. On 5/4/2020 pt symptoms worsened and was admitted to Lumta clinic. Sample was taken and pt was transported to regional hospital on 6/4/2020. Pt died at regional hospital on 7/4/2020."</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">pt_course</span>, <span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Symptom onset 1/4/2020 vomiting chills\nfever. Pt saw traditional healer in\nhome village on 2/4/2020. On 5/4/2020\npt symptoms worsened and was admitted\nto Lumta clinic. Sample was taken and pt\nwas transported to regional hospital on\n6/4/2020. Pt died at regional hospital\non 7/4/2020."</code></pre>
<p><strong>base</strong> の <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> に上記のコマンドを入力することで、改行された文章を表示することができます。</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">pt_course</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Symptom onset 1/4/2020 vomiting chills
## fever. Pt saw traditional healer in
## home village on 2/4/2020. On 5/4/2020
## pt symptoms worsened and was admitted
## to Lumta clinic. Sample was taken and pt
## was transported to regional hospital on
## 6/4/2020. Pt died at regional hospital
## on 7/4/2020.</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="位置による操作" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> 位置による操作<a class="anchor" aria-label="anchor" href="#%E4%BD%8D%E7%BD%AE%E3%81%AB%E3%82%88%E3%82%8B%E6%93%8D%E4%BD%9C"><i class="fas fa-link"></i></a>
</h2>
<div id="位置を指定して文字を抽出する" class="section level3 unnumbered">
<h3>位置を指定して文字を抽出する<a class="anchor" aria-label="anchor" href="#%E4%BD%8D%E7%BD%AE%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E6%96%87%E5%AD%97%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub()</a></code> は文字列の一部を返します。この関数は次の 3 つの引数を取ります。</p>
<ol style="list-style-type: decimal">
<li>文字ベクトル</li>
<li>開始位置</li>
<li>終了位置</li>
</ol>
<p>位置を定義する際にいくつかの注意点があります：</p>
<ul>
<li>位置番号が正のとき、位置は文字列の左端からカウントされます。</li>
<li>位置番号が負のとき、位置は文字列の右端からカウントされます。</li>
<li>開始・終了位置は選択範囲に含まれます。</li>
<li>文字列の長さを超えて選択された範囲は無視されます。</li>
</ul>
<p>以下に文字列 “pneumonia” を用いた例を示します：</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 左から3文字目を開始および終了位置に設定</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "e"</code></pre>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 位置0は存在しません</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] ""</code></pre>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 左から6文字目を開始位置、右から1文字目を終了位置に設定</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="fl">6</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "onia"</code></pre>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 右から5文字目を開始位置、右から2文字目を終了位置に設定</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "moni"</code></pre>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 左から4文字目を開始位置、文字列の長さを超えた位置を終了位置に設定</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="fl">4</span>, <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "umonia"</code></pre>
</div>
<div id="位置を指定して単語を抽出する" class="section level3 unnumbered">
<h3>位置を指定して単語を抽出する<a class="anchor" aria-label="anchor" href="#%E4%BD%8D%E7%BD%AE%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E5%8D%98%E8%AA%9E%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p>n 番目の単語を抽出したい場合は、<strong>stringr</strong> パッケージの <code><a href="https://stringr.tidyverse.org/reference/word.html">word()</a></code> を用います。文字列、開始位置、終了位置を引数に取ります。</p>
<p>初期設定では空白で区切られた部分が単語と認識されます。区切りは <code>sep =</code> で変更でき、例えば <code>sep = "_"</code> と指定すると下線で区切られた部分が単語と認識されます。</p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 評価したい文字列</span></span>
<span><span class="va">chief_complaints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"I just got out of the hospital 2 days ago, but still can barely breathe."</span>,</span>
<span>                      <span class="st">"My stomach hurts"</span>,</span>
<span>                      <span class="st">"Severe ear pain"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1から3番目の単語を抽出</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html">word</a></span><span class="op">(</span><span class="va">chief_complaints</span>, start <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">3</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "I just got"       "My stomach hurts" "Severe ear pain"</code></pre>
</div>
<div id="位置を指定して文字を入れ替える" class="section level3 unnumbered">
<h3>位置を指定して文字を入れ替える<a class="anchor" aria-label="anchor" href="#%E4%BD%8D%E7%BD%AE%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E6%96%87%E5%AD%97%E3%82%92%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub()</a></code> と代入演算子（<code>&lt;-</code>）を組み合わせて文字列の一部を変更できます。</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">word</span> <span class="op">&lt;-</span> <span class="st">"pneumonia"</span></span>
<span></span>
<span><span class="co"># 3番目と4番目の文字をXに変更する</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">word</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"XX"</span></span>
<span></span>
<span><span class="co"># 結果を表示</span></span>
<span><span class="va">word</span></span></code></pre></div>
<pre><code>## [1] "pnXXmonia"</code></pre>
<p>データフレームの列など、複数の文字列に対して用いる場合の例を示します。以下の例では、コマンド実行後に “HIV” の文字列が長くなることに注意してください。</p>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">words</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="st">"tubercolosis"</span>, <span class="st">"HIV"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3番目と4番目の文字をXに変更する</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">words</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"XX"</span></span>
<span></span>
<span><span class="va">words</span></span></code></pre></div>
<pre><code>## [1] "pnXXmonia"    "tuXXrcolosis" "HIXX"</code></pre>
</div>
<div id="長さを評価する" class="section level3 unnumbered">
<h3>長さを評価する<a class="anchor" aria-label="anchor" href="#%E9%95%B7%E3%81%95%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="st">"abc"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p><strong>base</strong> R の <code><a href="https://rdrr.io/r/base/nchar.html">nchar()</a></code> でも同様の操作が可能です。</p>
<!-- ======================================================= -->
</div>
</div>
<div id="パターン" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> パターン<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><i class="fas fa-link"></i></a>
</h2>
<p><strong>stringr</strong> に含まれる関数の多くは、与えられた文字列から特定の<u>パターン</u>を見つけ、その位置を特定したり、抽出・入れ替えなどの操作を行うことができます。</p>
<!-- ======================================================= -->
<div id="パターンを見つける" class="section level3 unnumbered">
<h3>パターンを見つける<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%82%92%E8%A6%8B%E3%81%A4%E3%81%91%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p>以下の例のように <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> を使うことで、文字列中に特定のパターンが存在するか否かを判別することができます。初めに検索する文字列を与え（<code>string =</code>）、さらに探したいパターンを入力します（<code>pattern =</code>）。 初期設定では<u>大文字小文字が区別される</u>ことに注意してください！</p>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span>string <span class="op">=</span> <span class="st">"primary school teacher"</span>, pattern <span class="op">=</span> <span class="st">"teach"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>引数 <code>negate =</code> を <code>TRUE</code> に設定することで、パターンが存在「しない」かどうかを判定できます。</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span>string <span class="op">=</span> <span class="st">"primary school teacher"</span>, pattern <span class="op">=</span> <span class="st">"teach"</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>大文字小文字を無視したい場合は、パターンを <code><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex()</a></code> で包み、<code><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex()</a></code> <u>中に</u> <code>ignore_case = TRUE</code>（もしくは短く <code>T</code>）と指定します。</p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span>string <span class="op">=</span> <span class="st">"Teacher"</span>, pattern <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex</a></span><span class="op">(</span><span class="st">"teach"</span>, ignore_case <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> で検索する文字列が文字ベクトルやデータフレームの列である場合は、各要素ごとに <code>TRUE</code> または <code>FALSE</code> が返されます。</p>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 職業のベクトル・列</span></span>
<span><span class="va">occupations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"field laborer"</span>,</span>
<span>                 <span class="st">"university professor"</span>,</span>
<span>                 <span class="st">"primary school teacher &amp; tutor"</span>,</span>
<span>                 <span class="st">"tutor"</span>,</span>
<span>                 <span class="st">"nurse at regional hospital"</span>,</span>
<span>                 <span class="st">"lineworker at Amberdeen Fish Factory"</span>,</span>
<span>                 <span class="st">"physican"</span>,</span>
<span>                 <span class="st">"cardiologist"</span>,</span>
<span>                 <span class="st">"office worker"</span>,</span>
<span>                 <span class="st">"food service"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 各文字列中に"teach"が含まれるかを判別する - TRUE/FALSE が出力される</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<p><code>TRUE</code> がいくつあるかを数えたい場合は、出力された値を <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> に入力します。</p>
<div class="sourceCode" id="cb501"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>複数のパターンを探したい場合は、以下のように各パターンを OR 記号（<code>|</code>）で区切り、<code>pattern =</code> で指定します。</p>
<div class="sourceCode" id="cb503"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">occupations</span>, pattern <span class="op">=</span> <span class="st">"teach|professor|tutor"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>より多くのパターンを同時に探したいときは、 <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> と <code>sep = |</code> を組み合わせた出力を文字オブジェクトとして先に定義することで、コードをより簡潔にすることができます。以下の例では、医療従事者の職業リストをパターンとして検索します。</p>
<div class="sourceCode" id="cb505"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 検索するパターン</span></span>
<span><span class="va">occupation_med_frontline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"medical"</span>, <span class="st">"medicine"</span>, <span class="st">"hcw"</span>, <span class="st">"healthcare"</span>, <span class="st">"home care"</span>, <span class="st">"home health"</span>,</span>
<span>                                <span class="st">"surgeon"</span>, <span class="st">"doctor"</span>, <span class="st">"doc"</span>, <span class="st">"physician"</span>, <span class="st">"surgery"</span>, <span class="st">"peds"</span>, <span class="st">"pediatrician"</span>,</span>
<span>                               <span class="st">"intensivist"</span>, <span class="st">"cardiologist"</span>, <span class="st">"coroner"</span>, <span class="st">"nurse"</span>, <span class="st">"nursing"</span>, <span class="st">"rn"</span>, <span class="st">"lpn"</span>,</span>
<span>                               <span class="st">"cna"</span>, <span class="st">"pa"</span>, <span class="st">"physician assistant"</span>, <span class="st">"mental health"</span>,</span>
<span>                               <span class="st">"emergency department technician"</span>, <span class="st">"resp therapist"</span>, <span class="st">"respiratory"</span>,</span>
<span>                                <span class="st">"phlebotomist"</span>, <span class="st">"pharmacy"</span>, <span class="st">"pharmacist"</span>, <span class="st">"hospital"</span>, <span class="st">"snf"</span>, <span class="st">"rehabilitation"</span>,</span>
<span>                               <span class="st">"rehab"</span>, <span class="st">"activity"</span>, <span class="st">"elderly"</span>, <span class="st">"subacute"</span>, <span class="st">"sub acute"</span>,</span>
<span>                                <span class="st">"clinic"</span>, <span class="st">"post acute"</span>, <span class="st">"therapist"</span>, <span class="st">"extended care"</span>,</span>
<span>                                <span class="st">"dental"</span>, <span class="st">"dential"</span>, <span class="st">"dentist"</span>, sep <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">occupation_med_frontline</span></span></code></pre></div>
<pre><code>## [1] "medical|medicine|hcw|healthcare|home care|home health|surgeon|doctor|doc|physician|surgery|peds|pediatrician|intensivist|cardiologist|coroner|nurse|nursing|rn|lpn|cna|pa|physician assistant|mental health|emergency department technician|resp therapist|respiratory|phlebotomist|pharmacy|pharmacist|hospital|snf|rehabilitation|rehab|activity|elderly|subacute|sub acute|clinic|post acute|therapist|extended care|dental|dential|dentist"</code></pre>
<p>以下の例では、先に定義した職業リストの中に含まれる医療職（<code>occupation_med_frontline</code>）の数を返します。</p>
<div class="sourceCode" id="cb507"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">occupations</span>, pattern <span class="op">=</span> <span class="va">occupation_med_frontline</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p><strong>文字列検索のための基本 R 関数</strong></p>
<p><strong>base</strong> R の <code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code> は <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> と同様、パターンの有無を判定しロジカルベクトルを返します。基本構文は <code>grepl(pattern, strings_to_search, ignore.case = FALSE, ...)</code> です。<code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code> を使用する利点の 1 つとして、<code><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex()</a></code> を使わずに <code>ignore.case =</code> を指定するだけで大文字小文字を区別するかを変更することができます。</p>
<p>同様に、<strong>base</strong> R の <code><a href="https://rdrr.io/r/base/grep.html">sub()</a></code> と <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> は <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code> に近い働きをします。 基本構文は <code>gsub(pattern, replacement, strings_to_search, ignore.case = FALSE)</code> です。<code><a href="https://rdrr.io/r/base/grep.html">sub()</a></code> は一致したパターンのうち最初に現れるものだけを、<code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> は一致したパターンの全てを入れ替えます。</p>
<div id="コンマをピリオドに入れ替える" class="section level4 unnumbered">
<h4>コンマをピリオドに入れ替える<a class="anchor" aria-label="anchor" href="#%E3%82%B3%E3%83%B3%E3%83%9E%E3%82%92%E3%83%94%E3%83%AA%E3%82%AA%E3%83%89%E3%81%AB%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B"><i class="fas fa-link"></i></a>
</h4>
<p>以下に <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> を用いてコンマをピリオドに入れ替える例を示します。これは米国や英国以外で収集されたデータを扱う際に役に立つかもしれません。</p>
<p>内部の <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> は <code>lengths</code> 内のピリオドを除いて ““（空白無し）に入れ替えます。ピリオド”.” をパターンとして指定する際は、その前に 2 つバックスラッシュを置くことで「エスケープ」する必要があります。これは正規表現において “.” が “全ての文字” を意味するためです。 ここで出力された結果（ピリオドは削除されカンマのみを含む）は外側の <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> に渡され、コンマがピリオドに置き換わります。</p>
<div class="sourceCode" id="cb509"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2.454,56"</span>, <span class="st">"1,2"</span>, <span class="st">"6.096,5"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">","</span>,                <span class="co"># コンマを見つける</span></span>
<span>                replacement <span class="op">=</span> <span class="st">"."</span>,            <span class="co"># ピリオドに入れ替える</span></span>
<span>                x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\."</span>, <span class="st">""</span>, <span class="va">lengths</span><span class="op">)</span>  <span class="co"># ピリオド（エスケープして指定）を削除する</span></span>
<span>                <span class="op">)</span></span>
<span>           <span class="op">)</span>                                  <span class="co"># 出力を数字ベクトルに変更</span></span></code></pre></div>
</div>
</div>
<div id="全て入れ替える" class="section level3 unnumbered">
<h3>全て入れ替える<a class="anchor" aria-label="anchor" href="#%E5%85%A8%E3%81%A6%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all()</a></code> は「検索と置換」ツールとして使用できます。検索する文字列、パターン、置き換える値をそれぞれ <code>string =</code>、<code>pattern =</code>、<code>replacement =</code> で指定します。 以下の例では、全ての “dead” を “deceased” に入れ替えます。大文字小文字が区別されることに注意してください。</p>
<div class="sourceCode" id="cb510"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Karl: dead"</span>,</span>
<span>            <span class="st">"Samantha: dead"</span>,</span>
<span>            <span class="st">"Marco: not dead"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">outcome</span>, pattern <span class="op">=</span> <span class="st">"dead"</span>, replacement <span class="op">=</span> <span class="st">"deceased"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "Karl: deceased"      "Samantha: deceased"  "Marco: not deceased"</code></pre>
<p>注釈：</p>
<ul>
<li>指定したパターンを <code>NA</code> で置き換えるには <code><a href="https://stringr.tidyverse.org/reference/str_replace_na.html">str_replace_na()</a></code> を用います。</li>
<li>
<code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace()</a></code> は与えられた各文字列中に現れる最初のパターンだけを入れ替えます。</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="パターンの有無による条件分岐" class="section level3 unnumbered">
<h3>パターンの有無による条件分岐<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AE%E6%9C%89%E7%84%A1%E3%81%AB%E3%82%88%E3%82%8B%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90"><i class="fas fa-link"></i></a>
</h3>
<p><strong><code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> との組み合わせ</strong></p>
<p><code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> は <strong>dplyr</strong> パッケージの <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> と組み合わせて用いられることが多いです。例として、<code>occupations</code> がラインリスト内の列であるとします。以下の <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> は <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> による条件分岐に従って新しい列 <code>is_educator</code> を作ります。<code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> についての詳細は、<a href="cleaning.html#cleaning">データクリーニングと主要関数</a> の章を参照してください。</p>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>is_educator <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="co"># occupation内でパターン検索（大文字小文字は区別しない）</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">occupations</span>,</span>
<span>               <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex</a></span><span class="op">(</span><span class="st">"teach|prof|tutor|university"</span>,</span>
<span>                     ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>              <span class="op">~</span> <span class="st">"Educator"</span>,</span>
<span>    <span class="co"># その他全て</span></span>
<span>    <span class="cn">TRUE</span>                                               <span class="op">~</span> <span class="st">"Not an educator"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>negate = F</code> を用いて除外したいパターンを指定できることも覚えておきましょう。</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="characters-strings.html#cb513-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb513-2"><a href="characters-strings.html#cb513-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 新しい列is_educatorの値を条件分岐により決定する</span></span>
<span id="cb513-3"><a href="characters-strings.html#cb513-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_educator =</span> <span class="fu">case_when</span>(</span>
<span id="cb513-4"><a href="characters-strings.html#cb513-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb513-5"><a href="characters-strings.html#cb513-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "Educator"の値を取るためには2つの基準を満たす必要がある：</span></span>
<span id="cb513-6"><a href="characters-strings.html#cb513-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 指定されたパターンを持ち、かつ除外されたパターンを持たない</span></span>
<span id="cb513-7"><a href="characters-strings.html#cb513-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb513-8"><a href="characters-strings.html#cb513-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 指定されたパターンを持つ</span></span>
<span id="cb513-9"><a href="characters-strings.html#cb513-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(occupations,</span>
<span id="cb513-10"><a href="characters-strings.html#cb513-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">regex</span>(<span class="st">"teach|prof|tutor|university"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">&amp;</span></span>
<span id="cb513-11"><a href="characters-strings.html#cb513-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb513-12"><a href="characters-strings.html#cb513-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 指定されたパターンを持たない</span></span>
<span id="cb513-13"><a href="characters-strings.html#cb513-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(occupations,</span>
<span id="cb513-14"><a href="characters-strings.html#cb513-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">regex</span>(<span class="st">"admin"</span>, <span class="at">ignore_case =</span> T),</span>
<span id="cb513-15"><a href="characters-strings.html#cb513-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">negate =</span> <span class="cn">TRUE</span>                        <span class="sc">~</span> <span class="st">"Educator"</span></span>
<span id="cb513-16"><a href="characters-strings.html#cb513-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb513-17"><a href="characters-strings.html#cb513-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 上記の条件を満たさない全ての行</span></span>
<span id="cb513-18"><a href="characters-strings.html#cb513-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                                            <span class="sc">~</span> <span class="st">"Not an educator"</span>))</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="パターンの位置を特定する" class="section level3 unnumbered">
<h3>パターンの位置を特定する<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AE%E4%BD%8D%E7%BD%AE%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p>指定したパターンが与えられた文字列中に<u>最初に</u>現れる位置を特定するためには、<code><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate()</a></code> を用います。パターンの最初と最後の文字の位置を返します。</p>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate</a></span><span class="op">(</span><span class="st">"I wish"</span>, <span class="st">"sh"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      start end
## [1,]     5   6</code></pre>
<p>その他の <code>str</code> 関数と同様、<code><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate()</a></code> にも “_all” バージョンが存在します（<code><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate_all()</a></code>）。与えられた各文字列中に現れるパターンの全ての位置を <code>list</code> 形式で返します。</p>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phrases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"I wish"</span>, <span class="st">"I hope"</span>, <span class="st">"he hopes"</span>, <span class="st">"He hopes"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate</a></span><span class="op">(</span><span class="va">phrases</span>, <span class="st">"h"</span> <span class="op">)</span>     <span class="co"># *最初に*現れるパターンの位置</span></span></code></pre></div>
<pre><code>##      start end
## [1,]     6   6
## [2,]     3   3
## [3,]     1   1
## [4,]     4   4</code></pre>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_locate.html">str_locate_all</a></span><span class="op">(</span><span class="va">phrases</span>, <span class="st">"h"</span> <span class="op">)</span> <span class="co"># *全ての*パターンの位置</span></span></code></pre></div>
<pre><code>## [[1]]
##      start end
## [1,]     6   6
## 
## [[2]]
##      start end
## [1,]     3   3
## 
## [[3]]
##      start end
## [1,]     1   1
## [2,]     4   4
## 
## [[4]]
##      start end
## [1,]     4   4</code></pre>
<!-- ======================================================= -->
</div>
<div id="一致したパターンを抽出する" class="section level3 unnumbered">
<h3>一致したパターンを抽出する<a class="anchor" aria-label="anchor" href="#%E4%B8%80%E8%87%B4%E3%81%97%E3%81%9F%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all()</a></code> はマッチしたパターンそのものを返します。これは “OR（<code>|</code>）” を用いて複数のパターンを検索したときに特に有用です。例えば、職業の文字列リスト（前のセクションを参照）内で “teach”、“prof”、“tutor” の<u>いずれかの</u>パターンに合致する単語を探したいとします。</p>
<p><code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all()</a></code> 与えられた文字列内の一致するパターン<u>全ての</u> <code>list</code> を返します。以下の例では、出力されたリストのうち 3 つ目の要素において 2 つのパターンが一致していることに注目してください。</p>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach|prof|tutor"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
## character(0)
## 
## [[2]]
## [1] "prof"
## 
## [[3]]
## [1] "teach" "tutor"
## 
## [[4]]
## [1] "tutor"
## 
## [[5]]
## character(0)
## 
## [[6]]
## character(0)
## 
## [[7]]
## character(0)
## 
## [[8]]
## character(0)
## 
## [[9]]
## character(0)
## 
## [[10]]
## character(0)</code></pre>
<p>一方、<code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract()</a></code> は<u>最初に一致したパターンのみ</u>を返します。従って、出力結果は与えられた各文字列に対して 1 つのパターンが文字ベクトルで返されます。 一致するパターンがない場合は <code>NA</code> が返されます。この <code>NA</code> は <code>str_extract</code> を <code><a href="https://rdrr.io/r/stats/na.fail.html">na.exclude()</a></code> で包むことで消去することもできます。以下の例では、3 つ目の文字列の 2 つ目の一致パターンが表示されないことに注意してください。</p>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach|prof|tutor"</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] NA      "prof"  "teach" "tutor" NA      NA      NA      NA      NA     
## [10] NA</code></pre>
<!-- ======================================================= -->
</div>
<div id="サブセットと数え上げ" class="section level3 unnumbered">
<h3>サブセットと数え上げ<a class="anchor" aria-label="anchor" href="#%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E3%81%A8%E6%95%B0%E3%81%88%E4%B8%8A%E3%81%92"><i class="fas fa-link"></i></a>
</h3>
<p>ここでは <code><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset()</a></code> と <code><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count()</a></code> を扱います。</p>
<p><code><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset()</a></code> は一致したパターンだけでなく、そのパターンを含む文字列全体を返します：</p>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach|prof|tutor"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "university professor"           "primary school teacher &amp; tutor"
## [3] "tutor"</code></pre>
<p><code><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count()</a></code> は検索した文字列中に指定したパターンが現れる<strong>合計回数</strong>をベクトルで返します。</p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html">str_count</a></span><span class="op">(</span><span class="va">occupations</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex</a></span><span class="op">(</span><span class="st">"teach|prof|tutor"</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] 0 1 2 1 0 0 0 0 0 0</code></pre>
<!-- ======================================================= -->
</div>
<div id="正規表現グループ" class="section level3 unnumbered">
<h3>正規表現グループ<a class="anchor" aria-label="anchor" href="#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97"><i class="fas fa-link"></i></a>
</h3>
<p>作成中</p>
<!-- ======================================================= -->
</div>
</div>
<div id="特殊文字" class="section level2" number="10.6">
<h2>
<span class="header-section-number">10.6</span> 特殊文字<a class="anchor" aria-label="anchor" href="#%E7%89%B9%E6%AE%8A%E6%96%87%E5%AD%97"><i class="fas fa-link"></i></a>
</h2>
<p><strong>バックスラッシュ <code>\</code> によるエスケープ</strong></p>
<p>バックスラッシュ <code>\</code> はその直後に現れる文字の意味を「エスケープ」するために使われます。例えば、二重引用符の中で使用されている引用符の前にバックスラッシュを置くと（<code>\"</code>）、その引用符が二重引用符の<em>中で</em>表示されます。その際、中で挟まれる引用符はそれを囲む引用符とは干渉しません。</p>
<p>注釈：バックスラッシュを<u>文字として表示したい</u>場合は、その前に<u>もう 1 つの</u>バックスラッシュを置いて、エスケープ記号としての役割を回避する必要があります。つまり、<code>\\</code> と書くことでバックスラッシュを1 つ表示できます。</p>
<p><strong>特殊文字の例</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>特殊文字</th>
<th>意味</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"\\"</code></td>
<td>バックスラッシュ</td>
</tr>
<tr class="even">
<td><code>"\n"</code></td>
<td>改行</td>
</tr>
<tr class="odd">
<td><code>"\""</code></td>
<td>
<u>二重引用符中での</u>二重引用符の表示</td>
</tr>
<tr class="even">
<td><code>'\''</code></td>
<td>
<u>一重引用符中での</u>一重引用符の表示</td>
</tr>
<tr class="odd">
<td><code>"\`"</code></td>
<td>バッククオート</td>
</tr>
<tr class="even">
<td><code>"\r"</code></td>
<td>キャリッジリターン</td>
</tr>
<tr class="odd">
<td><code>"\t"</code></td>
<td>タブ</td>
</tr>
<tr class="even">
<td><code>"\v"</code></td>
<td>バーティカルタブ</td>
</tr>
<tr class="odd">
<td><code>"\b"</code></td>
<td>バックスペース</td>
</tr>
</tbody>
</table></div>
<p><code><a href="https://rdrr.io/r/base/Quotes.html">?"'"</a></code> コマンドを R コンソールで実行すると、特殊文字の一覧が表示できます（RStudio ではヘルプ画面に表示されます）。</p>
<!-- ======================================================= -->
</div>
<div id="正規表現-regex" class="section level2" number="10.7">
<h2>
<span class="header-section-number">10.7</span> 正規表現 (regex)<a class="anchor" aria-label="anchor" href="#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE-regex"><i class="fas fa-link"></i></a>
</h2>
<!-- ======================================================= -->
</div>
<div id="正規表現と特殊文字" class="section level2" number="10.8">
<h2>
<span class="header-section-number">10.8</span> 正規表現と特殊文字<a class="anchor" aria-label="anchor" href="#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E3%81%A8%E7%89%B9%E6%AE%8A%E6%96%87%E5%AD%97"><i class="fas fa-link"></i></a>
</h2>
<p>正規表現（または regex）とは、文字列パターンを記述するために用いられる言語規則のことです。馴染みがない人にとっては、まるで他の星の言葉のように映るかもしれません。ここでは、その正規表現に対するハードルを少し下げることを目標にします。</p>
<p><u>このセクションで扱う内容の多くは <a href="https://towardsdatascience.com/a-gentle-introduction-to-regular-expressions-with-r-df5e897ca432">こちらのチュートリアル</a> と <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">こちらのチートシート</a> を参考に作成されました。</u>ここでは、このハンドブックがインターネットへのアクセスが無く他のチュートリアルを見れない方からも利用されうることを念頭に、これらの参考文献から内容を選んで参考にしています。</p>
<p>正規表現は<u>決まった構造を持たない</u>文章（例えば、診療録、主訴、既往歴やデータフレーム中の文字列など）から特定のパターンを抜き出すためによく使われます。</p>
<p>正規表現を構築するために使われる基本ツールは以下の 4 つです。</p>
<ol style="list-style-type: decimal">
<li>文字セット</li>
<li>メタ文字</li>
<li>数量詞</li>
<li>グループ</li>
</ol>
<p><strong>文字セット</strong></p>
<p>文字セットは角括弧 <code>[ ]</code> を用いて文字のリストを表現します。角括弧中に含まれる文字のいずれかが対象の文字列中に含まれる場合、一致パターンとして扱われます。例えば、母音のいずれかを検索したい場合 “[aeiou]” と表現できます。以下によく使われる文字セットを示します。</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>文字セット</th>
<th>検索される文字</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"[A-Z]"</code></td>
<td>全ての大文字アルファベット</td>
</tr>
<tr class="even">
<td><code>"[a-z]"</code></td>
<td>全ての小文字アルファベット</td>
</tr>
<tr class="odd">
<td><code>"[0-9]"</code></td>
<td>全ての数字</td>
</tr>
<tr class="even">
<td><code>[:alnum:]</code></td>
<td>全てのアルファベットおよび数字</td>
</tr>
<tr class="odd">
<td><code>[:digit:]</code></td>
<td>全ての数字</td>
</tr>
<tr class="even">
<td><code>[:alpha:]</code></td>
<td>全ての大文字および小文字アルファベット</td>
</tr>
<tr class="odd">
<td><code>[:upper:]</code></td>
<td>全ての大文字アルファベット</td>
</tr>
<tr class="even">
<td><code>[:lower:]</code></td>
<td>全ての小文字アルファベット</td>
</tr>
</tbody>
</table></div>
<p>複数の文字セットを 1 つの角括弧中に（空白なしで！）組み合わせることができます。例えば <code>"[A-Za-z]"</code> は全ての大文字および小文字アルファベットを、<code>"[t-z0-5]"</code> は t から z までの小文字アルファベットと 0 から 5 までの数字を表します。</p>
<p><strong>メタ文字</strong></p>
<p>メタ文字は文字セットの省略表記です。以下にいくつかの重要な例を示します：</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>メタ文字</th>
<th>検索される文字</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"\\s"</code></td>
<td>1 つの空白</td>
</tr>
<tr class="even">
<td><code>"\\w"</code></td>
<td>全てのアルファベットおよび数字（A-Z、a-z、または 0-9）</td>
</tr>
<tr class="odd">
<td><code>"\\d"</code></td>
<td>全ての数字（0-9）</td>
</tr>
</tbody>
</table></div>
<p><strong>数量詞</strong></p>
<p>多くの場合、検索したいパターンは 2 つ以上の文字を含みます。数量詞により一致を探す文字や数字の長さを規定できます。</p>
<p>数量詞は数を指定したいパターンの<u>後に</u>波括弧 <code><a href="https://rdrr.io/r/base/Paren.html">{ }</a></code> を置き、その中に数字を書くことで定義されます。 例えば、</p>
<ul>
<li>
<code>"A{2}"</code> は大文字 A <strong>2 つ</strong>を示します。<br>
</li>
<li>
<code>"A{2,4}"</code> は <strong>2 から 4 つの</strong>大文字 A を示します（波括弧中に空白は置かれません！）。<br>
</li>
<li>
<code>"A{2,}"</code> は <strong>2 つ以上の</strong>大文字 A を示します。</li>
<li>
<code>"A+"</code> は <strong>1 つ以上の</strong>大文字 A を示します（他の文字が現れるまで、連続した A は全てグループに含まれます）。</li>
<li>アスタリスク <code>*</code> を前におくと <strong>0 個以上の</strong>という意味が付加されます（そのパターンが存在するか不確かなときに有用です）。</li>
</ul>
<p><code>+</code> シンボルを使うと、他の文字が出てくるまでの連続した同一の文字が全て一致するパターンとして扱われます。例えば、<code>"[A-Za-z]+"</code> という表現は全ての単語（アルファベットのみでできた文字列）に対応します。</p>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 数量詞をテストするための文字列</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="st">"A-AA-AAA-AAAA"</span></span></code></pre></div>
<p>数量詞 {2} を用いた場合、2 つ続きの A のみがマッチとして扱われます。<code>AAAA</code> からは 2 つのマッチが返されます。</p>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">test</span>, <span class="st">"A{2}"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] "AA" "AA" "AA" "AA"</code></pre>
<p>数量詞 {2,4} を用いた場合、2 つから 4 つ続きの A がマッチとして扱われます。</p>
<div class="sourceCode" id="cb531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">test</span>, <span class="st">"A{2,4}"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] "AA"   "AAA"  "AAAA"</code></pre>
<p>数量詞 <code>+</code> を用いた場合、<strong>1 つ以上の</strong>連続した A がマッチとして扱われます：</p>
<div class="sourceCode" id="cb533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">test</span>, <span class="st">"A+"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
## [1] "A"    "AA"   "AAA"  "AAAA"</code></pre>
<p><strong>相対的位置</strong></p>
<p>ここで紹介する構文を用いることで、探したいパターンの直前または直後に来る文字ないしはパターンを指定することができます。例えば、「ピリオドが直後に来る 2 つ続きの数字」というパターンを表現したいときは (?&lt;=\.)\s(?=[A-Z])</p>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">test</span>, <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
##  [1] "A" "-" "A" "A" "-" "A" "A" "A" "-" "A" "A" "A" "A"</code></pre>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>位置構文</th>
<th>マッチするパターン</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"(?&lt;=b)a"</code></td>
<td>“b” が<strong>直前に来る</strong> “a”</td>
</tr>
<tr class="even">
<td><code>"(?&lt;!b)a"</code></td>
<td>“b” が<strong>直前に来ない</strong> “a”</td>
</tr>
<tr class="odd">
<td><code>"a(?=b)"</code></td>
<td>“b” が<strong>直後に来る</strong> “a”</td>
</tr>
<tr class="even">
<td><code>"a(?!b)"</code></td>
<td>“b” が<strong>直後に来ない</strong> “a”</td>
</tr>
</tbody>
</table></div>
<p><strong>グループ</strong></p>
<p>正規表現の中でグループを用いることで、パターン検索をより整理された形で行うことができます。</p>
<p><strong>正規表現の例</strong></p>
<p>ここでは、以下の文章から正規表現を用いて有用な情報を抽出する例を示します。</p>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt_note</span> <span class="op">&lt;-</span> <span class="st">"Patient arrived at Broward Hospital emergency ward at 18:00 on 6/12/2005. Patient presented with radiating abdominal pain from LR quadrant. Patient skin was pale, cool, and clammy. Patient temperature was 99.8 degrees farinheit. Patient pulse rate was 100 bpm and thready. Respiratory rate was 29 per minute."</span></span></code></pre></div>
<p>以下の正規表現は、全ての単語（連続したアルファベットのみからなるまとまり）を抽出します。</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">pt_note</span>, <span class="st">"[A-Za-z]+"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
##  [1] "Patient"     "arrived"     "at"          "Broward"     "Hospital"   
##  [6] "emergency"   "ward"        "at"          "on"          "Patient"    
## [11] "presented"   "with"        "radiating"   "abdominal"   "pain"       
## [16] "from"        "LR"          "quadrant"    "Patient"     "skin"       
## [21] "was"         "pale"        "cool"        "and"         "clammy"     
## [26] "Patient"     "temperature" "was"         "degrees"     "farinheit"  
## [31] "Patient"     "pulse"       "rate"        "was"         "bpm"        
## [36] "and"         "thready"     "Respiratory" "rate"        "was"        
## [41] "per"         "minute"</code></pre>
<p>正規表現 <code>"[0-9]{1,2}"</code> は 1 つのみもしくは 2 つ続きの数字にマッチします。<code>"\\d{1,2}"</code> もしくは <code>"[:digit:]{1,2}"</code> と書くこともできます。</p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">pt_note</span>, <span class="st">"[0-9]{1,2}"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [[1]]
##  [1] "18" "00" "6"  "12" "20" "05" "99" "8"  "10" "0"  "29"</code></pre>
<!-- This expression will extract all sentences (assuming first letter is capitalized, and the sentence ends with a period). The pattern reads in English as: "A capital letter followed by some lowercase letters, a space, some letters, a space,     -->
<!-- ```{r} -->
<!-- str_extract_all(pt_note, "[A-Z][a-z]+\\s\\w+\\s\\d{1,2}\\s\\w+\\s*\\w*") -->
<!-- ``` -->
<p><a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">こちらのチートシート</a> の 2 ページ目に、有用な正規表現のリストやヒントがありますので、参照してください。</p>
<p><a href="https://towardsdatascience.com/a-gentle-introduction-to-regular-expressions-with-r-df5e897ca432">こちらのチュートリアル</a> も参考にしてください。</p>
<!-- ======================================================= -->
</div>
<div id="参考資料-3" class="section level2" number="10.9">
<h2>
<span class="header-section-number">10.9</span> 参考資料<a class="anchor" aria-label="anchor" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-3"><i class="fas fa-link"></i></a>
</h2>
<p><strong>stringr</strong> に含まれる関数の詳細は <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">こちら</a> を参照してください。</p>
<p><strong>stringr</strong> に関する簡単な説明は <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html">こちら</a> から読むことができます。</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></div>
<div class="next"><a href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#characters-strings"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li>
<a class="nav-link" href="#%E6%BA%96%E5%82%99-1"><span class="header-section-number">10.1</span> 準備</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-2">パッケージの読み込み</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF">データの読み込み</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E7%B5%90%E5%90%88%E5%88%86%E5%89%B2%E9%85%8D%E5%88%97"><span class="header-section-number">10.2</span> 結合、分割、配列</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E7%B5%90%E5%90%88">文字列の結合</a></li>
<li><a class="nav-link" href="#%E5%8B%95%E7%9A%84%E6%96%87%E5%AD%97%E5%88%97">動的文字列</a></li>
<li><a class="nav-link" href="#str_unite">列の結合</a></li>
<li><a class="nav-link" href="#%E5%88%86%E5%89%B2">分割</a></li>
<li><a class="nav-link" href="#%E5%88%97%E3%81%AE%E5%88%86%E5%89%B2">列の分割</a></li>
<li><a class="nav-link" href="#%E3%82%A2%E3%83%AB%E3%83%95%E3%82%A1%E3%83%99%E3%83%83%E3%83%88%E9%A0%86%E3%81%AB%E4%B8%A6%E3%81%B9%E3%82%8B">アルファベット順に並べる</a></li>
<li><a class="nav-link" href="#r-%E3%81%AE%E5%9F%BA%E6%9C%AC%E9%96%A2%E6%95%B0">R の基本関数</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E6%95%B4%E7%90%86%E3%81%A8%E6%A8%99%E6%BA%96%E5%8C%96"><span class="header-section-number">10.3</span> 整理と標準化</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%A4%A7%E6%96%87%E5%AD%97%E5%B0%8F%E6%96%87%E5%AD%97%E3%81%AE%E5%A4%89%E6%9B%B4">大文字小文字の変更</a></li>
<li><a class="nav-link" href="#str_pad">文字列を伸長する</a></li>
<li><a class="nav-link" href="#%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E7%9F%AD%E7%B8%AE%E3%81%99%E3%82%8B">文字列を短縮する</a></li>
<li><a class="nav-link" href="#%E9%95%B7%E3%81%95%E3%81%AE%E6%A8%99%E6%BA%96%E5%8C%96">長さの標準化</a></li>
<li><a class="nav-link" href="#%E5%85%88%E9%A0%AD%E6%9C%AB%E5%B0%BE%E3%81%AE%E7%A9%BA%E7%99%BD%E3%82%92%E5%89%8A%E9%99%A4%E3%81%99%E3%82%8B">先頭・末尾の空白を削除する</a></li>
<li><a class="nav-link" href="#%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%95%E3%82%8C%E3%82%8B%E7%A9%BA%E7%99%BD%E3%81%AE%E5%89%8A%E9%99%A4">繰り返される空白の削除</a></li>
<li><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E3%81%AE%E6%96%87%E5%AD%97%E6%95%B0%E3%81%A7%E6%96%87%E7%AB%A0%E3%82%92%E6%94%B9%E8%A1%8C%E3%81%99%E3%82%8B">指定の文字数で文章を改行する</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E4%BD%8D%E7%BD%AE%E3%81%AB%E3%82%88%E3%82%8B%E6%93%8D%E4%BD%9C"><span class="header-section-number">10.4</span> 位置による操作</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E4%BD%8D%E7%BD%AE%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E6%96%87%E5%AD%97%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B">位置を指定して文字を抽出する</a></li>
<li><a class="nav-link" href="#%E4%BD%8D%E7%BD%AE%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E5%8D%98%E8%AA%9E%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B">位置を指定して単語を抽出する</a></li>
<li><a class="nav-link" href="#%E4%BD%8D%E7%BD%AE%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%97%E3%81%A6%E6%96%87%E5%AD%97%E3%82%92%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B">位置を指定して文字を入れ替える</a></li>
<li><a class="nav-link" href="#%E9%95%B7%E3%81%95%E3%82%92%E8%A9%95%E4%BE%A1%E3%81%99%E3%82%8B">長さを評価する</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><span class="header-section-number">10.5</span> パターン</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%82%92%E8%A6%8B%E3%81%A4%E3%81%91%E3%82%8B">パターンを見つける</a></li>
<li><a class="nav-link" href="#%E5%85%A8%E3%81%A6%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B">全て入れ替える</a></li>
<li><a class="nav-link" href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AE%E6%9C%89%E7%84%A1%E3%81%AB%E3%82%88%E3%82%8B%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90">パターンの有無による条件分岐</a></li>
<li><a class="nav-link" href="#%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AE%E4%BD%8D%E7%BD%AE%E3%82%92%E7%89%B9%E5%AE%9A%E3%81%99%E3%82%8B">パターンの位置を特定する</a></li>
<li><a class="nav-link" href="#%E4%B8%80%E8%87%B4%E3%81%97%E3%81%9F%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%82%92%E6%8A%BD%E5%87%BA%E3%81%99%E3%82%8B">一致したパターンを抽出する</a></li>
<li><a class="nav-link" href="#%E3%82%B5%E3%83%96%E3%82%BB%E3%83%83%E3%83%88%E3%81%A8%E6%95%B0%E3%81%88%E4%B8%8A%E3%81%92">サブセットと数え上げ</a></li>
<li><a class="nav-link" href="#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97">正規表現グループ</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E7%89%B9%E6%AE%8A%E6%96%87%E5%AD%97"><span class="header-section-number">10.6</span> 特殊文字</a></li>
<li><a class="nav-link" href="#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE-regex"><span class="header-section-number">10.7</span> 正規表現 (regex)</a></li>
<li><a class="nav-link" href="#%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE%E3%81%A8%E7%89%B9%E6%AE%8A%E6%96%87%E5%AD%97"><span class="header-section-number">10.8</span> 正規表現と特殊文字</a></li>
<li><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-3"><span class="header-section-number">10.9</span> 参考資料</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>疫学のための R ハンドブック</strong>" was written by the handbook team. It was last built on 2023-01-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>19 単変量と多変量回帰 | 疫学のための R ハンドブック</title>
<meta name="author" content="the handbook team">
<meta name="description" content="この章では、変数間の関連性（オッズ比、リスク比、ハザード比など）を調べるために、glm() といった base R の基本的な回帰関数と gtsummary パッケージの使い方を説明します。また、broom パッケージの tidy() のような関数を使用して、回帰の出力を整えます。 単変量: 2 ×2 表 層別：Mantel-Haenszel 推定...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="19 単変量と多変量回帰 | 疫学のための R ハンドブック">
<meta property="og:type" content="book">
<meta property="og:description" content="この章では、変数間の関連性（オッズ比、リスク比、ハザード比など）を調べるために、glm() といった base R の基本的な回帰関数と gtsummary パッケージの使い方を説明します。また、broom パッケージの tidy() のような関数を使用して、回帰の出力を整えます。 単変量: 2 ×2 表 層別：Mantel-Haenszel 推定...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="19 単変量と多変量回帰 | 疫学のための R ハンドブック">
<meta name="twitter:description" content="この章では、変数間の関連性（オッズ比、リスク比、ハザード比など）を調べるために、glm() といった base R の基本的な回帰関数と gtsummary パッケージの使い方を説明します。また、broom パッケージの tidy() のような関数を使用して、回帰の出力を整えます。 単変量: 2 ×2 表 層別：Mantel-Haenszel 推定...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script type="text/javascript">
        // window.addEventListener("load", function() {
        //     document.getElementById('toc').firstChild.innerHTML = "章目次"; 
        // });
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementsByClassName("d-flex align-items-start justify-content-between")[0].children[0].children[0].innerHTML = "疫学のための R</br>ハンドブック";
            document.getElementById('toc').firstChild.innerHTML = "章目次"; 
            document.getElementById('main-nav').children[1].firstChild.innerHTML = "総目次";
            document.getElementById('search').setAttribute("placeholder", "検索");
        });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">疫学のための R ハンドブック</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">本書について</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> 編集前記・技術注記</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> ハンドブックとデータのダウンロード</a></li>
<li class="book-part">基本編</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R の基礎</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Excel・Stata・SASとの比較</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> 推奨パッケージ</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R プロジェクト</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> データのインポート・エクスポート</a></li>
<li class="book-part">データマネジメント</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> データクリーニングと主要関数</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> データのグループ化</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> 重複データの排除</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> ループと反復処理・リストの操作</a></li>
<li class="book-part">データ分析</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> 記述統計表の作り方</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></li>
<li><a class="active" href="regression.html"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> 標準化率</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> 移動平均</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> 時系列分析とアウトブレイクの検出</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> エピデミックモデリング</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></li>
<li class="book-part">データの可視化</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> 流行曲線（エピカーブ）</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> 人口ピラミッドとリッカート尺度</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> 感染連鎖</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> 系統樹</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></li>
<li class="book-part">レポートとダッシュボード</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> R Markdownで作るダッシュボード</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny で作るダッシュボード</a></li>
<li class="book-part">その他</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> 関数の作成</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> ディレクトリの操作</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Git と Github を使ったバージョン管理と共同作業</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> よくあるエラー</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> ヘルプ</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> ネットワークドライブで R を使用する場合</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table パッケージを使用したデータ処理</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="regression" class="section level1" number="19">
<h1>
<span class="header-section-number">19</span> 単変量と多変量回帰<a class="anchor" aria-label="anchor" href="#regression"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<p>この章では、変数間の関連性（オッズ比、リスク比、ハザード比など）を調べるために、<code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> といった <strong>base</strong> R の基本的な回帰関数と <strong>gtsummary</strong> パッケージの使い方を説明します。また、<strong>broom</strong> パッケージの <code>tidy()</code> のような関数を使用して、回帰の出力を整えます。</p>
<ol style="list-style-type: decimal">
<li>単変量: 2 ×2 表</li>
<li>層別：Mantel-Haenszel 推定</li>
<li>多変量：変数選択、モデル選択、最終的な結果の表</li>
<li>フォレストプロット</li>
</ol>
<p>Cox 比例ハザード回帰分析については、<a href="survival-analysis.html#survival-analysis">生存時間解析</a>を参照してください。</p>
<p><span style="color: black;"><u><strong>注釈:</strong></u> この章では、複数の説明変数を持つ回帰を<u>多変量（multivariable）</u>と呼びます。この意味で、<u>多変数（multivariate）</u>モデルは、複数のアウトカムを持つ回帰を示します。より詳しくは、アメリカ公衆衛生学会誌に掲載された<a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3518362/">論説</a>を参照してください。</span></p>
<!-- ======================================================= -->
<div id="準備-10" class="section level2" number="19.1">
<h2>
<span class="header-section-number">19.1</span> 準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-10"><i class="fas fa-link"></i></a>
</h2>
<div id="パッケージの読み込み-8" class="section level3 unnumbered">
<h3>パッケージの読み込み<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-8"><i class="fas fa-link"></i></a>
</h3>
<p>以下のコードを実行すると、分析に必要なパッケージが読み込まれます。このハンドブックでは、パッケージを読み込むために、<strong>pacman</strong> パッケージの <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> を主に使用しています。<code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> は、必要に応じてパッケージをインストールし、現在の R セッションで使用するためにパッケージを読み込む関数です。また、すでにインストールされたパッケージは、R の基本パッケージである <strong>base</strong> の <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> を使用して読み込むこともできます。R のパッケージに関する詳細は <a href="basics.html#basics">R の基本</a> の章をご覧ください。</p>
<div class="sourceCode" id="cb959"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>,          <span class="co"># ファイルのインポート</span></span>
<span>  <span class="va">here</span>,         <span class="co"># ファイルパスの指定</span></span>
<span>  <span class="va">tidyverse</span>,    <span class="co"># データ管理と ggplot2 での可視化</span></span>
<span>  <span class="va">stringr</span>,      <span class="co"># テキストの編集 </span></span>
<span>  <span class="va">purrr</span>,        <span class="co"># tidy な方法でのオブジェクトの反復</span></span>
<span>  <span class="va">gtsummary</span>,    <span class="co"># 統計量や検定の要約 </span></span>
<span>  <span class="va">broom</span>,        <span class="co"># 回帰の結果を整然化</span></span>
<span>  <span class="va">lmtest</span>,       <span class="co"># 尤度比検定</span></span>
<span>  <span class="va">parameters</span>,   <span class="co"># 回帰の結果を整然化するための代替手段</span></span>
<span>  <span class="va">see</span>           <span class="co"># フォレストプロットを可視化するための代替手段</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div id="データの読み込み-1" class="section level3 unnumbered">
<h3>データの読み込み<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-1"><i class="fas fa-link"></i></a>
</h3>
<p>エボラ出血熱の流行をシミュレートしたデータセットをインポートします。お手元の環境でこの章の内容を実行したい方は、 <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds" class="download-button">クリック</a>して「前処理された」ラインリスト（linelist）データをダウンロードしてください&gt;（.rds 形式で取得できます）。データは <strong>rio</strong> パッケージの <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> を利用してインポートしましょう（<strong>rio</strong> パッケージは、.xlsx、.csv、.rds など様々な種類のファイルを取り扱うことができます。詳細は、<a href="importing.html#importing">インポートとエクスポート</a> の章をご覧ください。）</p>
<div class="sourceCode" id="cb960"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ラインリストのインポート</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
<p>ラインリストの始めの 50 行は次のように表示されます。</p>
<div id="htmlwidget-8ff8731f5b4a3072e121" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8ff8731f5b4a3072e121">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="データの前処理-1" class="section level3 unnumbered">
<h3>データの前処理<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%89%8D%E5%87%A6%E7%90%86-1"><i class="fas fa-link"></i></a>
</h3>
<div id="説明変数を保存" class="section level4 unnumbered">
<h4>説明変数を保存<a class="anchor" aria-label="anchor" href="#%E8%AA%AC%E6%98%8E%E5%A4%89%E6%95%B0%E3%82%92%E4%BF%9D%E5%AD%98"><i class="fas fa-link"></i></a>
</h4>
<p>説明変数の列名を文字ベクトルとして保存します。この文字ベクトルは後で使用します。</p>
<div class="sourceCode" id="cb961"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 関心のある変数を定義</span></span>
<span><span class="va">explanatory_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gender"</span>, <span class="st">"fever"</span>, <span class="st">"chills"</span>, <span class="st">"cough"</span>, <span class="st">"aches"</span>, <span class="st">"vomit"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="と-0-に変換" class="section level4 unnumbered">
<h4>1 と 0 に変換<a class="anchor" aria-label="anchor" href="#%E3%81%A8-0-%E3%81%AB%E5%A4%89%E6%8F%9B"><i class="fas fa-link"></i></a>
</h4>
<p>以下では、説明変数の列（はい・いいえ（“yes”/“no”）、男性・女性（“m”/“f”）と死亡・生存（“dead”/“alive”））をロジスティック回帰モデルの解析がうまくいく形（<strong>1 / 0</strong>）へ変換します。これを効率的に行うために、<strong>dplyr</strong> パッケージの <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> を使って、複数の列を一度に変換します。それぞれの列に適用する関数は <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> （この関数も <strong>dplyr</strong> パッケージ）です。この関数は、特定の変数に対して 1 と 0 に変換するロジックを適用する。<code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> と <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> については<a href="cleaning.html#cleaning">データクリーニングと主要関数</a>の章を参照してください。</p>
<p>注釈: 下記コード中の「.」は、ある時点で <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> 処理されている列を表します。</p>
<div class="sourceCode" id="cb962"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 2 値変数（yes/no などが格納されている変数）を 0/1 に変換</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>                                      </span>
<span>    .cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">explanatory_vars</span>, <span class="st">"outcome"</span><span class="op">)</span><span class="op">)</span>,  <span class="co">## 各列と「アウトカム」に対する処理であることを指定</span></span>
<span>    .fns <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>                              </span>
<span>      <span class="va">.</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"yes"</span>, <span class="st">"Death"</span><span class="op">)</span>   <span class="op">~</span> <span class="fl">1</span>,           <span class="co">## 男性、はい、死亡を 1 に変換</span></span>
<span>      <span class="va">.</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"no"</span>,  <span class="st">"Recover"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>,           <span class="co">## 女性、いいえ、回復を 0 に変換</span></span>
<span>      <span class="cn">TRUE</span>                            <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span>    <span class="co">## それ以外は欠測値に変換</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div id="欠測値のある行を削除" class="section level4 unnumbered">
<h4>欠測値のある行を削除<a class="anchor" aria-label="anchor" href="#%E6%AC%A0%E6%B8%AC%E5%80%A4%E3%81%AE%E3%81%82%E3%82%8B%E8%A1%8C%E3%82%92%E5%89%8A%E9%99%A4"><i class="fas fa-link"></i></a>
</h4>
<p>欠測値を含む行を削除するために、<strong>tidyr</strong> パッケージの関数の <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> が使用できます。しかし、この処理を行いたいのは、対象となる列の値に欠測がある時だけです。</p>
<p>まず行わなければいけないことは、先に作成した <code>explanatory_vars</code> ベクトルに列 <code>age</code> が含まれるか確認することです（前述の <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code> 操作は 2 値変数のみに対応しているため、<code>age</code> はエラーになります）。次に、<code>linelist</code> を <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code> に渡して、<code>outcome</code> 列や <code>explanatory_vars</code> のいずれかで値が欠測している行を削除します。</p>
<p>コードを実行する前に、<code>linelist</code> オブジェクトの行数は <code>nrow(linelist)</code> で確認できます。</p>
<div class="sourceCode" id="cb963"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## age_category を説明変数に追加 </span></span>
<span><span class="va">explanatory_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">explanatory_vars</span>, <span class="st">"age_cat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 対象となる変数の情報が欠測している行を削除</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"outcome"</span>, <span class="va">explanatory_vars</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>linelist</code> オブジェクトに残っている行数は <code>nrow(linelist)</code> で確認できます。</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="単変量" class="section level2" number="19.2">
<h2>
<span class="header-section-number">19.2</span> 単変量<a class="anchor" aria-label="anchor" href="#%E5%8D%98%E5%A4%89%E9%87%8F"><i class="fas fa-link"></i></a>
</h2>
<p><a href="tables-descriptive.html#tables-descriptive">記述統計表の作り方</a>の章と同様に、事例によって使用する R パッケージが決まります。ここでは単変量解析を行うための 2 つのオプションを紹介します。</p>
<ul>
<li>
<strong>base</strong> R で利用可能な関数を使用して、結果をすぐにコンソールに表示します。また、<strong>broom</strong> パッケージを使用して、出力を整然化します。</li>
<li>モデルに対して <strong>gtsummary</strong> パッケージを使用して、出版原稿レベルの出力を得ます。</li>
</ul>
<!-- ======================================================= --><div id="base-r-3" class="section level3 unnumbered">
<h3>
<strong>base</strong> R<a class="anchor" aria-label="anchor" href="#base-r-3"><i class="fas fa-link"></i></a>
</h3>
<div id="線形回帰" class="section level4 unnumbered">
<h4>線形回帰<a class="anchor" aria-label="anchor" href="#%E7%B7%9A%E5%BD%A2%E5%9B%9E%E5%B8%B0"><i class="fas fa-link"></i></a>
</h4>
<p><strong>base</strong> R 関数の <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> は線形回帰を実行し、連続尺度の応答と説明変数との関連を、線形の関係があるという仮定のもとで評価します。</p>
<p>式を応答と説明変数の列名をチルダ（~）で分けた formula として与え、利用するデータを <code>data =</code> で指定しましょう。後で利用するために、実行結果のモデルを R オブジェクトとして定義しておきます。</p>
<div class="sourceCode" id="cb964"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">ht_cm</span> <span class="op">~</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
<p>そうすると、 <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> をモデルの結果に対して実行することができ、回帰係数（推定値）、P 値、残差などの統計指標を確認することができます。</p>
<div class="sourceCode" id="cb965"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_results</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ht_cm ~ age, data = linelist)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -128.579  -15.854    1.177   15.887  175.483 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  69.9051     0.5979   116.9   &lt;2e-16 ***
## age           3.4354     0.0293   117.2   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 23.75 on 4165 degrees of freedom
## Multiple R-squared:  0.7675, Adjusted R-squared:  0.7674 
## F-statistic: 1.375e+04 on 1 and 4165 DF,  p-value: &lt; 2.2e-16</code></pre>
<p><code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> の代わりに、<strong>broom</strong> パッケージの <code>tidy()</code> を使って、結果を表にまとめることもできます。結果より、年齢が 1 歳上がるごとに身長が 3.5 cm ずつ高くなり、これは統計的にも有意であることがわかりました。</p>
<div class="sourceCode" id="cb967"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tidy</span><span class="op">(</span><span class="va">lm_results</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   term        estimate std.error statistic p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)    69.9     0.598       117.       0
## 2 age             3.44    0.0293      117.       0</code></pre>
<p>この回帰の結果を <strong>ggplot</strong> パッケージを使って表すこともできます。これを行うためには、まず <strong>broom</strong> パッケージの <code>argument()</code> を使って、観測データ点とモデルに当てはめた直線を 1 つのデータフレームに取り込みます。</p>
<div class="sourceCode" id="cb969"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 回帰した点と観測データを 1 つのデータフレームにまとめる</span></span>
<span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu">augment</span><span class="op">(</span><span class="va">lm_results</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 年齢を x 軸としてプロット</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">points</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## 身長を追加</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">ht_cm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## 得られた回帰直線を追加</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/lin_reg_res_plot-1.png" width="672"></div>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> を使って、<strong>ggplot</strong> パッケージに単純な線形回帰の直線を追加することも可能です。</p>
<div class="sourceCode" id="cb970"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## データをプロット</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">ht_cm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## 観測データを表示</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## 回帰直線を追加</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="_main_files/figure-html/geom_smooth-1.png" width="672"></div>
<p>より詳細なチュートリアルは、この章の最後にある参考資料を参照してください。</p>
</div>
<div id="ロジスティック回帰" class="section level4 unnumbered">
<h4>ロジスティック回帰<a class="anchor" aria-label="anchor" href="#%E3%83%AD%E3%82%B8%E3%82%B9%E3%83%86%E3%82%A3%E3%83%83%E3%82%AF%E5%9B%9E%E5%B8%B0"><i class="fas fa-link"></i></a>
</h4>
<p><strong>stats</strong> パッケージ（<strong>base</strong> R の一部）の <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> は、一般化線形モデル（GLM: Generalized Linear Models）のあてはめに使われます。</p>
<p><code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> は単変量および多変量のロジスティック回帰に使われます（例えば、オッズ比が得られる）。核となる部分は次の通りです。</p>
<div class="sourceCode" id="cb972"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># glm() の引数</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">family</span>, <span class="va">data</span>, <span class="va">weights</span>, <span class="va">subset</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<code>formula =</code> モデルは、アウトカムを左に説明変数をチルダの右に配置した式として <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> に設定されます。</li>
<li>
<code>family =</code> この引数は実行するモデルのタイプを決めます。ロジスティック回帰の場合は <code>family = "binomial"</code> を、ポアソン回帰の場合は <code>family = "poisson"</code> を使います。他の例は下の表に示します。</li>
<li>
<code>data =</code> 使用するデータフレームを設定します。</li>
</ul>
<p>必要であれば、<code>family = familytype(link = "linkfunction"))</code> 構文を使ってリンク関数を設定します。他の分布族や、<code>weights =</code> や <code>subset =</code> などのオプション引数については、ヘルプドキュメントで詳しく説明されています（<code><a href="https://rdrr.io/r/stats/glm.html">?glm</a></code>）。</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="40%">
<col width="60%">
</colgroup>
<thead><tr class="header">
<th>分布族</th>
<th>リンク関数のデフォルト</th>
</tr></thead>
<tbody><tr class="odd">
<td><code>"binomial"</code></td>
<td>
<code>(link = "logit| |</code>“gaussian”<code>|</code>(link = “identity”)<code>| |</code>“Gamma”<code>|</code>(link = “inverse”)<code>| |</code>“inverse.gaussian”<code>|</code>(link = “1/mu^2”)<code>| |</code>“poisson”<code>|</code>(link = “log”)<code>| |</code>“quasi”<code>|</code>(link = “identity”, variance = “constant”)<code>| |</code>“quasibinomial”<code>|</code>(link = “logit”)<code>| |</code>“quasipoisson”<code>|</code>(link = “log”)`</td>
</tr></tbody>
</table></div>
<p><code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> を実行する際には、結果を名前付きの R オブジェクトとして保存するのが一般的です。そうすることで、以下のように <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> を使って結果をコンソールに表示させたり、結果に対して他の操作（例：指数変換）を行ったりすることができます。</p>
<p>負の二項回帰を実行する必要がある場合は、<strong>MASS</strong> パッケージを使用します。<code>glm.nb()</code> は <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> と同じ構文を使います。様々な回帰を段階的に知りたい場合は、<a href="https://stats.idre.ucla.edu/other/dae/">UCLA stats のページ</a>を見てください。</p>
</div>
<div id="単変量の-glm" class="section level4 unnumbered">
<h4>単変量の <code>glm()</code><a class="anchor" aria-label="anchor" href="#%E5%8D%98%E5%A4%89%E9%87%8F%E3%81%AE-glm"><i class="fas fa-link"></i></a>
</h4>
<p>この例では、異なる年齢カテゴリと死亡というアウトカム（準備セクションで死亡を 1 と変換しました）との関連を評価しています。以下は、<code>age_cat</code> によるアウトカムの単変量モデルです。モデルの出力を <code>model</code> として保存し、<code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> でコンソールに出力します。出力される推定値は<u>対数オッズ比</u>であり、ベースラインレベルは <code>age_cat</code> の 1 番目の因子水準（レベル）（“0 - 4”）です。</p>
<div class="sourceCode" id="cb973"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">age_cat</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = outcome ~ age_cat, family = "binomial", data = linelist)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.339  -1.278   1.024   1.080   1.354  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)   0.233738   0.072805   3.210  0.00133 **
## age_cat5-9   -0.062898   0.101733  -0.618  0.53640   
## age_cat10-14  0.138204   0.107186   1.289  0.19726   
## age_cat15-19 -0.005565   0.113343  -0.049  0.96084   
## age_cat20-29  0.027511   0.102133   0.269  0.78765   
## age_cat30-49  0.063764   0.113771   0.560  0.57517   
## age_cat50-69 -0.387889   0.259240  -1.496  0.13459   
## age_cat70+   -0.639203   0.915770  -0.698  0.48518   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 5712.4  on 4166  degrees of freedom
## Residual deviance: 5705.1  on 4159  degrees of freedom
## AIC: 5721.1
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>与えた変数のベースラインレベルを変更するには、列のデータ型が因子であることを確認し、<code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel()</a></code> で希望するレベルを最初の位置に移動させます（<a href="factors.html#factors">因子（ファクタ）型データ</a>の章を参照してください）。例えば、下の例では、列 <code>age_cat</code> に対して、“20-29” をベースラインとして設定してから、修正したデータフレームを <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> に渡しています。</p>
<div class="sourceCode" id="cb975"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">age_cat</span>, <span class="st">"20-29"</span>, after <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">outcome</span> <span class="op">~</span> <span class="va">age_cat</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = outcome ~ age_cat, family = "binomial", data = .)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.339  -1.278   1.024   1.080   1.354  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   0.26125    0.07163   3.647 0.000265 ***
## age_cat0-4   -0.02751    0.10213  -0.269 0.787652    
## age_cat5-9   -0.09041    0.10090  -0.896 0.370220    
## age_cat10-14  0.11069    0.10639   1.040 0.298133    
## age_cat15-19 -0.03308    0.11259  -0.294 0.768934    
## age_cat30-49  0.03625    0.11302   0.321 0.748390    
## age_cat50-69 -0.41540    0.25891  -1.604 0.108625    
## age_cat70+   -0.66671    0.91568  -0.728 0.466546    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 5712.4  on 4166  degrees of freedom
## Residual deviance: 5705.1  on 4159  degrees of freedom
## AIC: 5721.1
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="結果の表示" class="section level4 unnumbered">
<h4>結果の表示<a class="anchor" aria-label="anchor" href="#%E7%B5%90%E6%9E%9C%E3%81%AE%E8%A1%A8%E7%A4%BA"><i class="fas fa-link"></i></a>
</h4>
<p>ほとんどの用途では、上記の出力にいくつかの修正を加える必要があります。<strong>broom</strong> パッケージの <code>tidy()</code> は、モデルの結果を見やすくするために便利です。</p>
<p>ここでは、モデルの出力とカウントの表を組み合わせる方法を紹介します。</p>
<ol style="list-style-type: decimal">
<li>
<u>指数変換された</u>対数オッズ比の推定値と信頼区間を得るために、モデルを <code>tidy()</code> に渡し、 <code>exponentiate = TRUE</code> と <code>conf.int = TRUE</code> を設定します。</li>
</ol>
<div class="sourceCode" id="cb977"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">age_cat</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidy</span><span class="op">(</span>exponentiate <span class="op">=</span> <span class="cn">TRUE</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>        <span class="co"># 指数変換し信頼区間を算出</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>  <span class="co"># 全ての数値列を四捨五入</span></span></code></pre></div>
<p>以下の表は、整然化された <code>model</code> の出力です:</p>
<div id="htmlwidget-fb1a08cf83ac4daee0f9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fb1a08cf83ac4daee0f9">{"x":{"filter":"none","vertical":false,"data":[["(Intercept)","age_cat5-9","age_cat10-14","age_cat15-19","age_cat20-29","age_cat30-49","age_cat50-69","age_cat70+"],[1.26,0.94,1.15,0.99,1.03,1.07,0.68,0.53],[0.07,0.1,0.11,0.11,0.1,0.11,0.26,0.92],[3.21,-0.62,1.29,-0.05,0.27,0.56,-1.5,-0.7],[0,0.54,0.2,0.96,0.79,0.58,0.13,0.49],[1.1,0.77,0.93,0.8,0.84,0.85,0.41,0.07],[1.46,1.15,1.42,1.24,1.26,1.33,1.13,3.2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>term<\/th>\n      <th>estimate<\/th>\n      <th>std.error<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n      <th>conf.low<\/th>\n      <th>conf.high<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><ol start="2" style="list-style-type: decimal">
<li>これらのモデルの結果とカウントの表を組み合わせます。下記では、<strong>janitor</strong> パッケージの <code>tabyl()</code> を使ってクロス集計表を作成します。これは<a href="tables-descriptive.html#tables-descriptive">記述統計表の作り方</a>の章で説明しています。</li>
</ol>
<div class="sourceCode" id="cb978"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_table</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">age_cat</span>, <span class="va">outcome</span><span class="op">)</span></span></code></pre></div>
<!-- * Group rows by outcome, and get counts by age category   -->
<!-- * Pivot wider so the column are `age_cat`, `0`, and `1`   -->
<!-- * Remove row for `NA` `age_cat`, if applicable, to align with the model results   -->
<!-- ```{r} -->
<!-- counts_table <- linelist %>%  -->
<!--   filter(!is.na(outcome) & !is.na(age_cat)) %>%    # ensure outcome and age_cat are present  -->
<!--   group_by(outcome) %>%                            # get counts of variable of interest grouped by outcome -->
<!--   count(age_cat) %>%   ## gets number or rows by unique outcome-age category combinations   -->
<!--   pivot_wider(names_from = outcome, values_from = n)    ## spread data to wide format (as in cross-tabulation) -->
<!-- ``` -->
<p>この <code>counts_table</code> データフレームは、次のように見えます:</p>
<div id="htmlwidget-cb71be9ef1d61853410e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-cb71be9ef1d61853410e">{"x":{"filter":"none","vertical":false,"data":[["0-4","5-9","10-14","15-19","20-29","30-49","50-69","70+"],[338,365,273,238,345,228,35,3],[427,433,396,299,448,307,30,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat<\/th>\n      <th>0<\/th>\n      <th>1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>これで <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code>（<strong>dplyr</strong> パッケージ）を使って <code>counts_table</code> と結果 <code>model</code> を水平方向に結合することができます。<code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols()</a></code> では、2 つのデータフレームの行数が完全に一致していなければならないことを注意してください。このコードでは、一連の引き渡し過程の中で結合しているので、渡されたオブジェクト <code>counts_table</code> を表す <code>.</code> を使って、そのオブジェクトと <code>model</code> を結合しています。最後に、<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> を使って必要な列とその順番を選択し、<strong>base</strong> R の <code><a href="https://rdrr.io/r/base/Round.html">round()</a></code> で小数点以下 2 桁に指定した四捨五入を全ての数値列に適用しています。</p>
<div class="sourceCode" id="cb979"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="va">counts_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>           <span class="co"># カウントの集計表から始める</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>              <span class="co"># 回帰の出力と結合</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="va">estimate</span>,          <span class="co"># 変数を選択し、列の並べ直し</span></span>
<span>         <span class="va">conf.low</span>, <span class="va">conf.high</span>, <span class="va">p.value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">## 小数点以下 2 桁に四捨五入</span></span></code></pre></div>
<p>結合されたデータフレームの外観は以下の通りです。これは <strong>flextable</strong> パッケージの関数を使って画像として綺麗に印刷されます。<a href="tables-presentation.html#tables-presentation">見やすい表の作り方</a>では、<strong>flextable</strong> パッケージを使ったこのような表のカスタマイズ方法を説明していますが、<strong>knitr</strong> や <strong>GT</strong> などの他のさまざまなパッケージを使うこともできます。</p>
<div class="sourceCode" id="cb980"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">combined</span> <span class="op">&lt;-</span> <span class="va">combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">flextable</span><span class="fu">::</span><span class="fu"><a href="https://davidgohel.github.io/flextable/reference/flextable.html">qflextable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="複数の単変量モデルの反復方法" class="section level4 unnumbered">
<h4>複数の単変量モデルの反復方法<a class="anchor" aria-label="anchor" href="#%E8%A4%87%E6%95%B0%E3%81%AE%E5%8D%98%E5%A4%89%E9%87%8F%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%8F%8D%E5%BE%A9%E6%96%B9%E6%B3%95"><i class="fas fa-link"></i></a>
</h4>
<p>以下では、<code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> と <code>tidy()</code> を使った方法を紹介します。よりシンプルな方法については、<strong>gtsummary</strong> パッケージのセクションを参照してください。</p>
<p>いくつかの曝露変数のモデルを立て、単変量のオッズ比（つまり、変数同士で調整しない）を生成するためには、下記のアプローチが使えます。まず、<strong>stringr</strong> パッケージの <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> を使って単変量のモデル式を作成します（<a href="characters-strings.html#characters-strings">文字型・文字列型データ</a>を参照）。次に、それぞれのモデル式に対して <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> の回帰を実行し、それぞれの <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> の結果を <code>tidy()</code> に渡します。最後に <strong>tidyr</strong> パッケージの <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> を使って全てのモデルの出力を縦に結合します。このアプローチでは、<strong>purrr</strong> パッケージの <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> を使って反復処理を行います。このツールのより詳しい情報は<a href="iteration.html#iteration">ループと反復処理・リストの操作</a>を参照してください。</p>
<ol style="list-style-type: decimal">
<li><p>説明変数の列名のベクトルを作成します。このベクトルはこの章の準備セクションで <code>explanatory_vars</code> としてすでに作っています。</p></li>
<li><p><code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> を使って複数の文字列としてのモデル式を作成します。ここでは左に <code>outcome</code>、右に <code>explanatory_vars</code> から得られる列名を指定します。ピリオド <code>.</code> が <code>explanatory_vars</code> の列名に置き換わります。</p></li>
</ol>
<div class="sourceCode" id="cb981"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">explanatory_vars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"outcome ~ "</span>, <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "outcome ~ gender"  "outcome ~ fever"   "outcome ~ chills" 
## [4] "outcome ~ cough"   "outcome ~ aches"   "outcome ~ vomit"  
## [7] "outcome ~ age_cat"</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>この文字列としてのモデル式を <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> に渡して、各入力に適用する関数として <code>~glm()</code> に設定します。<code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> の中では、<code>as.formula(.x)</code> を回帰式として設定します。ここで、 <code>.x</code> は上のステップで定義した文字列としての式で置き換えられます。<code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> は各文字列の式を反復し、それぞれの回帰を実行します。</p></li>
<li><p>この最初の <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> の出力は 2 番目の <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> コマンドに渡されることにより、回帰の出力に対して <code>tidy()</code> が適用されます。</p></li>
<li><p>最後に、2 番目の <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> の出力（整然化されたデータフレームのリスト）が <code><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows()</a></code> で縦に結合され、全ての単変量の結果が単一のデータフレームになります。</p></li>
</ol>
<div class="sourceCode" id="cb983"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="va">explanatory_vars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>       <span class="co"># 関心のある変数から始める</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"outcome ~ "</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>         <span class="co"># 各変数を式にする（"アウトカム ~ 関心のある変数"）</span></span>
<span>  </span>
<span>  <span class="co"># 各単変量の式を反復</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>                               </span>
<span>    .f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>                       <span class="co"># 式を一つ一つ glm() に渡す</span></span>
<span>      formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>,      <span class="co"># glm() の中で、文字列としての式は .x である</span></span>
<span>      family <span class="op">=</span> <span class="st">"binomial"</span>,           <span class="co"># glm のタイプ（ロジスティック）を指定</span></span>
<span>      data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>          <span class="co"># データセット</span></span>
<span>  </span>
<span>  <span class="co"># 上記から得られた glm 回帰の出力を整然化</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span></span>
<span>    .f <span class="op">=</span> <span class="op">~</span><span class="fu">tidy</span><span class="op">(</span></span>
<span>      <span class="va">.x</span>, </span>
<span>      exponentiate <span class="op">=</span> <span class="cn">TRUE</span>,           <span class="co"># 指数変換 </span></span>
<span>      conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>          <span class="co"># 信頼区間を算出</span></span>
<span>  </span>
<span>  <span class="co"># 回帰の出力のリストを一つのデータフレームとして結合</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># 全ての数値列を四捨五入</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>今回は、複数の単変量回帰の結果を結合しているため、<code>models</code> の最終的なオブジェクトが長くなっています。クリックすると <code>model</code> の全ての行が表示されます。</p>
<div id="htmlwidget-7ed343470ef2b5e7f6eb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7ed343470ef2b5e7f6eb">{"x":{"filter":"none","vertical":false,"data":[["(Intercept)","gender","(Intercept)","fever","(Intercept)","chills","(Intercept)","cough","(Intercept)","aches","(Intercept)","vomit","(Intercept)","age_cat5-9","age_cat10-14","age_cat15-19","age_cat20-29","age_cat30-49","age_cat50-69","age_cat70+"],[1.28,1,1.28,1,1.28,1.03,1.14,1.15,1.29,0.93,1.23,1.09,1.26,0.94,1.15,0.99,1.03,1.07,0.68,0.53],[0.04,0.06,0.07,0.08,0.03,0.08,0.08,0.09,0.03,0.1,0.04,0.06,0.07,0.1,0.11,0.11,0.1,0.11,0.26,0.92],[5.67,-0.04,3.44,0.01,6.98,0.41,1.53,1.58,7.78,-0.66,4.67,1.39,3.21,-0.62,1.29,-0.05,0.27,0.56,-1.5,-0.7],[0,0.97,0,0.99,0,0.68,0.13,0.11,0,0.51,0,0.17,0,0.54,0.2,0.96,0.79,0.58,0.13,0.49],[1.18,0.88,1.11,0.85,1.19,0.89,0.97,0.97,1.21,0.76,1.13,0.96,1.1,0.77,0.93,0.8,0.84,0.85,0.41,0.07],[1.4,1.13,1.48,1.17,1.37,1.21,1.34,1.37,1.38,1.14,1.34,1.23,1.46,1.15,1.42,1.24,1.26,1.33,1.13,3.2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>term<\/th>\n      <th>estimate<\/th>\n      <th>std.error<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n      <th>conf.low<\/th>\n      <th>conf.high<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>先に示したように、各説明変数の <code>linelist</code> から集計表を作成し、<code>models</code> に結合して、見栄えの良い表を作ることができます。まず、変数定義からはじめて、<code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> を使って、その変数を反復処理させます。この反復処理には、<strong>dplyr</strong> パッケージの関数を使って集計表を作成するユーザー定義関数を用います。そして、その結果を組み合わせ、<code>models</code> の結果と結合します。</p>
<div class="sourceCode" id="cb984"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## それぞれの説明変数に対して処理</span></span>
<span><span class="va">univ_tab_base</span> <span class="op">&lt;-</span> <span class="va">explanatory_vars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>.f <span class="op">=</span> </span>
<span>    <span class="op">~</span><span class="op">{</span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                <span class="co">## linelist から始める</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     <span class="co">## アウトカムごとにデータをグループ化</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">.x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    <span class="co">## 関心のある変数に対して集計</span></span>
<span>        <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>              <span class="co">## 横長形式に変換（クロス集計表として）</span></span>
<span>          names_from <span class="op">=</span> <span class="va">outcome</span>,</span>
<span>          values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">.x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>         <span class="co">## 欠測行を削除</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"variable"</span> <span class="op">=</span> <span class="va">.x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>      <span class="co">## 関心のある列の変数名を "variable" に変更</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="co">## 文字列に変換しないと、2 値でない（カテゴリカル）変数が因子として出てきてしまい結合できない</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">## 集計結果のリストを 1 つのデータフレームとして結合</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">## 回帰の結果と結合</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">models</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">## 関心のある列のみ抽出</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="va">estimate</span>, <span class="va">conf.low</span>, <span class="va">conf.high</span>, <span class="va">p.value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">## 四捨五入する小数点位置を指定</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>以下は、上で作成したデータフレームです。この表を綺麗な HTML 出力に変換する方法（例えば、<strong>flextable</strong> パッケージの使用）については、<a href="tables-presentation.html#tables-presentation">見やすい表の作り方</a>の章を参照してください。</p>
<div id="htmlwidget-15dff1bd0b3a614fb032" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-15dff1bd0b3a614fb032">{"x":{"filter":"none","vertical":false,"data":[["(Intercept)","gender","(Intercept)","fever","(Intercept)","chills","(Intercept)","cough","(Intercept)","aches","(Intercept)","vomit","(Intercept)","age_cat5-9","age_cat10-14","age_cat15-19","age_cat20-29","age_cat30-49","age_cat50-69","age_cat70+"],[909,916,340,1485,1472,353,272,1553,1636,189,931,894,338,365,273,238,345,228,35,3],[1168,1174,436,1906,1877,465,309,2033,2114,228,1144,1198,427,433,396,299,448,307,30,2],[1.28,1,1.28,1,1.28,1.03,1.14,1.15,1.29,0.93,1.23,1.09,1.26,0.94,1.15,0.99,1.03,1.07,0.68,0.53],[1.18,0.88,1.11,0.85,1.19,0.89,0.97,0.97,1.21,0.76,1.13,0.96,1.1,0.77,0.93,0.8,0.84,0.85,0.41,0.07],[1.4,1.13,1.48,1.17,1.37,1.21,1.34,1.37,1.38,1.14,1.34,1.23,1.46,1.15,1.42,1.24,1.26,1.33,1.13,3.2],[0,0.97,0,0.99,0,0.68,0.13,0.11,0,0.51,0,0.17,0,0.54,0.2,0.96,0.79,0.58,0.13,0.49]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>term<\/th>\n      <th>0<\/th>\n      <th>1<\/th>\n      <th>estimate<\/th>\n      <th>conf.low<\/th>\n      <th>conf.high<\/th>\n      <th>p.value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="reg_gt_uni" class="section level3 unnumbered">
<h3>
<strong>gtsummary</strong> パッケージ<a class="anchor" aria-label="anchor" href="#reg_gt_uni"><i class="fas fa-link"></i></a>
</h3>
<p>以下では、<strong>gtsummary</strong> パッケージの <code>tbl_uvregression()</code> の使い方を紹介します。<a href="tables-descriptive.html#tables-descriptive">記述統計表の作り方</a>の章に示したように、<strong>gtsummary</strong> パッケージの関数は統計解析を行い、<u>かつ</u>プロフェッショナルな外観の出力を作成するのに良い仕事をします。この関数は単変量の回帰分析の結果の表を作成します。</p>
<p><code>linelist</code> から必要な列（説明変数とアウトカム変数）のみ選択し、それを <code>tbl_uvregression()</code> に渡します。これにより、準備のセクションで <code>explanatory_vars</code> として定義したそれぞれの列（gender、fever、chills、cough、aches、vomit と age_cat）に対して単変量回帰を行います。</p>
<p>この関数に対して、<code>method =</code> として <code>glm</code> （引用符はいらない）を、<code>y =</code> にアウトカム列を、ロジスティック回帰を行いたい場合は <code>method.args =</code> に <code>family = binomial</code> を指定し、さらに結果を指数変換するように指示しています。</p>
<p>出力は HTML で、カウントが含まれます。</p>
<div class="sourceCode" id="cb985"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">univ_tab</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">explanatory_vars</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">## 関心のある変数を選択</span></span>
<span></span>
<span>  <span class="fu">tbl_uvregression</span><span class="op">(</span>                         <span class="co">## 単変量解析の表を生成</span></span>
<span>    method <span class="op">=</span> <span class="va">glm</span>,                           <span class="co">## 実行したい回帰（一般化線形モデル）を定義</span></span>
<span>    y <span class="op">=</span> <span class="va">outcome</span>,                            <span class="co">## アウトカム変数を定義</span></span>
<span>    method.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span>,  <span class="co">## 実行したい glm のタイプを定義（ここではロジスティック）</span></span>
<span>    exponentiate <span class="op">=</span> <span class="cn">TRUE</span>                     <span class="co">## 対数オッズ比ではなくオッズ比を得るために指数変換を指定</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## 単変量の結果の表を出力</span></span>
<span><span class="va">univ_tab</span></span></code></pre></div>
<div id="lurccgofry" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lurccgofry .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lurccgofry .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lurccgofry .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lurccgofry .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lurccgofry .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lurccgofry .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lurccgofry .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lurccgofry .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lurccgofry .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lurccgofry .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lurccgofry .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lurccgofry .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lurccgofry .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lurccgofry .gt_from_md > :first-child {
  margin-top: 0;
}

#lurccgofry .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lurccgofry .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lurccgofry .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lurccgofry .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lurccgofry .gt_row_group_first td {
  border-top-width: 2px;
}

#lurccgofry .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lurccgofry .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lurccgofry .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lurccgofry .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lurccgofry .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lurccgofry .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lurccgofry .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lurccgofry .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lurccgofry .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lurccgofry .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lurccgofry .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lurccgofry .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lurccgofry .gt_left {
  text-align: left;
}

#lurccgofry .gt_center {
  text-align: center;
}

#lurccgofry .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lurccgofry .gt_font_normal {
  font-weight: normal;
}

#lurccgofry .gt_font_bold {
  font-weight: bold;
}

#lurccgofry .gt_font_italic {
  font-style: italic;
}

#lurccgofry .gt_super {
  font-size: 65%;
}

#lurccgofry .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#lurccgofry .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lurccgofry .gt_indent_1 {
  text-indent: 5px;
}

#lurccgofry .gt_indent_2 {
  text-indent: 10px;
}

#lurccgofry .gt_indent_3 {
  text-indent: 15px;
}

#lurccgofry .gt_indent_4 {
  text-indent: 20px;
}

#lurccgofry .gt_indent_5 {
  text-indent: 25px;
}
</style>
<div class="inline-table"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>N</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>OR</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>95% CI</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>p-value</strong></th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">gender</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.88, 1.13</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left">fever</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.85, 1.17</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left">chills</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.89, 1.21</td>
<td class="gt_row gt_center">0.7</td>
</tr>
<tr>
<td class="gt_row gt_left">cough</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.15</td>
<td class="gt_row gt_center">0.97, 1.37</td>
<td class="gt_row gt_center">0.11</td>
</tr>
<tr>
<td class="gt_row gt_left">aches</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">0.93</td>
<td class="gt_row gt_center">0.76, 1.14</td>
<td class="gt_row gt_center">0.5</td>
</tr>
<tr>
<td class="gt_row gt_left">vomit</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.09</td>
<td class="gt_row gt_center">0.96, 1.23</td>
<td class="gt_row gt_center">0.2</td>
</tr>
<tr>
<td class="gt_row gt_left">age_cat</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">0-4</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5-9</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.94</td>
<td class="gt_row gt_center">0.77, 1.15</td>
<td class="gt_row gt_center">0.5</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">10-14</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">1.15</td>
<td class="gt_row gt_center">0.93, 1.42</td>
<td class="gt_row gt_center">0.2</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">15-19</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.99</td>
<td class="gt_row gt_center">0.80, 1.24</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">20-29</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.84, 1.26</td>
<td class="gt_row gt_center">0.8</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">30-49</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">1.07</td>
<td class="gt_row gt_center">0.85, 1.33</td>
<td class="gt_row gt_center">0.6</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">50-69</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.68</td>
<td class="gt_row gt_center">0.41, 1.13</td>
<td class="gt_row gt_center">0.13</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">70+</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.53</td>
<td class="gt_row gt_center">0.07, 3.20</td>
<td class="gt_row gt_center">0.5</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr>
<td class="gt_footnote" colspan="5">
<sup class="gt_footnote_marks">1</sup> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr></tfoot>
</table></div>
</div>
<p>この表の出力は、テキストラベルを調整したり、P 値によって行を太字にしたりするなど、さまざまな変更を加えることができます。チュートリアルは<a href="http://www.danieldsjoberg.com/gtsummary/articles/tbl_regression.html">こちら</a>やオンラインサイトを参照してください。</p>
<!-- ======================================================= -->
</div>
</div>
<div id="層別" class="section level2" number="19.3">
<h2>
<span class="header-section-number">19.3</span> 層別<a class="anchor" aria-label="anchor" href="#%E5%B1%A4%E5%88%A5"><i class="fas fa-link"></i></a>
</h2>
<p><strong>gtsummary</strong> パッケージを使った層別解析は現在も継続して開発しています。この章は追って更新します。</p>
</div>
<div id="多変量" class="section level2" number="19.4">
<h2>
<span class="header-section-number">19.4</span> 多変量<a class="anchor" aria-label="anchor" href="#%E5%A4%9A%E5%A4%89%E9%87%8F"><i class="fas fa-link"></i></a>
</h2>
<p>多変量回帰分析をするために、またしても 2 つのアプローチを提案します。</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> と <code>tidy()</code>
</li>
<li>
<strong>gtsummary</strong> パッケージ</li>
</ul>
<p>これらのワークフローはそれぞれ似ていて、最後のステップで最終的に表にまとめるところだけが違います。</p>
<div id="多変量回帰分析の実施" class="section level3 unnumbered">
<h3>多変量回帰分析の実施<a class="anchor" aria-label="anchor" href="#%E5%A4%9A%E5%A4%89%E9%87%8F%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%AE%E5%AE%9F%E6%96%BD"><i class="fas fa-link"></i></a>
</h3>
<p>ここでは、<code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> を使います。（単変量解析と違って）プラス記号（ <code>+</code> ）で説明変数を区切ることで、式の右辺に変数を追加していきます。</p>
<p>全ての説明変数を使ってモデルを実行するには、次のようにします:</p>
<div class="sourceCode" id="cb986"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mv_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">fever</span> <span class="op">+</span> <span class="va">chills</span> <span class="op">+</span> <span class="va">cough</span> <span class="op">+</span> <span class="va">aches</span> <span class="op">+</span> <span class="va">vomit</span> <span class="op">+</span> <span class="va">age_cat</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mv_reg</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = outcome ~ gender + fever + chills + cough + aches + 
##     vomit + age_cat, family = "binomial", data = linelist)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.383  -1.279   1.029   1.078   1.346  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept)   0.069054   0.131726   0.524    0.600
## gender        0.002448   0.065133   0.038    0.970
## fever         0.004309   0.080522   0.054    0.957
## chills        0.034112   0.078924   0.432    0.666
## cough         0.138584   0.089909   1.541    0.123
## aches        -0.070705   0.104078  -0.679    0.497
## vomit         0.086098   0.062618   1.375    0.169
## age_cat5-9   -0.063562   0.101851  -0.624    0.533
## age_cat10-14  0.136372   0.107275   1.271    0.204
## age_cat15-19 -0.011074   0.113640  -0.097    0.922
## age_cat20-29  0.026552   0.102780   0.258    0.796
## age_cat30-49  0.059569   0.116402   0.512    0.609
## age_cat50-69 -0.388964   0.262384  -1.482    0.138
## age_cat70+   -0.647443   0.917375  -0.706    0.480
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 5712.4  on 4166  degrees of freedom
## Residual deviance: 5700.2  on 4153  degrees of freedom
## AIC: 5728.2
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>2 つの変数とそれらの交互作用項は、<code>+</code> の代わりにアスタリスク（ <code>*</code> ）で変数を区切ることでモデルに含めることができます。また交互作用項のみを指定する場合は、コロン（ <code>:</code> ）で区切ります。例えば次の通りです。</p>
<div class="sourceCode" id="cb988"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age_cat</span> <span class="op">*</span> <span class="va">fever</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></span></code></pre></div>
<p><u>オプション</u>として、下記コードを使うことで、あらかじめ定義された列名のベクトルと <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> を使って上記コードを再生成することもできます。これは、説明変数の名前が変更される場合や、全てを再入力したくない場合に便利です。</p>
<div class="sourceCode" id="cb989"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 全ての関心のある変数に対して回帰を実行</span></span>
<span><span class="va">mv_reg</span> <span class="op">&lt;-</span> <span class="va">explanatory_vars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co">## 説明変数の列名ベクトルから始める</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"+"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     <span class="co">## 全ての関心のある説明変数名をプラス記号で区切って結合</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"outcome ~ "</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    <span class="co">## アウトカムと上記文字列を結合し、モデル式の形にする</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"binomial"</span>,      <span class="co">## glm のタイプをロジスティックとして定義</span></span>
<span>      data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span>          <span class="co">## データセットを定義</span></span></code></pre></div>
<div id="モデルの構築" class="section level4 unnumbered">
<h4>モデルの構築<a class="anchor" aria-label="anchor" href="#%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E6%A7%8B%E7%AF%89"><i class="fas fa-link"></i></a>
</h4>
<p>任意の説明変数を含む様々なモデルを保存しながら、段階的にモデルを構築することができます。また以下に示すように、<strong>lmtest</strong> パッケージの <code>lrtest()</code> を使ってこれらのモデルを尤度比検定で比較することができます:</p>
<p><span style="color: black;"><strong><u>注釈:</u></strong> <strong>base</strong> の <code>anova(model1, model2, test = "Chisq")</code> を使っても同じ結果を得ることができます。</span></p>
<div class="sourceCode" id="cb990"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">age_cat</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">age_cat</span> <span class="op">+</span> <span class="va">gender</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">model2</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Likelihood ratio test
## 
## Model 1: outcome ~ age_cat
## Model 2: outcome ~ age_cat + gender
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)
## 1   8 -2852.6                     
## 2   9 -2852.6  1 0.0002     0.9883</code></pre>
<p>他の方法は、各モデルのオブジェクトを受け取り、<strong>stats</strong> パッケージの <code><a href="https://rdrr.io/r/stats/step.html">step()</a></code> を適用することです。この関数では、モデルを構築する際に使用したい変数選択の方向を指定します。</p>
<div class="sourceCode" id="cb992"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## AIC に基づいた変数増加法によりモデルを選択</span></span>
<span><span class="co">## "backward" や "both" を指定することで変数選択の方法を調整できる</span></span>
<span><span class="va">final_mv_reg</span> <span class="op">&lt;-</span> <span class="va">mv_reg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"forward"</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>また数値の表示をわかりやすくするために、指数表記をオフにすることもできます:</p>
<div class="sourceCode" id="cb993"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen<span class="op">=</span><span class="fl">999</span><span class="op">)</span></span></code></pre></div>
<p>単変量解析のセクションで説明したように、モデルの出力を <code>tidy()</code> に渡して、対数オッズ比と信頼区間を指数変換します。最後に、全ての数値列を小数点以下 2 桁に四捨五入します。スクロールして全ての行を確認してください。</p>
<div class="sourceCode" id="cb994"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mv_tab_base</span> <span class="op">&lt;-</span> <span class="va">final_mv_reg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>exponentiate <span class="op">=</span> <span class="cn">TRUE</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co">## 推定値の整然化されたデータフレームを得る</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>          <span class="co">## 四捨五入</span></span></code></pre></div>
<p>結果として得られたデータフレームは以下のようになります:</p>
<div id="htmlwidget-aa30748eb591690c3d4f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-aa30748eb591690c3d4f">{"x":{"filter":"none","vertical":false,"data":[["(Intercept)","gender","fever","chills","cough","aches","vomit","age_cat5-9","age_cat10-14","age_cat15-19","age_cat20-29","age_cat30-49","age_cat50-69","age_cat70+"],[1.07,1,1,1.03,1.15,0.93,1.09,0.94,1.15,0.99,1.03,1.06,0.68,0.52],[0.13,0.07,0.08,0.08,0.09,0.1,0.06,0.1,0.11,0.11,0.1,0.12,0.26,0.92],[0.52,0.04,0.05,0.43,1.54,-0.68,1.37,-0.62,1.27,-0.1,0.26,0.51,-1.48,-0.71],[0.6,0.97,0.96,0.67,0.12,0.5,0.17,0.53,0.2,0.92,0.8,0.61,0.14,0.48],[0.83,0.88,0.86,0.89,0.96,0.76,0.96,0.77,0.93,0.79,0.84,0.85,0.4,0.07],[1.39,1.14,1.18,1.21,1.37,1.14,1.23,1.15,1.41,1.24,1.26,1.33,1.13,3.19]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>term<\/th>\n      <th>estimate<\/th>\n      <th>std.error<\/th>\n      <th>statistic<\/th>\n      <th>p.value<\/th>\n      <th>conf.low<\/th>\n      <th>conf.high<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="単変量と多変量の解析結果の結合" class="section level3 unnumbered">
<h3>単変量と多変量の解析結果の結合<a class="anchor" aria-label="anchor" href="#%E5%8D%98%E5%A4%89%E9%87%8F%E3%81%A8%E5%A4%9A%E5%A4%89%E9%87%8F%E3%81%AE%E8%A7%A3%E6%9E%90%E7%B5%90%E6%9E%9C%E3%81%AE%E7%B5%90%E5%90%88"><i class="fas fa-link"></i></a>
</h3>
<div id="gtsummary-パッケージを使った結合" class="section level4 unnumbered">
<h4>
<strong>gtsummary</strong> パッケージを使った結合<a class="anchor" aria-label="anchor" href="#gtsummary-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E7%B5%90%E5%90%88"><i class="fas fa-link"></i></a>
</h4>
<p><strong>gtsummary</strong> パッケージは <code>tbl_regression()</code> を提供しており、回帰の結果（この場合は <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>）を受け取り、美しくまとめた表を作成します。</p>
<div class="sourceCode" id="cb995"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 最終的な回帰モデルの結果の表を表示</span></span>
<span><span class="va">mv_tab</span> <span class="op">&lt;-</span> <span class="fu">tbl_regression</span><span class="op">(</span><span class="va">final_mv_reg</span>, exponentiate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>表を確認しましょう。</p>
<div class="sourceCode" id="cb996"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mv_tab</span></span></code></pre></div>
<div id="gtpagivpgy" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#gtpagivpgy .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gtpagivpgy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gtpagivpgy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gtpagivpgy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gtpagivpgy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gtpagivpgy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gtpagivpgy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gtpagivpgy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gtpagivpgy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gtpagivpgy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gtpagivpgy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gtpagivpgy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#gtpagivpgy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gtpagivpgy .gt_from_md > :first-child {
  margin-top: 0;
}

#gtpagivpgy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gtpagivpgy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gtpagivpgy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gtpagivpgy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gtpagivpgy .gt_row_group_first td {
  border-top-width: 2px;
}

#gtpagivpgy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gtpagivpgy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gtpagivpgy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gtpagivpgy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gtpagivpgy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gtpagivpgy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gtpagivpgy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gtpagivpgy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gtpagivpgy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gtpagivpgy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gtpagivpgy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gtpagivpgy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gtpagivpgy .gt_left {
  text-align: left;
}

#gtpagivpgy .gt_center {
  text-align: center;
}

#gtpagivpgy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gtpagivpgy .gt_font_normal {
  font-weight: normal;
}

#gtpagivpgy .gt_font_bold {
  font-weight: bold;
}

#gtpagivpgy .gt_font_italic {
  font-style: italic;
}

#gtpagivpgy .gt_super {
  font-size: 65%;
}

#gtpagivpgy .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#gtpagivpgy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gtpagivpgy .gt_indent_1 {
  text-indent: 5px;
}

#gtpagivpgy .gt_indent_2 {
  text-indent: 10px;
}

#gtpagivpgy .gt_indent_3 {
  text-indent: 15px;
}

#gtpagivpgy .gt_indent_4 {
  text-indent: 20px;
}

#gtpagivpgy .gt_indent_5 {
  text-indent: 25px;
}
</style>
<div class="inline-table"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>OR</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>95% CI</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>p-value</strong></th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">gender</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.88, 1.14</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left">fever</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.86, 1.18</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left">chills</td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.89, 1.21</td>
<td class="gt_row gt_center">0.7</td>
</tr>
<tr>
<td class="gt_row gt_left">cough</td>
<td class="gt_row gt_center">1.15</td>
<td class="gt_row gt_center">0.96, 1.37</td>
<td class="gt_row gt_center">0.12</td>
</tr>
<tr>
<td class="gt_row gt_left">aches</td>
<td class="gt_row gt_center">0.93</td>
<td class="gt_row gt_center">0.76, 1.14</td>
<td class="gt_row gt_center">0.5</td>
</tr>
<tr>
<td class="gt_row gt_left">vomit</td>
<td class="gt_row gt_center">1.09</td>
<td class="gt_row gt_center">0.96, 1.23</td>
<td class="gt_row gt_center">0.2</td>
</tr>
<tr>
<td class="gt_row gt_left">age_cat</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">0-4</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5-9</td>
<td class="gt_row gt_center">0.94</td>
<td class="gt_row gt_center">0.77, 1.15</td>
<td class="gt_row gt_center">0.5</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">10-14</td>
<td class="gt_row gt_center">1.15</td>
<td class="gt_row gt_center">0.93, 1.41</td>
<td class="gt_row gt_center">0.2</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">15-19</td>
<td class="gt_row gt_center">0.99</td>
<td class="gt_row gt_center">0.79, 1.24</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">20-29</td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.84, 1.26</td>
<td class="gt_row gt_center">0.8</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">30-49</td>
<td class="gt_row gt_center">1.06</td>
<td class="gt_row gt_center">0.85, 1.33</td>
<td class="gt_row gt_center">0.6</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">50-69</td>
<td class="gt_row gt_center">0.68</td>
<td class="gt_row gt_center">0.40, 1.13</td>
<td class="gt_row gt_center">0.14</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">70+</td>
<td class="gt_row gt_center">0.52</td>
<td class="gt_row gt_center">0.07, 3.19</td>
<td class="gt_row gt_center">0.5</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr>
<td class="gt_footnote" colspan="4">
<sup class="gt_footnote_marks">1</sup> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr></tfoot>
</table></div>
</div>
<p>また、<strong>gtsummary</strong> パッケージで作成したいくつかの異なる表を <code>tbl_merge()</code> で結合することができます。ここでは、多変量回帰分析の結果を、<a href="regression.html#reg_gt_uni">上</a>で作成した<strong>gtsummary</strong> パッケージの<strong>単変量</strong>の結果と結合させています。</p>
<div class="sourceCode" id="cb997"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 単変量結果を結合 </span></span>
<span><span class="fu">tbl_merge</span><span class="op">(</span></span>
<span>  tbls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">univ_tab</span>, <span class="va">mv_tab</span><span class="op">)</span>,                          <span class="co"># 結合</span></span>
<span>  tab_spanner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"**Univariate**"</span>, <span class="st">"**Multivariable**"</span><span class="op">)</span><span class="op">)</span> <span class="co"># ヘッダー名を設定</span></span></code></pre></div>
<div id="njdkzskmif" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#njdkzskmif .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#njdkzskmif .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#njdkzskmif .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#njdkzskmif .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#njdkzskmif .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njdkzskmif .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#njdkzskmif .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#njdkzskmif .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#njdkzskmif .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#njdkzskmif .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#njdkzskmif .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#njdkzskmif .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#njdkzskmif .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#njdkzskmif .gt_from_md > :first-child {
  margin-top: 0;
}

#njdkzskmif .gt_from_md > :last-child {
  margin-bottom: 0;
}

#njdkzskmif .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#njdkzskmif .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#njdkzskmif .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#njdkzskmif .gt_row_group_first td {
  border-top-width: 2px;
}

#njdkzskmif .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#njdkzskmif .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#njdkzskmif .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#njdkzskmif .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njdkzskmif .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#njdkzskmif .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#njdkzskmif .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#njdkzskmif .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njdkzskmif .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#njdkzskmif .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#njdkzskmif .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#njdkzskmif .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#njdkzskmif .gt_left {
  text-align: left;
}

#njdkzskmif .gt_center {
  text-align: center;
}

#njdkzskmif .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#njdkzskmif .gt_font_normal {
  font-weight: normal;
}

#njdkzskmif .gt_font_bold {
  font-weight: bold;
}

#njdkzskmif .gt_font_italic {
  font-style: italic;
}

#njdkzskmif .gt_super {
  font-size: 65%;
}

#njdkzskmif .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#njdkzskmif .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#njdkzskmif .gt_indent_1 {
  text-indent: 5px;
}

#njdkzskmif .gt_indent_2 {
  text-indent: 10px;
}

#njdkzskmif .gt_indent_3 {
  text-indent: 15px;
}

#njdkzskmif .gt_indent_4 {
  text-indent: 20px;
}

#njdkzskmif .gt_indent_5 {
  text-indent: 25px;
}
</style>
<div class="inline-table"><table class="gt_table">
<thead class="gt_col_headings">
<tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col"><strong>Characteristic</strong></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="4" scope="colgroup">
        <span class="gt_column_spanner"><strong>Univariate</strong></span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3" scope="colgroup">
        <span class="gt_column_spanner"><strong>Multivariable</strong></span>
      </th>
    </tr>
<tr>
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>N</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>OR</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>95% CI</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>p-value</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>OR</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>95% CI</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>p-value</strong></th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">gender</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.88, 1.13</td>
<td class="gt_row gt_center">&gt;0.9</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.88, 1.14</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left">fever</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.85, 1.17</td>
<td class="gt_row gt_center">&gt;0.9</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.86, 1.18</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left">chills</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.89, 1.21</td>
<td class="gt_row gt_center">0.7</td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.89, 1.21</td>
<td class="gt_row gt_center">0.7</td>
</tr>
<tr>
<td class="gt_row gt_left">cough</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.15</td>
<td class="gt_row gt_center">0.97, 1.37</td>
<td class="gt_row gt_center">0.11</td>
<td class="gt_row gt_center">1.15</td>
<td class="gt_row gt_center">0.96, 1.37</td>
<td class="gt_row gt_center">0.12</td>
</tr>
<tr>
<td class="gt_row gt_left">aches</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">0.93</td>
<td class="gt_row gt_center">0.76, 1.14</td>
<td class="gt_row gt_center">0.5</td>
<td class="gt_row gt_center">0.93</td>
<td class="gt_row gt_center">0.76, 1.14</td>
<td class="gt_row gt_center">0.5</td>
</tr>
<tr>
<td class="gt_row gt_left">vomit</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center">1.09</td>
<td class="gt_row gt_center">0.96, 1.23</td>
<td class="gt_row gt_center">0.2</td>
<td class="gt_row gt_center">1.09</td>
<td class="gt_row gt_center">0.96, 1.23</td>
<td class="gt_row gt_center">0.2</td>
</tr>
<tr>
<td class="gt_row gt_left">age_cat</td>
<td class="gt_row gt_center">4,167</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">0-4</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center">—</td>
<td class="gt_row gt_center"></td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5-9</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.94</td>
<td class="gt_row gt_center">0.77, 1.15</td>
<td class="gt_row gt_center">0.5</td>
<td class="gt_row gt_center">0.94</td>
<td class="gt_row gt_center">0.77, 1.15</td>
<td class="gt_row gt_center">0.5</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">10-14</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">1.15</td>
<td class="gt_row gt_center">0.93, 1.42</td>
<td class="gt_row gt_center">0.2</td>
<td class="gt_row gt_center">1.15</td>
<td class="gt_row gt_center">0.93, 1.41</td>
<td class="gt_row gt_center">0.2</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">15-19</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.99</td>
<td class="gt_row gt_center">0.80, 1.24</td>
<td class="gt_row gt_center">&gt;0.9</td>
<td class="gt_row gt_center">0.99</td>
<td class="gt_row gt_center">0.79, 1.24</td>
<td class="gt_row gt_center">&gt;0.9</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">20-29</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.84, 1.26</td>
<td class="gt_row gt_center">0.8</td>
<td class="gt_row gt_center">1.03</td>
<td class="gt_row gt_center">0.84, 1.26</td>
<td class="gt_row gt_center">0.8</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">30-49</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">1.07</td>
<td class="gt_row gt_center">0.85, 1.33</td>
<td class="gt_row gt_center">0.6</td>
<td class="gt_row gt_center">1.06</td>
<td class="gt_row gt_center">0.85, 1.33</td>
<td class="gt_row gt_center">0.6</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">50-69</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.68</td>
<td class="gt_row gt_center">0.41, 1.13</td>
<td class="gt_row gt_center">0.13</td>
<td class="gt_row gt_center">0.68</td>
<td class="gt_row gt_center">0.40, 1.13</td>
<td class="gt_row gt_center">0.14</td>
</tr>
<tr>
<td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">70+</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center">0.53</td>
<td class="gt_row gt_center">0.07, 3.20</td>
<td class="gt_row gt_center">0.5</td>
<td class="gt_row gt_center">0.52</td>
<td class="gt_row gt_center">0.07, 3.19</td>
<td class="gt_row gt_center">0.5</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr>
<td class="gt_footnote" colspan="8">
<sup class="gt_footnote_marks">1</sup> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr></tfoot>
</table></div>
</div>
</div>
<div id="dplyr-を使った結合" class="section level4 unnumbered">
<h4>
<strong>dplyr</strong> を使った結合<a class="anchor" aria-label="anchor" href="#dplyr-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E7%B5%90%E5%90%88"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> / <code>tidy()</code> の単変量と多変量の出力を結合する別の方法として、<strong>dplyr</strong> パッケージの結合関数があります。</p>
<ul>
<li>先に示した単変量の結果（カウントを含む <code>univ_tab_base</code>）と、整然化された多変量の結果 <code>mv_tab_base</code> を結合します。</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> を使って、必要な列だけを残し、その順序を指定し、名前を変更します。</li>
<li>実数型である全ての列に対して <code><a href="https://rdrr.io/r/base/Round.html">round()</a></code> を適用して、小数点以下 2 桁に四捨五入します。</li>
</ul>
<div class="sourceCode" id="cb998"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 単変量と多変量の表を結合</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">univ_tab_base</span>, <span class="va">mv_tab_base</span>, by <span class="op">=</span> <span class="st">"term"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 列を選択し、名前を変更</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span> <span class="co"># 新しい名前 = 古い名前</span></span>
<span>    <span class="st">"characteristic"</span> <span class="op">=</span> <span class="va">term</span>, </span>
<span>    <span class="st">"recovered"</span>      <span class="op">=</span> <span class="st">"0"</span>, </span>
<span>    <span class="st">"dead"</span>           <span class="op">=</span> <span class="st">"1"</span>, </span>
<span>    <span class="st">"univ_or"</span>        <span class="op">=</span> <span class="va">estimate.x</span>, </span>
<span>    <span class="st">"univ_ci_low"</span>    <span class="op">=</span> <span class="va">conf.low.x</span>, </span>
<span>    <span class="st">"univ_ci_high"</span>   <span class="op">=</span> <span class="va">conf.high.x</span>,</span>
<span>    <span class="st">"univ_pval"</span>      <span class="op">=</span> <span class="va">p.value.x</span>, </span>
<span>    <span class="st">"mv_or"</span>          <span class="op">=</span> <span class="va">estimate.y</span>, </span>
<span>    <span class="st">"mvv_ci_low"</span>     <span class="op">=</span> <span class="va">conf.low.y</span>, </span>
<span>    <span class="st">"mv_ci_high"</span>     <span class="op">=</span> <span class="va">conf.high.y</span>,</span>
<span>    <span class="st">"mv_pval"</span>        <span class="op">=</span> <span class="va">p.value.y</span> </span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.double</span><span class="op">)</span>, <span class="va">round</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>   </span></code></pre></div>
<pre><code>## # A tibble: 20 × 11
##    charact…¹ recov…²  dead univ_or univ_…³ univ_…⁴ univ_…⁵ mv_or mvv_c…⁶ mv_ci…⁷
##    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 (Interce…     909  1168    1.28    1.18    1.4     0     1.07    0.83    1.39
##  2 gender        916  1174    1       0.88    1.13    0.97  1       0.88    1.14
##  3 (Interce…     340   436    1.28    1.11    1.48    0     1.07    0.83    1.39
##  4 fever        1485  1906    1       0.85    1.17    0.99  1       0.86    1.18
##  5 (Interce…    1472  1877    1.28    1.19    1.37    0     1.07    0.83    1.39
##  6 chills        353   465    1.03    0.89    1.21    0.68  1.03    0.89    1.21
##  7 (Interce…     272   309    1.14    0.97    1.34    0.13  1.07    0.83    1.39
##  8 cough        1553  2033    1.15    0.97    1.37    0.11  1.15    0.96    1.37
##  9 (Interce…    1636  2114    1.29    1.21    1.38    0     1.07    0.83    1.39
## 10 aches         189   228    0.93    0.76    1.14    0.51  0.93    0.76    1.14
## 11 (Interce…     931  1144    1.23    1.13    1.34    0     1.07    0.83    1.39
## 12 vomit         894  1198    1.09    0.96    1.23    0.17  1.09    0.96    1.23
## 13 (Interce…     338   427    1.26    1.1     1.46    0     1.07    0.83    1.39
## 14 age_cat5…     365   433    0.94    0.77    1.15    0.54  0.94    0.77    1.15
## 15 age_cat1…     273   396    1.15    0.93    1.42    0.2   1.15    0.93    1.41
## 16 age_cat1…     238   299    0.99    0.8     1.24    0.96  0.99    0.79    1.24
## 17 age_cat2…     345   448    1.03    0.84    1.26    0.79  1.03    0.84    1.26
## 18 age_cat3…     228   307    1.07    0.85    1.33    0.58  1.06    0.85    1.33
## 19 age_cat5…      35    30    0.68    0.41    1.13    0.13  0.68    0.4     1.13
## 20 age_cat7…       3     2    0.53    0.07    3.2     0.49  0.52    0.07    3.19
## # … with 1 more variable: mv_pval &lt;dbl&gt;, and abbreviated variable names
## #   ¹​characteristic, ²​recovered, ³​univ_ci_low, ⁴​univ_ci_high, ⁵​univ_pval,
## #   ⁶​mvv_ci_low, ⁷​mv_ci_high</code></pre>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="フォレストプロット" class="section level2" number="19.5">
<h2>
<span class="header-section-number">19.5</span> フォレストプロット<a class="anchor" aria-label="anchor" href="#%E3%83%95%E3%82%A9%E3%83%AC%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"><i class="fas fa-link"></i></a>
</h2>
<p>このセクションでは、回帰の結果を図示する方法を示します。<strong>ggplot2</strong> パッケージを使って自分自身でプロットを作成する方法と、<strong>easystats</strong> と呼ばれるメタパッケージ（多くのパッケージを含むパッケージ）を使う方法があります。</p>
<p><strong>ggplot2</strong> パッケージに慣れていない方は、<a href="ggplot-basics.html#ggplot-basics">ggplot の基礎</a>の章をご参照ください。</p>
<!-- ======================================================= -->
<div id="ggplot2-パッケージ" class="section level3 unnumbered">
<h3>
<strong>ggplot2</strong> パッケージ<a class="anchor" aria-label="anchor" href="#ggplot2-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> を使って、多変量回帰の結果の要素をプロットすることで、フォレストプロットを構築できます。下の “geoms” を使ってプロットのレイヤーを追加していきます:</p>
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> を使った推定値の図示</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar()</a></code> を使った信頼区間の図示</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline()</a></code> を使った OR = 1 を表す垂直線の図示</li>
</ul>
<p>プロットする前に、<strong>forcats</strong> パッケージの <code><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel()</a></code> を使って、y 軸上の変数 / レベルの順序を設定すると良いでしょう。（設定しないと）<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> は、年齢カテゴリに対して英数字順に表示するといった期待通りの結果を返さないかもしれません。詳しくは<a href="factors.html#factors">因子（ファクタ）型データ</a>を参照してください。</p>
<div class="sourceCode" id="cb1000"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 多変量の結果から切片項を削除</span></span>
<span><span class="va">mv_tab_base</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># y 軸上に示される変数 / レベルの順序を指定</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>term <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span></span>
<span>    <span class="va">term</span>,</span>
<span>    <span class="st">"vomit"</span>, <span class="st">"gender"</span>, <span class="st">"fever"</span>, <span class="st">"cough"</span>, <span class="st">"chills"</span>, <span class="st">"aches"</span>,</span>
<span>    <span class="st">"age_cat5-9"</span>, <span class="st">"age_cat10-14"</span>, <span class="st">"age_cat15-19"</span>, <span class="st">"age_cat20-29"</span>,</span>
<span>    <span class="st">"age_cat30-49"</span>, <span class="st">"age_cat50-69"</span>, <span class="st">"age_cat70+"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="co"># "intercept" の行をプロットから削除</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">!=</span> <span class="st">"(Intercept)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">## y 軸に変数を x 軸に推定値（OR）をプロット</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, y <span class="op">=</span> <span class="va">term</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co">## 点推定値をポイントとして図示</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co">## 信頼区間をエラーバーとして追加</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">conf.low</span>, xmax <span class="op">=</span> <span class="va">conf.high</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="co">## OR = 1 を示す参照をダッシュ線で示す</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/ggplot_forest-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
<div id="easystats-パッケージ" class="section level3 unnumbered">
<h3>
<strong>easystats</strong> パッケージ<a class="anchor" aria-label="anchor" href="#easystats-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fas fa-link"></i></a>
</h3>
<p><strong>ggplot2</strong> パッケージが提供する細かいレベルの制御をしたくない場合は、代わりに <strong>easystats</strong> パッケージの組み合わせを使用することができます。</p>
<p><strong>parameters</strong> パッケージの <code>model_parameters()</code> は <strong>broom</strong> パッケージの <code>tidy()</code> と同じ処理を行います。<strong>see</strong> パッケージは、これらの出力を受け取り <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> オブジェクトとしてデフォルトのフォレストプロットを作成します。</p>
<div class="sourceCode" id="cb1001"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">easystats</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 多変量の結果から切片項を削除</span></span>
<span><span class="va">final_mv_reg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">model_parameters</span><span class="op">(</span>exponentiate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/easystats_forest-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="参考資料-12" class="section level2" number="19.6">
<h2>
<span class="header-section-number">19.6</span> 参考資料<a class="anchor" aria-label="anchor" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-12"><i class="fas fa-link"></i></a>
</h2>
<p>この章の内容は、これらの資料やオンラインの動作例を参考にしています。</p>
<p><a href="https://www.datacamp.com/community/tutorials/linear-regression-R">Linear regression in R</a></p>
<p><a href="http://www.danieldsjoberg.com/gtsummary/articles/tbl_regression.html">gtsummary</a></p>
<p><a href="https://stats.idre.ucla.edu/other/dae/">UCLA stats page</a></p>
<p><a href="http://www.sthda.com/english/articles/36-classification-methods-essentials/150-stepwise-logistic-regression-essentials-in-r/">sthda stepwise regression</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></div>
<div class="next"><a href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#regression"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li>
<a class="nav-link" href="#%E6%BA%96%E5%82%99-10"><span class="header-section-number">19.1</span> 準備</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-8">パッケージの読み込み</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-1">データの読み込み</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%89%8D%E5%87%A6%E7%90%86-1">データの前処理</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E5%8D%98%E5%A4%89%E9%87%8F"><span class="header-section-number">19.2</span> 単変量</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#base-r-3">base R</a></li>
<li><a class="nav-link" href="#reg_gt_uni">gtsummary パッケージ</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E5%B1%A4%E5%88%A5"><span class="header-section-number">19.3</span> 層別</a></li>
<li>
<a class="nav-link" href="#%E5%A4%9A%E5%A4%89%E9%87%8F"><span class="header-section-number">19.4</span> 多変量</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E5%A4%9A%E5%A4%89%E9%87%8F%E5%9B%9E%E5%B8%B0%E5%88%86%E6%9E%90%E3%81%AE%E5%AE%9F%E6%96%BD">多変量回帰分析の実施</a></li>
<li><a class="nav-link" href="#%E5%8D%98%E5%A4%89%E9%87%8F%E3%81%A8%E5%A4%9A%E5%A4%89%E9%87%8F%E3%81%AE%E8%A7%A3%E6%9E%90%E7%B5%90%E6%9E%9C%E3%81%AE%E7%B5%90%E5%90%88">単変量と多変量の解析結果の結合</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E3%83%95%E3%82%A9%E3%83%AC%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%83%83%E3%83%88"><span class="header-section-number">19.5</span> フォレストプロット</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot2-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8">ggplot2 パッケージ</a></li>
<li><a class="nav-link" href="#easystats-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8">easystats パッケージ</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-12"><span class="header-section-number">19.6</span> 参考資料</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>疫学のための R ハンドブック</strong>" was written by the handbook team. It was last built on 2022-10-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>

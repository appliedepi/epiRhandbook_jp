<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>26 標本調査データ分析 | 疫学のための R ハンドブック</title>
<meta name="author" content="the handbook team">
<meta name="description" content="26.1 概要 この章では、標本調査データ分析のためのいくつかのパッケージの使用方法を説明します。 ほとんどの調査用 R パッケージは、重み付け分析を行うために surveyパッケージに依存しています。本章では、survey パッケージと同様に srvyr パッケージ（tidyverse スタイルのコーディングを可能にする survey パッケージのラッパー）および gtsummary...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="26 標本調査データ分析 | 疫学のための R ハンドブック">
<meta property="og:type" content="book">
<meta property="og:description" content="26.1 概要 この章では、標本調査データ分析のためのいくつかのパッケージの使用方法を説明します。 ほとんどの調査用 R パッケージは、重み付け分析を行うために surveyパッケージに依存しています。本章では、survey パッケージと同様に srvyr パッケージ（tidyverse スタイルのコーディングを可能にする survey パッケージのラッパー）および gtsummary...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="26 標本調査データ分析 | 疫学のための R ハンドブック">
<meta name="twitter:description" content="26.1 概要 この章では、標本調査データ分析のためのいくつかのパッケージの使用方法を説明します。 ほとんどの調査用 R パッケージは、重み付け分析を行うために surveyパッケージに依存しています。本章では、survey パッケージと同様に srvyr パッケージ（tidyverse スタイルのコーディングを可能にする survey パッケージのラッパー）および gtsummary...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script><script type="text/javascript">
        // window.addEventListener("load", function() {
        //     document.getElementById('toc').firstChild.innerHTML = "章目次"; 
        // });
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementsByClassName("d-flex align-items-start justify-content-between")[0].children[0].children[0].innerHTML = "疫学のための R</br>ハンドブック";
            document.getElementById('toc').firstChild.innerHTML = "章目次"; 
            document.getElementById('main-nav').children[1].firstChild.innerHTML = "総目次";
            document.getElementById('search').setAttribute("placeholder", "検索");
        });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">疫学のための R ハンドブック</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">本書について</li>
<li><a class="" href="editorial-style.html"><span class="header-section-number">1</span> 編集前記・技術注記</a></li>
<li><a class="" href="data-used.html"><span class="header-section-number">2</span> ハンドブックとデータのダウンロード</a></li>
<li class="book-part">基本編</li>
<li><a class="" href="basics.html"><span class="header-section-number">3</span> R の基礎</a></li>
<li><a class="" href="transition-to-R.html"><span class="header-section-number">4</span> Excel・Stata・SASとの比較</a></li>
<li><a class="" href="packages-suggested.html"><span class="header-section-number">5</span> 推奨パッケージ</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> R プロジェクト</a></li>
<li><a class="" href="importing.html"><span class="header-section-number">7</span> データのインポート・エクスポート</a></li>
<li class="book-part">データマネジメント</li>
<li><a class="" href="cleaning.html"><span class="header-section-number">8</span> データクリーニングと主要関数</a></li>
<li><a class="" href="dates.html"><span class="header-section-number">9</span> 日付型データ</a></li>
<li><a class="" href="characters-strings.html"><span class="header-section-number">10</span> 文字型・文字列型データ</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> 因子（ファクタ）型データ</a></li>
<li><a class="" href="pivoting.html"><span class="header-section-number">12</span> データの縦横変換</a></li>
<li><a class="" href="grouping.html"><span class="header-section-number">13</span> データのグループ化</a></li>
<li><a class="" href="joining-matching.html"><span class="header-section-number">14</span> データの結合</a></li>
<li><a class="" href="deduplication.html"><span class="header-section-number">15</span> 重複データの排除</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">16</span> ループと反復処理・リストの操作</a></li>
<li class="book-part">データ分析</li>
<li><a class="" href="tables-descriptive.html"><span class="header-section-number">17</span> 記述統計表の作り方</a></li>
<li><a class="" href="stat-tests.html"><span class="header-section-number">18</span> 基本的な統計的検定</a></li>
<li><a class="" href="regression.html"><span class="header-section-number">19</span> 単変量と多変量回帰</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> データの欠損</a></li>
<li><a class="" href="standardization.html"><span class="header-section-number">21</span> 標準化率</a></li>
<li><a class="" href="moving-average.html"><span class="header-section-number">22</span> 移動平均</a></li>
<li><a class="" href="time-series.html"><span class="header-section-number">23</span> 時系列分析とアウトブレイクの検出</a></li>
<li><a class="" href="epidemic-models.html"><span class="header-section-number">24</span> エピデミックモデリング</a></li>
<li><a class="" href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></li>
<li><a class="active" href="survey-analysis.html"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></li>
<li><a class="" href="gis.html"><span class="header-section-number">28</span> GIS の基本</a></li>
<li class="book-part">データの可視化</li>
<li><a class="" href="tables-presentation.html"><span class="header-section-number">29</span> 見やすい表の作り方</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> ggplot の基本</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> ggplotのヒント</a></li>
<li><a class="" href="epicurves.html"><span class="header-section-number">32</span> 流行曲線（エピカーブ）</a></li>
<li><a class="" href="age-pyramid.html"><span class="header-section-number">33</span> 人口ピラミッドとリッカート尺度</a></li>
<li><a class="" href="heatmaps.html"><span class="header-section-number">34</span> ヒートマップ</a></li>
<li><a class="" href="diagrams.html"><span class="header-section-number">35</span> フローチャート・サンキー図・タイムライン</a></li>
<li><a class="" href="combination-analysis.html"><span class="header-section-number">36</span> 複数回答データの分析</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> 感染連鎖</a></li>
<li><a class="" href="phylogenetic-trees.html"><span class="header-section-number">38</span> 系統樹</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> 動的な図の作成</a></li>
<li class="book-part">レポートとダッシュボード</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">40</span> R Markdown で作るレポート</a></li>
<li><a class="" href="reportfactory.html"><span class="header-section-number">41</span> ルーチンで作成するレポートの整理</a></li>
<li><a class="" href="flexdashboard.html"><span class="header-section-number">42</span> R Markdownで作るダッシュボード</a></li>
<li><a class="" href="shiny-basics.html"><span class="header-section-number">43</span> Shiny で作るダッシュボード</a></li>
<li class="book-part">その他</li>
<li><a class="" href="writing-functions.html"><span class="header-section-number">44</span> 関数の作成</a></li>
<li><a class="" href="directories.html"><span class="header-section-number">45</span> ディレクトリの操作</a></li>
<li><a class="" href="collaboration.html"><span class="header-section-number">46</span> Git と Github を使ったバージョン管理と共同作業</a></li>
<li><a class="" href="errors.html"><span class="header-section-number">47</span> よくあるエラー</a></li>
<li><a class="" href="help.html"><span class="header-section-number">48</span> ヘルプ</a></li>
<li><a class="" href="network-drives.html"><span class="header-section-number">49</span> ネットワークドライブで R を使用する場合</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table パッケージを使用したデータ処理</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="survey-analysis" class="section level1" number="26">
<h1>
<span class="header-section-number">26</span> 標本調査データ分析<a class="anchor" aria-label="anchor" href="#survey-analysis"><i class="fas fa-link"></i></a>
</h1>
<!-- ======================================================= -->
<div id="概要-3" class="section level2" number="26.1">
<h2>
<span class="header-section-number">26.1</span> 概要<a class="anchor" aria-label="anchor" href="#%E6%A6%82%E8%A6%81-3"><i class="fas fa-link"></i></a>
</h2>
<p>この章では、標本調査データ分析のためのいくつかのパッケージの使用方法を説明します。</p>
<p>ほとんどの調査用 R パッケージは、重み付け分析を行うために <a href="https://cran.r-project.org/web/packages/survey/index.html"><strong>survey</strong>パッケージ</a>に依存しています。本章では、<strong>survey</strong> パッケージと同様に <a href="https://cran.r-project.org/web/packages/srvyr/index.html"><strong>srvyr</strong></a> パッケージ（tidyverse スタイルのコーディングを可能にする <strong>survey</strong> パッケージのラッパー）および <a href="https://cran.r-project.org/web/packages/gtsummary/index.html"><strong>gtsummary</strong></a> パッケージ（出版原稿レベルの整った表の出力を可能にする <strong>survey</strong> パッケージのラッパー）を使用します。オリジナルの <strong>survey</strong> パッケージは、tidyverse スタイルのコーディングはできませんが、調査重み付け一般化線形モデル（survey-weighted generalised linearmodel）を使用できるという利点があります（後日この章に追加される予定です）。また、<a href="https://github.com/R4EPI/sitrep"><strong>sitrep</strong></a> パッケージの関数を使用して、標本抽出法による重み付けを作成するデモも行います（注：このパッケージは現在 CRAN にはありませんが、Github からインストールできます）。</p>
<p>この章のほとんどは、<a href="https://r4epis.netlify.app/">“R4Epis” プロジェクト</a>で行われた作業に基づいています。詳細なコードと R markdown テンプレートファイルについては、<a href="https://github.com/R4EPI/sitrep">“R4Epis” の Github ページ</a>を参照してください。<strong>survey</strong> パッケージを利用したのコードの一部は、<a href="https://github.com/EPIET/RapidAssessmentSurveys">EPIET ケーススタディ</a>の初期バージョンに基づいています。</p>
<p>現在、この章では標本サイズの計算や標本抽出法そのものについては触れていません。簡単に利用できる標本サイズ計算機については、<a href="https://www.openepi.com/Menu/OE_Menu.htm">OpenEpi</a> を参照してください。ハンドブックの <a href="gis.html#gis">GIS の基礎</a>の章には、いずれ空間的無作為抽出のセクションが設けられ、本章には、標本サイズの計算だけでなく、無作為抽出するための「標本抽出枠」（sampling frame）のセクションが設けられる予定です。</p>
<ol style="list-style-type: decimal">
<li>調査データ</li>
<li>観察期間</li>
<li>重み付け</li>
<li>調査デザイン対象</li>
<li>記述的分析</li>
<li>重み付けされた割合</li>
<li>重み付けされた比率</li>
</ol>
<!-- ======================================================= -->
</div>
<div id="準備-16" class="section level2" number="26.2">
<h2>
<span class="header-section-number">26.2</span> 準備<a class="anchor" aria-label="anchor" href="#%E6%BA%96%E5%82%99-16"><i class="fas fa-link"></i></a>
</h2>
<div id="パッケージ-2" class="section level3 unnumbered">
<h3>パッケージ<a class="anchor" aria-label="anchor" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-2"><i class="fas fa-link"></i></a>
</h3>
<p>以下のコードを実行すると、分析に必要なパッケージが読み込まれます。このハンドブックでは、パッケージを読み込むために、<strong>pacman</strong> パッケージの <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> を主に使用しています。<code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> は、必要に応じてパッケージをインストールし、現在の R セッションで使用するためにパッケージを読み込む関数です。また、すでにインストールされたパッケージは、R の基本パッケージである <strong>base</strong> （以下、<strong>base</strong> R）の <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> を使用して読み込むこともできます。R のパッケージに関する詳細は <a href="basics.html#basics">R の基礎</a> の章をご覧ください。
<strong>pacman</strong> パッケージの <code><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh()</a></code> 関数を使って、まだ CRAN で公開されていない github 上のパッケージをインストールして読み込むデモも行っています。</p>
<div class="sourceCode" id="cb1239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## CRAN からパッケージを読み込む</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">rio</span>,          <span class="co"># ファイルのインポート</span></span>
<span>               <span class="va">here</span>,         <span class="co"># ファイルパスの指定</span></span>
<span>               <span class="va">tidyverse</span>,    <span class="co"># データ管理 + ggplot2 のグラフ</span></span>
<span>               <span class="va">tsibble</span>,      <span class="co"># 時系列データセットを扱う</span></span>
<span>               <span class="va">survey</span>,       <span class="co"># 調査関数</span></span>
<span>               <span class="va">srvyr</span>,        <span class="co"># survey パッケージ用の dplyr ラッパー</span></span>
<span>               <span class="va">gtsummary</span>,    <span class="co"># 表作成のための survey パッケージ</span></span>
<span>               <span class="va">apyramid</span>,     <span class="co"># 年齢ピラミッド作成のためのパッケージ</span></span>
<span>               <span class="va">patchwork</span>,    <span class="co"># ggplot を組み合わせるためのパッケージ</span></span>
<span>               <span class="va">ggforce</span>       <span class="co"># 沖積図・サンキーダイアグラム</span></span>
<span>               <span class="op">)</span> </span>
<span></span>
<span><span class="co">## load packages from github</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh</a></span><span class="op">(</span></span>
<span>     <span class="st">"R4EPI/sitrep"</span>          <span class="co"># 観察期間・重み付け関数</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="データの読み込み-2" class="section level3 unnumbered">
<h3>データの読み込み<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-2"><i class="fas fa-link"></i></a>
</h3>
<p>本章で使用する例示用データセットです。</p>
<ul>
<li>架空の死亡率調査データ</li>
<li>調査対象地域の架空の母集団</li>
<li>架空の死亡率調査データのデータ辞書</li>
</ul>
<p>これらは、MSF OCA 倫理審査委員会が事前に承認した調査に基づいています。架空のデータセットは、<a href="https://r4epis.netlify.app/">“R4Epis” プロジェクト</a>の一環として作成されました。これはすべて、<a href="https://opendatakit.org/">OpenDataKit</a> をベースにしたデータ収集ソフトウェアである <a href="https://www.kobotoolbox.org/">KoboToolbox</a> を使って収集したデータに基づいています。</p>
<p>Kobo では、収集したデータだけでなく、そのデータセットのデータ辞書もエクスポートできます。データの前処理が容易になり、変数や質問文を調べるのに便利なので、この方法を強くお勧めします。</p>
<p><span style="color: darkgreen;"><strong><u>ヒント：</u></strong> Kobo のデータ辞書形式（例、<a href="https://github.com/R4EPI/epidict/blob/master/inst/extdata/MSF-survey-dict.xlsx">MSF-survey-dict.xlsx</a>）では、調査ごとシートに分かれており、各シートの “name” 列に変数名（質問）が記載されています。各変数がとり得る値（回答の選択肢）は、“options” シートで設定されています。“options” シートでは、“name” 列には選択肢の省略形が、“label::english” および “label::french” 列にはそれぞれの言語で適切な長さの選択肢が表示されています。<strong>Epidict</strong> パッケージの <code>msf_dict_survey()</code> 関数を使って、Kobo データ辞書形式の Excel ファイルをインポートすると、対象の調査シートがデータフレームに変換されるので、調査データをコード記述に簡単に利用できます。</span></p>
<p><span style="color: orange;"><strong><u>注意：</u></strong><a href="data-used.html#data-used">ハンドブックとデータのダウンロード</a> からダウンロードできる例示用データセット（survey_dict.xlsx）は、Kobo からの単純なエクスポートとは出力形式が異なります（Koboでは、異なる質問表をそれぞれ個別にエクスポートします）異なる質問表をマージするには、以下の「調査データ」のセクションを参照してください。</span></p>
<p>データセットは <strong>rio</strong> パッケージの <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> 関数を使ってインポートされます。データをインポートするさまざまな方法については、<a href="importing.html#importing">データのインポート・エクスポート</a>の章を参照してください。</p>
<div class="sourceCode" id="cb1240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 調査データをインポートする</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"survey_data.xlsx"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># データ辞書を R にインポートする</span></span>
<span><span class="va">survey_dict</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"survey_dict.xlsx"</span><span class="op">)</span> </span></code></pre></div>
<p>調査データの最初の 10 行を以下に示します。</p>
<div id="htmlwidget-bbdaf687887730094860" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bbdaf687887730094860">{"x":{"filter":"none","vertical":false,"data":[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["2018-04-15T00:00:00Z","2018-03-04T00:00:00Z","2018-04-16T00:00:00Z","2018-01-23T00:00:00Z","2018-01-09T00:00:00Z","2018-03-07T00:00:00Z","2018-02-18T00:00:00Z","2018-04-12T00:00:00Z","2018-04-17T00:00:00Z","2018-01-05T00:00:00Z"],[null,null,null,null,null,null,null,null,null,null],["village_1","village_1","village_10","village_5","village_3","village_8","other","village_7","village_4","village_2"],[null,null,null,null,null,null,null,null,null,null],[1,1,10,5,3,8,11,7,4,2],[9,1,15,6,18,14,17,16,13,14],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["yes","no","no","yes","no","yes","no","yes","yes","yes"],[null,"no_benefit","neg_experience",null,"other",null,"no_benefit",null,null,null],[null,null,null,null,null,null,null,null,null,null],[6,null,null,8,null,5,null,6,5,5],["female",null,null,"female",null,"male",null,"male","male","female"],[26,null,null,3,null,22,null,33,96,18],[null,null,null,36,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no",null,null,"no",null,"yes",null,"yes","yes","yes"],["yes",null,null,null,null,"yes",null,"no","no","no"],["secondary",null,null,null,null,"secondary",null,null,null,null],["no",null,null,"no",null,"yes",null,"no","yes","yes"],[null,null,null,null,null,"yes",null,null,"no","no"],["yes",null,null,null,null,null,null,null,null,"yes"],["no",null,null,"no",null,"yes",null,"yes","no","yes"],["yes",null,null,"no",null,"no",null,"no","yes","yes"],["no",null,null,null,null,null,null,null,"no","no"],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"no",null,"no",null,"yes","no","no"],["no",null,null,null,null,null,null,"no",null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no","no","no","no","no","no","no","no","yes","no"],[null,null,null,null,null,null,null,null,"no",null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,"dont_know",null],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"yes",null,"no",null,"yes","no","no"],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["sexual",null,null,"sexual",null,null,null,"shot",null,null],["0",null,null,"0",null,null,null,"0",null,null],["1",null,null,"1",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"1",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],[9,1,183,83,58,146,205,130,72,33],[1,1,1,1,1,1,1,1,1,1],["9_1","1_1","183_1","83_1","58_1","146_1","205_1","130_1","72_1","33_1"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>start<\/th>\n      <th>end<\/th>\n      <th>today<\/th>\n      <th>deviceid<\/th>\n      <th>date<\/th>\n      <th>team_number<\/th>\n      <th>village_name<\/th>\n      <th>village_other<\/th>\n      <th>cluster_number<\/th>\n      <th>household_number<\/th>\n      <th>households_building<\/th>\n      <th>random_hh<\/th>\n      <th>random_hh_note<\/th>\n      <th>consent<\/th>\n      <th>no_consent_reason<\/th>\n      <th>no_consent_other<\/th>\n      <th>member_number<\/th>\n      <th>sex<\/th>\n      <th>age_years<\/th>\n      <th>age_months_calc<\/th>\n      <th>age_months<\/th>\n      <th>bednet<\/th>\n      <th>read_write<\/th>\n      <th>education_level<\/th>\n      <th>measles_vaccination<\/th>\n      <th>vaccination_card<\/th>\n      <th>pregnant<\/th>\n      <th>malaria_treatment<\/th>\n      <th>arrived<\/th>\n      <th>remember_arrival<\/th>\n      <th>arrived_date<\/th>\n      <th>left<\/th>\n      <th>remember_departure<\/th>\n      <th>left_date<\/th>\n      <th>born<\/th>\n      <th>remember_dob<\/th>\n      <th>birthday_date<\/th>\n      <th>died<\/th>\n      <th>remember_death<\/th>\n      <th>death_date<\/th>\n      <th>cause<\/th>\n      <th>cause_other<\/th>\n      <th>violent_episode<\/th>\n      <th>violent_episodes_number<\/th>\n      <th>violence_nature_other<\/th>\n      <th>violence_nature<\/th>\n      <th>violence_nature/beaten<\/th>\n      <th>violence_nature/sexual<\/th>\n      <th>violence_nature/shot<\/th>\n      <th>violence_nature/detained_kidnapped<\/th>\n      <th>violence_nature/other<\/th>\n      <th>violence_nature/no_response<\/th>\n      <th>index<\/th>\n      <th>index_y<\/th>\n      <th>uid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[8,9,16,18,19,20,52,53]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>適切な重みを作成するために、標本を抽出した集団（母集団）についてのデータをインポートしましょう。このデータの形式はいろいろなファイル形式で作成できますが、以下に例示するような形式をお勧めします（このデータは、Excel に直接入力しても作成できます）。</p>
<div class="sourceCode" id="cb1241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 母集団データをインポートする</span></span>
<span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"population.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>母集団データの最初の 10 行を以下に示します。</p>
<div id="htmlwidget-a78ddca66a6b7936d213" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a78ddca66a6b7936d213">{"x":{"filter":"none","vertical":false,"data":[["0-2","3-14","15-29","30-44","45+","0-2","3-14","15-29","30-44","45+"],["male","male","male","male","male","female","female","female","female","female"],[0.034,0.1811,0.138,0.0808,0.0661,0.034,0.1811,0.138,0.0808,0.0661],[340,1811,1380,808,661,340,1811,1380,808,661],["district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_group<\/th>\n      <th>sex<\/th>\n      <th>proportions<\/th>\n      <th>population<\/th>\n      <th>health_district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>クラスター調査の場合は、クラスター単位で調査の重みを加えることが必要な場合もあります。クラスター単位のデータは上記と同じ手段でインポートできます。あるいは、クラスターや世帯のカウント数が少ない場合は、以下のように入力してクラスターとクラスターが含む世帯数の 2 つの列を定義できます。いずれの方法にしても、調査データと一致するクラスターを識別する列と、各クラスターが含む世帯数を表す列が必要になります。</p>
<div class="sourceCode" id="cb1242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 各クラスターの世帯数を定義する</span></span>
<span><span class="va">cluster_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"village_1"</span>, <span class="st">"village_2"</span>, <span class="st">"village_3"</span>, <span class="st">"village_4"</span>, </span>
<span>                                     <span class="st">"village_5"</span>, <span class="st">"village_6"</span>, <span class="st">"village_7"</span>, <span class="st">"village_8"</span>,</span>
<span>                                     <span class="st">"village_9"</span>, <span class="st">"village_10"</span><span class="op">)</span>, </span>
<span>                         households <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">700</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">500</span>, <span class="fl">300</span>, </span>
<span>                                        <span class="fl">800</span>, <span class="fl">700</span>, <span class="fl">400</span>, <span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="データの前処理データクリーニング" class="section level3 unnumbered">
<h3>データの前処理（データクリーニング）<a class="anchor" aria-label="anchor" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%89%8D%E5%87%A6%E7%90%86%E3%83%87%E3%83%BC%E3%82%BF%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0"><i class="fas fa-link"></i></a>
</h3>
<p>日付を値として持つ変数（列）が適切な形式であることを以下で確認しています。他にもいくつかの方法がありますが（詳しくは「<a href="dates.html#dates">日付型データ</a>」の章をご覧ください）、データ辞書を使って日付を定義するのが手っ取り早くて簡単です。</p>
<p>また、<strong>epikit</strong> パッケージの <code>age_categories()</code> 関数を使って、年齢グループの変数を作成します（詳細は<a href="cleaning.html#cleaning">データクリーニングと主要関数</a>の章を参照）。さらに、各クラスターがどの担当保健所に含まれるかを定義する文字型変数（列）を作成します。</p>
<p>最後に、yes/no で回答されている変数（列）をすべて TRUE/FALSE の値を取る変数に上書きします。値が yes/no のままであると、これらの変数は <strong>survey</strong> パッケージの人口を扱う関数で使用できません。</p>
<div class="sourceCode" id="cb1243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## survery_dict オブジェクトからtype 列に値 date を持つ行を選択する </span></span>
<span><span class="va">DATEVARS</span> <span class="op">&lt;-</span> <span class="va">survey_dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"date"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 前行でフィルタした行の "name" 列の値が survey_data オブジェクト内の変数名（列名）と、一致した行をフィルタする</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># type 列に値 date を持つ行を選択する</span></span>
<span>  </span>
<span><span class="co">## survey_data オブジェクト内の変数（列）で DATEVARS に含まれる変数（列）を日付型に変更する </span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">DATEVARS</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## 年齢が月単位の値（1 歳未満）を年齢の変数に加える（12 で割る）</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_years</span><span class="op">)</span>, </span>
<span>                             <span class="va">age_months</span> <span class="op">/</span> <span class="fl">12</span>, </span>
<span>                             <span class="va">age_years</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 年齢層を格納する変数を定義する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span><span class="va">age_years</span>, </span>
<span>                                    breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">45</span><span class="op">)</span></span>
<span>                                    <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## 他に cluster_number 変数（列）の内容を基にした health_distinct （担当保健所）という文字型変数（列）を作成する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>health_district <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">cluster_number</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="st">"district_a"</span>, </span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"district_b"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## survey_dict オブジェクトから type 列 に yn を値として持つ行を選択する </span></span>
<span><span class="va">YNVARS</span> <span class="op">&lt;-</span> <span class="va">survey_dict</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"yn"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 前行でフィルタした行の "name" 列の値が survey_data オブジェクト内の変数名（列名）と、一致した行をフィルタする</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># type 列に値 yn を持つ行を選択する</span></span>
<span>  </span>
<span><span class="co">## survey_data オブジェクト内の変数（列）で YNVARS に含まれる変数（列）をロジカル型に変更する </span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html">all_of</a></span><span class="op">(</span><span class="va">YNVARS</span><span class="op">)</span>, </span>
<span>                <span class="va">str_detect</span>, </span>
<span>                pattern <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="調査データ" class="section level2" number="26.3">
<h2>
<span class="header-section-number">26.3</span> 調査データ<a class="anchor" aria-label="anchor" href="#%E8%AA%BF%E6%9F%BB%E3%83%87%E3%83%BC%E3%82%BF"><i class="fas fa-link"></i></a>
</h2>
<p>標本調査の方法には、さまざまな標本抽出法があります。このセクションでは、以下の標本抽出法のコード実装例を紹介します。
- 層化抽出法
- クラスター抽出法
- 層化クラスター抽出法</p>
<p>「データの読み込み」セクションで例示したように、（調査票をどのように計画するかにもよりますが）各レベル（水準）のデータは、Kobo から別々のデータセットとしてエクスポートされます。下記のコード例では、世帯と、その世帯内の個人がそれぞれ 1 つのレベルで表現されています。</p>
<p>この 2 つのレベルは、一意の識別子で紐付けられています。Kobo のデータセットの場合、識別子は世帯レベルの “_index” という変数の値であり、各個人レベルの “_parent_index” という変数名の値と一致します。<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> による結合操作で、識別子が一致する個人ごとに世帯の新しい行が作成されます。詳細はハンドブックの<a href="joining-matching.html#joining-matching">データの結合</a>の章を参照してください。</p>
<div class="sourceCode" id="cb1244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 個人データと世帯データを結合し、完全なデータセットを作成する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">survey_data_hh</span>, </span>
<span>                         <span class="va">survey_data_indiv</span>,</span>
<span>                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_index"</span> <span class="op">=</span> <span class="st">"_parent_index"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## 個人と世帯の 2 つのレベルの組み合わせで、新たに識別子を作成する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>uid <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{index}_{index_y}"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="観察期間" class="section level2" number="26.4">
<h2>
<span class="header-section-number">26.4</span> 観察期間<a class="anchor" aria-label="anchor" href="#%E8%A6%B3%E5%AF%9F%E6%9C%9F%E9%96%93"><i class="fas fa-link"></i></a>
</h2>
<p>死亡率調査において、対象期間における適切な死亡率を算出するために、各個人が対象地域にどのくらいの期間、居住したかという情報が必要です。この居住に関する情報は、すべての調査に当てはまるわけではありませんが、特に死亡率調査の場合は重要です。なぜなら、移動人口や避難民人口を含んだ状況で頻繁に行われる調査だからです。</p>
<p>死亡率調査を行うためには、まず、対象期間を設定する必要があります。対象期間の設定は、想起期間（リコール期間、質問に答える際に参加者にその期間の健康状態を考慮して回答を求める期間）としても知られています。例えば、この対象期間を利用して、対象期間外の死亡報告などは、不適切な日付として欠損値を設定できます。</p>
<div class="sourceCode" id="cb1245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 想起期間の開始日・終了日を設定する</span></span>
<span><span class="co">## データセットに日付型変数（列）として設定</span></span>
<span><span class="co">## (例：転入日や質問日)</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>recall_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-01-01"</span><span class="op">)</span>, </span>
<span>         recall_end   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-05-01"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># ルールに基づいて不適切な日付に NA を設定する </span></span>
<span><span class="co">## 例：想起期間開始前の転入、想起期間終了後の転出</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>           arrived_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">arrived_date</span> <span class="op">&lt;</span> <span class="va">recall_start</span>, </span>
<span>                                 <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                                  <span class="va">arrived_date</span><span class="op">)</span>,</span>
<span>           birthday_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">birthday_date</span> <span class="op">&lt;</span> <span class="va">recall_start</span>,</span>
<span>                                  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                                  <span class="va">birthday_date</span><span class="op">)</span>,</span>
<span>           left_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">left_date</span> <span class="op">&gt;</span> <span class="va">recall_end</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                               <span class="va">left_date</span><span class="op">)</span>,</span>
<span>           death_date <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">death_date</span> <span class="op">&gt;</span> <span class="va">recall_end</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>                               <span class="va">death_date</span><span class="op">)</span></span>
<span>           <span class="op">)</span></span></code></pre></div>
<p>次に、日付型の値を格納している変数（列）を使って、観察期間開始日と観察期間終了日を設定します。<strong>sitrep</strong> パッケージの <code>find_start_date()</code> 関数と <code>find_end_date()</code> 関数を使って、観察期間開始・終了イベント発生理由とそれぞれの日付を調べます。そして、調べた観察期間開始・終了の日付を使って観察日数（person-time）を計算します。</p>
<p>観察期間開始日：想起期間内の適切なイベント開始の中で最も古い日付。想起期間の開始日（事前に設定する）、または該当するイベントがある場合は想起期間開始以後の日付（例：転入や出生など）が割り当てられる</p>
<p>観察期間終了日：想起期間内の適切なイベント終了の中で最も新しい日付。想起期間の終了日（事前に設定する）、または該当するイベントがある場合は想起期間終了以前の日付（例：転出や死亡など）が割り当てられる</p>
<div class="sourceCode" id="cb1246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 観察期間開始日、観察期間終了日、それぞれのイベント発生理由を格納するための新しい変数（列）を作成する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="co">## イベント発生理由が、出生、転入（世帯の転入、難民キャンプの転入）のうち</span></span>
<span>     <span class="co">## 入力された最も古い日付を選択する</span></span>
<span>     <span class="fu">find_start_date</span><span class="op">(</span><span class="st">"birthday_date"</span>,</span>
<span>                  <span class="st">"arrived_date"</span>,</span>
<span>                  period_start <span class="op">=</span> <span class="st">"recall_start"</span>,</span>
<span>                  period_end   <span class="op">=</span> <span class="st">"recall_end"</span>,</span>
<span>                  datecol      <span class="op">=</span> <span class="st">"startdate"</span>,</span>
<span>                  datereason   <span class="op">=</span> <span class="st">"startcause"</span> </span>
<span>                 <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>     <span class="co">## イベント発生理由が、転出（難民キャンプの転出ふくむ）、死亡、調査の終了のうち</span></span>
<span>     <span class="co">## 入力された最も新しい日付を選択する</span></span>
<span>     <span class="fu">find_end_date</span><span class="op">(</span><span class="st">"left_date"</span>,</span>
<span>                <span class="st">"death_date"</span>,</span>
<span>                period_start <span class="op">=</span> <span class="st">"recall_start"</span>,</span>
<span>                period_end   <span class="op">=</span> <span class="st">"recall_end"</span>,</span>
<span>                datecol      <span class="op">=</span> <span class="st">"enddate"</span>,</span>
<span>                datereason   <span class="op">=</span> <span class="st">"endcause"</span> </span>
<span>               <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## 想起期間開始・終了時点で継続して居住していた記録にラベルをつける（出生・死亡を除く）</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>       <span class="co">## 想起期間の開始日を個人の観察期間開始日に設定する（個人の観察期間開始日が欠損している場合への対応） </span></span>
<span>       startdate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">)</span>, <span class="va">recall_start</span>, <span class="va">startdate</span><span class="op">)</span>, </span>
<span>       <span class="co">## 個人の観察期間開始日が、出生日と等しくなく、かつ、想起期間開始日と等しい場合、</span></span>
<span>       <span class="co">## 観察期間開始理由を "Present at start" と設定する </span></span>
<span>       startcause <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">startdate</span> <span class="op">==</span> <span class="va">recall_start</span> <span class="op">&amp;</span> <span class="va">startcause</span> <span class="op">!=</span> <span class="st">"birthday_date"</span>,</span>
<span>                              <span class="st">"Present at start"</span>, <span class="va">startcause</span><span class="op">)</span>, </span>
<span>       <span class="co">## 想起期間の終了日を個人の観察期間終了日に設定する（個人の観察期間終了日が欠損している場合への対応） </span></span>
<span>       enddate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">enddate</span><span class="op">)</span>, <span class="va">recall_end</span>, <span class="va">enddate</span><span class="op">)</span>, </span>
<span>       <span class="co">## 個人の観察期間終了日が、死亡日と等しくなく、かつ、想起期間終了日に等しい場合は、</span></span>
<span>       <span class="co">## 観察期間終了理由を "Present at end" と設定する</span></span>
<span>       endcause <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">enddate</span> <span class="op">==</span> <span class="va">recall_end</span> <span class="op">&amp;</span> <span class="va">endcause</span> <span class="op">!=</span> <span class="st">"death_date"</span>, </span>
<span>                            <span class="st">"Present at end"</span>, <span class="va">endcause</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## 観察期間を日単位で計算し obstime 変数（列）に設定する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>obstime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">enddate</span> <span class="op">-</span> <span class="va">startdate</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="調査の重み付け" class="section level2" number="26.5">
<h2>
<span class="header-section-number">26.5</span> 調査の重み付け<a class="anchor" aria-label="anchor" href="#%E8%AA%BF%E6%9F%BB%E3%81%AE%E9%87%8D%E3%81%BF%E4%BB%98%E3%81%91"><i class="fas fa-link"></i></a>
</h2>
<p>調査の重み付けを実行する前に、誤った観測値の除外が必要です。例えば、負の観察期間が入力されている観察値がある場合、その詳細を確認する必要があります（<strong>sitrep</strong> パッケージの <code>assert_positive_timespan()</code> で負の観察期間の記録を一覧できます）。他に必要な前処理は、空行の除外や（例えば <code>drop_na(uid)</code> を使用して）、重複した行の除外です（詳細はハンドブックの <a href="deduplication.html#deduplication">重複データの排除</a>の章を参照してください）。同意（インフォームド・コンセント）が取れていない記録（“concent” 変数（列）が false）も除外する必要があります。</p>
<p>下記例では、除外したいケースを抽出して、別のデータフレーム（dropped）に保存します。この抽出操作により、調査分析から除外された症例を明示できます。次に、<strong>dplyr</strong> パッケージの <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code> 関数を使用して、調査データ（survey_data）オブジェクトからこれらの除外された症例を削除します。</p>
<p><span style="color: red;"><strong><u>危険：</u></strong> 体重の変数や、調査デザインに関連する変数（年齢、性別、層やクラスターの変数など）に欠損値があってはいけません。</span></p>
<div class="sourceCode" id="cb1247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 除外した症例を別のデータフレームとして保存しておけば、除外理由を説明できる（例：同意がないもしくは、誤った市区町村・クラスター)</span></span>
<span><span class="va">dropped</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">consent</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">enddate</span><span class="op">)</span> <span class="op">|</span> <span class="va">village_name</span> <span class="op">==</span> <span class="st">"other"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 除外された症例データセットを使用して、調査データセットから未使用の記録（行）を削除する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="va">survey_data</span>, <span class="va">dropped</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dropped</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>前述のように、3 つの異なる標本抽出法（層化抽出法、クラスター抽出法、層化クラスター抽出法）について、重みを追加する方法を示します。これらの抽出法には、母集団、標本の両方とも，またはいずれか一方の集団に関する情報が必要です。下記例では、層化クラスター抽出法のための重みを追加するコードを使用しますが、研究デザインに最も適したものを使用してください。</p>
<div class="sourceCode" id="cb1248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 層化抽出法 ------------------------------------------------------------------------</span></span>
<span><span class="co"># 年齢層別（age_group）、性別（sex）、担当保健所（health_district）各変数（列）についての各個人の重みを含んでいる（層化されている）</span></span>
<span><span class="co"># "surv_weight_strata" という変数（列）を作成する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">add_weights_strata</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey_data</span>,</span>
<span>                                         p <span class="op">=</span> <span class="va">population</span>,</span>
<span>                                         surv_weight <span class="op">=</span> <span class="st">"surv_weight_strata"</span>,</span>
<span>                                         surv_weight_ID <span class="op">=</span> <span class="st">"surv_weight_ID_strata"</span>,</span>
<span>                                         <span class="va">age_group</span>, <span class="va">sex</span>, <span class="va">health_district</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## クラスター抽出法 ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co"># 1 世帯あたりのインタビュー対象者（interviewed）の人数を得る</span></span>
<span><span class="co"># 次に、世帯（親クラスター）の識別子を格納する変数のカウントを持つ変数（列）を追加する（cluster_counts）</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">add_count</a></span><span class="op">(</span><span class="va">index</span>, name <span class="op">=</span> <span class="st">"interviewed"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## クラスターの重みを作成する</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">add_weights_cluster</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey_data</span>,</span>
<span>                                          cl <span class="op">=</span> <span class="va">cluster_counts</span>,</span>
<span>                                          eligible <span class="op">=</span> <span class="va">member_number</span>,</span>
<span>                                          interviewed <span class="op">=</span> <span class="va">interviewed</span>,</span>
<span>                                          cluster_x <span class="op">=</span> <span class="va">village_name</span>,</span>
<span>                                          cluster_cl <span class="op">=</span> <span class="va">cluster</span>,</span>
<span>                                          household_x <span class="op">=</span> <span class="va">index</span>,</span>
<span>                                          household_cl <span class="op">=</span> <span class="va">households</span>,</span>
<span>                                          surv_weight <span class="op">=</span> <span class="st">"surv_weight_cluster"</span>,</span>
<span>                                          surv_weight_ID <span class="op">=</span> <span class="st">"surv_weight_ID_cluster"</span>,</span>
<span>                                          ignore_cluster <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                          ignore_household <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># 層化クラスター抽出法 --------------------------------------------------------------</span></span>
<span><span class="co"># クラスターと層化をかけ合わせた重み（surv_weight_strata * surv_weight_cluster）を作成する（surv_weight_cluster_strata）</span></span>
<span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>surv_weight_cluster_strata <span class="op">=</span> <span class="va">surv_weight_strata</span> <span class="op">*</span> <span class="va">surv_weight_cluster</span><span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="調査デザインオブジェクト" class="section level2" number="26.6">
<h2>
<span class="header-section-number">26.6</span> 調査デザインオブジェクト<a class="anchor" aria-label="anchor" href="#%E8%AA%BF%E6%9F%BB%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><i class="fas fa-link"></i></a>
</h2>
<p>研究デザイン（抽出法）に合わせて調査デザインオブジェクト（survey design object）を作成します。データフレーム（survey_data）と同様に、重み付け人口比率などの計算に使用します。必要な変数（列）がすべて作成されていることを確認してから行います。</p>
<p>抽出法の設定には下記の 4 つの選択肢がありますが、使用しない抽出法に関するコードはコメントアウトしてください。
- 単純無作為抽出法
- 層化抽出法
- クラスター抽出法
- 層化クラスター抽出法</p>
<p>このテンプレートでは、2 つの異なる層（担当保健所 A と B）で標本調査をクラスター化したと仮定します。したがって、全体の推定値を得るためには、クラスターと層の重みを組み合わせる必要があります。</p>
<p>前述したように、抽出法に沿った分析を行うために 2 つのパッケージが用意されています。古典的なものは <strong>survey</strong> パッケージで、それから tidyverse コーディングに適したオブジェクトや関数を作る <strong>srvyr</strong> パッケージというラッパーがあります。両方ともデモを行いますが、本章のコードのほとんどは <strong>srvyr</strong> パッケージベースのオブジェクトを使用することに注意してください。1 つの例外は、<strong>gtsummary</strong> パッケージが <strong>survey</strong> パッケージのオブジェクトしか受け付けないことです。</p>
<div id="survey-パッケージ" class="section level3" number="26.6.1">
<h3>
<span class="header-section-number">26.6.1</span> <strong>Survey</strong> パッケージ<a class="anchor" aria-label="anchor" href="#survey-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fas fa-link"></i></a>
</h3>
<p><strong>survey</strong> パッケージの構文は、<strong>base</strong> R の構文を効果的に使用するため、パイプ （<code>%&gt;%</code>） やその他の <strong>dplyr</strong> パッケージの構文を使用することはできません。<strong>survey</strong> パッケージでは、<code>svydesign()</code> 関数を使用して、適切なクラスタ、重み、層を持つ調査オブジェクト（survey object）を定義します。</p>
<p><span style="color: black;"><strong><u>注釈：</u></strong><code>svydesign()</code> の引数に指定する変数の前にチルダ記号（<code>~</code>）を記述しなければいけません。なぜなら、<strong>survey</strong> パッケージは、formula オブジェクトに基づいて関数の引数に変数を割り当てる <strong>base</strong> R の構文を使用しているためです。</span></p>
<div class="sourceCode" id="cb1249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 単純無作為抽出法 ------------------------------------------------------------------</span></span>
<span><span class="va">base_survey_design_simple</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, <span class="co"># クラスター ID なしを意味する 1 を指定</span></span>
<span>                   weights <span class="op">=</span> <span class="cn">NULL</span>,               <span class="co"># 重みはなし</span></span>
<span>                   strata <span class="op">=</span> <span class="cn">NULL</span>,                <span class="co"># 単純無作為抽出法であるため層の指定はなし</span></span>
<span>                   data <span class="op">=</span> <span class="va">survey_data</span>            <span class="co"># データセットを指定する必要あり</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co">## 層化抽出法 -----------------------------------------------------------------------</span></span>
<span><span class="va">base_survey_design_strata</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,  <span class="co"># クラスター ID なしを意味する 1 を指定</span></span>
<span>                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_strata</span>, <span class="co"># 以前のコードチャンクで作成した層化に対応する重みの変数を指定</span></span>
<span>                   strata <span class="op">=</span> <span class="op">~</span><span class="va">health_district</span>,     <span class="co"># 層化抽出法の指定は担当保健所（health_district）ごとに層化する</span></span>
<span>                   data <span class="op">=</span> <span class="va">survey_data</span>             <span class="co"># データセットを指定する必要あり</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co"># クラスター抽出法 ------------------------------------------------------------------</span></span>
<span><span class="va">base_survey_design_cluster</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">village_name</span>, <span class="co"># クラスター ID を市区町村（village_name）に指定</span></span>
<span>                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_cluster</span>, <span class="co"># 以前のコードチャンクで作成したクラスターに対応する重みの変数を指定</span></span>
<span>                   strata <span class="op">=</span> <span class="cn">NULL</span>,                 <span class="co"># クラスター抽出法であるため層の指定はなし</span></span>
<span>                   data <span class="op">=</span> <span class="va">survey_data</span>              <span class="co"># データセットを指定する必要あり</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co"># 層化クラスター抽出法 --------------------------------------------------------------</span></span>
<span><span class="va">base_survey_design</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">village_name</span>,      <span class="co"># クラスター ID に市区町村（village_name）を指定</span></span>
<span>                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_cluster_strata</span>, <span class="co"># 以前のコードチャンクで作成した重みの変数を指定</span></span>
<span>                   strata <span class="op">=</span> <span class="op">~</span><span class="va">health_district</span>,             <span class="co"># 層化抽出法の指定は担当保健所（health_district）で層化を行う</span></span>
<span>                   data <span class="op">=</span> <span class="va">survey_data</span>                     <span class="co"># データセットを指定する必要あり</span></span>
<span>                  <span class="op">)</span></span></code></pre></div>
</div>
<div id="srvyr-パッケージ" class="section level3" number="26.6.2">
<h3>
<span class="header-section-number">26.6.2</span> <strong>Srvyr</strong> パッケージ<a class="anchor" aria-label="anchor" href="#srvyr-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Srvyr</strong> パッケージでは、<code>as_survey_design()</code> 関数を使うことができます。<code>as_survey_design()</code> は、<code>svydesign()</code> と同じ引数を取りますが、パイプ演算子（<code>%&gt;%</code>）を使えるので、チルダ記号（<code>~</code>）を使う必要はありません。</p>
<div class="sourceCode" id="cb1250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 単純無作為抽出法 ------------------------------------------------------------------</span></span>
<span><span class="va">survey_design_simple</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="fl">1</span>, <span class="co"># クラスター ID なしを意味するは 1 を指定 </span></span>
<span>                   weights <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># 重みはなし</span></span>
<span>                   strata <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># 単純無作為抽出法であるため層の指定はなし</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="co">## 層化抽出法 ------------------------------------------------------------------------</span></span>
<span><span class="va">survey_design_strata</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="fl">1</span>, <span class="co"># クラスター ID なしは 1 を指定</span></span>
<span>                   weights <span class="op">=</span> <span class="va">surv_weight_strata</span>, <span class="co"># 以前のコードチャンクで作成した重みの変数を指定</span></span>
<span>                   strata <span class="op">=</span> <span class="va">health_district</span> <span class="co"># 層化抽出法の指定は担当保健所（health_district）ごとに層化する</span></span>
<span>                  <span class="op">)</span></span>
<span><span class="co">## クラスター抽出法 ------------------------------------------------------------------</span></span>
<span><span class="va">survey_design_cluster</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="va">village_name</span>, <span class="co"># クラスター ID を指定</span></span>
<span>                   weights <span class="op">=</span> <span class="va">surv_weight_cluster</span>, <span class="co"># 以前のコードチャンクで作成した重みの変数を指定</span></span>
<span>                   strata <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># 抽出は単純に（層はなし）</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co">## 層化クラスター --------------------------------------------------------------</span></span>
<span><span class="va">survey_design</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="va">village_name</span>, <span class="co"># クラスター ID に市区町村（village_name）を指定</span></span>
<span>                   weights <span class="op">=</span> <span class="va">surv_weight_cluster_strata</span>, <span class="co"># 以前のコードチャンクで作成した重みの変数を指定</span></span>
<span>                   strata <span class="op">=</span> <span class="va">health_district</span> <span class="co"># 層化抽出法の指定は担当保健所（health_district）ごとに層化する</span></span>
<span>                  <span class="op">)</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="記述的分析" class="section level2" number="26.7">
<h2>
<span class="header-section-number">26.7</span> 記述的分析<a class="anchor" aria-label="anchor" href="#%E8%A8%98%E8%BF%B0%E7%9A%84%E5%88%86%E6%9E%90"><i class="fas fa-link"></i></a>
</h2>
<p>基本的な記述的分析と視覚化は、ハンドブックの他の章で広範囲にカバーされているので、ここでは触れません。詳細は、<a href="tables-descriptive.html#tables-descriptive">記述統計表の作り方</a>、<a href="stat-tests.html#stat-tests">簡単な統計的検定</a>、<a href="tables-presentation.html#tables-presentation">見やすい表の作り方</a>、<a href="ggplot-basics.html#ggplot-basics">ggplot の基礎</a>、<a href="rmarkdown.html#rmarkdown">R Markdown で作るレポート</a>の章を参照してください。</p>
<p>このセクションでは、標本の偏りを調査し、その偏りの程度を視覚化する方法に焦点を当てます。また、沖積図・サンキーダイアグラムを使って、調査環境における人口の流れを視覚化することも検討します。</p>
<p>一般的には、以下のような記述的な分析を含めることを検討すべきです。</p>
<ul>
<li>対象となるクラスター、世帯、個人の最終的な数</li>
<li>分析から除外された人の数とその理由</li>
<li>クラスターあたりの世帯数と世帯あたりの人数の中央値（範囲）</li>
</ul>
<div id="標本抽出のバイアス" class="section level3" number="26.7.1">
<h3>
<span class="header-section-number">26.7.1</span> 標本抽出のバイアス<a class="anchor" aria-label="anchor" href="#%E6%A8%99%E6%9C%AC%E6%8A%BD%E5%87%BA%E3%81%AE%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9"><i class="fas fa-link"></i></a>
</h3>
<p>各年齢層の割合を、標本と母集団の間で比較します。これは、潜在的な標本抽出のバイアスを明らかにするために重要です。同様の操作を性別に対して適用して分布を調べられます。</p>
<p>標本と母集団の比較（二項検定）で設定される p 値は単なる指標であり、母集団と比較した標本集団の分布の記述的な議論（または次のセクションの年齢ピラミッドによる視覚化）は、二項検定自体よりも重要であることに注意してください。なぜなら、標本サイズを大きくすると、データを重み付けした後では、p 値は無関係な差になることが多いからです。</p>
<div class="sourceCode" id="cb1251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 標本の人数と年齢層ごとの人口構成比率</span></span>
<span><span class="va">ag</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, </span>
<span>         n_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 母集団の人数と年齢層ごと人口構成比率</span></span>
<span><span class="va">propcount</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 2 つの表の列を結合し、年齢別にグループ化し、二項検定を行って、</span></span>
<span><span class="co">## 標本の n/total が母集団の n/total と有意に異なるかどうかを調べる</span></span>
<span>  <span class="co">## 次の行では、2 つのデータセットの列の最後に接尾文字を追加している</span></span>
<span><span class="va">joined_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">ag</span>, <span class="va">propcount</span>, by <span class="op">=</span> <span class="st">"age_group"</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_pop"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## broom::tidy(binom.test()) は、二項検定の結果からデータフレームを作成し、</span></span>
<span>  <span class="co">## 変数（列） p.value, parameter, conf.low, conf.high, method, and alternative を追加する</span></span>
<span>  <span class="co">## ここでは p.value のみを使用する</span></span>
<span>  <span class="co">## 信頼区間を報告したい場合は、他の列を含めることができる</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>binom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">n_total</span>, <span class="va">proportion_pop</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">binom</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># important for expanding the binom.test data frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion_pop <span class="op">=</span> <span class="va">proportion_pop</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## 偽陽性を補正するために p 値を調整する </span></span>
<span>  <span class="co">## （複数の年齢層をテストしたことによる）</span></span>
<span>  <span class="co">## これは、多くの年齢カテゴリーがある場合にのみ違いが生じる</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>p.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">p.value</span>, method <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                      </span>
<span>  <span class="co">## 0.001 を超える p 値のみ示す(0.001 未満は &lt;0.001 として示す)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>p.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.001</span>, </span>
<span>                          <span class="st">"&lt;0.001"</span>, </span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p.value</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co">## 列の名前を適切に変更する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="st">"Age group"</span> <span class="op">=</span> <span class="va">age_group</span>,</span>
<span>    <span class="st">"Study population (n)"</span> <span class="op">=</span> <span class="va">n</span>,</span>
<span>    <span class="st">"Study population (%)"</span> <span class="op">=</span> <span class="va">proportion</span>,</span>
<span>    <span class="st">"Source population (n)"</span> <span class="op">=</span> <span class="va">n_pop</span>,</span>
<span>    <span class="st">"Source population (%)"</span> <span class="op">=</span> <span class="va">proportion_pop</span>,</span>
<span>    <span class="st">"P-value"</span> <span class="op">=</span> <span class="va">p.value</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">joined_table</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pageLength <span class="op">=</span> <span class="fl">5</span>, scrollX<span class="op">=</span><span class="cn">T</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">'white-space: nowrap'</span> <span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-f966879e45b2180e06bc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f966879e45b2180e06bc">{"x":{"filter":"none","vertical":false,"data":[["0-2","3-14","15-29","30-44","45+"],[12,42,64,52,299],[0.0255863539445629,0.0895522388059701,0.136460554371002,0.110874200426439,0.637526652452026],[1360,7244,5520,3232,2644],[6.8,36.22,27.6,16.16,13.22],["&lt;0.001","&lt;0.001","&lt;0.001","0.002","&lt;0.001"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Age group<\/th>\n      <th>Study population (n)<\/th>\n      <th>Study population (%)<\/th>\n      <th>Source population (n)<\/th>\n      <th>Source population (%)<\/th>\n      <th>P-value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="人口統計ピラミッド" class="section level3" number="26.7.2">
<h3>
<span class="header-section-number">26.7.2</span> 人口統計ピラミッド<a class="anchor" aria-label="anchor" href="#%E4%BA%BA%E5%8F%A3%E7%B5%B1%E8%A8%88%E3%83%94%E3%83%A9%E3%83%9F%E3%83%83%E3%83%89"><i class="fas fa-link"></i></a>
</h3>
<p>人口統計（または年齢-性別）ピラミッドは、母集団の分布を視覚化する簡単な方法です。また、調査の層別に年齢と性別の<a href="tables-descriptive.html#tables-descriptive">記述統計表</a>を作成することも検討する価値があります。ここでは、上記で作成した調査デザインオブジェクト（study design object）を使用して、加重比例が可能な <strong>apyramid</strong> パッケージを使用して説明します。<a href="age-pyramid.html#age-pyramid">人口ピラミッドとリッカート尺度</a> の章で、人口統計ピラミッドを作成するための他の選択肢について詳しく説明しています。また、<strong>sitrep</strong> パッケージの <code>plot_age_pyramid()</code> ラッパー関数を使用して、人口比率のプロットを作成するためのコーディングを省きます。</p>
<p>前述の標本抽出のバイアスのセクションで例示した母集団と標本の人口比率の差の二項検定のように、このセクションでは、我々の標本抽出した集団が元の母集団と実質的に異なるかどうか、そして重み付けがこの差を修正するかどうかを可視化を扱います。コードを実行するために、<strong>ggplot</strong> パッケージの出力を並べて表示するために <strong>patchwork</strong> パッケージを使用します。詳細はハンドブックの <a href="ggplot-tips.html#ggplot-tips">ggplot のヒント</a> の章の「図の中に図を挿入する」のセクションを参照してください。このセクションでは、「母集団」、「重み付けされていない標本集団」、「重み付けされた標本集団」を視覚化します。また、調査の各層ごとに視覚化も可能です。ここでの例では、<code>stack_by = "health_district"</code> という引数を使用します（詳細は <code>?plot_age_pyramid</code> を参照してください）。</p>
<p><span style="color: black;"><strong><u>注釈：</u></strong>人口ピラミッドのプロットでは、x 軸と y 軸が反転します。</span></p>
<div class="sourceCode" id="cb1252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## x 軸の範囲とラベルを定義する ---------------------------------------------</span></span>
<span><span class="co">## (これらの数値をグラフの値として更新する)</span></span>
<span><span class="va">max_prop</span> <span class="op">&lt;-</span> <span class="fl">35</span>      <span class="co"># 表示させたい人口比率の上限を選ぶ </span></span>
<span><span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">5</span>           <span class="co"># 表示させたいラベル間のスペースを選ぶ</span></span>
<span></span>
<span><span class="co">## 上記の数値を使って、軸の区切りのベクトルを定義する</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span> <span class="op">-</span> <span class="va">step</span><span class="op">/</span><span class="fl">100</span>, <span class="va">step</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, </span>
<span>    <span class="fl">0</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">step</span> <span class="op">/</span> <span class="fl">100</span>, <span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span>, <span class="va">step</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co">## 上記の数値を使って、軸の範囲のベクトルを定義する</span></span>
<span><span class="va">limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, <span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 上記の数値を使って、軸のラベルのベクトルを定義する</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">max_prop</span>, <span class="va">step</span>, <span class="op">-</span><span class="va">step</span><span class="op">)</span>, </span>
<span>      <span class="fl">0</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">step</span>, <span class="va">max_prop</span>, <span class="va">step</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## プロットを個別に作成する  --------------------------------------------------</span></span>
<span></span>
<span><span class="co">## 母集団をプロットする</span></span>
<span><span class="co">## 注：全体の人口を対象にして集計する必要がある（例：担当保健所によるクラスタリングを行わない）</span></span>
<span><span class="va">source_population</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">## 年齢と性別が因子型であることを明示する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_group</span>, </span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-2"</span>, </span>
<span>                                       <span class="st">"3-14"</span>, </span>
<span>                                       <span class="st">"15-29"</span>,</span>
<span>                                       <span class="st">"30-44"</span>, </span>
<span>                                       <span class="st">"45+"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 各担当保健所内の人口数を足し合わせる</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## グループ化を解除して全体の比率を算出する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">population</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 人口ピラミッドをプロットする</span></span>
<span>  <span class="fu">age_pyramid</span><span class="op">(</span></span>
<span>            age_group <span class="op">=</span> <span class="va">age_group</span>, </span>
<span>            split_by <span class="op">=</span> <span class="va">sex</span>, </span>
<span>            count <span class="op">=</span> <span class="va">proportion</span>, </span>
<span>            proportional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## x 軸（表示状は垂直方向に表示される）のラベルのみを表示（設定しないと、他の 3 つのプロットすべてにラベル表示が繰り返される）</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Source population"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">""</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"Age group (years)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## すべてのプロットの x 軸（垂直表示）のスケールを同一にする </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, </span>
<span>    limits <span class="op">=</span> <span class="va">limits</span>, </span>
<span>    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span><span class="co">## 重み付けされていない標本集団をプロットする</span></span>
<span><span class="va">sample_population</span> <span class="op">&lt;-</span> <span class="fu">plot_age_pyramid</span><span class="op">(</span><span class="va">survey_data</span>, </span>
<span>                 age_group <span class="op">=</span> <span class="st">"age_group"</span>, </span>
<span>                 split_by <span class="op">=</span> <span class="st">"sex"</span>,</span>
<span>                 proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## y 軸（表示状は水平方向に表示される）のラベルのみを表示（設定しないと、他の 3 つのプロットすべてにラベル表示が繰り返される）</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Unweighted sample population"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">"Proportion (%)"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## すべてのプロットの y 軸（水平表示）のスケールを同一にする </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, </span>
<span>    limits <span class="op">=</span> <span class="va">limits</span>, </span>
<span>    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## 重み付けされた標本人口をプロットする</span></span>
<span><span class="va">weighted_population</span> <span class="op">&lt;-</span> <span class="va">survey_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## make sure the variables are factors</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span>, </span>
<span>         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">plot_age_pyramid</span><span class="op">(</span></span>
<span>    age_group <span class="op">=</span> <span class="st">"age_group"</span>,</span>
<span>    split_by <span class="op">=</span> <span class="st">"sex"</span>, </span>
<span>    proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## グラフタイトルを表示（設定しないと、他の 3 つのプロットすべてにラベル表示が繰り返される）</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weighted sample population"</span>, </span>
<span>       y <span class="op">=</span> <span class="st">""</span>, </span>
<span>       x <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="co">## すべてのプロットの y 軸（水平表示）のスケールを同一にする </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, </span>
<span>    limits <span class="op">=</span> <span class="va">limits</span>, </span>
<span>    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## 3 つのプロットを組み合わせる  ----------------------------------------------------</span></span>
<span><span class="co">## 隣接する 3 つのプロットを + で結合する</span></span>
<span><span class="va">source_population</span> <span class="op">+</span> <span class="va">sample_population</span> <span class="op">+</span> <span class="va">weighted_population</span> <span class="op">+</span> </span>
<span>  <span class="co">## 凡例を 1 つだけ表示し、テーマを定義する </span></span>
<span>  <span class="co">## テーマを plot_layout() と組み合わせるための &amp; の使用法に注意する</span></span>
<span>  <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># move legend to bottom</span></span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,                <span class="co"># remove title</span></span>
<span>        text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,                <span class="co"># change text size</span></span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># turn x-axis text</span></span>
<span>       <span class="op">)</span></span></code></pre></div>
</div>
<div id="沖積図サンキーダイアグラム" class="section level3" number="26.7.3">
<h3>
<span class="header-section-number">26.7.3</span> 沖積図・サンキーダイアグラム<a class="anchor" aria-label="anchor" href="#%E6%B2%96%E7%A9%8D%E5%9B%B3%E3%82%B5%E3%83%B3%E3%82%AD%E3%83%BC%E3%83%80%E3%82%A4%E3%82%A2%E3%82%B0%E3%83%A9%E3%83%A0"><i class="fas fa-link"></i></a>
</h3>
<p>個人個人の観測開始とアウトカムを視覚化することは、概要を把握するのに非常に役立ちます。移動人口比率を考慮する非常に分かりやすいグラフ描画方法があります。また、コホートや、個人の状態に遷移があるその他の状況などを描画する数多くのグラフがあります。これらのグラフには、沖積図、サンキー、パラレルセットなど、いくつかの異なる表現があり、詳細はハンドブックの<a href="diagrams.html#diagrams">フローチャート・サンキー図・タイムライン</a>の章に記載されています。</p>
<div class="sourceCode" id="cb1253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 標本調査データの要約</span></span>
<span><span class="va">flow_table</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">startcause</span>, <span class="va">endcause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># 観察期間開始理由（startcause）、観察期間終了理由（endcause）、性別（sex）変数（列）のカウントを取得する</span></span>
<span>  <span class="fu">gather_set_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"startcause"</span>, <span class="st">"endcause"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>     <span class="co"># プロットのために startcause、endcause の形式を縦長から横長に変更する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"startcause"</span>, <span class="st">"endcause"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># startcause を最初の水準（レベル）に設定する</span></span>
<span>         x <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html">fct_recode</a></span><span class="op">(</span><span class="va">x</span>, </span>
<span>                        <span class="st">"Start \n cause"</span> <span class="op">=</span> <span class="st">"startcause"</span>,   <span class="co"># 改行コード(\n)を Start や End という文字の後に追加する</span></span>
<span>                        <span class="st">"End \n cause"</span>   <span class="op">=</span> <span class="st">"endcause"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## データセットをプロットする</span></span>
<span>  <span class="co">## x 軸は観察期間開始理由（startcause）と観察期間終了理由（endcause）</span></span>
<span>  <span class="co">## gather_set_data では、可能な組み合わせごとに ID を生成する</span></span>
<span>  <span class="co">## y で分割すると、可能性のある開始と終了の組み合わせを取得できる</span></span>
<span>  <span class="co">## 値を n とすると、数となる（比率に変更することも可能）</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">flow_table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, id <span class="op">=</span> <span class="va">id</span>, split <span class="op">=</span> <span class="va">y</span>, value <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## 性別での色分け </span></span>
<span>  <span class="fu">geom_parallel_sets</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, axis.width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## ラベルボックスをグレーにする</span></span>
<span>  <span class="fu">geom_parallel_sets_axes</span><span class="op">(</span>axis.width <span class="op">=</span> <span class="fl">0.15</span>, fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## 文字の色や角度の変更する（調整が必要）</span></span>
<span>  <span class="fu">geom_parallel_sets_labels</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, angle <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## y 軸と x 軸の調整（おそらく垂直方向のスペースが必要）</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">## 軸ラベルを削除する</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span><span class="op">)</span>,</span>
<span>    text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># 凡例を図の下に移動</span></span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,                <span class="co"># タイトルを除去</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/visualise_population_flow-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="重み付けされた人口比率" class="section level2" number="26.8">
<h2>
<span class="header-section-number">26.8</span> 重み付けされた人口比率<a class="anchor" aria-label="anchor" href="#%E9%87%8D%E3%81%BF%E4%BB%98%E3%81%91%E3%81%95%E3%82%8C%E3%81%9F%E4%BA%BA%E5%8F%A3%E6%AF%94%E7%8E%87"><i class="fas fa-link"></i></a>
</h2>
<p>このセクションでは、重み付けされた人口数と人口比率の表を、関連する信頼区間とデザイン効果（標本の分散の、同じ要素数の単純無作為標本の分散に対する比）とともに作成する方法を詳しく説明します。<strong>survey</strong> パッケージ、<strong>srvyr</strong> パッケージ、<strong>sitrep</strong> パッケージ、<strong>gtsummary</strong> パッケージの関数を使った 4 つの異なる方法があります。標準的な疫学スタイルの表を作成するための最小限のコーディングには、<strong>srvyr</strong> パッケージのラッパーである <strong>sitrep</strong> 関数をお勧めしますが、これはまだ CRAN に掲載されておらず、将来変更される可能性があることに注意してください。それ以外では、<strong>srvyr</strong> パッケージが tidyverse のワークフローに最もうまく適合するのに対し、<strong>survey</strong> パッケージのコードは長期的に最も安定していると思われます。<strong>gtsummary</strong> パッケージの関数群は多くの可能性を秘めていますが、この記事を書いている時点では実験的で不完全なもののようです。</p>
<div id="survey-パッケージ-1" class="section level3" number="26.8.1">
<h3>
<span class="header-section-number">26.8.1</span> <strong>Survey</strong> パッケージ<a class="anchor" aria-label="anchor" href="#survey-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-1"><i class="fas fa-link"></i></a>
</h3>
<p><strong>survey</strong> パッケージから <code>svyciprop()</code> 関数を使用して、重み付けされた人口比率とそれに伴う 95% 信頼区間を得ることができます。適切なデザイン効果は、<code>svyprop()</code> ではなく、<code>svymean()</code> を使用して抽出できます。<code>svyprop()</code>は、0 から 1 の間の値（または TRUE/FALSE）しか受け付けませんので、カテゴリー変数は使えないことに注意する必要があります。</p>
<p><span style="color: black;"><strong><u>注釈：</u></strong> <strong>survey</strong> パッケージ由来の関数は、<strong>srvyr</strong> パッケージデザイン・オブジェクトも受け入れますが、ここでは一貫性を保つために <strong>survey</strong> パッケージデザイン・オブジェクトを使用しています。</span></p>
<div class="sourceCode" id="cb1254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 重み付けされた死亡数を生成する</span></span>
<span><span class="fu">svytable</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span><span class="op">)</span></span></code></pre></div>
<pre><code>## died
##      FALSE       TRUE 
## 1406244.43   76213.01</code></pre>
<div class="sourceCode" id="cb1256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 重み付けされた人口比率を生成する</span></span>
<span><span class="fu">svyciprop</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code>##               2.5% 97.5%
## died 0.0514 0.0208  0.12</code></pre>
<div class="sourceCode" id="cb1258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## デザイン効果を得る</span></span>
<span><span class="fu">svymean</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span>, na.rm <span class="op">=</span> <span class="cn">T</span>, deff <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">deff</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## diedFALSE  diedTRUE 
##  3.755508  3.755508</code></pre>
<p>上記のような <strong>survey</strong> パッケージの関数を組み合わせて、以下のように独自に定義した <code>svy_prop</code> という関数を作成できます。この関数と <strong>purrr</strong> パッケージの <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> を使って、複数の変数を反復処理し、表を作成できます。<strong>purrr</strong> パッケージの詳細については、ハンドブックの<a href="iteration.html#iteration">ループと反復処理・リストの操作</a>の章を参照してください。</p>
<div class="sourceCode" id="cb1260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 重み付けされた死亡数、人口比率、信頼区間、デザイン効果を計算する関数を定義する</span></span>
<span><span class="co"># x は引用符で囲まれた変数</span></span>
<span><span class="co"># design は survey パッケージのデザインオブジェクト</span></span>
<span></span>
<span><span class="va">svy_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## 興味のある変数を計算式に入れる </span></span>
<span>  <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="st">"~"</span> , <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## svytable からカウントの TRUE 列だけを残す</span></span>
<span>  <span class="va">weighted_counts</span> <span class="op">&lt;-</span> <span class="fu">svytable</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="co">## 割合を計算する（100 倍にして ％ を算出）</span></span>
<span>  <span class="va">weighted_props</span> <span class="op">&lt;-</span> <span class="fu">svyciprop</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="co">## 信頼区間を抽出し、乗算してパーセンテージを求める</span></span>
<span>  <span class="va">weighted_confint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">weighted_props</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="co">## svymean を使ってデザイン効果を計算し、TRUE の列だけを残す</span></span>
<span>  <span class="va">design_eff</span> <span class="op">&lt;-</span> <span class="fu">deff</span><span class="op">(</span><span class="fu">svymean</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="cn">TRUE</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">## 1 つのデータフレームにまとめる</span></span>
<span>  <span class="va">full_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>    <span class="st">"Variable"</span>        <span class="op">=</span> <span class="va">x</span>,</span>
<span>    <span class="st">"Count"</span>           <span class="op">=</span> <span class="va">weighted_counts</span>,</span>
<span>    <span class="st">"Proportion"</span>      <span class="op">=</span> <span class="va">weighted_props</span>,</span>
<span>    <span class="va">weighted_confint</span>, </span>
<span>    <span class="st">"Design effect"</span>   <span class="op">=</span> <span class="va">design_eff</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## テーブルをデータフレームとして返す</span></span>
<span>  <span class="va">full_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">full_table</span>, </span>
<span>             <span class="co">## remove the variable names from rows (is a separate column now)</span></span>
<span>             row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## 数値を数字型に戻す</span></span>
<span>  <span class="va">full_table</span><span class="op">[</span> , <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">full_table</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## データフレームを返す</span></span>
<span>  <span class="va">full_table</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 複数の変数を反復してテーブルを作成する </span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span></span>
<span>  <span class="co">## 関心のある変数を定義する</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"died"</span>, <span class="st">"arrived"</span><span class="op">)</span>, </span>
<span>  <span class="co">## 使用する関数とその関数の引数（design）を指定する</span></span>
<span>  <span class="va">svy_prop</span>, design <span class="op">=</span> <span class="va">base_survey_design</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## リストを単一のデータフレームにまとめる</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 四捨五入する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>##   Variable    Count Proportion X2.5. X97.5. Design.effect
## 1     left 701199.1       47.3  39.2   55.5           2.4
## 2     died  76213.0        5.1   2.1   12.1           3.8
## 3  arrived 761799.0       51.4  40.9   61.7           3.9</code></pre>
</div>
<div id="srvyr-パッケージ-1" class="section level3" number="26.8.2">
<h3>
<span class="header-section-number">26.8.2</span> <strong>Srvyr</strong> パッケージ<a class="anchor" aria-label="anchor" href="#srvyr-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-1"><i class="fas fa-link"></i></a>
</h3>
<p><strong>srvyr</strong> パッケージでは、<strong>dplyr</strong> パッケージの構文を使って表を作成できます。<code>survey_mean()</code> が使用され、割合引数が指定されていること、また、デザイン効果の計算にも同じ関数が使用されていることに注意してください。これは、<strong>srvyr</strong> パッケージが、前述のセクションで使われている <strong>survey</strong> パッケージ関数群の <code>svyciprop()</code> と <code>svymean()</code> の両方を内包しているからです。</p>
<p><span style="color: black;"><strong><u>注釈：</u></strong> <strong>srvyr</strong> パッケージを使ってカテゴリカル変数から人口比率を求めることはできないようです。もしこの操作が必要であれば、<strong>sitrep</strong> パッケージを使用する以降のセクションをチェックしてください。 </span></p>
<div class="sourceCode" id="cb1262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## srvyr パッケージのデザイン・オブジェクトの使用</span></span>
<span><span class="va">survey_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="co">## 重み付けされた死亡数を生成する</span></span>
<span>    counts <span class="op">=</span> <span class="fu">survey_total</span><span class="op">(</span><span class="va">died</span><span class="op">)</span>, </span>
<span>    <span class="co">## 重み付けされた人口比率と信頼区間の生成する </span></span>
<span>    <span class="co">## 100 倍にしてパーセンテージを算出する</span></span>
<span>    props <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">died</span>, </span>
<span>                        proportion <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                        vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, </span>
<span>    <span class="co">## デザイン効果を生成する</span></span>
<span>    deff <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">died</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 興味のある行だけを残す</span></span>
<span>  <span class="co">## (標準誤差をドロップして、人口比率の計算を繰り返す)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">counts</span>, <span class="va">props</span>, <span class="va">props_low</span>, <span class="va">props_upp</span>, <span class="va">deff_deff</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   counts props props_low props_upp deff_deff
##    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 76213.  5.14      2.08      12.1      3.76</code></pre>
<p>ここでも <strong>purrr</strong> パッケージを使って、複数の変数を反復処理する関数を書くことができます。<strong>purrr</strong> の詳細については、ハンドブックの<a href="iteration.html#iteration">ループと反復処理・リストの操作</a>の章を参照してください。</p>
<div class="sourceCode" id="cb1264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 重み付けされた死亡数、人口比率、信頼区間、デザイン効果を計算する関数の定義する</span></span>
<span><span class="co"># design は survey パッケージのデザインオブジェクト</span></span>
<span><span class="co"># x は引用符で囲まれた変数</span></span>
<span></span>
<span></span>
<span><span class="va">srvyr_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    <span class="co">## survey パッケージのデザインオブジェクトを使用する</span></span>
<span>    <span class="va">design</span>, </span>
<span>    <span class="co">## 重み付けされた死亡数を生成する </span></span>
<span>    counts <span class="op">=</span> <span class="fu">survey_total</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    <span class="co">## 重み付けされた人口比率と信頼区間の生成する</span></span>
<span>    <span class="co">## 100 倍にしてパーセンテージを求める </span></span>
<span>    props <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                        proportion <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                        vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, </span>
<span>    <span class="co">## デザイン効果を求める</span></span>
<span>    deff <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 変数名を追加する</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 興味のある行だけを残す</span></span>
<span>  <span class="co">## (標準誤差をドロップして、人口比率の計算を繰り返す)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">variable</span>, <span class="va">counts</span>, <span class="va">props</span>, <span class="va">props_low</span>, <span class="va">props_upp</span>, <span class="va">deff_deff</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span>  </span>
<span></span>
<span><span class="co">## 複数の変数を反復してテーブルを作成する </span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span></span>
<span>  <span class="co">## 関心のある変数を定義する</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"died"</span>, <span class="st">"arrived"</span><span class="op">)</span>, </span>
<span>  <span class="co">## 使用する関数とその関数の引数（design）を指定する</span></span>
<span>  <span class="op">~</span><span class="fu">srvyr_prop</span><span class="op">(</span><span class="va">.x</span>, design <span class="op">=</span> <span class="va">survey_design</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## リストを単一のデータフレームにまとめる</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   variable  counts props props_low props_upp deff_deff
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 left     701199. 47.3      39.2       55.5      2.38
## 2 died      76213.  5.14      2.08      12.1      3.76
## 3 arrived  761799. 51.4      40.9       61.7      3.93</code></pre>
</div>
<div id="sitrep-パッケージ" class="section level3" number="26.8.3">
<h3>
<span class="header-section-number">26.8.3</span> <strong>Sitrep</strong> パッケージ<a class="anchor" aria-label="anchor" href="#sitrep-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fas fa-link"></i></a>
</h3>
<p><strong>sitrep</strong> パッケージの <code>tab_survey()</code> は、<strong>srvyr</strong> パッケージのラッパーであり、最小限のコーディングで重み付けされた表を作成できます。また、カテゴリカル変数の加重割合を計算することもできます。</p>
<div class="sourceCode" id="cb1266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## survey_design オブジェクトを使用する</span></span>
<span><span class="va">survey_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 興味のある変数の名前を引用符をつけずに渡す</span></span>
<span>  <span class="fu">tab_survey</span><span class="op">(</span><span class="va">arrived</span>, <span class="va">left</span>, <span class="va">died</span>, <span class="va">education_level</span>,</span>
<span>             deff <span class="op">=</span> <span class="cn">TRUE</span>,   <span class="co"># デザイン効果を求める</span></span>
<span>             pretty <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># 人口比率と95%信頼区間を統合する</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
<pre><code>## Warning: removing 257 missing value(s) from `education_level`</code></pre>
<pre><code>## # A tibble: 9 × 5
##   variable        value            n  deff ci                
##   &lt;chr&gt;           &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             
## 1 arrived         TRUE       761799.  3.93 51.4% (40.9--61.7)
## 2 arrived         FALSE      720658.  3.93 48.6% (38.3--59.1)
## 3 left            TRUE       701199.  2.38 47.3% (39.2--55.5)
## 4 left            FALSE      781258.  2.38 52.7% (44.5--60.8)
## 5 died            TRUE        76213.  3.76 5.1% (2.1--12.1)  
## 6 died            FALSE     1406244.  3.76 94.9% (87.9--97.9)
## 7 education_level higher     171644.  4.70 42.4% (26.9--59.7)
## 8 education_level primary    102609.  2.37 25.4% (16.2--37.3)
## 9 education_level secondary  130201.  6.68 32.2% (16.5--53.3)</code></pre>
</div>
<div id="gtsummary-パッケージ" class="section level3" number="26.8.4">
<h3>
<span class="header-section-number">26.8.4</span> <strong>Gtsummary</strong> パッケージ<a class="anchor" aria-label="anchor" href="#gtsummary-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><i class="fas fa-link"></i></a>
</h3>
<p><strong>gtsummary</strong> パッケージには、信頼区間やデザイン効果を追加するための組み込み関数がまだないようです。ここでは、信頼区間を追加するための関数を定義し、<code>tbl_svysummary()</code> を使って作成した <strong>gtsummary</strong> パッケージのテーブルに信頼区間を追加する方法を示します。</p>
<div class="sourceCode" id="cb1269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confidence_intervals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">variable</span>, <span class="va">by</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## 信頼区間を抽出し、乗算してパーセンテージを求める</span></span>
<span>  <span class="va">props</span> <span class="op">&lt;-</span> <span class="fu">svyciprop</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="st">"~"</span> , <span class="va">variable</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="va">data</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## 信頼区間を抽出する</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">## 数値化してパーセンテージを乗算する</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>           <span class="co">## 1 桁に四捨五入する</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>                           <span class="co">## 行列から数値を抽出する</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, collapse <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>          <span class="co">## 1 つの文字列にまとめる</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## survey パッケージのデザインオブジェクトを使用する</span></span>
<span><span class="fu">tbl_svysummary</span><span class="op">(</span><span class="va">base_survey_design</span>, </span>
<span>               include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">arrived</span>, <span class="va">left</span>, <span class="va">died</span><span class="op">)</span>,   <span class="co">## 含めたい変数を定義する</span></span>
<span>               statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"{n} ({p}%)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">## 興味のある統計量を定義する</span></span>
<span>  <span class="fu">add_n</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co">## 重み付けされた総数を加える</span></span>
<span>  <span class="fu">add_stat</span><span class="op">(</span>fns <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="va">confidence_intervals</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">## 信頼区間を加える</span></span>
<span>  <span class="co">## カラムのヘッダーを変更する</span></span>
<span>  <span class="fu">modify_header</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      <span class="va">n</span> <span class="op">~</span> <span class="st">"**Weighted total (N)**"</span>,</span>
<span>      <span class="va">stat_0</span> <span class="op">~</span> <span class="st">"**Weighted Count**"</span>,</span>
<span>      <span class="va">add_stat_1</span> <span class="op">~</span> <span class="st">"**95%CI**"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<div id="ocsvqxalrs" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ocsvqxalrs .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ocsvqxalrs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ocsvqxalrs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ocsvqxalrs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ocsvqxalrs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ocsvqxalrs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ocsvqxalrs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ocsvqxalrs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ocsvqxalrs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ocsvqxalrs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ocsvqxalrs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ocsvqxalrs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ocsvqxalrs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ocsvqxalrs .gt_from_md > :first-child {
  margin-top: 0;
}

#ocsvqxalrs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ocsvqxalrs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ocsvqxalrs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ocsvqxalrs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ocsvqxalrs .gt_row_group_first td {
  border-top-width: 2px;
}

#ocsvqxalrs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ocsvqxalrs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ocsvqxalrs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ocsvqxalrs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ocsvqxalrs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ocsvqxalrs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ocsvqxalrs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ocsvqxalrs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ocsvqxalrs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ocsvqxalrs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ocsvqxalrs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ocsvqxalrs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ocsvqxalrs .gt_left {
  text-align: left;
}

#ocsvqxalrs .gt_center {
  text-align: center;
}

#ocsvqxalrs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ocsvqxalrs .gt_font_normal {
  font-weight: normal;
}

#ocsvqxalrs .gt_font_bold {
  font-weight: bold;
}

#ocsvqxalrs .gt_font_italic {
  font-style: italic;
}

#ocsvqxalrs .gt_super {
  font-size: 65%;
}

#ocsvqxalrs .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ocsvqxalrs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ocsvqxalrs .gt_indent_1 {
  text-indent: 5px;
}

#ocsvqxalrs .gt_indent_2 {
  text-indent: 10px;
}

#ocsvqxalrs .gt_indent_3 {
  text-indent: 15px;
}

#ocsvqxalrs .gt_indent_4 {
  text-indent: 20px;
}

#ocsvqxalrs .gt_indent_5 {
  text-indent: 25px;
}
</style>
<div class="inline-table"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>Weighted total (N)</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>Weighted Count</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>95%CI</strong></th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">arrived</td>
<td class="gt_row gt_center">1,482,457</td>
<td class="gt_row gt_center">761,799 (51%)</td>
<td class="gt_row gt_center">40.9-61.7</td>
</tr>
<tr>
<td class="gt_row gt_left">left</td>
<td class="gt_row gt_center">1,482,457</td>
<td class="gt_row gt_center">701,199 (47%)</td>
<td class="gt_row gt_center">39.2-55.5</td>
</tr>
<tr>
<td class="gt_row gt_left">died</td>
<td class="gt_row gt_center">1,482,457</td>
<td class="gt_row gt_center">76,213 (5.1%)</td>
<td class="gt_row gt_center">2.1-12.1</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr>
<td class="gt_footnote" colspan="4">
<sup class="gt_footnote_marks">1</sup> n (%)</td>
    </tr></tfoot>
</table></div>
</div>
<!-- ======================================================= -->
</div>
</div>
<div id="重み付けされた比率" class="section level2" number="26.9">
<h2>
<span class="header-section-number">26.9</span> 重み付けされた比率<a class="anchor" aria-label="anchor" href="#%E9%87%8D%E3%81%BF%E4%BB%98%E3%81%91%E3%81%95%E3%82%8C%E3%81%9F%E6%AF%94%E7%8E%87"><i class="fas fa-link"></i></a>
</h2>
<p>重み付けされた比率（例えば死亡率のような）については同様に、<strong>survey</strong> パッケージや <strong>srvyr</strong> パッケージを使うことができます。さらに、複数の変数を反復処理する関数（前のセクションのものと同様）を書くこともできます。上記のように <strong>gtsummary</strong> パッケージのための関数を作れますが、現在のところ相当の処理を行う関数はパッケージにありません。</p>
<div id="survey-パッケージ-2" class="section level3" number="26.9.1">
<h3>
<span class="header-section-number">26.9.1</span> <strong>Survey</strong> パッケージ<a class="anchor" aria-label="anchor" href="#survey-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu">svyratio</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, </span>
<span>         denominator <span class="op">=</span> <span class="op">~</span><span class="va">obstime</span>, </span>
<span>         design <span class="op">=</span> <span class="va">base_survey_design</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">ratio</span><span class="op">$</span><span class="va">ratio</span> <span class="op">*</span> <span class="fl">10000</span>, </span>
<span>  <span class="va">ci</span> <span class="op">*</span> <span class="fl">10000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code>##       obstime    2.5 %   97.5 %
## died 5.981922 1.194294 10.76955</code></pre>
</div>
<div id="srvyr-パッケージ-2" class="section level3" number="26.9.2">
<h3>
<span class="header-section-number">26.9.2</span> <strong>Srvyr</strong> パッケージ<a class="anchor" aria-label="anchor" href="#srvyr-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">## 観察期間を考慮した死亡率</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    mortality <span class="op">=</span> <span class="fu">survey_ratio</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">died</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10000</span>, </span>
<span>      <span class="va">obstime</span>, </span>
<span>      vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   mortality mortality_low mortality_upp
##       &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1      5.98         0.349          11.6</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="参考資料-18" class="section level2" number="26.10">
<h2>
<span class="header-section-number">26.10</span> 参考資料<a class="anchor" aria-label="anchor" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-18"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://stats.idre.ucla.edu/r/seminars/survey-data-analysis-with-r/">UCLA 統計ページ</a></p>
<p><a href="http://asdfree.com/">アンケートデータを無料で分析</a></p>
<p><a href="http://gdfe.co/srvyr/">srvyr パッケージ</a></p>
<p><a href="http://www.danieldsjoberg.com/gtsummary/reference/index.html">gtsummary パッケージ</a></p>
<p><a href="https://github.com/EPIET/RapidAssessmentSurveys">EPIET 調査のケーススタディ</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="contact-tracing.html"><span class="header-section-number">25</span> 接触者の追跡</a></div>
<div class="next"><a href="survival-analysis.html"><span class="header-section-number">27</span> 生存時間解析</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#survey-analysis"><span class="header-section-number">26</span> 標本調査データ分析</a></li>
<li><a class="nav-link" href="#%E6%A6%82%E8%A6%81-3"><span class="header-section-number">26.1</span> 概要</a></li>
<li>
<a class="nav-link" href="#%E6%BA%96%E5%82%99-16"><span class="header-section-number">26.2</span> 準備</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-2">パッケージ</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BF-2">データの読み込み</a></li>
<li><a class="nav-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%89%8D%E5%87%A6%E7%90%86%E3%83%87%E3%83%BC%E3%82%BF%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0">データの前処理（データクリーニング）</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E8%AA%BF%E6%9F%BB%E3%83%87%E3%83%BC%E3%82%BF"><span class="header-section-number">26.3</span> 調査データ</a></li>
<li><a class="nav-link" href="#%E8%A6%B3%E5%AF%9F%E6%9C%9F%E9%96%93"><span class="header-section-number">26.4</span> 観察期間</a></li>
<li><a class="nav-link" href="#%E8%AA%BF%E6%9F%BB%E3%81%AE%E9%87%8D%E3%81%BF%E4%BB%98%E3%81%91"><span class="header-section-number">26.5</span> 調査の重み付け</a></li>
<li>
<a class="nav-link" href="#%E8%AA%BF%E6%9F%BB%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88"><span class="header-section-number">26.6</span> 調査デザインオブジェクト</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#survey-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><span class="header-section-number">26.6.1</span> Survey パッケージ</a></li>
<li><a class="nav-link" href="#srvyr-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><span class="header-section-number">26.6.2</span> Srvyr パッケージ</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E8%A8%98%E8%BF%B0%E7%9A%84%E5%88%86%E6%9E%90"><span class="header-section-number">26.7</span> 記述的分析</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#%E6%A8%99%E6%9C%AC%E6%8A%BD%E5%87%BA%E3%81%AE%E3%83%90%E3%82%A4%E3%82%A2%E3%82%B9"><span class="header-section-number">26.7.1</span> 標本抽出のバイアス</a></li>
<li><a class="nav-link" href="#%E4%BA%BA%E5%8F%A3%E7%B5%B1%E8%A8%88%E3%83%94%E3%83%A9%E3%83%9F%E3%83%83%E3%83%89"><span class="header-section-number">26.7.2</span> 人口統計ピラミッド</a></li>
<li><a class="nav-link" href="#%E6%B2%96%E7%A9%8D%E5%9B%B3%E3%82%B5%E3%83%B3%E3%82%AD%E3%83%BC%E3%83%80%E3%82%A4%E3%82%A2%E3%82%B0%E3%83%A9%E3%83%A0"><span class="header-section-number">26.7.3</span> 沖積図・サンキーダイアグラム</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E9%87%8D%E3%81%BF%E4%BB%98%E3%81%91%E3%81%95%E3%82%8C%E3%81%9F%E4%BA%BA%E5%8F%A3%E6%AF%94%E7%8E%87"><span class="header-section-number">26.8</span> 重み付けされた人口比率</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#survey-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-1"><span class="header-section-number">26.8.1</span> Survey パッケージ</a></li>
<li><a class="nav-link" href="#srvyr-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-1"><span class="header-section-number">26.8.2</span> Srvyr パッケージ</a></li>
<li><a class="nav-link" href="#sitrep-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><span class="header-section-number">26.8.3</span> Sitrep パッケージ</a></li>
<li><a class="nav-link" href="#gtsummary-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8"><span class="header-section-number">26.8.4</span> Gtsummary パッケージ</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#%E9%87%8D%E3%81%BF%E4%BB%98%E3%81%91%E3%81%95%E3%82%8C%E3%81%9F%E6%AF%94%E7%8E%87"><span class="header-section-number">26.9</span> 重み付けされた比率</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#survey-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-2"><span class="header-section-number">26.9.1</span> Survey パッケージ</a></li>
<li><a class="nav-link" href="#srvyr-%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8-2"><span class="header-section-number">26.9.2</span> Srvyr パッケージ</a></li>
</ul>
</li>
<li><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99-18"><span class="header-section-number">26.10</span> 参考資料</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>疫学のための R ハンドブック</strong>" was written by the handbook team. It was last built on 2022-10-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
